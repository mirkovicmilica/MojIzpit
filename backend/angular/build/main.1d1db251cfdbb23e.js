(self.webpackChunkDemo=self.webpackChunkDemo||[]).push([[792],{126:(vn,Ee,nt)=>{"use strict";function ve(t){return"function"==typeof t}function _e(t){const e=t(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const ct=_e(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function te(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class pe{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const i of e)i.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(ve(r))try{r()}catch(i){n=i instanceof ct?i.errors:[i]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const i of o)try{Ne(i)}catch(a){n=n??[],a instanceof ct?n=[...n,...a.errors]:n.push(a)}}if(n)throw new ct(n)}}add(n){var e;if(n&&n!==this)if(this.closed)Ne(n);else{if(n instanceof pe){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&te(e,n)}remove(n){const{_finalizers:e}=this;e&&te(e,n),n instanceof pe&&n._removeParent(this)}}pe.EMPTY=(()=>{const t=new pe;return t.closed=!0,t})();const Ge=pe.EMPTY;function ye(t){return t instanceof pe||t&&"closed"in t&&ve(t.remove)&&ve(t.add)&&ve(t.unsubscribe)}function Ne(t){ve(t)?t():t.unsubscribe()}const oe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},st={setTimeout(t,n,...e){const{delegate:r}=st;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=st;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Qe(t){st.setTimeout(()=>{const{onUnhandledError:n}=oe;if(!n)throw t;n(t)})}function Oe(){}const be=rt("C",void 0,void 0);function rt(t,n,e){return{kind:t,value:n,error:e}}let Dt=null;function Lt(t){if(oe.useDeprecatedSynchronousErrorHandling){const n=!Dt;if(n&&(Dt={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:r}=Dt;if(Dt=null,e)throw r}}else t()}class He extends pe{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,ye(n)&&n.add(this)):this.destination=vt}static create(n,e,r){return new Tt(n,e,r)}next(n){this.isStopped?fn(function Ve(t){return rt("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?fn(function we(t){return rt("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?fn(be,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ze=Function.prototype.bind;function fe(t,n){return ze.call(t,n)}class We{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){ut(r)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){ut(r)}else ut(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){ut(e)}}}class Tt extends He{constructor(n,e,r){let o;if(super(),ve(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&oe.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&fe(n.next,i),error:n.error&&fe(n.error,i),complete:n.complete&&fe(n.complete,i)}):o=n}this.destination=new We(o)}}function ut(t){oe.useDeprecatedSynchronousErrorHandling?function ht(t){oe.useDeprecatedSynchronousErrorHandling&&Dt&&(Dt.errorThrown=!0,Dt.error=t)}(t):Qe(t)}function fn(t,n){const{onStoppedNotification:e}=oe;e&&st.setTimeout(()=>e(t,n))}const vt={closed:!0,next:Oe,error:function tn(t){throw t},complete:Oe},Kn="function"==typeof Symbol&&Symbol.observable||"@@observable";function qt(t){return t}function Hn(t){return 0===t.length?qt:1===t.length?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}let kt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){const i=function En(t){return t&&t instanceof He||function Zn(t){return t&&ve(t.next)&&ve(t.error)&&ve(t.complete)}(t)&&ye(t)}(e)?e:new Tt(e,r,o);return Lt(()=>{const{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=ot(r))((o,i)=>{const a=new Tt({next:s=>{try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[Kn](){return this}pipe(...e){return Hn(e)(this)}toPromise(e){return new(e=ot(e))((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return t.create=n=>new t(n),t})();function ot(t){var n;return null!==(n=t??oe.Promise)&&void 0!==n?n:Promise}const ho=_e(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Nn=(()=>{class t extends kt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new ur(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new ho}next(e){Lt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){Lt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Lt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:o,observers:i}=this;return r||o?Ge:(this.currentObservers=null,i.push(e),new pe(()=>{this.currentObservers=null,te(i,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){const e=new kt;return e.source=this,e}}return t.create=(n,e)=>new ur(n,e),t})();class ur extends Nn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,n)}error(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==r?r:Ge}}function Fn(t){return ve(t?.lift)}function Ht(t){return n=>{if(Fn(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function At(t,n,e,r,o){return new cn(t,n,e,r,o)}class cn extends He{constructor(n,e,r,o,i,a){super(n),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=e?function(s){try{e(s)}catch(u){n.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){n.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){n.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function et(t,n){return Ht((e,r)=>{let o=0;e.subscribe(At(r,i=>{r.next(t.call(n,i,o++))}))})}function Pn(t){return this instanceof Pn?(this.v=t,this):new Pn(t)}function I(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function Li(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(a){return new Promise(function(s,u){!function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}(s,u,(a=t[i](a)).done,a.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const U=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function qe(t){return ve(t?.then)}function De(t){return ve(t[Kn])}function ke(t){return Symbol.asyncIterator&&ve(t?.[Symbol.asyncIterator])}function Bt(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ln=function fi(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function zt(t){return ve(t?.[Ln])}function Yn(t){return function ko(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=e.apply(t,n||[]),i=[];return o=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function a(h){return function(p){return Promise.resolve(p).then(h,d)}}),o[Symbol.asyncIterator]=function(){return this},o;function s(h,p){r[h]&&(o[h]=function(g){return new Promise(function(m,v){i.push([h,g,m,v])>1||u(h,g)})},p&&(o[h]=p(o[h])))}function u(h,p){try{!function c(h){h.value instanceof Pn?Promise.resolve(h.value.v).then(l,d):f(i[0][2],h)}(r[h](p))}catch(g){f(i[0][3],g)}}function l(h){u("next",h)}function d(h){u("throw",h)}function f(h,p){h(p),i.shift(),i.length&&u(i[0][0],i[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:r,done:o}=yield Pn(e.read());if(o)return yield Pn(void 0);yield yield Pn(r)}}finally{e.releaseLock()}})}function mr(t){return ve(t?.getReader)}function hn(t){if(t instanceof kt)return t;if(null!=t){if(De(t))return function Du(t){return new kt(n=>{const e=t[Kn]();if(ve(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(U(t))return function Su(t){return new kt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(qe(t))return function Qn(t){return new kt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Qe)})}(t);if(ke(t))return cr(t);if(zt(t))return function vo(t){return new kt(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(mr(t))return function hi(t){return cr(Yn(t))}(t)}throw Bt(t)}function cr(t){return new kt(n=>{(function Yo(t,n){var e,r,o,i;return function eo(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=I(t);!(r=yield e.next()).done;)if(n.next(r.value),n.closed)return}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function Qo(t,n,e,r=0,o=!1){const i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function kr(t,n,e=1/0){return ve(n)?kr((r,o)=>et((i,a)=>n(r,i,o,a))(hn(t(r,o))),e):("number"==typeof n&&(e=n),Ht((r,o)=>function uF(t,n,e,r,o,i,a,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&n.complete()},h=g=>c<r?p(g):u.push(g),p=g=>{i&&n.next(g),c++;let m=!1;hn(e(g,l++)).subscribe(At(n,v=>{o?.(v),i?h(v):n.next(v)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;u.length&&c<r;){const v=u.shift();a?Qo(n,a,()=>p(v)):p(v)}f()}catch(v){n.error(v)}}))};return t.subscribe(At(n,h,()=>{d=!0,f()})),()=>{s?.()}}(r,o,t,e)))}function Iu(t=1/0){return kr(qt,t)}const ji=new kt(t=>t.complete());function kw(t){return t&&ve(t.schedule)}function Xg(t){return t[t.length-1]}function Rw(t){return ve(Xg(t))?t.pop():void 0}function cl(t){return kw(Xg(t))?t.pop():void 0}function Nw(t,n=0){return Ht((e,r)=>{e.subscribe(At(r,o=>Qo(r,t,()=>r.next(o),n),()=>Qo(r,t,()=>r.complete(),n),o=>Qo(r,t,()=>r.error(o),n)))})}function Fw(t,n=0){return Ht((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function Ow(t,n){if(!t)throw new Error("Iterable cannot be null");return new kt(e=>{Qo(e,n,()=>{const r=t[Symbol.asyncIterator]();Qo(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function vr(t,n){return n?function mF(t,n){if(null!=t){if(De(t))return function dF(t,n){return hn(t).pipe(Fw(n),Nw(n))}(t,n);if(U(t))return function hF(t,n){return new kt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}(t,n);if(qe(t))return function fF(t,n){return hn(t).pipe(Fw(n),Nw(n))}(t,n);if(ke(t))return Ow(t,n);if(zt(t))return function pF(t,n){return new kt(e=>{let r;return Qo(e,n,()=>{r=t[Ln](),Qo(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){return void e.error(a)}i?e.complete():e.next(o)},0,!0)}),()=>ve(r?.return)&&r.return()})}(t,n);if(mr(t))return function gF(t,n){return Ow(Yn(t),n)}(t,n)}throw Bt(t)}(t,n):hn(t)}class Jo extends Nn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function lt(...t){return vr(t,cl(t))}function Pw(t={}){const{connector:n=(()=>new Nn),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return i=>{let a,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},h=()=>{f(),a=u=void 0,l=d=!1},p=()=>{const g=a;h(),g?.unsubscribe()};return Ht((g,m)=>{c++,!d&&!l&&f();const v=u=u??n();m.add(()=>{c--,0===c&&!d&&!l&&(s=Kg(p,o))}),v.subscribe(m),!a&&c>0&&(a=new Tt({next:b=>v.next(b),error:b=>{d=!0,f(),s=Kg(h,e,b),v.error(b)},complete:()=>{l=!0,f(),s=Kg(h,r),v.complete()}}),hn(g).subscribe(a))})(i)}}function Kg(t,n,...e){if(!0===n)return void t();if(!1===n)return;const r=new Tt({next:()=>{r.unsubscribe(),t()}});return hn(n(...e)).subscribe(r)}function pi(t,n){return Ht((e,r)=>{let o=null,i=0,a=!1;const s=()=>a&&!o&&r.complete();e.subscribe(At(r,u=>{o?.unsubscribe();let c=0;const l=i++;hn(t(u,l)).subscribe(o=At(r,d=>r.next(n?n(u,d,l,c++):d),()=>{o=null,s()}))},()=>{a=!0,s()}))})}function bF(t,n){return t===n}function pn(t){for(let n in t)if(t[n]===pn)return n;throw Error("Could not find renamed property on target object.")}function Cf(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function yr(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(yr).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function Zg(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const _F=pn({__forward_ref__:pn});function Dn(t){return t.__forward_ref__=Dn,t.toString=function(){return yr(this())},t}function pt(t){return Yg(t)?t():t}function Yg(t){return"function"==typeof t&&t.hasOwnProperty(_F)&&t.__forward_ref__===Dn}function Qg(t){return t&&!!t.\u0275providers}const Lw="https://g.co/ng/security#xss";class de extends Error{constructor(n,e){super(function Ef(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,e)),this.code=n}}function yt(t){return"string"==typeof t?t:null==t?"":String(t)}function Jg(t,n){throw new de(-201,!1)}function ei(t,n){null==t&&function dt(t,n,e,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${e} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function Je(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function ti(t){return{providers:t.providers||[],imports:t.imports||[]}}function Df(t){return Bw(t,If)||Bw(t,jw)}function Bw(t,n){return t.hasOwnProperty(n)?t[n]:null}function Sf(t){return t&&(t.hasOwnProperty(em)||t.hasOwnProperty(AF))?t[em]:null}const If=pn({\u0275prov:pn}),em=pn({\u0275inj:pn}),jw=pn({ngInjectableDef:pn}),AF=pn({ngInjectorDef:pn});var jt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(jt||{});let tm;function yo(t){const n=tm;return tm=t,n}function Uw(t,n,e){const r=Df(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&jt.Optional?null:void 0!==n?n:void Jg(yr(t))}const Sn=globalThis;class Me{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Je({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const ll={},am="__NG_DI_FLAG__",Af="ngTempTokenPath",kF=/\n/gm,zw="__source";let Au;function rs(t){const n=Au;return Au=t,n}function FF(t,n=jt.Default){if(void 0===Au)throw new de(-203,!1);return null===Au?Uw(t,void 0,n):Au.get(t,n&jt.Optional?null:void 0,n)}function Ue(t,n=jt.Default){return(function Vw(){return tm}()||FF)(pt(t),n)}function Te(t,n=jt.Default){return Ue(t,Mf(n))}function Mf(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function sm(t){const n=[];for(let e=0;e<t.length;e++){const r=pt(t[e]);if(Array.isArray(r)){if(0===r.length)throw new de(900,!1);let o,i=jt.Default;for(let a=0;a<r.length;a++){const s=r[a],u=OF(s);"number"==typeof u?-1===u?o=s.token:i|=u:o=s}n.push(Ue(o,i))}else n.push(Ue(r))}return n}function dl(t,n){return t[am]=n,t.prototype[am]=n,t}function OF(t){return t[am]}function ya(t){return{toString:t}.toString()}var Tf=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Tf||{}),gi=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(gi||{});const Vi={},nn=[],kf=pn({\u0275cmp:pn}),um=pn({\u0275dir:pn}),cm=pn({\u0275pipe:pn}),$w=pn({\u0275mod:pn}),ba=pn({\u0275fac:pn}),fl=pn({__NG_ELEMENT_ID__:pn}),Gw=pn({__NG_ENV_ID__:pn});function qw(t,n,e){let r=t.length;for(;;){const o=t.indexOf(n,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}function lm(t,n,e){let r=0;for(;r<e.length;){const o=e[r];if("number"==typeof o){if(0!==o)break;r++;const i=e[r++],a=e[r++],s=e[r++];t.setAttribute(n,a,s,i)}else{const i=o,a=e[++r];Kw(i)?t.setProperty(n,i,a):t.setAttribute(n,i,a),r++}}return r}function Xw(t){return 3===t||4===t||6===t}function Kw(t){return 64===t.charCodeAt(0)}function hl(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){const o=n[r];"number"==typeof o?e=o:0===e||Zw(t,e,o,null,-1===e||2===e?n[++r]:null)}}return t}function Zw(t,n,e,r,o){let i=0,a=t.length;if(-1===n)a=-1;else for(;i<t.length;){const s=t[i++];if("number"==typeof s){if(s===n){a=-1;break}if(s>n){a=i-1;break}}}for(;i<t.length;){const s=t[i];if("number"==typeof s)break;if(s===e){if(null===r)return void(null!==o&&(t[i+1]=o));if(r===t[i+1])return void(t[i+2]=o)}i++,null!==r&&i++,null!==o&&i++}-1!==a&&(t.splice(a,0,n),i=a+1),t.splice(i++,0,e),null!==r&&t.splice(i++,0,r),null!==o&&t.splice(i++,0,o)}const Yw="ng-template";function BF(t,n,e){let r=0,o=!0;for(;r<t.length;){let i=t[r++];if("string"==typeof i&&o){const a=t[r++];if(e&&"class"===i&&-1!==qw(a.toLowerCase(),n,0))return!0}else{if(1===i){for(;r<t.length&&"string"==typeof(i=t[r++]);)if(i.toLowerCase()===n)return!0;return!1}"number"==typeof i&&(o=!1)}}return!1}function Qw(t){return 4===t.type&&t.value!==Yw}function jF(t,n,e){return n===(4!==t.type||e?t.value:Yw)}function VF(t,n,e){let r=4;const o=t.attrs||[],i=function zF(t){for(let n=0;n<t.length;n++)if(Xw(t[n]))return n;return t.length}(o);let a=!1;for(let s=0;s<n.length;s++){const u=n[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!jF(t,u,e)||""===u&&1===n.length){if(mi(r))return!1;a=!0}}else{const c=8&r?u:n[++s];if(8&r&&null!==t.attrs){if(!BF(t.attrs,c,e)){if(mi(r))return!1;a=!0}continue}const d=UF(8&r?"class":u,o,Qw(t),e);if(-1===d){if(mi(r))return!1;a=!0;continue}if(""!==c){let f;f=d>i?"":o[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==qw(h,c,0)||2&r&&c!==f){if(mi(r))return!1;a=!0}}}}else{if(!a&&!mi(r)&&!mi(u))return!1;if(a&&mi(u))continue;a=!1,r=u|1&r}}return mi(r)||a}function mi(t){return 0==(1&t)}function UF(t,n,e,r){if(null===n)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){const a=n[o];if(a===t)return o;if(3===a||6===a)i=!0;else{if(1===a||2===a){let s=n[++o];for(;"string"==typeof s;)s=n[++o];continue}if(4===a)break;if(0===a){o+=4;continue}}o+=i?1:2}return-1}return function WF(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const r=t[e];if("number"==typeof r)return-1;if(r===n)return e;e++}return-1}(n,t)}function Jw(t,n,e=!1){for(let r=0;r<n.length;r++)if(VF(t,n[r],e))return!0;return!1}function e1(t,n){return t?":not("+n.trim()+")":n}function GF(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let a=t[e];if("string"==typeof a)if(2&r){const s=t[++e];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?o+="."+a:4&r&&(o+=" "+a);else""!==o&&!mi(a)&&(n+=e1(i,o),o=""),r=a,i=i||!mi(r);e++}return""!==o&&(n+=e1(i,o)),n}function vi(t){return ya(()=>{const n=n1(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Tf.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||gi.Emulated,styles:t.styles||nn,_:null,schemas:t.schemas||null,tView:null,id:""};r1(e);const r=t.dependencies;return e.directiveDefs=Rf(r,!1),e.pipeDefs=Rf(r,!0),e.id=function eO(t){let n=0;const e=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const o of e)n=Math.imul(31,n)+o.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(e),e})}function ZF(t){return Kt(t)||Rr(t)}function YF(t){return null!==t}function yi(t){return ya(()=>({type:t.type,bootstrap:t.bootstrap||nn,declarations:t.declarations||nn,imports:t.imports||nn,exports:t.exports||nn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function t1(t,n){if(null==t)return Vi;const e={};for(const r in t)if(t.hasOwnProperty(r)){let o=t[r],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),e[o]=r,n&&(n[o]=i)}return e}function gt(t){return ya(()=>{const n=n1(t);return r1(n),n})}function Kt(t){return t[kf]||null}function Rr(t){return t[um]||null}function to(t){return t[cm]||null}function No(t,n){const e=t[$w]||null;if(!e&&!0===n)throw new Error(`Type ${yr(t)} does not have '\u0275mod' property.`);return e}function n1(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||Vi,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||nn,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:t1(t.inputs,n),outputs:t1(t.outputs)}}function r1(t){t.features?.forEach(n=>n(t))}function Rf(t,n){if(!t)return null;const e=n?to:ZF;return()=>("function"==typeof t?t():t).map(r=>e(r)).filter(YF)}const Jn=0,Se=1,St=2,jn=3,bi=4,pl=5,Wr=6,Tu=7,or=8,os=9,ku=10,bt=11,gl=12,o1=13,Ru=14,ir=15,ml=16,Nu=17,Ui=18,vl=19,i1=20,is=21,_a=22,yl=23,bl=24,Vt=25,dm=1,a1=2,Hi=7,Fu=9,Nr=11;function _o(t){return Array.isArray(t)&&"object"==typeof t[dm]}function no(t){return Array.isArray(t)&&!0===t[dm]}function fm(t){return 0!=(4&t.flags)}function Ls(t){return t.componentOffset>-1}function Ff(t){return 1==(1&t.flags)}function _i(t){return!!t.template}function hm(t){return 0!=(512&t[St])}function Bs(t,n){return t.hasOwnProperty(ba)?t[ba]:null}let Fr=null,Of=!1;function ni(t){const n=Fr;return Fr=t,n}const c1={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function d1(t){if(!wl(t)||t.dirty){if(!t.producerMustRecompute(t)&&!p1(t))return void(t.dirty=!1);t.producerRecomputeValue(t),t.dirty=!1}}function h1(t){t.dirty=!0,function f1(t){if(void 0===t.liveConsumerNode)return;const n=Of;Of=!0;try{for(const e of t.liveConsumerNode)e.dirty||h1(e)}finally{Of=n}}(t),t.consumerMarkedDirty?.(t)}function gm(t){return t&&(t.nextProducerIndex=0),ni(t)}function mm(t,n){if(ni(n),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(wl(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Pf(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function p1(t){Ou(t);for(let n=0;n<t.producerNode.length;n++){const e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(d1(e),r!==e.version))return!0}return!1}function g1(t){if(Ou(t),wl(t))for(let n=0;n<t.producerNode.length;n++)Pf(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Pf(t,n){if(function v1(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),Ou(t),1===t.liveConsumerNode.length)for(let r=0;r<t.producerNode.length;r++)Pf(t.producerNode[r],t.producerIndexOfThis[r]);const e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){const r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];Ou(o),o.producerIndexOfThis[r]=n}}function wl(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Ou(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let y1=null;const x1=()=>{},hO=(()=>({...c1,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule(t.ref)},hasRun:!1,cleanupFn:x1}))();class pO{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function ri(){return C1}function C1(t){return t.type.prototype.ngOnChanges&&(t.setInput=mO),gO}function gO(){const t=D1(this),n=t?.current;if(n){const e=t.previous;if(e===Vi)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function mO(t,n,e,r){const o=this.declaredInputs[e],i=D1(t)||function vO(t,n){return t[E1]=n}(t,{previous:Vi,current:null}),a=i.current||(i.current={}),s=i.previous,u=s[o];a[o]=new pO(u&&u.currentValue,n,s===Vi),t[r]=n}ri.ngInherit=!0;const E1="__ngSimpleChanges__";function D1(t){return t[E1]||null}const zi=function(t,n,e){};function In(t){for(;Array.isArray(t);)t=t[Jn];return t}function Lf(t,n){return In(n[t])}function wo(t,n){return In(n[t.index])}function A1(t,n){return t.data[n]}function Fo(t,n){const e=n[t];return _o(e)?e:e[Jn]}function ss(t,n){return null==n?null:t[n]}function M1(t){t[Nu]=0}function CO(t){1024&t[St]||(t[St]|=1024,k1(t,1))}function T1(t){1024&t[St]&&(t[St]&=-1025,k1(t,-1))}function k1(t,n){let e=t[jn];if(null===e)return;e[pl]+=n;let r=e;for(e=e[jn];null!==e&&(1===n&&1===r[pl]||-1===n&&0===r[pl]);)e[pl]+=n,r=e,e=e[jn]}const ft={lFrame:H1(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function F1(){return ft.bindingsEnabled}function re(){return ft.lFrame.lView}function Zt(){return ft.lFrame.tView}function wt(t){return ft.lFrame.contextLView=t,t[or]}function xt(t){return ft.lFrame.contextLView=null,t}function Or(){let t=O1();for(;null!==t&&64===t.type;)t=t.parent;return t}function O1(){return ft.lFrame.currentTNode}function Wi(t,n){const e=ft.lFrame;e.currentTNode=t,e.isParent=n}function wm(){return ft.lFrame.isParent}function xm(){ft.lFrame.isParent=!1}function wa(){return ft.lFrame.bindingIndex}function Bu(){return ft.lFrame.bindingIndex++}function xa(t){const n=ft.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function OO(t,n){const e=ft.lFrame;e.bindingIndex=e.bindingRootIndex=t,Cm(n)}function Cm(t){ft.lFrame.currentDirectiveIndex=t}function Dm(t){ft.lFrame.currentQueryIndex=t}function LO(t){const n=t[Se];return 2===n.type?n.declTNode:1===n.type?t[Wr]:null}function V1(t,n,e){if(e&jt.SkipSelf){let o=n,i=t;for(;!(o=o.parent,null!==o||e&jt.Host||(o=LO(i),null===o||(i=i[Ru],10&o.type))););if(null===o)return!1;n=o,t=i}const r=ft.lFrame=U1();return r.currentTNode=n,r.lView=t,!0}function Sm(t){const n=U1(),e=t[Se];ft.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function U1(){const t=ft.lFrame,n=null===t?null:t.child;return null===n?H1(t):n}function H1(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function z1(){const t=ft.lFrame;return ft.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const W1=z1;function Im(){const t=z1();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function oo(){return ft.lFrame.selectedIndex}function js(t){ft.lFrame.selectedIndex=t}function zn(){const t=ft.lFrame;return A1(t.tView,t.selectedIndex)}let G1=!0;function Bf(){return G1}function us(t){G1=t}function jf(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){const i=t.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(t.contentHooks??=[]).push(-e,a),s&&((t.contentHooks??=[]).push(e,s),(t.contentCheckHooks??=[]).push(e,s)),u&&(t.viewHooks??=[]).push(-e,u),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),null!=l&&(t.destroyHooks??=[]).push(e,l)}}function Vf(t,n,e){q1(t,n,3,e)}function Uf(t,n,e,r){(3&t[St])===e&&q1(t,n,e,r)}function Am(t,n){let e=t[St];(3&e)===n&&(e&=8191,e+=1,t[St]=e)}function q1(t,n,e,r){const i=r??-1,a=n.length-1;let s=0;for(let u=void 0!==r?65535&t[Nu]:0;u<a;u++)if("number"==typeof n[u+1]){if(s=n[u],null!=r&&s>=r)break}else n[u]<0&&(t[Nu]+=65536),(s<i||-1==i)&&($O(t,e,n,u),t[Nu]=(4294901760&t[Nu])+u+2),u++}function X1(t,n){zi(4,t,n);const e=ni(null);try{n.call(t)}finally{ni(e),zi(5,t,n)}}function $O(t,n,e,r){const o=e[r]<0,i=e[r+1],s=t[o?-e[r]:e[r]];o?t[St]>>13<t[Nu]>>16&&(3&t[St])===n&&(t[St]+=8192,X1(s,i)):X1(s,i)}const ju=-1;class Cl{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function Tm(t){return t!==ju}function El(t){return 32767&t}function Dl(t,n){let e=function KO(t){return t>>16}(t),r=n;for(;e>0;)r=r[Ru],e--;return r}let km=!0;function Hf(t){const n=km;return km=t,n}const K1=255,Z1=5;let ZO=0;const $i={};function zf(t,n){const e=Y1(t,n);if(-1!==e)return e;const r=n[Se];r.firstCreatePass&&(t.injectorIndex=n.length,Rm(r.data,t),Rm(n,null),Rm(r.blueprint,null));const o=Wf(t,n),i=t.injectorIndex;if(Tm(o)){const a=El(o),s=Dl(o,n),u=s[Se].data;for(let c=0;c<8;c++)n[i+c]=s[a+c]|u[a+c]}return n[i+8]=o,i}function Rm(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Y1(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Wf(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;null!==o;){if(r=ox(o),null===r)return ju;if(e++,o=o[Ru],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return ju}function Nm(t,n,e){!function YO(t,n,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(fl)&&(r=e[fl]),null==r&&(r=e[fl]=ZO++);const o=r&K1;n.data[t+(o>>Z1)]|=1<<o}(t,n,e)}function Q1(t,n,e){if(e&jt.Optional||void 0!==t)return t;Jg()}function J1(t,n,e,r){if(e&jt.Optional&&void 0===r&&(r=null),!(e&(jt.Self|jt.Host))){const o=t[os],i=yo(void 0);try{return o?o.get(n,r,e&jt.Optional):Uw(n,r,e&jt.Optional)}finally{yo(i)}}return Q1(r,0,e)}function ex(t,n,e,r=jt.Default,o){if(null!==t){if(2048&n[St]&&!(r&jt.Self)){const a=function rP(t,n,e,r,o){let i=t,a=n;for(;null!==i&&null!==a&&2048&a[St]&&!(512&a[St]);){const s=tx(i,a,e,r|jt.Self,$i);if(s!==$i)return s;let u=i.parent;if(!u){const c=a[i1];if(c){const l=c.get(e,$i,r);if(l!==$i)return l}u=ox(a),a=a[Ru]}i=u}return o}(t,n,e,r,$i);if(a!==$i)return a}const i=tx(t,n,e,r,$i);if(i!==$i)return i}return J1(n,e,r,o)}function tx(t,n,e,r,o){const i=function eP(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(fl)?t[fl]:void 0;return"number"==typeof n?n>=0?n&K1:nP:n}(e);if("function"==typeof i){if(!V1(n,t,r))return r&jt.Host?Q1(o,0,r):J1(n,e,r,o);try{let a;if(a=i(r),null!=a||r&jt.Optional)return a;Jg()}finally{W1()}}else if("number"==typeof i){let a=null,s=Y1(t,n),u=ju,c=r&jt.Host?n[ir][Wr]:null;for((-1===s||r&jt.SkipSelf)&&(u=-1===s?Wf(t,n):n[s+8],u!==ju&&rx(r,!1)?(a=n[Se],s=El(u),n=Dl(u,n)):s=-1);-1!==s;){const l=n[Se];if(nx(i,s,l.data)){const d=JO(s,n,e,a,r,c);if(d!==$i)return d}u=n[s+8],u!==ju&&rx(r,n[Se].data[s+8]===c)&&nx(i,s,n)?(a=l,s=El(u),n=Dl(u,n)):s=-1}}return o}function JO(t,n,e,r,o,i){const a=n[Se],s=a.data[t+8],l=function $f(t,n,e,r,o){const i=t.providerIndexes,a=n.data,s=1048575&i,u=t.directiveStart,l=i>>20,f=o?s+l:t.directiveEnd;for(let h=r?s:s+l;h<f;h++){const p=a[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(o){const h=a[u];if(h&&_i(h)&&h.type===e)return u}return null}(s,a,e,null==r?Ls(s)&&km:r!=a&&0!=(3&s.type),o&jt.Host&&i===s);return null!==l?Vs(n,a,l,s):$i}function Vs(t,n,e,r){let o=t[e];const i=n.data;if(function GO(t){return t instanceof Cl}(o)){const a=o;a.resolving&&function wF(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new de(-200,`Circular dependency in DI detected for ${t}${e}`)}(function dn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():yt(t)}(i[e]));const s=Hf(a.canSeeViewProviders);a.resolving=!0;const c=a.injectImpl?yo(a.injectImpl):null;V1(t,r,jt.Default);try{o=t[e]=a.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&function WO(t,n,e){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){const a=C1(n);(e.preOrderHooks??=[]).push(t,a),(e.preOrderCheckHooks??=[]).push(t,a)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}(e,i[e],n)}finally{null!==c&&yo(c),Hf(s),a.resolving=!1,W1()}}return o}function nx(t,n,e){return!!(e[n+(t>>Z1)]&1<<t)}function rx(t,n){return!(t&jt.Self||t&jt.Host&&n)}class io{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return ex(this._tNode,this._lView,n,Mf(r),e)}}function nP(){return new io(Or(),re())}function Pr(t){return ya(()=>{const n=t.prototype.constructor,e=n[ba]||Fm(n),r=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){const i=o[ba]||Fm(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function Fm(t){return Yg(t)?()=>{const n=Fm(pt(t));return n&&n()}:Bs(t)}function ox(t){const n=t[Se],e=n.type;return 2===e?n.declTNode:1===e?t[Wr]:null}const Uu="__parameters__";function zu(t,n,e){return ya(()=>{const r=function Om(t){return function(...e){if(t){const r=t(...e);for(const o in r)this[o]=r[o]}}}(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;const a=new o(...i);return s.annotation=a,s;function s(u,c,l){const d=u.hasOwnProperty(Uu)?u[Uu]:Object.defineProperty(u,Uu,{value:[]})[Uu];for(;d.length<=l;)d.push(null);return(d[l]=d[l]||[]).push(a),u}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}function $u(t,n){t.forEach(e=>Array.isArray(e)?$u(e,n):n(e))}function ax(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function qf(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function Oo(t,n,e){let r=Gu(t,n);return r>=0?t[1|r]=e:(r=~r,function lP(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(1===o)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;)t[o]=t[o-2],o--;t[n]=e,t[n+1]=r}}(t,r,n,e)),r}function Pm(t,n){const e=Gu(t,n);if(e>=0)return t[1|e]}function Gu(t,n){return function sx(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){const i=r+(o-r>>1),a=t[i<<e];if(n===a)return i<<e;a>n?o=i:r=i+1}return~(o<<e)}(t,n,1)}const Kf=dl(zu("Optional"),8),Zf=dl(zu("SkipSelf"),4);function th(t){return 128==(128&t.flags)}var cs=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(cs||{});const kP=/^>|^->|<!--|-->|--!>|<!-$/g,RP=/(<|>)/g,NP="\u200b$1\u200b";const Um=new Map;let FP=0;const zm="__ngContext__";function $r(t,n){_o(n)?(t[zm]=n[vl],function PP(t){Um.set(t[vl],t)}(n)):t[zm]=n}let Wm;function $m(t,n){return Wm(t,n)}function kl(t){const n=t[jn];return no(n)?n[jn]:n}function Ix(t){return Mx(t[gl])}function Ax(t){return Mx(t[bi])}function Mx(t){for(;null!==t&&!no(t);)t=t[bi];return t}function Ku(t,n,e,r,o){if(null!=r){let i,a=!1;no(r)?i=r:_o(r)&&(a=!0,r=r[Jn]);const s=In(r);0===t&&null!==e?null==o?Nx(n,e,s):Us(n,e,s,o||null,!0):1===t&&null!==e?Us(n,e,s,o||null,!0):2===t?function uh(t,n,e){const r=ah(t,n);r&&function tL(t,n,e,r){t.removeChild(n,e,r)}(t,r,n,e)}(n,s,a):3===t&&n.destroyNode(s),null!=i&&function oL(t,n,e,r,o){const i=e[Hi];i!==In(e)&&Ku(n,t,r,i,o);for(let s=Nr;s<e.length;s++){const u=e[s];Nl(u[Se],u,t,n,r,i)}}(n,t,i,e,o)}}function Gm(t,n){return t.createComment(function bx(t){return t.replace(kP,n=>n.replace(RP,NP))}(n))}function oh(t,n,e){return t.createElement(n,e)}function kx(t,n){const e=t[Fu],r=e.indexOf(n);T1(n),e.splice(r,1)}function ih(t,n){if(t.length<=Nr)return;const e=Nr+n,r=t[e];if(r){const o=r[ml];null!==o&&o!==t&&kx(o,r),n>0&&(t[e-1][bi]=r[bi]);const i=qf(t,Nr+n);!function qP(t,n){Nl(t,n,n[bt],2,null,null),n[Jn]=null,n[Wr]=null}(r[Se],r);const a=i[Ui];null!==a&&a.detachView(i[Se]),r[jn]=null,r[bi]=null,r[St]&=-129}return r}function qm(t,n){if(!(256&n[St])){const e=n[bt];n[yl]&&g1(n[yl]),n[bl]&&g1(n[bl]),e.destroyNode&&Nl(t,n,e,3,null,null),function ZP(t){let n=t[gl];if(!n)return Xm(t[Se],t);for(;n;){let e=null;if(_o(n))e=n[gl];else{const r=n[Nr];r&&(e=r)}if(!e){for(;n&&!n[bi]&&n!==t;)_o(n)&&Xm(n[Se],n),n=n[jn];null===n&&(n=t),_o(n)&&Xm(n[Se],n),e=n&&n[bi]}n=e}}(n)}}function Xm(t,n){if(!(256&n[St])){n[St]&=-129,n[St]|=256,function eL(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let r=0;r<e.length;r+=2){const o=n[e[r]];if(!(o instanceof Cl)){const i=e[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){const s=o[i[a]],u=i[a+1];zi(4,s,u);try{u.call(s)}finally{zi(5,s,u)}}else{zi(4,o,i);try{i.call(o)}finally{zi(5,o,i)}}}}}(t,n),function JP(t,n){const e=t.cleanup,r=n[Tu];if(null!==e)for(let i=0;i<e.length-1;i+=2)if("string"==typeof e[i]){const a=e[i+3];a>=0?r[a]():r[-a].unsubscribe(),i+=2}else e[i].call(r[e[i+1]]);null!==r&&(n[Tu]=null);const o=n[is];if(null!==o){n[is]=null;for(let i=0;i<o.length;i++)(0,o[i])()}}(t,n),1===n[Se].type&&n[bt].destroy();const e=n[ml];if(null!==e&&no(n[jn])){e!==n[jn]&&kx(e,n);const r=n[Ui];null!==r&&r.detachView(t)}!function LP(t){Um.delete(t[vl])}(n)}}function Km(t,n,e){return function Rx(t,n,e){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return e[Jn];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:i}=t.data[r.directiveStart+o];if(i===gi.None||i===gi.Emulated)return null}return wo(r,e)}}(t,n.parent,e)}function Us(t,n,e,r,o){t.insertBefore(n,e,r,o)}function Nx(t,n,e){t.appendChild(n,e)}function Fx(t,n,e,r,o){null!==r?Us(t,n,e,r,o):Nx(t,n,e)}function ah(t,n){return t.parentNode(n)}let Zm,ev,Lx=function Px(t,n,e){return 40&t.type?wo(t,e):null};function sh(t,n,e,r){const o=Km(t,r,n),i=n[bt],s=function Ox(t,n,e){return Lx(t,n,e)}(r.parent||n[Wr],r,n);if(null!=o)if(Array.isArray(e))for(let u=0;u<e.length;u++)Fx(i,o,e[u],s,!1);else Fx(i,o,e,s,!1);void 0!==Zm&&Zm(i,r,n,e,o)}function Rl(t,n){if(null!==n){const e=n.type;if(3&e)return wo(n,t);if(4&e)return Ym(-1,t[n.index]);if(8&e){const r=n.child;if(null!==r)return Rl(t,r);{const o=t[n.index];return no(o)?Ym(-1,o):In(o)}}if(32&e)return $m(n,t)()||In(t[n.index]);{const r=jx(t,n);return null!==r?Array.isArray(r)?r[0]:Rl(kl(t[ir]),r):Rl(t,n.next)}}return null}function jx(t,n){return null!==n?t[ir][Wr].projection[n.projection]:null}function Ym(t,n){const e=Nr+t+1;if(e<n.length){const r=n[e],o=r[Se].firstChild;if(null!==o)return Rl(r,o)}return n[Hi]}function Qm(t,n,e,r,o,i,a){for(;null!=e;){const s=r[e.index],u=e.type;if(a&&0===n&&(s&&$r(In(s),r),e.flags|=2),32!=(32&e.flags))if(8&u)Qm(t,n,e.child,r,o,i,!1),Ku(n,t,o,s,i);else if(32&u){const c=$m(e,r);let l;for(;l=c();)Ku(n,t,o,l,i);Ku(n,t,o,s,i)}else 16&u?Ux(t,n,r,e,o,i):Ku(n,t,o,s,i);e=a?e.projectionNext:e.next}}function Nl(t,n,e,r,o,i){Qm(e,r,t.firstChild,n,o,i,!1)}function Ux(t,n,e,r,o,i){const a=e[ir],u=a[Wr].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)Ku(n,t,o,u[c],i);else{let c=u;const l=a[jn];th(r)&&(c.flags|=128),Qm(t,n,c,l,o,i,!0)}}function Hx(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function zx(t,n,e){const{mergedAttrs:r,classes:o,styles:i}=e;null!==r&&lm(t,n,r),null!==o&&Hx(t,n,o),null!==i&&function aL(t,n,e){t.setAttribute(n,"style",e)}(t,n,i)}class qx{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Lw})`}}function ls(t){return t instanceof qx?t.changingThisBreaksApplicationSecurity:t}const _L=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Qu=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(Qu||{});function fh(t){const n=function Pl(){const t=re();return t&&t[ku].sanitizer}();return n?n.sanitize(Qu.URL,t)||"":function Fl(t,n){const e=function mL(t){return t instanceof qx&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${Lw})`)}return e===n}(t,"URL")?ls(t):function nv(t){return(t=String(t)).match(_L)?t:"unsafe:"+t}(yt(t))}const Ll=new Me("ENVIRONMENT_INITIALIZER"),nC=new Me("INJECTOR",-1),rC=new Me("INJECTOR_DEF_TYPES");class av{get(n,e=ll){if(e===ll){const r=new Error(`NullInjectorError: No provider for ${yr(n)}!`);throw r.name="NullInjectorError",r}return e}}function NL(...t){return{\u0275providers:oC(0,t),\u0275fromNgModule:!0}}function oC(t,...n){const e=[],r=new Set;let o;const i=a=>{e.push(a)};return $u(n,a=>{const s=a;hh(s,i,[],r)&&(o||=[],o.push(s))}),void 0!==o&&iC(o,i),e}function iC(t,n){for(let e=0;e<t.length;e++){const{ngModule:r,providers:o}=t[e];uv(o,i=>{n(i,r)})}}function hh(t,n,e,r){if(!(t=pt(t)))return!1;let o=null,i=Sf(t);const a=!i&&Kt(t);if(i||a){if(a&&!a.standalone)return!1;o=t}else{const u=t.ngModule;if(i=Sf(u),!i)return!1;o=u}const s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){const u="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of u)hh(c,n,e,r)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;r.add(o);try{$u(i.imports,l=>{hh(l,n,e,r)&&(c||=[],c.push(l))})}finally{}void 0!==c&&iC(c,n)}if(!s){const c=Bs(o)||(()=>new o);n({provide:o,useFactory:c,deps:nn},o),n({provide:rC,useValue:o,multi:!0},o),n({provide:Ll,useValue:()=>Ue(o),multi:!0},o)}const u=i.providers;if(null!=u&&!s){const c=t;uv(u,l=>{n(l,c)})}}}return o!==t&&void 0!==t.providers}function uv(t,n){for(let e of t)Qg(e)&&(e=e.\u0275providers),Array.isArray(e)?uv(e,n):n(e)}const FL=pn({provide:String,useValue:pn});function cv(t){return null!==t&&"object"==typeof t&&FL in t}function Hs(t){return"function"==typeof t}const lv=new Me("Set Injector scope."),ph={},PL={};let dv;function gh(){return void 0===dv&&(dv=new av),dv}class Po{}class Ju extends Po{get destroyed(){return this._destroyed}constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hv(n,a=>this.processProvider(a)),this.records.set(nC,ec(void 0,this)),o.has("environment")&&this.records.set(Po,ec(void 0,this));const i=this.records.get(lv);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(rC.multi,nn,jt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const e of n)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const e=rs(this),r=yo(void 0);try{return n()}finally{rs(e),yo(r)}}get(n,e=ll,r=jt.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Gw))return n[Gw](this);r=Mf(r);const i=rs(this),a=yo(void 0);try{if(!(r&jt.SkipSelf)){let u=this.records.get(n);if(void 0===u){const c=function UL(t){return"function"==typeof t||"object"==typeof t&&t instanceof Me}(n)&&Df(n);u=c&&this.injectableDefInScope(c)?ec(fv(n),ph):null,this.records.set(n,u)}if(null!=u)return this.hydrate(n,u)}return(r&jt.Self?gh():this.parent).get(n,e=r&jt.Optional&&e===ll?null:e)}catch(s){if("NullInjectorError"===s.name){if((s[Af]=s[Af]||[]).unshift(yr(n)),i)throw s;return function PF(t,n,e,r){const o=t[Af];throw n[zw]&&o.unshift(n[zw]),t.message=function LF(t,n,e,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let o=yr(n);if(Array.isArray(n))o=n.map(yr).join(" -> ");else if("object"==typeof n){let i=[];for(let a in n)if(n.hasOwnProperty(a)){let s=n[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):yr(s)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(kF,"\n  ")}`}("\n"+t.message,o,e,r),t.ngTokenPath=o,t[Af]=null,t}(s,n,"R3InjectorError",this.source)}throw s}finally{yo(a),rs(i)}}resolveInjectorInitializers(){const n=rs(this),e=yo(void 0);try{const o=this.get(Ll.multi,nn,jt.Self);for(const i of o)i()}finally{rs(n),yo(e)}}toString(){const n=[],e=this.records;for(const r of e.keys())n.push(yr(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new de(205,!1)}processProvider(n){let e=Hs(n=pt(n))?n:pt(n&&n.provide);const r=function BL(t){return cv(t)?ec(void 0,t.useValue):ec(uC(t),ph)}(n);if(Hs(n)||!0!==n.multi)this.records.get(e);else{let o=this.records.get(e);o||(o=ec(void 0,ph,!0),o.factory=()=>sm(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){return e.value===ph&&(e.value=PL,e.value=e.factory()),"object"==typeof e.value&&e.value&&function VL(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=pt(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){const e=this._onDestroyHooks.indexOf(n);-1!==e&&this._onDestroyHooks.splice(e,1)}}function fv(t){const n=Df(t),e=null!==n?n.factory:Bs(t);if(null!==e)return e;if(t instanceof Me)throw new de(204,!1);if(t instanceof Function)return function LL(t){const n=t.length;if(n>0)throw function Al(t,n){const e=[];for(let r=0;r<t;r++)e.push(n);return e}(n,"?"),new de(204,!1);const e=function IF(t){return t&&(t[If]||t[jw])||null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new de(204,!1)}function uC(t,n,e){let r;if(Hs(t)){const o=pt(t);return Bs(o)||fv(o)}if(cv(t))r=()=>pt(t.useValue);else if(function sC(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...sm(t.deps||[]));else if(function aC(t){return!(!t||!t.useExisting)}(t))r=()=>Ue(pt(t.useExisting));else{const o=pt(t&&(t.useClass||t.provide));if(!function jL(t){return!!t.deps}(t))return Bs(o)||fv(o);r=()=>new o(...sm(t.deps))}return r}function ec(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function hv(t,n){for(const e of t)Array.isArray(e)?hv(e,n):e&&Qg(e)?hv(e.\u0275providers,n):n(e)}const mh=new Me("AppId",{providedIn:"root",factory:()=>HL}),HL="ng",cC=new Me("Platform Initializer"),zs=new Me("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),lC=new Me("CSP nonce",{providedIn:"root",factory:()=>function Yu(){if(void 0!==ev)return ev;if(typeof document<"u")return document;throw new de(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let dC=(t,n,e)=>null;function wv(t,n,e=!1){return dC(t,n,e)}class QL{}class pC{}class e3{resolveComponentFactory(n){throw function JL(t){const n=Error(`No component factory found for ${yr(t)}.`);return n.ngComponent=t,n}(n)}}let xh=(()=>{class t{static{this.NULL=new e3}}return t})();function t3(){return rc(Or(),re())}function rc(t,n){return new Lo(wo(t,n))}let Lo=(()=>{class t{constructor(e){this.nativeElement=e}static{this.__NG_ELEMENT_ID__=t3}}return t})();class mC{}let Ea=(()=>{class t{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function r3(){const t=re(),e=Fo(Or().index,t);return(_o(e)?e:t)[bt]}()}}return t})(),o3=(()=>{class t{static{this.\u0275prov=Je({token:t,providedIn:"root",factory:()=>null})}}return t})();class Vl{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const i3=new Vl("16.2.12"),Ev={};function _C(t,n=null,e=null,r){const o=wC(t,n,e,r);return o.resolveInjectorInitializers(),o}function wC(t,n=null,e=null,r,o=new Set){const i=[e||nn,NL(t)];return r=r||("object"==typeof t?void 0:yr(t)),new Ju(i,n||gh(),r||null,o)}let Bo=(()=>{class t{static{this.THROW_IF_NOT_FOUND=ll}static{this.NULL=new av}static create(e,r){if(Array.isArray(e))return _C({name:""},r,e,"");{const o=e.name??"";return _C({name:o},e.parent,e.providers,o)}}static{this.\u0275prov=Je({token:t,providedIn:"any",factory:()=>Ue(nC)})}static{this.__NG_ELEMENT_ID__=-1}}return t})();function Sv(t){return t.ngOriginalError}class Da{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&Sv(n);for(;e&&Sv(e);)e=Sv(e);return e||null}}function Iv(t){return n=>{setTimeout(t,void 0,n)}}const er=class h3 extends Nn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,r){let o=n,i=e||(()=>null),a=r;if(n&&"object"==typeof n){const u=n;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=Iv(i),o&&(o=Iv(o)),a&&(a=Iv(a)));const s=super.subscribe({next:o,error:i,complete:a});return n instanceof pe&&n.add(s),s}};function CC(...t){}class An{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new er(!1),this.onMicrotaskEmpty=new er(!1),this.onStable=new er(!1),this.onError=new er(!1),typeof Zone>"u")throw new de(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&e,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function p3(){const t="function"==typeof Sn.requestAnimationFrame;let n=Sn[t?"requestAnimationFrame":"setTimeout"],e=Sn[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&e){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const o=e[Zone.__symbol__("OriginalDelegate")];o&&(e=o)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function v3(t){const n=()=>{!function m3(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Sn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Mv(t),t.isCheckStableRunning=!0,Av(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Mv(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,o,i,a,s)=>{if(function b3(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(s))return e.invokeTask(o,i,a,s);try{return EC(t),e.invokeTask(o,i,a,s)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||t.shouldCoalesceRunChangeDetection)&&n(),DC(t)}},onInvoke:(e,r,o,i,a,s,u)=>{try{return EC(t),e.invoke(o,i,a,s,u)}finally{t.shouldCoalesceRunChangeDetection&&n(),DC(t)}},onHasTask:(e,r,o,i)=>{e.hasTask(o,i),r===o&&("microTask"==i.change?(t._hasPendingMicrotasks=i.microTask,Mv(t),Av(t)):"macroTask"==i.change&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,o,i)=>(e.handleError(o,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!An.isInAngularZone())throw new de(909,!1)}static assertNotInAngularZone(){if(An.isInAngularZone())throw new de(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,n,g3,CC,CC);try{return i.runTask(a,e,r)}finally{i.cancelTask(a)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}}const g3={};function Av(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Mv(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function EC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function DC(t){t._nesting--,Av(t)}class y3{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new er,this.onMicrotaskEmpty=new er,this.onStable=new er,this.onError=new er}run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}}const SC=new Me("",{providedIn:"root",factory:IC});function IC(){const t=Te(An);let n=!0;return function vF(...t){const n=cl(t),e=function lF(t,n){return"number"==typeof Xg(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?hn(r[0]):Iu(e)(vr(r,n)):ji}(new kt(o=>{n=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{o.next(n),o.complete()})}),new kt(o=>{let i;t.runOutsideAngular(()=>{i=t.onStable.subscribe(()=>{An.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(n=!0,o.next(!0))})})});const a=t.onUnstable.subscribe(()=>{An.assertInAngularZone(),n&&(n=!1,t.runOutsideAngular(()=>{o.next(!1)}))});return()=>{i.unsubscribe(),a.unsubscribe()}}).pipe(Pw()))}function Sa(t){return t instanceof Function?t():t}let Tv=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static{this.\u0275prov=Je({token:t,providedIn:"root",factory:()=>new t})}}return t})();function Ul(t){for(;t;){t[St]|=64;const n=kl(t);if(hm(t)&&!n)return t;t=n}return null}const RC=new Me("",{providedIn:"root",factory:()=>!1});let Dh=null;function PC(t,n){return t[n]??jC()}function LC(t,n){const e=jC();e.producerNode?.length&&(t[n]=Dh,e.lView=t,Dh=BC())}const M3={...c1,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{Ul(t.lView)},lView:null};function BC(){return Object.create(M3)}function jC(){return Dh??=BC(),Dh}const Ct={};function H(t){VC(Zt(),re(),oo()+t,!1)}function VC(t,n,e,r){if(!r)if(3==(3&n[St])){const i=t.preOrderCheckHooks;null!==i&&Vf(n,i,e)}else{const i=t.preOrderHooks;null!==i&&Uf(n,i,0,e)}js(e)}function q(t,n=jt.Default){const e=re();return null===e?Ue(t,n):ex(Or(),e,pt(t),n)}function Sh(t,n,e,r,o,i,a,s,u,c,l){const d=n.blueprint.slice();return d[Jn]=o,d[St]=140|r,(null!==c||t&&2048&t[St])&&(d[St]|=2048),M1(d),d[jn]=d[Ru]=t,d[or]=e,d[ku]=a||t&&t[ku],d[bt]=s||t&&t[bt],d[os]=u||t&&t[os]||null,d[Wr]=i,d[vl]=function OP(){return FP++}(),d[_a]=l,d[i1]=c,d[ir]=2==n.type?t[ir]:d,d}function ac(t,n,e,r,o){let i=t.data[n];if(null===i)i=function kv(t,n,e,r,o){const i=O1(),a=wm(),u=t.data[n]=function L3(t,n,e,r,o,i){let a=n?n.injectorIndex:-1,s=0;return function Lu(){return null!==ft.skipHydrationRootTNode}()&&(s|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:a,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:s,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?i:i&&i.parent,e,n,r,o);return null===t.firstChild&&(t.firstChild=u),null!==i&&(a?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u,u.prev=i)),u}(t,n,e,r,o),function FO(){return ft.lFrame.inI18n}()&&(i.flags|=32);else if(64&i.type){i.type=e,i.value=r,i.attrs=o;const a=function xl(){const t=ft.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();i.injectorIndex=null===a?-1:a.injectorIndex}return Wi(i,!0),i}function Hl(t,n,e,r){if(0===e)return-1;const o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function HC(t,n,e,r,o){const i=PC(n,yl),a=oo(),s=2&r;try{js(-1),s&&n.length>Vt&&VC(t,n,Vt,!1),zi(s?2:0,o);const c=s?i:null,l=gm(c);try{null!==c&&(c.dirty=!1),e(r,o)}finally{mm(c,l)}}finally{s&&null===n[yl]&&LC(n,yl),js(a),zi(s?3:1,o)}}function Rv(t,n,e){if(fm(n)){const r=ni(null);try{const i=n.directiveEnd;for(let a=n.directiveStart;a<i;a++){const s=t.data[a];s.contentQueries&&s.contentQueries(1,e[a],a)}}finally{ni(r)}}}function Nv(t,n,e){F1()&&(function W3(t,n,e,r){const o=e.directiveStart,i=e.directiveEnd;Ls(e)&&function Y3(t,n,e){const r=wo(n,t),o=zC(e);let a=16;e.signals?a=4096:e.onPush&&(a=64);const s=Ih(t,Sh(t,o,null,a,r,n,null,t[ku].rendererFactory.createRenderer(r,e),null,null,null));t[n.index]=s}(n,e,t.data[o+e.componentOffset]),t.firstCreatePass||zf(e,n),$r(r,n);const a=e.initialInputs;for(let s=o;s<i;s++){const u=t.data[s],c=Vs(n,t,s,e);$r(c,n),null!==a&&Q3(0,s-o,c,u,0,a),_i(u)&&(Fo(e.index,n)[or]=Vs(n,t,s,e))}}(t,n,e,wo(e,n)),64==(64&e.flags)&&XC(t,n,e))}function Fv(t,n,e=wo){const r=n.localNames;if(null!==r){let o=n.index+1;for(let i=0;i<r.length;i+=2){const a=r[i+1],s=-1===a?e(n,t):t[a];t[o++]=s}}}function zC(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Ov(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function Ov(t,n,e,r,o,i,a,s,u,c,l){const d=Vt+r,f=d+o,h=function k3(t,n){const e=[];for(let r=0;r<n;r++)e.push(r<t?null:Ct);return e}(d,f),p="function"==typeof c?c():c;return h[Se]={type:t,blueprint:h,template:e,queries:null,viewQuery:s,declTNode:n,data:h.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1,ssrId:l}}let WC=t=>null;function $C(t,n,e,r){for(let o in t)if(t.hasOwnProperty(o)){e=null===e?{}:e;const i=t[o];null===r?GC(e,n,o,i):r.hasOwnProperty(o)&&GC(e,n,r[o],i)}return e}function GC(t,n,e,r){t.hasOwnProperty(e)?t[e].push(n,r):t[e]=[n,r]}function jo(t,n,e,r,o,i,a,s){const u=wo(n,e);let l,c=n.inputs;!s&&null!=c&&(l=c[r])?(Vv(t,e,l,r,o),Ls(n)&&function V3(t,n){const e=Fo(n,t);16&e[St]||(e[St]|=64)}(e,n.index)):3&n.type&&(r=function j3(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),o=null!=a?a(o,n.value||"",r):o,i.setProperty(u,r,o))}function Pv(t,n,e,r){if(F1()){const o=null===r?null:{"":-1},i=function G3(t,n){const e=t.directiveRegistry;let r=null,o=null;if(e)for(let i=0;i<e.length;i++){const a=e[i];if(Jw(n,a.selectors,!1))if(r||(r=[]),_i(a))if(null!==a.findHostDirectiveDefs){const s=[];o=o||new Map,a.findHostDirectiveDefs(a,s,o),r.unshift(...s,a),Lv(t,n,s.length)}else r.unshift(a),Lv(t,n,0);else o=o||new Map,a.findHostDirectiveDefs?.(a,r,o),r.push(a)}return null===r?null:[r,o]}(t,e);let a,s;null===i?a=s=null:[a,s]=i,null!==a&&qC(t,n,e,a,o,s),o&&function q3(t,n,e){if(n){const r=t.localNames=[];for(let o=0;o<n.length;o+=2){const i=e[n[o+1]];if(null==i)throw new de(-301,!1);r.push(n[o],i)}}}(e,r,o)}e.mergedAttrs=hl(e.mergedAttrs,e.attrs)}function qC(t,n,e,r,o,i){for(let c=0;c<r.length;c++)Nm(zf(e,n),t,r[c].type);!function K3(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,r.length);for(let c=0;c<r.length;c++){const l=r[c];l.providersResolver&&l.providersResolver(l)}let a=!1,s=!1,u=Hl(t,n,r.length,null);for(let c=0;c<r.length;c++){const l=r[c];e.mergedAttrs=hl(e.mergedAttrs,l.hostAttrs),Z3(t,e,n,u,l),X3(u,l,o),null!==l.contentQueries&&(e.flags|=4),(null!==l.hostBindings||null!==l.hostAttrs||0!==l.hostVars)&&(e.flags|=64);const d=l.type.prototype;!a&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),a=!0),!s&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),s=!0),u++}!function B3(t,n,e){const o=n.directiveEnd,i=t.data,a=n.attrs,s=[];let u=null,c=null;for(let l=n.directiveStart;l<o;l++){const d=i[l],f=e?e.get(d):null,p=f?f.outputs:null;u=$C(d.inputs,l,u,f?f.inputs:null),c=$C(d.outputs,l,c,p);const g=null===u||null===a||Qw(n)?null:J3(u,l,a);s.push(g)}null!==u&&(u.hasOwnProperty("class")&&(n.flags|=8),u.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=s,n.inputs=u,n.outputs=c}(t,e,i)}function XC(t,n,e){const r=e.directiveStart,o=e.directiveEnd,i=e.index,a=function PO(){return ft.lFrame.currentDirectiveIndex}();try{js(i);for(let s=r;s<o;s++){const u=t.data[s],c=n[s];Cm(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&$3(u,c)}}finally{js(-1),Cm(a)}}function $3(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function Lv(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function X3(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;_i(n)&&(e[""]=t)}}function Z3(t,n,e,r,o){t.data[r]=o;const i=o.factory||(o.factory=Bs(o.type)),a=new Cl(i,_i(o),q);t.blueprint[r]=a,e[r]=a,function H3(t,n,e,r,o){const i=o.hostBindings;if(i){let a=t.hostBindingOpCodes;null===a&&(a=t.hostBindingOpCodes=[]);const s=~n.index;(function z3(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(a)!=s&&a.push(s),a.push(e,r,i)}}(t,n,r,Hl(t,e,o.hostVars,Ct),o)}function Gi(t,n,e,r,o,i){const a=wo(t,n);!function Bv(t,n,e,r,o,i,a){if(null==i)t.removeAttribute(n,o,e);else{const s=null==a?yt(i):a(i,r||"",o);t.setAttribute(n,o,s,e)}}(n[bt],a,i,t.value,e,r,o)}function Q3(t,n,e,r,o,i){const a=i[n];if(null!==a)for(let s=0;s<a.length;)KC(r,e,a[s++],a[s++],a[s++])}function KC(t,n,e,r,o){const i=ni(null);try{const a=t.inputTransforms;null!==a&&a.hasOwnProperty(r)&&(o=a[r].call(n,o)),null!==t.setInput?t.setInput(n,o,e,r):n[r]=o}finally{ni(i)}}function J3(t,n,e){let r=null,o=0;for(;o<e.length;){const i=e[o];if(0!==i)if(5!==i){if("number"==typeof i)break;if(t.hasOwnProperty(i)){null===r&&(r=[]);const a=t[i];for(let s=0;s<a.length;s+=2)if(a[s]===n){r.push(i,a[s+1],e[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function ZC(t,n,e,r){return[t,!0,!1,n,null,0,r,e,null,null,null]}function YC(t,n){const e=t.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const i=e[r+1];if(-1!==i){const a=t.data[i];Dm(e[r]),a.contentQueries(2,n[i],i)}}}function Ih(t,n){return t[gl]?t[o1][bi]=n:t[gl]=n,t[o1]=n,n}function jv(t,n,e){Dm(0);const r=ni(null);try{n(t,e)}finally{ni(r)}}function tE(t,n){const e=t[os],r=e?e.get(Da,null):null;r&&r.handleError(n)}function Vv(t,n,e,r,o){for(let i=0;i<e.length;){const a=e[i++],s=e[i++];KC(t.data[a],n[a],r,s,o)}}function Ia(t,n,e){const r=Lf(n,t);!function Tx(t,n,e){t.setValue(n,e)}(t[bt],r,e)}function eB(t,n){const e=Fo(n,t),r=e[Se];!function tB(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}(r,e);const o=e[Jn];null!==o&&null===e[_a]&&(e[_a]=wv(o,e[os])),Uv(r,e,e[or])}function Uv(t,n,e){Sm(n);try{const r=t.viewQuery;null!==r&&jv(1,r,e);const o=t.template;null!==o&&HC(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&YC(t,n),t.staticViewQueries&&jv(2,t.viewQuery,e);const i=t.components;null!==i&&function nB(t,n){for(let e=0;e<n.length;e++)eB(t,n[e])}(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[St]&=-5,Im()}}let nE=(()=>{class t{constructor(){this.all=new Set,this.queue=new Map}create(e,r,o){const i=typeof Zone>"u"?null:Zone.current,a=function fO(t,n,e){const r=Object.create(hO);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;const o=a=>{r.cleanupFn=a};return r.ref={notify:()=>h1(r),run:()=>{if(r.dirty=!1,r.hasRun&&!p1(r))return;r.hasRun=!0;const a=gm(r);try{r.cleanupFn(),r.cleanupFn=x1,r.fn(o)}finally{mm(r,a)}},cleanup:()=>r.cleanupFn()},r.ref}(e,c=>{this.all.has(c)&&this.queue.set(c,i)},o);let s;this.all.add(a),a.notify();const u=()=>{a.cleanup(),s?.(),this.all.delete(a),this.queue.delete(a)};return s=r?.onDestroy(u),{destroy:u}}flush(){if(0!==this.queue.size)for(const[e,r]of this.queue)this.queue.delete(e),r?r.run(()=>e.run()):e.run()}get isQueueEmpty(){return 0===this.queue.size}static{this.\u0275prov=Je({token:t,providedIn:"root",factory:()=>new t})}}return t})();function Ah(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(null!==n)for(let a=0;a<n.length;a++){const s=n[a];"number"==typeof s?i=s:1==i?o=Zg(o,s):2==i&&(r=Zg(r,s+": "+n[++a]+";"))}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}function zl(t,n,e,r,o=!1){for(;null!==e;){const i=n[e.index];null!==i&&r.push(In(i)),no(i)&&rE(i,r);const a=e.type;if(8&a)zl(t,n,e.child,r);else if(32&a){const s=$m(e,n);let u;for(;u=s();)r.push(u)}else if(16&a){const s=jx(n,e);if(Array.isArray(s))r.push(...s);else{const u=kl(n[ir]);zl(u[Se],u,s,r,!0)}}e=o?e.projectionNext:e.next}return r}function rE(t,n){for(let e=Nr;e<t.length;e++){const r=t[e],o=r[Se].firstChild;null!==o&&zl(r[Se],r,o,n)}t[Hi]!==t[Jn]&&n.push(t[Hi])}function Mh(t,n,e,r=!0){const o=n[ku],i=o.rendererFactory,a=o.afterRenderEventManager;i.begin?.(),a?.begin();try{oE(t,n,t.template,e)}catch(u){throw r&&tE(n,u),u}finally{i.end?.(),o.effectManager?.flush(),a?.end()}}function oE(t,n,e,r){const o=n[St];if(256!=(256&o)){n[ku].effectManager?.flush(),Sm(n);try{M1(n),function L1(t){return ft.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&HC(t,n,e,2,r);const a=3==(3&o);if(a){const c=t.preOrderCheckHooks;null!==c&&Vf(n,c,null)}else{const c=t.preOrderHooks;null!==c&&Uf(n,c,0,null),Am(n,0)}if(function iB(t){for(let n=Ix(t);null!==n;n=Ax(n)){if(!n[a1])continue;const e=n[Fu];for(let r=0;r<e.length;r++){CO(e[r])}}}(n),iE(n,2),null!==t.contentQueries&&YC(t,n),a){const c=t.contentCheckHooks;null!==c&&Vf(n,c)}else{const c=t.contentHooks;null!==c&&Uf(n,c,1),Am(n,1)}!function T3(t,n){const e=t.hostBindingOpCodes;if(null===e)return;const r=PC(n,bl);try{for(let o=0;o<e.length;o++){const i=e[o];if(i<0)js(~i);else{const a=i,s=e[++o],u=e[++o];OO(s,a),r.dirty=!1;const c=gm(r);try{u(2,n[a])}finally{mm(r,c)}}}}finally{null===n[bl]&&LC(n,bl),js(-1)}}(t,n);const s=t.components;null!==s&&sE(n,s,0);const u=t.viewQuery;if(null!==u&&jv(2,u,r),a){const c=t.viewCheckHooks;null!==c&&Vf(n,c)}else{const c=t.viewHooks;null!==c&&Uf(n,c,2),Am(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[St]&=-73,T1(n)}finally{Im()}}}function iE(t,n){for(let e=Ix(t);null!==e;e=Ax(e))for(let r=Nr;r<e.length;r++)aE(e[r],n)}function aB(t,n,e){aE(Fo(n,t),e)}function aE(t,n){if(!function wO(t){return 128==(128&t[St])}(t))return;const e=t[Se],r=t[St];if(80&r&&0===n||1024&r||2===n)oE(e,t,e.template,t[or]);else if(t[pl]>0){iE(t,1);const o=e.components;null!==o&&sE(t,o,1)}}function sE(t,n,e){for(let r=0;r<n.length;r++)aB(t,n[r],e)}class Wl{get rootNodes(){const n=this._lView,e=n[Se];return zl(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[or]}set context(n){this._lView[or]=n}get destroyed(){return 256==(256&this._lView[St])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[jn];if(no(n)){const e=n[8],r=e?e.indexOf(this):-1;r>-1&&(ih(n,r),qf(e,r))}this._attachedToViewContainer=!1}qm(this._lView[Se],this._lView)}onDestroy(n){!function R1(t,n){if(256==(256&t[St]))throw new de(911,!1);null===t[is]&&(t[is]=[]),t[is].push(n)}(this._lView,n)}markForCheck(){Ul(this._cdRefInjectingView||this._lView)}detach(){this._lView[St]&=-129}reattach(){this._lView[St]|=128}detectChanges(){Mh(this._lView[Se],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new de(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function KP(t,n){Nl(t,n,n[bt],2,null,null)}(this._lView[Se],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new de(902,!1);this._appRef=n}}class sB extends Wl{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Mh(n[Se],n,n[or],!1)}checkNoChanges(){}get context(){return null}}class uE extends xh{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Kt(n);return new $l(e,this.ngModule)}}function cE(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class cB{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Mf(r);const o=this.injector.get(n,Ev,r);return o!==Ev||e===Ev?o:this.parentInjector.get(n,e,r)}}class $l extends pC{get inputs(){const n=this.componentDef,e=n.inputTransforms,r=cE(n.inputs);if(null!==e)for(const o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return cE(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function qF(t){return t.map(GF).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,o){let i=(o=o||this.ngModule)instanceof Po?o:o?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const a=i?new cB(n,i):n,s=a.get(mC,null);if(null===s)throw new de(407,!1);const d={rendererFactory:s,sanitizer:a.get(o3,null),effectManager:a.get(nE,null),afterRenderEventManager:a.get(Tv,null)},f=s.createRenderer(null,this.componentDef),h=this.componentDef.selectors[0][0]||"div",p=r?function R3(t,n,e,r){const i=r.get(RC,!1)||e===gi.ShadowDom,a=t.selectRootElement(n,i);return function N3(t){WC(t)}(a),a}(f,r,this.componentDef.encapsulation,a):oh(f,h,function uB(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(h)),v=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let b=null;null!==p&&(b=wv(p,a,!0));const w=Ov(0,null,null,1,0,null,null,null,null,null,null),_=Sh(null,w,null,v,null,null,d,f,a,null,b);let x,D;Sm(_);try{const R=this.componentDef;let k,M=null;R.findHostDirectiveDefs?(k=[],M=new Map,R.findHostDirectiveDefs(R,k,M),k.push(R)):k=[R];const T=function dB(t,n){const e=t[Se],r=Vt;return t[r]=n,ac(e,r,2,"#host",null)}(_,p),B=function fB(t,n,e,r,o,i,a){const s=o[Se];!function hB(t,n,e,r){for(const o of t)n.mergedAttrs=hl(n.mergedAttrs,o.hostAttrs);null!==n.mergedAttrs&&(Ah(n,n.mergedAttrs,!0),null!==e&&zx(r,e,n))}(r,t,n,a);let u=null;null!==n&&(u=wv(n,o[os]));const c=i.rendererFactory.createRenderer(n,e);let l=16;e.signals?l=4096:e.onPush&&(l=64);const d=Sh(o,zC(e),null,l,o[t.index],t,i,c,null,null,u);return s.firstCreatePass&&Lv(s,t,r.length-1),Ih(o,d),o[t.index]=d}(T,p,R,k,_,d,f);D=A1(w,Vt),p&&function gB(t,n,e,r){if(r)lm(t,e,["ng-version",i3.full]);else{const{attrs:o,classes:i}=function XF(t){const n=[],e=[];let r=1,o=2;for(;r<t.length;){let i=t[r];if("string"==typeof i)2===o?""!==i&&n.push(i,t[++r]):8===o&&e.push(i);else{if(!mi(o))break;o=i}r++}return{attrs:n,classes:e}}(n.selectors[0]);o&&lm(t,e,o),i&&i.length>0&&Hx(t,e,i.join(" "))}}(f,R,p,r),void 0!==e&&function mB(t,n,e){const r=t.projection=[];for(let o=0;o<n.length;o++){const i=e[o];r.push(null!=i?Array.from(i):null)}}(D,this.ngContentSelectors,e),x=function pB(t,n,e,r,o,i){const a=Or(),s=o[Se],u=wo(a,o);qC(s,o,a,e,null,r);for(let l=0;l<e.length;l++)$r(Vs(o,s,a.directiveStart+l,a),o);XC(s,o,a),u&&$r(u,o);const c=Vs(o,s,a.directiveStart+a.componentOffset,a);if(t[or]=o[or]=c,null!==i)for(const l of i)l(c,n);return Rv(s,a,t),c}(B,R,k,M,_,[vB]),Uv(w,_,null)}finally{Im()}return new lB(this.componentType,x,rc(D,_),_,D)}}class lB extends QL{constructor(n,e,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new sB(o),this.componentType=n}setInput(n,e){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;const i=this._rootLView;Vv(i[Se],i,o,n,e),this.previousInputValues.set(n,e),Ul(Fo(this._tNode.index,i))}}get injector(){return new io(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function vB(){const t=Or();jf(re()[Se],t)}function gn(t){let n=function lE(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const r=[t];for(;n;){let o;if(_i(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new de(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);const a=t;a.inputs=Th(t.inputs),a.inputTransforms=Th(t.inputTransforms),a.declaredInputs=Th(t.declaredInputs),a.outputs=Th(t.outputs);const s=o.hostBindings;s&&wB(t,s);const u=o.viewQuery,c=o.contentQueries;if(u&&bB(t,u),c&&_B(t,c),Cf(t.inputs,o.inputs),Cf(t.declaredInputs,o.declaredInputs),Cf(t.outputs,o.outputs),null!==o.inputTransforms&&(null===a.inputTransforms&&(a.inputTransforms={}),Cf(a.inputTransforms,o.inputTransforms)),_i(o)&&o.data.animation){const l=t.data;l.animation=(l.animation||[]).concat(o.data.animation)}}const i=o.features;if(i)for(let a=0;a<i.length;a++){const s=i[a];s&&s.ngInherit&&s(t),s===gn&&(e=!1)}}n=Object.getPrototypeOf(n)}!function yB(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){const o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=hl(o.hostAttrs,e=hl(e,o.hostAttrs))}}(r)}function Th(t){return t===Vi?{}:t===nn?[]:t}function bB(t,n){const e=t.viewQuery;t.viewQuery=e?(r,o)=>{n(r,o),e(r,o)}:n}function _B(t,n){const e=t.contentQueries;t.contentQueries=e?(r,o,i)=>{n(r,o,i),e(r,o,i)}:n}function wB(t,n){const e=t.hostBindings;t.hostBindings=e?(r,o)=>{n(r,o),e(r,o)}:n}function kh(t){return!!Hv(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function Hv(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Gr(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function Ws(t,n,e,r){const o=Gr(t,n,e);return Gr(t,n+1,r)||o}function Rh(t,n,e,r,o){const i=Ws(t,n,e,r);return Gr(t,n+2,o)||i}function Xi(t,n,e,r){const o=re();return Gr(o,Bu(),n)&&(Zt(),Gi(zn(),o,t,n,e,r)),Xi}function uc(t,n,e,r){return Gr(t,Bu(),e)?n+yt(e)+r:Ct}function dc(t,n,e,r,o,i,a,s,u,c){const d=function ii(t,n,e,r,o,i){const a=Ws(t,n,e,r);return Ws(t,n+2,o,i)||a}(t,wa(),e,o,a,u);return xa(4),d?n+yt(e)+r+yt(o)+i+yt(a)+s+yt(u)+c:Ct}function xe(t,n,e,r,o,i,a,s){const u=re(),c=Zt(),l=t+Vt,d=c.firstCreatePass?function GB(t,n,e,r,o,i,a,s,u){const c=n.consts,l=ac(n,t,4,a||null,ss(c,s));Pv(n,e,l,ss(c,u)),jf(n,l);const d=l.tView=Ov(2,l,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return null!==n.queries&&(n.queries.template(n,l),d.queries=n.queries.embeddedTView(l)),l}(l,c,u,n,e,r,o,i,a):c.data[l];Wi(d,!1);const f=IE(c,u,d,t);Bf()&&sh(c,u,f,d),$r(f,u),Ih(u,u[l]=ZC(f,u,f,d)),Ff(d)&&Nv(c,u,d),null!=a&&Fv(u,d,s)}let IE=function AE(t,n,e,r){return us(!0),n[bt].createComment("")};function ie(t,n,e){const r=re();return Gr(r,Bu(),n)&&jo(Zt(),zn(),r,t,n,r[bt],e,!1),ie}function Xv(t,n,e,r,o){const a=o?"class":"style";Vv(t,e,n.inputs[a],a,r)}function j(t,n,e,r){const o=re(),i=Zt(),a=Vt+t,s=o[bt],u=i.firstCreatePass?function YB(t,n,e,r,o,i){const a=n.consts,u=ac(n,t,2,r,ss(a,o));return Pv(n,e,u,ss(a,i)),null!==u.attrs&&Ah(u,u.attrs,!1),null!==u.mergedAttrs&&Ah(u,u.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,u),u}(a,i,o,n,e,r):i.data[a],c=ME(i,o,u,s,n,t);o[a]=c;const l=Ff(u);return Wi(u,!0),zx(s,c,u),32!=(32&u.flags)&&Bf()&&sh(i,o,c,u),0===function DO(){return ft.lFrame.elementDepthCount}()&&$r(c,o),function SO(){ft.lFrame.elementDepthCount++}(),l&&(Nv(i,o,u),Rv(i,u,o)),null!==r&&Fv(o,u),j}function V(){let t=Or();wm()?xm():(t=t.parent,Wi(t,!1));const n=t;(function AO(t){return ft.skipHydrationRootTNode===t})(n)&&function RO(){ft.skipHydrationRootTNode=null}(),function IO(){ft.lFrame.elementDepthCount--}();const e=Zt();return e.firstCreatePass&&(jf(e,t),fm(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function qO(t){return 0!=(8&t.flags)}(n)&&Xv(e,n,re(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function XO(t){return 0!=(16&t.flags)}(n)&&Xv(e,n,re(),n.stylesWithoutHost,!1),V}function bn(t,n,e,r){return j(t,n,e,r),V(),bn}let ME=(t,n,e,r,o,i)=>(us(!0),oh(r,o,function $1(){return ft.lFrame.currentNamespace}()));function _n(t,n,e){const r=re(),o=Zt(),i=t+Vt,a=o.firstCreatePass?function ej(t,n,e,r,o){const i=n.consts,a=ss(i,r),s=ac(n,t,8,"ng-container",a);return null!==a&&Ah(s,a,!0),Pv(n,e,s,ss(i,o)),null!==n.queries&&n.queries.elementStart(n,s),s}(i,o,r,n,e):o.data[i];Wi(a,!0);const s=kE(o,r,a,t);return r[i]=s,Bf()&&sh(o,r,s,a),$r(s,r),Ff(a)&&(Nv(o,r,a),Rv(o,a,r)),null!=e&&Fv(r,a),_n}function wn(){let t=Or();const n=Zt();return wm()?xm():(t=t.parent,Wi(t,!1)),n.firstCreatePass&&(jf(n,t),fm(t)&&n.queries.elementEnd(t)),wn}let kE=(t,n,e,r)=>(us(!0),Gm(n[bt],""));function Mn(){return re()}function Zl(t){return!!t&&"function"==typeof t.then}function RE(t){return!!t&&"function"==typeof t.subscribe}function Ie(t,n,e,r){const o=re(),i=Zt(),a=Or();return function FE(t,n,e,r,o,i,a){const s=Ff(r),c=t.firstCreatePass&&function JC(t){return t.cleanup||(t.cleanup=[])}(t),l=n[or],d=function QC(t){return t[Tu]||(t[Tu]=[])}(n);let f=!0;if(3&r.type||a){const g=wo(r,n),m=a?a(g):g,v=d.length,b=a?_=>a(In(_[r.index])):r.index;let w=null;if(!a&&s&&(w=function rj(t,n,e,r){const o=t.cleanup;if(null!=o)for(let i=0;i<o.length-1;i+=2){const a=o[i];if(a===e&&o[i+1]===r){const s=n[Tu],u=o[i+2];return s.length>u?s[u]:null}"string"==typeof a&&(i+=2)}return null}(t,n,o,r.index)),null!==w)(w.__ngLastListenerFn__||w).__ngNextListenerFn__=i,w.__ngLastListenerFn__=i,f=!1;else{i=PE(r,n,l,i,!1);const _=e.listen(m,o,i);d.push(i,_),c&&c.push(o,b,v,v+1)}}else i=PE(r,n,l,i,!1);const h=r.outputs;let p;if(f&&null!==h&&(p=h[o])){const g=p.length;if(g)for(let m=0;m<g;m+=2){const x=n[p[m]][p[m+1]].subscribe(i),D=d.length;d.push(i,x),c&&c.push(o,r.index,D,-(D+1))}}}(i,o,o[bt],a,t,n,r),Ie}function OE(t,n,e,r){try{return zi(6,n,e),!1!==e(r)}catch(o){return tE(t,o),!1}finally{zi(7,n,e)}}function PE(t,n,e,r,o){return function i(a){if(a===Function)return r;Ul(t.componentOffset>-1?Fo(t.index,n):n);let u=OE(n,e,r,a),c=i.__ngNextListenerFn__;for(;c;)u=OE(n,e,c,a)&&u,c=c.__ngNextListenerFn__;return o&&!1===u&&a.preventDefault(),u}}function ge(t=1){return function BO(t){return(ft.lFrame.contextLView=function jO(t,n){for(;t>0;)n=n[Ru],t--;return n}(t,ft.lFrame.contextLView))[or]}(t)}function ds(t,n,e){return Aa(t,"",n,"",e),ds}function Aa(t,n,e,r,o){const i=re(),a=uc(i,n,e,r);return a!==Ct&&jo(Zt(),zn(),i,t,a,i[bt],o,!1),Aa}function Ph(t,n){return t<<17|n<<2}function fs(t){return t>>17&32767}function Kv(t){return 2|t}function $s(t){return(131068&t)>>2}function Zv(t,n){return-131069&t|n<<2}function Yv(t){return 1|t}function $E(t,n,e,r,o){const i=t[e+1],a=null===n;let s=r?fs(i):$s(i),u=!1;for(;0!==s&&(!1===u||a);){const l=t[s+1];fj(t[s],n)&&(u=!0,t[s+1]=r?Yv(l):Kv(l)),s=r?fs(l):$s(l)}u&&(t[e+1]=r?Kv(i):Yv(i))}function fj(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Gu(t,n)>=0}function Lh(t,n){return function wi(t,n,e,r){const o=re(),i=Zt(),a=xa(2);i.firstUpdatePass&&function eD(t,n,e,r){const o=t.data;if(null===o[e+1]){const i=o[oo()],a=function JE(t,n){return n>=t.expandoStartIndex}(t,e);(function oD(t,n){return 0!=(t.flags&(n?8:16))})(i,r)&&null===n&&!a&&(n=!1),n=function wj(t,n,e,r){const o=function Em(t){const n=ft.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let i=r?n.residualClasses:n.residualStyles;if(null===o)0===(r?n.classBindings:n.styleBindings)&&(e=Yl(e=Qv(null,t,n,e,r),n.attrs,r),i=null);else{const a=n.directiveStylingLast;if(-1===a||t[a]!==o)if(e=Qv(o,t,n,e,r),null===i){let u=function xj(t,n,e){const r=e?n.classBindings:n.styleBindings;if(0!==$s(r))return t[fs(r)]}(t,n,r);void 0!==u&&Array.isArray(u)&&(u=Qv(null,t,n,u[1],r),u=Yl(u,n.attrs,r),function Cj(t,n,e,r){t[fs(e?n.classBindings:n.styleBindings)]=r}(t,n,r,u))}else i=function Ej(t,n,e){let r;const o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++)r=Yl(r,t[i].hostAttrs,e);return Yl(r,n.attrs,e)}(t,n,r)}return void 0!==i&&(r?n.residualClasses=i:n.residualStyles=i),e}(o,i,n,r),function lj(t,n,e,r,o,i){let a=i?n.classBindings:n.styleBindings,s=fs(a),u=$s(a);t[r]=e;let l,c=!1;if(Array.isArray(e)?(l=e[1],(null===l||Gu(e,l)>0)&&(c=!0)):l=e,o)if(0!==u){const f=fs(t[s+1]);t[r+1]=Ph(f,s),0!==f&&(t[f+1]=Zv(t[f+1],r)),t[s+1]=function uj(t,n){return 131071&t|n<<17}(t[s+1],r)}else t[r+1]=Ph(s,0),0!==s&&(t[s+1]=Zv(t[s+1],r)),s=r;else t[r+1]=Ph(u,0),0===s?s=r:t[u+1]=Zv(t[u+1],r),u=r;c&&(t[r+1]=Kv(t[r+1])),$E(t,l,r,!0),$E(t,l,r,!1),function dj(t,n,e,r,o){const i=o?t.residualClasses:t.residualStyles;null!=i&&"string"==typeof n&&Gu(i,n)>=0&&(e[r+1]=Yv(e[r+1]))}(n,l,t,r,i),a=Ph(s,u),i?n.classBindings=a:n.styleBindings=a}(o,i,n,e,a,r)}}(i,t,a,r),n!==Ct&&Gr(o,a,n)&&function nD(t,n,e,r,o,i,a,s){if(!(3&n.type))return;const u=t.data,c=u[s+1],l=function cj(t){return 1==(1&t)}(c)?rD(u,n,e,o,$s(c),a):void 0;Bh(l)||(Bh(i)||function sj(t){return 2==(2&t)}(c)&&(i=rD(u,null,e,o,s,a)),function iL(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=-1===r.indexOf("-")?void 0:cs.DashCase;null==o?t.removeStyle(e,r,i):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=cs.Important),t.setStyle(e,r,o,i))}}(r,a,Lf(oo(),e),o,i))}(i,i.data[oo()],o,o[bt],t,o[a+1]=function Aj(t,n){return null==t||""===t||("string"==typeof n?t+=n:"object"==typeof t&&(t=yr(ls(t)))),t}(n,e),r,a)}(t,n,null,!0),Lh}function Qv(t,n,e,r,o){let i=null;const a=e.directiveEnd;let s=e.directiveStylingLast;for(-1===s?s=e.directiveStart:s++;s<a&&(i=n[s],r=Yl(r,i.hostAttrs,o),i!==t);)s++;return null!==t&&(e.directiveStylingLast=s),r}function Yl(t,n,e){const r=e?1:2;let o=-1;if(null!==n)for(let i=0;i<n.length;i++){const a=n[i];"number"==typeof a?o=a:o===r&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Oo(t,a,!!e||n[++i]))}return void 0===t?null:t}function rD(t,n,e,r,o,i){const a=null===n;let s;for(;o>0;){const u=t[o],c=Array.isArray(u),l=c?u[1]:u,d=null===l;let f=e[o+1];f===Ct&&(f=d?nn:void 0);let h=d?Pm(f,r):l===r?f:void 0;if(c&&!Bh(h)&&(h=Pm(u,r)),Bh(h)&&(s=h,a))return s;const p=t[o+1];o=a?fs(p):$s(p)}if(null!==n){let u=i?n.residualClasses:n.residualStyles;null!=u&&(s=Pm(u,r))}return s}function Bh(t){return void 0!==t}function J(t,n=""){const e=re(),r=Zt(),o=t+Vt,i=r.firstCreatePass?ac(r,o,1,n,null):r.data[o],a=iD(r,e,i,n,t);e[o]=a,Bf()&&sh(r,e,a,i),Wi(i,!1)}let iD=(t,n,e,r,o)=>(us(!0),function rh(t,n){return t.createText(n)}(n[bt],r));function Wn(t){return Sr("",t,""),Wn}function Sr(t,n,e){const r=re(),o=uc(r,t,n,e);return o!==Ct&&Ia(r,oo(),o),Sr}function Ql(t,n,e,r,o){const i=re(),a=function cc(t,n,e,r,o,i){const s=Ws(t,wa(),e,o);return xa(2),s?n+yt(e)+r+yt(o)+i:Ct}(i,t,n,e,r,o);return a!==Ct&&Ia(i,oo(),a),Ql}function jh(t,n,e,r,o,i,a){const s=re(),u=function lc(t,n,e,r,o,i,a,s){const c=Rh(t,wa(),e,o,a);return xa(3),c?n+yt(e)+r+yt(o)+i+yt(a)+s:Ct}(s,t,n,e,r,o,i,a);return u!==Ct&&Ia(s,oo(),u),jh}function Jv(t,n,e,r,o,i,a,s,u){const c=re(),l=dc(c,t,n,e,r,o,i,a,s,u);return l!==Ct&&Ia(c,oo(),l),Jv}const yc="en-US";let ED=yc;function ny(t,n,e,r,o){if(t=pt(t),Array.isArray(t))for(let i=0;i<t.length;i++)ny(t[i],n,e,r,o);else{const i=Zt(),a=re(),s=Or();let u=Hs(t)?t:pt(t.provide);const c=uC(t),l=1048575&s.providerIndexes,d=s.directiveStart,f=s.providerIndexes>>20;if(Hs(t)||!t.multi){const h=new Cl(c,o,q),p=oy(u,n,o?l:l+f,d);-1===p?(Nm(zf(s,a),i,u),ry(i,t,n.length),n.push(u),s.directiveStart++,s.directiveEnd++,o&&(s.providerIndexes+=1048576),e.push(h),a.push(h)):(e[p]=h,a[p]=h)}else{const h=oy(u,n,l+f,d),p=oy(u,n,l,l+f),m=p>=0&&e[p];if(o&&!m||!o&&!(h>=0&&e[h])){Nm(zf(s,a),i,u);const v=function K4(t,n,e,r,o){const i=new Cl(t,e,q);return i.multi=[],i.index=n,i.componentProviders=0,KD(i,o,r&&!e),i}(o?X4:q4,e.length,o,r,c);!o&&m&&(e[p].providerFactory=v),ry(i,t,n.length,0),n.push(u),s.directiveStart++,s.directiveEnd++,o&&(s.providerIndexes+=1048576),e.push(v),a.push(v)}else ry(i,t,h>-1?h:p,KD(e[o?p:h],c,!o&&r));!o&&r&&m&&e[p].componentProviders++}}}function ry(t,n,e,r){const o=Hs(n),i=function OL(t){return!!t.useClass}(n);if(o||i){const u=(i?pt(n.useClass):n).prototype.ngOnDestroy;if(u){const c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){const l=c.indexOf(e);-1===l?c.push(e,[r,u]):c[l+1].push(r,u)}else c.push(e,u)}}}function KD(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function oy(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function q4(t,n,e,r){return iy(this.multi,[])}function X4(t,n,e,r){const o=this.multi;let i;if(this.providerFactory){const a=this.providerFactory.componentProviders,s=Vs(e,e[Se],this.providerFactory.index,r);i=s.slice(0,a),iy(o,i);for(let u=a;u<s.length;u++)i.push(s[u])}else i=[],iy(o,i);return i}function iy(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function Vn(t,n=[]){return e=>{e.providersResolver=(r,o)=>function G4(t,n,e){const r=Zt();if(r.firstCreatePass){const o=_i(t);ny(e,r.data,r.blueprint,o,!0),ny(n,r.data,r.blueprint,o,!1)}}(r,o?o(t):t,n)}}class qs{}class ZD{}class ay extends qs{constructor(n,e,r){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new uE(this);const o=No(n);this._bootstrapComponents=Sa(o.bootstrap),this._r3Injector=wC(n,e,[{provide:qs,useValue:this},{provide:xh,useValue:this.componentFactoryResolver},...r],yr(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class sy extends ZD{constructor(n){super(),this.moduleType=n}create(n){return new ay(this.moduleType,n,[])}}class YD extends qs{constructor(n){super(),this.componentFactoryResolver=new uE(this),this.instance=null;const e=new Ju([...n.providers,{provide:qs,useValue:this},{provide:xh,useValue:this.componentFactoryResolver}],n.parent||gh(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function uy(t,n,e=null){return new YD({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}let Q4=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const r=oC(0,e.type),o=r.length>0?uy([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Je({token:t,providedIn:"environment",factory:()=>new t(Ue(Po))})}}return t})();function QD(t){t.getStandaloneInjector=n=>n.get(Q4).getOrCreateStandaloneInjector(t)}function iS(t,n,e,r,o,i){return function uS(t,n,e,r,o,i,a,s){const u=n+e;return Rh(t,u,o,i,a)?function qi(t,n,e){return t[n]=e}(t,u+3,s?r.call(s,o,i,a):r(o,i,a)):function od(t,n){const e=t[n];return e===Ct?void 0:e}(t,u+3)}(re(),function ro(){const t=ft.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}(),t,n,e,r,o,i)}function DV(t,n,e,r=!0){const o=n[Se];if(function YP(t,n,e,r){const o=Nr+r,i=e.length;r>0&&(e[o-1][bi]=n),r<i-Nr?(n[bi]=e[o],ax(e,Nr+r,n)):(e.push(n),n[bi]=null),n[jn]=e;const a=n[ml];null!==a&&e!==a&&function QP(t,n){const e=t[Fu];n[ir]!==n[jn][jn][ir]&&(t[a1]=!0),null===e?t[Fu]=[n]:e.push(n)}(a,n);const s=n[Ui];null!==s&&s.insertView(t),n[St]|=128}(o,n,t,e),r){const i=Ym(e,t),a=n[bt],s=ah(a,t[Hi]);null!==s&&function XP(t,n,e,r,o,i){r[Jn]=o,r[Wr]=n,Nl(t,r,e,1,o,i)}(o,t[Wr],a,n,s,i)}}let Ma=(()=>{class t{static{this.__NG_ELEMENT_ID__=AV}}return t})();const SV=Ma,IV=class extends SV{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){const o=function EV(t,n,e,r){const o=n.tView,s=Sh(t,o,e,4096&t[St]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);s[ml]=t[n.index];const c=t[Ui];return null!==c&&(s[Ui]=c.createEmbeddedView(o)),Uv(o,s,e),s}(this._declarationLView,this._declarationTContainer,n,{injector:e,hydrationInfo:r});return new Wl(o)}};function AV(){return Wh(Or(),re())}function Wh(t,n){return 4&t.type?new IV(n,t,rc(t,n)):null}let Ci=(()=>{class t{static{this.__NG_ELEMENT_ID__=FV}}return t})();function FV(){return function vS(t,n){let e;const r=n[t.index];return no(r)?e=r:(e=ZC(r,n,null,t),n[t.index]=e,Ih(n,e)),yS(e,n,t,r),new gS(e,t,n)}(Or(),re())}const OV=Ci,gS=class extends OV{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return rc(this._hostTNode,this._hostLView)}get injector(){return new io(this._hostTNode,this._hostLView)}get parentInjector(){const n=Wf(this._hostTNode,this._hostLView);if(Tm(n)){const e=Dl(n,this._hostLView),r=El(n);return new io(e[Se].data[r+8],e)}return new io(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=mS(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-Nr}createEmbeddedView(n,e,r){let o,i;"number"==typeof r?o=r:null!=r&&(o=r.index,i=r.injector);const s=n.createEmbeddedViewImpl(e||{},i,null);return this.insertImpl(s,o,false),s}createComponent(n,e,r,o,i){const a=n&&!function Il(t){return"function"==typeof t}(n);let s;if(a)s=e;else{const g=e||{};s=g.index,r=g.injector,o=g.projectableNodes,i=g.environmentInjector||g.ngModuleRef}const u=a?n:new $l(Kt(n)),c=r||this.parentInjector;if(!i&&null==u.ngModule){const m=(a?c:this.parentInjector).get(Po,null);m&&(i=m)}Kt(u.componentType??{});const h=u.create(c,o,null,i);return this.insertImpl(h.hostView,s,false),h}insert(n,e){return this.insertImpl(n,e,!1)}insertImpl(n,e,r){const o=n._lView;if(function xO(t){return no(t[jn])}(o)){const u=this.indexOf(n);if(-1!==u)this.detach(u);else{const c=o[jn],l=new gS(c,c[Wr],c[jn]);l.detach(l.indexOf(n))}}const a=this._adjustIndex(e),s=this._lContainer;return DV(s,o,a,!r),n.attachToViewContainerRef(),ax(dy(s),a,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=mS(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),r=ih(this._lContainer,e);r&&(qf(dy(this._lContainer),e),qm(r[Se],r))}detach(n){const e=this._adjustIndex(n,-1),r=ih(this._lContainer,e);return r&&null!=qf(dy(this._lContainer),e)?new Wl(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function mS(t){return t[8]}function dy(t){return t[8]||(t[8]=[])}let yS=function bS(t,n,e,r){if(t[Hi])return;let o;o=8&e.type?In(r):function PV(t,n){const e=t[bt],r=e.createComment(""),o=wo(n,t);return Us(e,ah(e,o),r,function nL(t,n){return t.nextSibling(n)}(e,o),!1),r}(n,e),t[Hi]=o};function AS(t,n){return Wh(t,n)}const xy=new Me("Application Initializer");let Cy=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r}),this.appInits=Te(xy,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const e=[];for(const o of this.appInits){const i=o();if(Zl(i))e.push(i);else if(RE(i)){const a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});e.push(a)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),0===e.length&&r(),this.initialized=!0}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),$S=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();const Ta=new Me("LocaleId",{providedIn:"root",factory:()=>Te(Ta,jt.Optional|jt.SkipSelf)||function fU(){return typeof $localize<"u"&&$localize.locale||yc}()});let qh=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Jo(!1)}add(){this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class gU{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let GS=(()=>{class t{compileModuleSync(e){return new sy(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const r=this.compileModuleSync(e),i=Sa(No(e).declarations).reduce((a,s)=>{const u=Kt(s);return u&&a.push(new $l(u)),a},[]);return new gU(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const ZS=new Me(""),Kh=new Me("");let Ay,Sy=(()=>{class t{constructor(e,r,o){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ay||(function LU(t){Ay=t}(o),o.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{An.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,o){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==i),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:o})}whenStable(e,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,o){return[]}static{this.\u0275fac=function(r){return new(r||t)(Ue(An),Ue(Iy),Ue(Kh))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})(),Iy=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return Ay?.findTestabilityInTree(this,e,r)??null}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})(),hs=null;const YS=new Me("AllowMultipleToken"),My=new Me("PlatformDestroyListeners"),Ty=new Me("appBootstrapListener");class JS{constructor(n,e){this.name=n,this.token=e}}function tI(t,n,e=[]){const r=`Platform: ${n}`,o=new Me(r);return(i=[])=>{let a=ky();if(!a||a.injector.get(YS,!1)){const s=[...e,...i,{provide:o,useValue:!0}];t?t(s):function VU(t){if(hs&&!hs.get(YS,!1))throw new de(400,!1);(function QS(){!function sO(t){y1=t}(()=>{throw new de(600,!1)})})(),hs=t;const n=t.get(rI);(function eI(t){t.get(cC,null)?.forEach(e=>e())})(t)}(function nI(t=[],n){return Bo.create({name:n,providers:[{provide:lv,useValue:"platform"},{provide:My,useValue:new Set([()=>hs=null])},...t]})}(s,r))}return function HU(t){const n=ky();if(!n)throw new de(401,!1);return n}()}}function ky(){return hs?.get(rI)??null}let rI=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const o=function zU(t="zone.js",n){return"noop"===t?new y3:"zone.js"===t?new An(n):t}(r?.ngZone,function oI(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return o.run(()=>{const i=function Y4(t,n,e){return new ay(t,n,e)}(e.moduleType,this.injector,function cI(t){return[{provide:An,useFactory:t},{provide:Ll,multi:!0,useFactory:()=>{const n=Te($U,{optional:!0});return()=>n.initialize()}},{provide:uI,useFactory:WU},{provide:SC,useFactory:IC}]}(()=>o)),a=i.injector.get(Da,null);return o.runOutsideAngular(()=>{const s=o.onError.subscribe({next:u=>{a.handleError(u)}});i.onDestroy(()=>{Zh(this._modules,i),s.unsubscribe()})}),function iI(t,n,e){try{const r=e();return Zl(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(a,o,()=>{const s=i.injector.get(Cy);return s.runInitializers(),s.donePromise.then(()=>(function DD(t){ei(t,"Expected localeId to be defined"),"string"==typeof t&&(ED=t.toLowerCase().replace(/_/g,"-"))}(i.injector.get(Ta,yc)||yc),this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,r=[]){const o=aI({},r);return function BU(t,n,e){const r=new sy(e);return Promise.resolve(r)}(0,0,e).then(i=>this.bootstrapModuleFactory(i,o))}_moduleDoBootstrap(e){const r=e.injector.get(wc);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new de(-403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new de(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(My,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static{this.\u0275fac=function(r){return new(r||t)(Ue(Bo))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();function aI(t,n){return Array.isArray(n)?n.reduce(aI,t):{...t,...n}}let wc=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Te(uI),this.zoneIsStable=Te(SC),this.componentTypes=[],this.components=[],this.isStable=Te(qh).hasPendingTasks.pipe(pi(e=>e?lt(!1):this.zoneIsStable),function yF(t,n=qt){return t=t??bF,Ht((e,r)=>{let o,i=!0;e.subscribe(At(r,a=>{const s=n(a);(i||!t(o,s))&&(i=!1,o=s,r.next(a))}))})}(),Pw()),this._injector=Te(Po)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,r){const o=e instanceof pC;if(!this._injector.get(Cy).done)throw!o&&function Mu(t){const n=Kt(t)||Rr(t)||to(t);return null!==n&&n.standalone}(e),new de(405,!1);let a;a=o?e:this._injector.get(xh).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const s=function jU(t){return t.isBoundToModule}(a)?void 0:this._injector.get(qs),c=a.create(Bo.NULL,[],r||a.selector,s),l=c.location.nativeElement,d=c.injector.get(ZS,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),Zh(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new de(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this.internalErrorHandler(e)}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;Zh(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const r=this._injector.get(Ty,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Zh(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new de(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Zh(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}const uI=new Me("",{providedIn:"root",factory:()=>Te(Da).handleError.bind(void 0)});function WU(){const t=Te(An),n=Te(Da);return e=>t.runOutsideAngular(()=>n.handleError(e))}let $U=(()=>{class t{constructor(){this.zone=Te(An),this.applicationRef=Te(wc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();let Yh=(()=>{class t{static{this.__NG_ELEMENT_ID__=qU}}return t})();function qU(t){return function XU(t,n,e){if(Ls(t)&&!e){const r=Fo(t.index,n);return new Wl(r,r)}return 47&t.type?new Wl(n[ir],n):null}(Or(),re(),16==(16&t))}class pI{constructor(){}supports(n){return kh(n)}create(n){return new JU(n)}}const QU=(t,n)=>n;class JU{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||QU}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){const a=!r||e&&e.currentIndex<mI(r,o,i)?e:r,s=mI(a,o,i),u=a.currentIndex;if(a===r)o--,r=r._nextRemoved;else if(e=e._next,null==a.previousIndex)o++;else{i||(i=[]);const c=s-o,l=u-o;if(c!=l){for(let f=0;f<c;f++){const h=f<i.length?i[f]:i[f]=0,p=h+f;l<=p&&p<c&&(i[f]=h+1)}i[a.previousIndex]=l-c}}s!==u&&n(a,s,u)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!kh(n))throw new de(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,i,a,e=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let s=0;s<this.length;s++)i=n[s],a=this._trackByFn(s,i),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,i,a,s)),Object.is(e.item,i)||this._addIdentityChange(e,i)):(e=this._mismatch(e,i,a,s),r=!0),e=e._next}else o=0,function AB(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let r;for(;!(r=e.next()).done;)n(r.value)}}(n,s=>{a=this._trackByFn(o,s),null!==e&&Object.is(e.trackById,a)?(r&&(e=this._verifyReinsertion(e,s,a,o)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,a,o),r=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return null===n?i=this._itTail:(i=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new eH(e,r),i,o),n}_verifyReinsertion(n,e,r,o){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==i?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,i=n._nextRemoved;return null===o?this._removalsHead=i:o._nextRemoved=i,null===i?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){const o=null===e?this._itHead:e._next;return n._next=o,n._prev=e,null===o?this._itTail=n:o._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new gI),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,r=n._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gI),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class eH{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class tH{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const e=n._prevDup,r=n._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class gI{constructor(){this.map=new Map}put(n){const e=n.trackById;let r=this.map.get(e);r||(r=new tH,this.map.set(e,r)),r.add(n)}get(n,e){const o=this.map.get(n);return o?o.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function mI(t,n,e){const r=t.previousIndex;if(null===r)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}class vI{constructor(){}supports(n){return n instanceof Map||Hv(n)}create(){return new nH}}class nH{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||Hv(n)))throw new de(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,o)=>{if(e&&e.key===o)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const i=this._getOrCreateRecordForKey(o,r);e=this._insertBeforeOrAppend(e,i)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const r=n._prev;return e._next=n,e._prev=r,n._prev=e,r&&(r._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,e);const i=o._prev,a=o._next;return i&&(i._next=a),a&&(a._prev=i),o._next=null,o._prev=null,o}const r=new rH(n);return this._records.set(n,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(r=>e(n[r],r))}}class rH{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function yI(){return new ep([new pI])}let ep=(()=>{class t{static{this.\u0275prov=Je({token:t,providedIn:"root",factory:yI})}constructor(e){this.factories=e}static create(e,r){if(null!=r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||yI()),deps:[[t,new Zf,new Kf]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(null!=r)return r;throw new de(901,!1)}}return t})();function bI(){return new ud([new vI])}let ud=(()=>{class t{static{this.\u0275prov=Je({token:t,providedIn:"root",factory:bI})}constructor(e){this.factories=e}static create(e,r){if(r){const o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||bI()),deps:[[t,new Zf,new Kf]]}}find(e){const r=this.factories.find(o=>o.supports(e));if(r)return r;throw new de(901,!1)}}return t})();const aH=tI(null,"core",[]);let sH=(()=>{class t{constructor(e){}static{this.\u0275fac=function(r){return new(r||t)(Ue(wc))}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({})}}return t})();let Ly=null;function ps(){return Ly}class wH{}const Vo=new Me("DocumentToken");let By=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return Te(CH)},providedIn:"platform"})}}return t})();const xH=new Me("Location Initialized");let CH=(()=>{class t extends By{constructor(){super(),this._doc=Te(Vo),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ps().getBaseHref(this._doc)}onPopState(e){const r=ps().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=ps().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return new t},providedIn:"platform"})}}return t})();function jy(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function AI(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function ka(t){return t&&"?"!==t[0]?"?"+t:t}let Ks=(()=>{class t{historyGo(e){throw new Error("Not implemented")}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return Te(TI)},providedIn:"root"})}}return t})();const MI=new Me("appBaseHref");let TI=(()=>{class t extends Ks{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Te(Vo).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return jy(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+ka(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){const a=this.prepareExternalUrl(o+ka(i));this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){const a=this.prepareExternalUrl(o+ka(i));this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(r){return new(r||t)(Ue(By),Ue(MI,8))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),EH=(()=>{class t extends Ks{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=jy(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,o,i){let a=this.prepareExternalUrl(o+ka(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,r,a)}replaceState(e,r,o,i){let a=this.prepareExternalUrl(o+ka(i));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(r){return new(r||t)(Ue(By),Ue(MI,8))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})(),Vy=(()=>{class t{constructor(e){this._subject=new er,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const r=this._locationStrategy.getBaseHref();this._basePath=function IH(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(AI(kI(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+ka(r))}normalize(e){return t.stripTrailingSlash(function SH(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,kI(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ka(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ka(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r,complete:o})}static{this.normalizeQueryParams=ka}static{this.joinWithSlash=jy}static{this.stripTrailingSlash=AI}static{this.\u0275fac=function(r){return new(r||t)(Ue(Ks))}}static{this.\u0275prov=Je({token:t,factory:function(){return function DH(){return new Vy(Ue(Ks))}()},providedIn:"root"})}}return t})();function kI(t){return t.replace(/\/index.html$/,"")}function VI(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const r=e.indexOf("="),[o,i]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}const Zy=/\s+/,UI=[];let HI=(()=>{class t{constructor(e,r,o,i){this._iterableDiffers=e,this._keyValueDiffers=r,this._ngEl=o,this._renderer=i,this.initialClasses=UI,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(Zy):UI}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(Zy):e}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const r of e)this._updateState(r,!0);else if(null!=e)for(const r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){const o=this.stateMap.get(e);void 0!==o?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){(e=e.trim()).length>0&&e.split(Zy).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static{this.\u0275fac=function(r){return new(r||t)(q(ep),q(ud),q(Lo),q(Ea))}}static{this.\u0275dir=gt({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}}return t})();class fz{constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Zs=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const r=this._viewContainer;e.forEachOperation((o,i,a)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new fz(o.item,this._ngForOf,-1,-1),null===a?void 0:a);else if(null==a)r.remove(null===i?void 0:i);else if(null!==i){const s=r.get(i);r.move(s,a),WI(s,o)}});for(let o=0,i=r.length;o<i;o++){const s=r.get(o).context;s.index=o,s.count=i,s.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{WI(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(e,r){return!0}static{this.\u0275fac=function(r){return new(r||t)(q(Ci),q(Ma),q(ep))}}static{this.\u0275dir=gt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return t})();function WI(t,n){t.context.$implicit=n.item}let Yi=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new hz,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){$I("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){$I("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}static{this.\u0275fac=function(r){return new(r||t)(q(Ci),q(Ma))}}static{this.\u0275dir=gt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return t})();class hz{constructor(){this.$implicit=null,this.ngIf=null}}function $I(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${yr(n)}'.`)}let Bz=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({})}}return t})();function KI(t){return"server"===t}let Hz=(()=>{class t{static{this.\u0275prov=Je({token:t,providedIn:"root",factory:()=>new zz(Ue(Vo),window)})}}return t})();class zz{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function Wz(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const i=o.shadowRoot;if(i){const a=i.getElementById(n)||i.querySelector(`[name="${n}"]`);if(a)return a}o=r.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const e=n.getBoundingClientRect(),r=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class ZI{}class h6 extends wH{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class rb extends h6{static makeCurrent(){!function _H(t){Ly||(Ly=t)}(new rb)}onAndCancel(n,e,r){return n.addEventListener(e,r),()=>{n.removeEventListener(e,r)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function p6(){return fd=fd||document.querySelector("base"),fd?fd.getAttribute("href"):null}();return null==e?null:function g6(t){pp=pp||document.createElement("a"),pp.setAttribute("href",t);const n=pp.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){fd=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return VI(document.cookie,n)}}let pp,fd=null,v6=(()=>{class t{build(){return new XMLHttpRequest}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const ob=new Me("EventManagerPlugins");let t2=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o){return this._findPluginFor(r).addEventListener(e,r,o)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new de(5101,!1);return this._eventNameToPlugin.set(e,r),r}static{this.\u0275fac=function(r){return new(r||t)(Ue(ob),Ue(An))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();class n2{constructor(n){this._doc=n}}const ib="ng-app-id";let r2=(()=>{class t{constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=KI(i),this.resetHostNodes()}addStyles(e){for(const r of e)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(e){for(const r of e)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const e=this.styleNodesInDOM;e&&(e.forEach(r=>r.remove()),e.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(const r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){const r=this.styleRef;r.get(e)?.elements?.forEach(o=>o.remove()),r.delete(e)}collectServerRenderedStyles(){const e=this.doc.head?.querySelectorAll(`style[${ib}="${this.appId}"]`);if(e?.length){const r=new Map;return e.forEach(o=>{null!=o.textContent&&r.set(o.textContent,o)}),r}return null}changeUsageCount(e,r){const o=this.styleRef;if(o.has(e)){const i=o.get(e);return i.usage+=r,i.usage}return o.set(e,{usage:r,elements:[]}),r}getStyleElement(e,r){const o=this.styleNodesInDOM,i=o?.get(r);if(i?.parentNode===e)return o.delete(r),i.removeAttribute(ib),i;{const a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=r,this.platformIsServer&&a.setAttribute(ib,this.appId),a}}addStyleToHost(e,r){const o=this.getStyleElement(e,r);e.appendChild(o);const i=this.styleRef,a=i.get(r)?.elements;a?a.push(o):i.set(r,{elements:[o],usage:1})}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}static{this.\u0275fac=function(r){return new(r||t)(Ue(Vo),Ue(mh),Ue(lC,8),Ue(zs))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const ab={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},sb=/%COMP%/g,w6=new Me("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function i2(t,n){return n.map(e=>e.replace(sb,t))}let a2=(()=>{class t{constructor(e,r,o,i,a,s,u,c=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=a,this.platformId=s,this.ngZone=u,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=KI(s),this.defaultRenderer=new ub(e,a,u,this.platformIsServer)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===gi.ShadowDom&&(r={...r,encapsulation:gi.Emulated});const o=this.getOrCreateRenderer(e,r);return o instanceof u2?o.applyToHost(e):o instanceof cb&&o.applyStyles(),o}getOrCreateRenderer(e,r){const o=this.rendererByCompId;let i=o.get(r.id);if(!i){const a=this.doc,s=this.ngZone,u=this.eventManager,c=this.sharedStylesHost,l=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(r.encapsulation){case gi.Emulated:i=new u2(u,c,r,this.appId,l,a,s,d);break;case gi.ShadowDom:return new D6(u,c,e,r,a,s,this.nonce,d);default:i=new cb(u,c,r,l,a,s,d)}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(r){return new(r||t)(Ue(t2),Ue(r2),Ue(mh),Ue(w6),Ue(Vo),Ue(zs),Ue(An),Ue(lC))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();class ub{constructor(n,e,r,o){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?this.doc.createElementNS(ab[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(s2(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(s2(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new de(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;const i=ab[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){const o=ab[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(cs.DashCase|cs.Important)?n.style.setProperty(e,r,o&cs.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&cs.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n[e]=r}setValue(n,e){n.nodeValue=e}listen(n,e,r){if("string"==typeof n&&!(n=ps().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${e}`);return this.eventManager.addEventListener(n,e,this.decoratePreventDefault(r))}decoratePreventDefault(n){return e=>{if("__ngUnwrap__"===e)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))&&e.preventDefault()}}}function s2(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class D6 extends ub{constructor(n,e,r,o,i,a,s,u){super(n,i,a,u),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=i2(o.id,o.styles);for(const l of c){const d=document.createElement("style");s&&d.setAttribute("nonce",s),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class cb extends ub{constructor(n,e,r,o,i,a,s,u){super(n,i,a,s),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o,this.styles=u?i2(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class u2 extends cb{constructor(n,e,r,o,i,a,s,u){const c=o+"-"+r.id;super(n,e,r,i,a,s,u,c),this.contentAttr=function x6(t){return"_ngcontent-%COMP%".replace(sb,t)}(c),this.hostAttr=function C6(t){return"_nghost-%COMP%".replace(sb,t)}(c)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}}let S6=(()=>{class t extends n2{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o){return e.addEventListener(r,o,!1),()=>this.removeEventListener(e,r,o)}removeEventListener(e,r,o){return e.removeEventListener(r,o)}static{this.\u0275fac=function(r){return new(r||t)(Ue(Vo))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const c2=["alt","control","meta","shift"],I6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},A6={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let M6=(()=>{class t extends n2{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,o){const i=t.parseEventName(r),a=t.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ps().onAndCancel(e,i.domEventName,a))}static parseEventName(e){const r=e.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const i=t._normalizeKey(r.pop());let a="",s=r.indexOf("code");if(s>-1&&(r.splice(s,1),a="code."),c2.forEach(c=>{const l=r.indexOf(c);l>-1&&(r.splice(l,1),a+=c+".")}),a+=i,0!=r.length||0===i.length)return null;const u={};return u.domEventName=o,u.fullKey=a,u}static matchEventFullKeyCode(e,r){let o=I6[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),c2.forEach(a=>{a!==o&&(0,A6[a])(e)&&(i+=a+".")}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return"esc"===e?"escape":e}static{this.\u0275fac=function(r){return new(r||t)(Ue(Vo))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const d2=[{provide:zs,useValue:"browser"},{provide:cC,useValue:function T6(){rb.makeCurrent()},multi:!0},{provide:Vo,useFactory:function R6(){return function lL(t){ev=t}(document),document},deps:[]}],N6=tI(aH,"browser",d2),F6=new Me(""),f2=[{provide:Kh,useClass:class m6{addToWindow(n){Sn.getAngularTestability=(r,o=!0)=>{const i=n.findTestabilityInTree(r,o);if(null==i)throw new de(5103,!1);return i},Sn.getAllAngularTestabilities=()=>n.getAllTestabilities(),Sn.getAllAngularRootElements=()=>n.getAllRootElements(),Sn.frameworkStabilizers||(Sn.frameworkStabilizers=[]),Sn.frameworkStabilizers.push(r=>{const o=Sn.getAllAngularTestabilities();let i=o.length,a=!1;const s=function(u){a=a||u,i--,0==i&&r(a)};o.forEach(u=>{u.whenStable(s)})})}findTestabilityInTree(n,e,r){return null==e?null:n.getTestability(e)??(r?ps().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:ZS,useClass:Sy,deps:[An,Iy,Kh]},{provide:Sy,useClass:Sy,deps:[An,Iy,Kh]}],h2=[{provide:lv,useValue:"root"},{provide:Da,useFactory:function k6(){return new Da},deps:[]},{provide:ob,useClass:S6,multi:!0,deps:[Vo,An,zs]},{provide:ob,useClass:M6,multi:!0,deps:[Vo]},a2,r2,t2,{provide:mC,useExisting:a2},{provide:ZI,useClass:v6,deps:[]},[]];let O6=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:mh,useValue:e.appId}]}}static{this.\u0275fac=function(r){return new(r||t)(Ue(F6,12))}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({providers:[...h2,...f2],imports:[Bz,sH]})}}return t})(),p2=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static{this.\u0275fac=function(r){return new(r||t)(Ue(Vo))}}static{this.\u0275prov=Je({token:t,factory:function(r){let o=null;return o=r?new r:function L6(){return new p2(Ue(Vo))}(),o},providedIn:"root"})}}return t})();function Ec(t,n){return ve(n)?kr(t,n,1):kr(t,1)}function Qi(t,n){return Ht((e,r)=>{let o=0;e.subscribe(At(r,i=>t.call(n,i,o++)&&r.next(i)))})}function hd(t){return Ht((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}typeof window<"u"&&window;class gp{}class mp{}class Ze{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?"string"==typeof n?this.lazyInit=()=>{this.headers=new Map,n.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const o=e.slice(0,r),i=o.toLowerCase(),a=e.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.setHeaderEntries(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof Ze?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new Ze;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Ze?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,e);const o=("a"===n.op?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":const i=n.value;if(i){let a=this.headers.get(e);if(!a)return;a=a.filter(s=>-1===i.indexOf(s)),0===a.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}else this.headers.delete(e),this.normalizedNames.delete(e)}}setHeaderEntries(n,e){const r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class H6{encodeKey(n){return y2(n)}encodeValue(n){return y2(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const W6=/%(\d[a-f0-9])/gi,$6={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function y2(t){return encodeURIComponent(t).replace(W6,(n,e)=>$6[e]??n)}function vp(t){return`${t}`}class Fa{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new H6,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function z6(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,s]=-1==i?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],u=e.get(a)||[];u.push(s),e.set(a,u)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const r=n.fromObject[e],o=Array.isArray(r)?r.map(vp):[vp(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(r=>{const o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new Fa({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(vp(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const o=r.indexOf(vp(n.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class G6{constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function b2(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function _2(t){return typeof Blob<"u"&&t instanceof Blob}function w2(t){return typeof FormData<"u"&&t instanceof FormData}class pd{constructor(n,e,r,o){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function q6(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ze),this.context||(this.context=new G6),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=e;else{const s=e.indexOf("?");this.urlWithParams=e+(-1===s?"?":s<e.length-1?"&":"")+a}}else this.params=new Fa,this.urlWithParams=e}serializeBody(){return null===this.body?null:b2(this.body)||_2(this.body)||w2(this.body)||function X6(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Fa?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||w2(this.body)?null:_2(this.body)?this.body.type||null:b2(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Fa?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=void 0!==n.body?n.body:this.body,a=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,s=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let u=n.headers||this.headers,c=n.params||this.params;const l=n.context??this.context;return void 0!==n.setHeaders&&(u=Object.keys(n.setHeaders).reduce((d,f)=>d.set(f,n.setHeaders[f]),u)),n.setParams&&(c=Object.keys(n.setParams).reduce((d,f)=>d.set(f,n.setParams[f]),c)),new pd(e,r,i,{params:c,headers:u,context:l,reportProgress:s,responseType:o,withCredentials:a})}}var Dc=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Dc||{});class db{constructor(n,e=200,r="OK"){this.headers=n.headers||new Ze,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class fb extends db{constructor(n={}){super(n),this.type=Dc.ResponseHeader}clone(n={}){return new fb({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Sc extends db{constructor(n={}){super(n),this.type=Dc.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Sc({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class x2 extends db{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function hb(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let pb=(()=>{class t{constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof pd)i=e;else{let u,c;u=o.headers instanceof Ze?o.headers:new Ze(o.headers),o.params&&(c=o.params instanceof Fa?o.params:new Fa({fromObject:o.params})),i=new pd(e,r,void 0!==o.body?o.body:null,{headers:u,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=lt(i).pipe(Ec(u=>this.handler.handle(u)));if(e instanceof pd||"events"===o.observe)return a;const s=a.pipe(Qi(u=>u instanceof Sc));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe(et(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return s.pipe(et(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return s.pipe(et(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return s.pipe(et(u=>u.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new Fa).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,hb(o,r))}post(e,r,o={}){return this.request("POST",e,hb(o,r))}put(e,r,o={}){return this.request("PUT",e,hb(o,r))}static{this.\u0275fac=function(r){return new(r||t)(Ue(gp))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();function D2(t,n){return n(t)}function Z6(t,n){return(e,r)=>n.intercept(e,{handle:o=>t(o,r)})}const Q6=new Me(""),gd=new Me(""),S2=new Me("");function J6(){let t=null;return(n,e)=>{null===t&&(t=(Te(Q6,{optional:!0})??[]).reduceRight(Z6,D2));const r=Te(qh),o=r.add();return t(n,e).pipe(hd(()=>r.remove(o)))}}let I2=(()=>{class t extends gp{constructor(e,r){super(),this.backend=e,this.injector=r,this.chain=null,this.pendingTasks=Te(qh)}handle(e){if(null===this.chain){const o=Array.from(new Set([...this.injector.get(gd),...this.injector.get(S2,[])]));this.chain=o.reduceRight((i,a)=>function Y6(t,n,e){return(r,o)=>e.runInContext(()=>n(r,i=>t(i,o)))}(i,a,this.injector),D2)}const r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(hd(()=>this.pendingTasks.remove(r)))}static{this.\u0275fac=function(r){return new(r||t)(Ue(mp),Ue(Po))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const rW=/^\)\]\}',?\n/;let M2=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new de(-2800,!1);const r=this.xhrFactory;return(r.\u0275loadImpl?vr(r.\u0275loadImpl()):lt(null)).pipe(pi(()=>new kt(i=>{const a=r.build();if(a.open(e.method,e.urlWithParams),e.withCredentials&&(a.withCredentials=!0),e.headers.forEach((g,m)=>a.setRequestHeader(g,m.join(","))),e.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const g=e.detectContentTypeHeader();null!==g&&a.setRequestHeader("Content-Type",g)}if(e.responseType){const g=e.responseType.toLowerCase();a.responseType="json"!==g?g:"text"}const s=e.serializeBody();let u=null;const c=()=>{if(null!==u)return u;const g=a.statusText||"OK",m=new Ze(a.getAllResponseHeaders()),v=function oW(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(a)||e.url;return u=new fb({headers:m,status:a.status,statusText:g,url:v}),u},l=()=>{let{headers:g,status:m,statusText:v,url:b}=c(),w=null;204!==m&&(w=typeof a.response>"u"?a.responseText:a.response),0===m&&(m=w?200:0);let _=m>=200&&m<300;if("json"===e.responseType&&"string"==typeof w){const x=w;w=w.replace(rW,"");try{w=""!==w?JSON.parse(w):null}catch(D){w=x,_&&(_=!1,w={error:D,text:w})}}_?(i.next(new Sc({body:w,headers:g,status:m,statusText:v,url:b||void 0})),i.complete()):i.error(new x2({error:w,headers:g,status:m,statusText:v,url:b||void 0}))},d=g=>{const{url:m}=c(),v=new x2({error:g,status:a.status||0,statusText:a.statusText||"Unknown Error",url:m||void 0});i.error(v)};let f=!1;const h=g=>{f||(i.next(c()),f=!0);let m={type:Dc.DownloadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),"text"===e.responseType&&a.responseText&&(m.partialText=a.responseText),i.next(m)},p=g=>{let m={type:Dc.UploadProgress,loaded:g.loaded};g.lengthComputable&&(m.total=g.total),i.next(m)};return a.addEventListener("load",l),a.addEventListener("error",d),a.addEventListener("timeout",d),a.addEventListener("abort",d),e.reportProgress&&(a.addEventListener("progress",h),null!==s&&a.upload&&a.upload.addEventListener("progress",p)),a.send(s),i.next({type:Dc.Sent}),()=>{a.removeEventListener("error",d),a.removeEventListener("abort",d),a.removeEventListener("load",l),a.removeEventListener("timeout",d),e.reportProgress&&(a.removeEventListener("progress",h),null!==s&&a.upload&&a.upload.removeEventListener("progress",p)),a.readyState!==a.DONE&&a.abort()}})))}static{this.\u0275fac=function(r){return new(r||t)(Ue(ZI))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();const gb=new Me("XSRF_ENABLED"),T2=new Me("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),k2=new Me("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class R2{}let sW=(()=>{class t{constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=VI(e,this.cookieName),this.lastCookieString=e),this.lastToken}static{this.\u0275fac=function(r){return new(r||t)(Ue(Vo),Ue(zs),Ue(T2))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();function uW(t,n){const e=t.url.toLowerCase();if(!Te(gb)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const r=Te(R2).getToken(),o=Te(k2);return null!=r&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var ms=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(ms||{});function Ys(t,n){return{\u0275kind:t,\u0275providers:n}}function cW(...t){const n=[pb,M2,I2,{provide:gp,useExisting:I2},{provide:mp,useExisting:M2},{provide:gd,useValue:uW,multi:!0},{provide:gb,useValue:!0},{provide:R2,useClass:sW}];for(const e of t)n.push(...e.\u0275providers);return function sv(t){return{\u0275providers:t}}(n)}const N2=new Me("LEGACY_INTERCEPTOR_FN");let dW=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({providers:[cW(Ys(ms.LegacyInterceptors,[{provide:N2,useFactory:J6},{provide:gd,useExisting:N2,multi:!0}]))]})}}return t})();const{isArray:yW}=Array,{getPrototypeOf:bW,prototype:_W,keys:wW}=Object;function F2(t){if(1===t.length){const n=t[0];if(yW(n))return{args:n,keys:null};if(function xW(t){return t&&"object"==typeof t&&bW(t)===_W}(n)){const e=wW(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}const{isArray:CW}=Array;function O2(t){return et(n=>function EW(t,n){return CW(n)?t(...n):t(n)}(t,n))}function P2(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function mb(...t){const n=cl(t),e=Rw(t),{args:r,keys:o}=F2(t);if(0===r.length)return vr([],n);const i=new kt(function DW(t,n,e=qt){return r=>{L2(n,()=>{const{length:o}=t,i=new Array(o);let a=o,s=o;for(let u=0;u<o;u++)L2(n,()=>{const c=vr(t[u],n);let l=!1;c.subscribe(At(r,d=>{i[u]=d,l||(l=!0,s--),s||r.next(e(i.slice()))},()=>{--a||r.complete()}))},r)},r)}}(r,n,o?a=>P2(o,a):qt));return e?i.pipe(O2(e)):i}function L2(t,n,e){t?Qo(e,t,n):n()}const bp=_e(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function vb(...t){return function SW(){return Iu(1)}()(vr(t,cl(t)))}function B2(t){return new kt(n=>{hn(t()).subscribe(n)})}function Lr(t,n){const e=ve(t)?t:()=>t,r=o=>o.error(e());return new kt(n?o=>n.schedule(r,0,o):r)}function yb(){return Ht((t,n)=>{let e=null;t._refCount++;const r=At(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}class j2 extends kt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Fn(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new pe;const e=this.getSubject();n.add(this.source.subscribe(At(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=pe.EMPTY)}return n}refCount(){return yb()(this)}}function Ic(t){return t<=0?()=>ji:Ht((n,e)=>{let r=0;n.subscribe(At(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function _p(t){return Ht((n,e)=>{let r=!1;n.subscribe(At(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function V2(t=AW){return Ht((n,e)=>{let r=!1;n.subscribe(At(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function AW(){return new bp}function Qs(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Qi((o,i)=>t(o,i,r)):qt,Ic(1),e?_p(n):V2(()=>new bp))}function Br(t,n,e){const r=ve(t)||n||e?{next:t,error:n,complete:e}:t;return r?Ht((o,i)=>{var a;null===(a=r.subscribe)||void 0===a||a.call(r);let s=!0;o.subscribe(At(i,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),i.next(u)},()=>{var u;s=!1,null===(u=r.complete)||void 0===u||u.call(r),i.complete()},u=>{var c;s=!1,null===(c=r.error)||void 0===c||c.call(r,u),i.error(u)},()=>{var u,c;s&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):qt}function Le(t){return Ht((n,e)=>{let i,r=null,o=!1;r=n.subscribe(At(e,void 0,void 0,a=>{i=hn(t(a,Le(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function bb(t){return t<=0?()=>ji:Ht((n,e)=>{let r=[];n.subscribe(At(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(const o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}const It="primary",md=Symbol("RouteTitle");class FW{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ac(t){return new FW(t)}function OW(t,n,e){const r=e.path.split("/");if(r.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||r.length<t.length))return null;const o={};for(let i=0;i<r.length;i++){const a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function Ji(t,n){const e=t?Object.keys(t):void 0,r=n?Object.keys(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!U2(t[o],n[o]))return!1;return!0}function U2(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}return t===n}function H2(t){return t.length>0?t[t.length-1]:null}function vs(t){return function vW(t){return!!t&&(t instanceof kt||ve(t.lift)&&ve(t.subscribe))}(t)?t:Zl(t)?vr(Promise.resolve(t)):lt(t)}const LW={exact:function $2(t,n,e){if(!Js(t.segments,n.segments)||!wp(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!t.children[r]||!$2(t.children[r],n.children[r],e))return!1;return!0},subset:G2},z2={exact:function BW(t,n){return Ji(t,n)},subset:function jW(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>U2(t[e],n[e]))},ignored:()=>!0};function W2(t,n,e){return LW[e.paths](t.root,n.root,e.matrixParams)&&z2[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function G2(t,n,e){return q2(t,n,n.segments,e)}function q2(t,n,e,r){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!Js(o,e)||n.hasChildren()||!wp(o,e,r))}if(t.segments.length===e.length){if(!Js(t.segments,e)||!wp(t.segments,e,r))return!1;for(const o in n.children)if(!t.children[o]||!G2(t.children[o],n.children[o],r))return!1;return!0}{const o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!!(Js(t.segments,o)&&wp(t.segments,o,r)&&t.children[It])&&q2(t.children[It],n,i,r)}}function wp(t,n,e){return n.every((r,o)=>z2[e](t[o].parameters,r.parameters))}class Mc{constructor(n=new mn([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ac(this.queryParams)),this._queryParamMap}toString(){return HW.serialize(this)}}class mn{constructor(n,e){this.segments=n,this.children=e,this.parent=null,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return xp(this)}}class vd{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ac(this.parameters)),this._parameterMap}toString(){return Z2(this)}}function Js(t,n){return t.length===n.length&&t.every((e,r)=>e.path===n[r].path)}let yd=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return new _b},providedIn:"root"})}}return t})();class _b{parse(n){const e=new JW(n);return new Mc(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${bd(n.root,!0)}`,r=function $W(t){const n=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(o=>`${Cp(e)}=${Cp(o)}`).join("&"):`${Cp(e)}=${Cp(r)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${r}${"string"==typeof n.fragment?`#${function zW(t){return encodeURI(t)}(n.fragment)}`:""}`}}const HW=new _b;function xp(t){return t.segments.map(n=>Z2(n)).join("/")}function bd(t,n){if(!t.hasChildren())return xp(t);if(n){const e=t.children[It]?bd(t.children[It],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==It&&r.push(`${o}:${bd(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function UW(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===It&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==It&&(e=e.concat(n(o,r)))}),e}(t,(r,o)=>o===It?[bd(t.children[It],!1)]:[`${o}:${bd(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[It]?`${xp(t)}/${e[0]}`:`${xp(t)}/(${e.join("//")})`}}function X2(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Cp(t){return X2(t).replace(/%3B/gi,";")}function wb(t){return X2(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ep(t){return decodeURIComponent(t)}function K2(t){return Ep(t.replace(/\+/g,"%20"))}function Z2(t){return`${wb(t.path)}${function WW(t){return Object.keys(t).map(n=>`;${wb(n)}=${wb(t[n])}`).join("")}(t.parameters)}`}const GW=/^[^\/()?;#]+/;function xb(t){const n=t.match(GW);return n?n[0]:""}const qW=/^[^\/()?;=#]+/,KW=/^[^=?&#]+/,YW=/^[^&#]+/;class JW{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new mn([],{}):new mn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[It]=new mn(n,e)),r}parseSegment(){const n=xb(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new de(4009,!1);return this.capture(n),new vd(Ep(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=function XW(t){const n=t.match(qW);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const o=xb(this.remaining);o&&(r=o,this.capture(r))}n[Ep(e)]=Ep(r)}parseQueryParam(n){const e=function ZW(t){const n=t.match(KW);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const a=function QW(t){const n=t.match(YW);return n?n[0]:""}(this.remaining);a&&(r=a,this.capture(r))}const o=K2(e),i=K2(r);if(n.hasOwnProperty(o)){let a=n[o];Array.isArray(a)||(a=[a],n[o]=a),a.push(i)}else n[o]=i}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=xb(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new de(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=It);const a=this.parseChildren();e[i]=1===Object.keys(a).length?a[It]:new mn([],a),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new de(4011,!1)}}function Y2(t){return t.segments.length>0?new mn([],{[It]:t}):t}function Q2(t){const n={};for(const r of Object.keys(t.children)){const i=Q2(t.children[r]);if(r===It&&0===i.segments.length&&i.hasChildren())for(const[a,s]of Object.entries(i.children))n[a]=s;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}return function e5(t){if(1===t.numberOfChildren&&t.children[It]){const n=t.children[It];return new mn(t.segments.concat(n.segments),n.children)}return t}(new mn(t.segments,n))}function eu(t){return t instanceof Mc}function J2(t){let n;const o=Y2(function e(i){const a={};for(const u of i.children){const c=e(u);a[u.outlet]=c}const s=new mn(i.url,a);return i===t&&(n=s),s}(t.root));return n??o}function eA(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(0===n.length)return Cb(o,o,o,e,r);const i=function n5(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new nA(!0,0,t);let n=0,e=!1;const r=t.reduce((o,i,a)=>{if("object"==typeof i&&null!=i){if(i.outlets){const s={};return Object.entries(i.outlets).forEach(([u,c])=>{s[u]="string"==typeof c?c.split("/"):c}),[...o,{outlets:s}]}if(i.segmentPath)return[...o,i.segmentPath]}return"string"!=typeof i?[...o,i]:0===a?(i.split("/").forEach((s,u)=>{0==u&&"."===s||(0==u&&""===s?e=!0:".."===s?n++:""!=s&&o.push(s))}),o):[...o,i]},[]);return new nA(e,n,r)}(n);if(i.toRoot())return Cb(o,o,new mn([],{}),e,r);const a=function r5(t,n,e){if(t.isAbsolute)return new Sp(n,!0,0);if(!e)return new Sp(n,!1,NaN);if(null===e.parent)return new Sp(e,!0,0);const r=Dp(t.commands[0])?0:1;return function o5(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new de(4005,!1);o=r.segments.length}return new Sp(r,!1,o-i)}(e,e.segments.length-1+r,t.numberOfDoubleDots)}(i,o,t),s=a.processChildren?wd(a.segmentGroup,a.index,i.commands):rA(a.segmentGroup,a.index,i.commands);return Cb(o,a.segmentGroup,s,e,r)}function Dp(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function _d(t){return"object"==typeof t&&null!=t&&t.outlets}function Cb(t,n,e,r,o){let a,i={};r&&Object.entries(r).forEach(([u,c])=>{i[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`}),a=t===n?e:tA(t,n,e);const s=Y2(Q2(a));return new Mc(s,i,o)}function tA(t,n,e){const r={};return Object.entries(t.children).forEach(([o,i])=>{r[o]=i===n?e:tA(i,n,e)}),new mn(t.segments,r)}class nA{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Dp(r[0]))throw new de(4003,!1);const o=r.find(_d);if(o&&o!==H2(r))throw new de(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Sp{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}}function rA(t,n,e){if(t||(t=new mn([],{})),0===t.segments.length&&t.hasChildren())return wd(t,n,e);const r=function a5(t,n,e){let r=0,o=n;const i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;const a=t.segments[o],s=e[r];if(_d(s))break;const u=`${s}`,c=r<e.length-1?e[r+1]:null;if(o>0&&void 0===u)break;if(u&&c&&"object"==typeof c&&void 0===c.outlets){if(!iA(u,c,a))return i;r+=2}else{if(!iA(u,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const i=new mn(t.segments.slice(0,r.pathIndex),{});return i.children[It]=new mn(t.segments.slice(r.pathIndex),t.children),wd(i,0,o)}return r.match&&0===o.length?new mn(t.segments,{}):r.match&&!t.hasChildren()?Eb(t,n,e):r.match?wd(t,0,o):Eb(t,n,e)}function wd(t,n,e){if(0===e.length)return new mn(t.segments,{});{const r=function i5(t){return _d(t[0])?t[0].outlets:{[It]:t}}(e),o={};if(Object.keys(r).some(i=>i!==It)&&t.children[It]&&1===t.numberOfChildren&&0===t.children[It].segments.length){const i=wd(t.children[It],n,e);return new mn(t.segments,i.children)}return Object.entries(r).forEach(([i,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(o[i]=rA(t.children[i],n,a))}),Object.entries(t.children).forEach(([i,a])=>{void 0===r[i]&&(o[i]=a)}),new mn(t.segments,o)}}function Eb(t,n,e){const r=t.segments.slice(0,n);let o=0;for(;o<e.length;){const i=e[o];if(_d(i)){const u=s5(i.outlets);return new mn(r,u)}if(0===o&&Dp(e[0])){r.push(new vd(t.segments[n].path,oA(e[0]))),o++;continue}const a=_d(i)?i.outlets[It]:`${i}`,s=o<e.length-1?e[o+1]:null;a&&s&&Dp(s)?(r.push(new vd(a,oA(s))),o+=2):(r.push(new vd(a,{})),o++)}return new mn(r,{})}function s5(t){const n={};return Object.entries(t).forEach(([e,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[e]=Eb(new mn([],{}),0,r))}),n}function oA(t){const n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function iA(t,n,e){return t==e.path&&Ji(n,e.parameters)}const xd="imperative";class ea{constructor(n,e){this.id=n,this.url=e}}class Cd extends ea{constructor(n,e,r="imperative",o=null){super(n,e),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Oa extends ea{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ed extends ea{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Tc extends ea{constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o,this.type=16}}class Ip extends ea{constructor(n,e,r,o){super(n,e),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class aA extends ea{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class u5 extends ea{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class c5 extends ea{constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class l5 extends ea{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class d5 extends ea{constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class f5{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class h5{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class p5{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class g5{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class m5{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class v5{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sA{constructor(n,e,r){this.routerEvent=n,this.position=e,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Db{}class Sb{constructor(n){this.url=n}}class y5{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Dd,this.attachRef=null}}let Dd=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){const o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){const r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new y5,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class uA{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Ib(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){const e=Ib(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=Ab(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Ab(n,this._root).map(e=>e.value)}}function Ib(t,n){if(t===n.value)return n;for(const e of n.children){const r=Ib(t,e);if(r)return r}return null}function Ab(t,n){if(t===n.value)return[n];for(const e of n.children){const r=Ab(t,e);if(r.length)return r.unshift(n),r}return[]}class Pa{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function kc(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class cA extends uA{constructor(n,e){super(n),this.snapshot=e,Mb(this,n)}toString(){return this.snapshot.toString()}}function lA(t,n){const e=function b5(t,n){const a=new Ap([],{},{},"",{},It,n,null,{});return new fA("",new Pa(a,[]))}(0,n),r=new Jo([new vd("",{})]),o=new Jo({}),i=new Jo({}),a=new Jo({}),s=new Jo(""),u=new Si(r,o,a,s,i,It,n,e.root);return u.snapshot=e.root,new cA(new Pa(u,[]),e)}class Si{constructor(n,e,r,o,i,a,s,u){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=a,this.component=s,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(et(c=>c[md]))??lt(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(et(n=>Ac(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(et(n=>Ac(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function dA(t,n="emptyOnly"){const e=t.pathFromRoot;let r=0;if("always"!==n)for(r=e.length-1;r>=1;){const o=e[r],i=e[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function _5(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(r))}class Ap{get title(){return this.data?.[md]}constructor(n,e,r,o,i,a,s,u,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=a,this.component=s,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ac(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ac(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class fA extends uA{constructor(n,e){super(e),this.url=n,Mb(this,e)}toString(){return hA(this._root)}}function Mb(t,n){n.value._routerState=t,n.children.forEach(e=>Mb(t,e))}function hA(t){const n=t.children.length>0?` { ${t.children.map(hA).join(", ")} } `:"";return`${t.value}${n}`}function Tb(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,Ji(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),Ji(n.params,e.params)||t.paramsSubject.next(e.params),function PW(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!Ji(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.urlSubject.next(e.url),Ji(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function kb(t,n){const e=Ji(t.params,n.params)&&function VW(t,n){return Js(t,n)&&t.every((e,r)=>Ji(e.parameters,n[r].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||kb(t.parent,n.parent))}let Rb=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=It,this.activateEvents=new er,this.deactivateEvents=new er,this.attachEvents=new er,this.detachEvents=new er,this.parentContexts=Te(Dd),this.location=Te(Ci),this.changeDetector=Te(Yh),this.environmentInjector=Te(Po),this.inputBinder=Te(Mp,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){const{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new de(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new de(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new de(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new de(4013,!1);this._activatedRoute=e;const o=this.location,a=e.snapshot.component,s=this.parentContexts.getOrCreateContext(this.name).children,u=new w5(e,s,o.injector);this.activated=o.createComponent(a,{index:o.length,injector:u,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275dir=gt({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ri]})}}return t})();class w5{constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===Si?this.route:n===Dd?this.childContexts:this.parent.get(n,e)}}const Mp=new Me("");let pA=(()=>{class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:r}=e,o=mb([r.queryParams,r.params,r.data]).pipe(pi(([i,a,s],u)=>(s={...i,...a,...s},0===u?lt(s):Promise.resolve(s)))).subscribe(i=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(e);const a=function bH(t){const n=Kt(t);if(!n)return null;const e=new $l(n);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(a)for(const{templateName:s}of a.inputs)e.activatedComponentRef.setInput(s,i[s]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,o)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();function Sd(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=n.value;const o=function C5(t,n,e){return n.children.map(r=>{for(const o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Sd(t,r,o);return Sd(t,r)})}(t,n,e);return new Pa(r,o)}{if(t.shouldAttach(n.value)){const i=t.retrieve(n.value);if(null!==i){const a=i.route;return a.value._futureSnapshot=n.value,a.children=n.children.map(s=>Sd(t,s)),a}}const r=function E5(t){return new Si(new Jo(t.url),new Jo(t.params),new Jo(t.queryParams),new Jo(t.fragment),new Jo(t.data),t.outlet,t.component,t)}(n.value),o=n.children.map(i=>Sd(t,i));return new Pa(r,o)}}const Nb="ngNavigationCancelingError";function gA(t,n){const{redirectTo:e,navigationBehaviorOptions:r}=eu(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=mA(!1,0,n);return o.url=e,o.navigationBehaviorOptions=r,o}function mA(t,n,e){const r=new Error("NavigationCancelingError: "+(t||""));return r[Nb]=!0,r.cancellationCode=n,e&&(r.url=e),r}function vA(t){return t&&t[Nb]}let yA=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=vi({type:t,selectors:[["ng-component"]],standalone:!0,features:[QD],decls:1,vars:0,template:function(r,o){1&r&&bn(0,"router-outlet")},dependencies:[Rb],encapsulation:2})}}return t})();function Fb(t){const n=t.children&&t.children.map(Fb),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==It&&(e.component=yA),e}function Ii(t){return t.outlet||It}function Id(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class R5{constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),Tb(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){const o=kc(e);n.children.forEach(i=>{const a=i.value.outlet;this.deactivateRoutes(i,o[a],r),delete o[a]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(o===i)if(o.component){const a=r.getContext(o.outlet);a&&this.deactivateChildRoutes(n,e,a.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=kc(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);if(r&&r.outlet){const a=r.outlet.detach(),s=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:a,route:n,contexts:s})}}deactivateRouteAndOutlet(n,e){const r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=kc(n);for(const a of Object.keys(i))this.deactivateRouteAndItsChildren(i[a],o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){const o=kc(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new v5(i.value.snapshot))}),n.children.length&&this.forwardEvent(new g5(n.value.snapshot))}activateRoutes(n,e,r){const o=n.value,i=e?e.value:null;if(Tb(o),o===i)if(o.component){const a=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,a.children)}else this.activateChildRoutes(n,e,r);else if(o.component){const a=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const s=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),Tb(s.route.value),this.activateChildRoutes(n,null,a.children)}else{const s=Id(o.snapshot);a.attachRef=null,a.route=o,a.injector=s,a.outlet&&a.outlet.activateWith(o,a.injector),this.activateChildRoutes(n,null,a.children)}}else this.activateChildRoutes(n,null,r)}}class bA{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Tp{constructor(n,e){this.component=n,this.route=e}}function N5(t,n,e){const r=t._root;return Ad(r,n?n._root:null,e,[r.value])}function Rc(t,n){const e=Symbol(),r=n.get(t,e);return r===e?"function"!=typeof t||function SF(t){return null!==Df(t)}(t)?n.get(t):t:r}function Ad(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=kc(n);return t.children.forEach(a=>{(function O5(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const i=t.value,a=n?n.value:null,s=e?e.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){const u=function P5(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!Js(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Js(t.url,n.url)||!Ji(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!kb(t,n)||!Ji(t.queryParams,n.queryParams);default:return!kb(t,n)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new bA(r)):(i.data=a.data,i._resolvedData=a._resolvedData),Ad(t,n,i.component?s?s.children:null:e,r,o),u&&s&&s.outlet&&s.outlet.isActivated&&o.canDeactivateChecks.push(new Tp(s.outlet.component,a))}else a&&Md(n,s,o),o.canActivateChecks.push(new bA(r)),Ad(t,null,i.component?s?s.children:null:e,r,o)})(a,i[a.value.outlet],e,r.concat([a.value]),o),delete i[a.value.outlet]}),Object.entries(i).forEach(([a,s])=>Md(s,e.getContext(a),o)),o}function Md(t,n,e){const r=kc(t),o=t.value;Object.entries(r).forEach(([i,a])=>{Md(a,o.component?n?n.children.getContext(i):null:n,e)}),e.canDeactivateChecks.push(new Tp(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}function Td(t){return"function"==typeof t}function _A(t){return t instanceof bp||"EmptyError"===t?.name}const kp=Symbol("INITIAL_VALUE");function Nc(){return pi(t=>mb(t.map(n=>n.pipe(Ic(1),function IW(...t){const n=cl(t);return Ht((e,r)=>{(n?vb(t,e,n):vb(t,e)).subscribe(r)})}(kp)))).pipe(et(n=>{for(const e of n)if(!0!==e){if(e===kp)return kp;if(!1===e||e instanceof Mc)return e}return!0}),Qi(n=>n!==kp),Ic(1)))}function wA(t){return function un(...t){return Hn(t)}(Br(n=>{if(eu(n))throw gA(0,n)}),et(n=>!0===n))}class Rp{constructor(n){this.segmentGroup=n||null}}class xA{constructor(n){this.urlTree=n}}function Fc(t){return Lr(new Rp(t))}function CA(t){return Lr(new xA(t))}class n8{constructor(n,e){this.urlSerializer=n,this.urlTree=e}noMatchError(n){return new de(4002,!1)}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return lt(r);if(o.numberOfChildren>1||!o.children[It])return Lr(new de(4e3,!1));o=o.children[It]}}applyRedirectCommands(n,e,r){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r)}applyRedirectCreateUrlTree(n,e,r,o){const i=this.createSegmentGroup(n,e.root,r,o);return new Mc(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const r={};return Object.entries(n).forEach(([o,i])=>{if("string"==typeof i&&i.startsWith(":")){const s=i.substring(1);r[o]=e[s]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){const i=this.createSegments(n,e.segments,r,o);let a={};return Object.entries(e.children).forEach(([s,u])=>{a[s]=this.createSegmentGroup(n,u,r,o)}),new mn(i,a)}createSegments(n,e,r,o){return e.map(i=>i.path.startsWith(":")?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){const o=r[e.path.substring(1)];if(!o)throw new de(4001,!1);return o}findOrReturn(n,e){let r=0;for(const o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}}const Ob={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function r8(t,n,e,r,o){const i=Pb(t,n,e);return i.matched?(r=function S5(t,n){return t.providers&&!t._injector&&(t._injector=uy(t.providers,n,`Route: ${t.path}`)),t._injector??n}(n,r),function J5(t,n,e,r){const o=n.canMatch;return o&&0!==o.length?lt(o.map(a=>{const s=Rc(a,t);return vs(function H5(t){return t&&Td(t.canMatch)}(s)?s.canMatch(n,e):t.runInContext(()=>s(n,e)))})).pipe(Nc(),wA()):lt(!0)}(r,n,e).pipe(et(a=>!0===a?i:{...Ob}))):lt(i)}function Pb(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...Ob}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const o=(n.matcher||OW)(e,t,n);if(!o)return{...Ob};const i={};Object.entries(o.posParams??{}).forEach(([s,u])=>{i[s]=u.path});const a=o.consumed.length>0?{...i,...o.consumed[o.consumed.length-1].parameters}:i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:a,positionalParamSegments:o.posParams??{}}}function EA(t,n,e,r){return e.length>0&&function a8(t,n,e){return e.some(r=>Np(t,n,r)&&Ii(r)!==It)}(t,e,r)?{segmentGroup:new mn(n,i8(r,new mn(e,t.children))),slicedSegments:[]}:0===e.length&&function s8(t,n,e){return e.some(r=>Np(t,n,r))}(t,e,r)?{segmentGroup:new mn(t.segments,o8(t,0,e,r,t.children)),slicedSegments:e}:{segmentGroup:new mn(t.segments,t.children),slicedSegments:e}}function o8(t,n,e,r,o){const i={};for(const a of r)if(Np(t,e,a)&&!o[Ii(a)]){const s=new mn([],{});i[Ii(a)]=s}return{...o,...i}}function i8(t,n){const e={};e[It]=n;for(const r of t)if(""===r.path&&Ii(r)!==It){const o=new mn([],{});e[Ii(r)]=o}return e}function Np(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}class d8{constructor(n,e,r,o,i,a,s){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=a,this.urlSerializer=s,this.allowRedirects=!0,this.applyRedirects=new n8(this.urlSerializer,this.urlTree)}noMatchError(n){return new de(4002,!1)}recognize(){const n=EA(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,It).pipe(Le(e=>{if(e instanceof xA)return this.allowRedirects=!1,this.urlTree=e.urlTree,this.match(e.urlTree);throw e instanceof Rp?this.noMatchError(e):e}),et(e=>{const r=new Ap([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},It,this.rootComponentType,null,{}),o=new Pa(r,e),i=new fA("",o),a=function t5(t,n,e=null,r=null){return eA(J2(t),n,e,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(a),this.inheritParamsAndData(i._root),{state:i,tree:a}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,It).pipe(Le(r=>{throw r instanceof Rp?this.noMatchError(r):r}))}inheritParamsAndData(n){const e=n.value,r=dA(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,e,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,o,!0)}processChildren(n,e,r){const o=[];for(const i of Object.keys(r.children))"primary"===i?o.unshift(i):o.push(i);return vr(o).pipe(Ec(i=>{const a=r.children[i],s=function T5(t,n){const e=t.filter(r=>Ii(r)===n);return e.push(...t.filter(r=>Ii(r)!==n)),e}(e,i);return this.processSegmentGroup(n,s,a,i)}),function TW(t,n){return Ht(function MW(t,n,e,r,o){return(i,a)=>{let s=e,u=n,c=0;i.subscribe(At(a,l=>{const d=c++;u=s?t(u,l,d):(s=!0,l),r&&a.next(u)},o&&(()=>{s&&a.next(u),a.complete()})))}}(t,n,arguments.length>=2,!0))}((i,a)=>(i.push(...a),i)),_p(null),function kW(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Qi((o,i)=>t(o,i,r)):qt,bb(1),e?_p(n):V2(()=>new bp))}(),kr(i=>{if(null===i)return Fc(r);const a=DA(i);return function f8(t){t.sort((n,e)=>n.value.outlet===It?-1:e.value.outlet===It?1:n.value.outlet.localeCompare(e.value.outlet))}(a),lt(a)}))}processSegment(n,e,r,o,i,a){return vr(e).pipe(Ec(s=>this.processSegmentAgainstRoute(s._injector??n,e,s,r,o,i,a).pipe(Le(u=>{if(u instanceof Rp)return lt(null);throw u}))),Qs(s=>!!s),Le(s=>{if(_A(s))return function c8(t,n,e){return 0===n.length&&!t.children[e]}(r,o,i)?lt([]):Fc(r);throw s}))}processSegmentAgainstRoute(n,e,r,o,i,a,s){return function u8(t,n,e,r){return!!(Ii(t)===r||r!==It&&Np(n,e,t))&&("**"===t.path||Pb(n,t,e).matched)}(r,o,i,a)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,o,r,i,a,s):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,a):Fc(o):Fc(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,o,a):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,r,o){const i=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?CA(i):this.applyRedirects.lineralizeSegments(r,i).pipe(kr(a=>{const s=new mn(a,{});return this.processSegment(n,e,s,a,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,o,i,a){const{matched:s,consumedSegments:u,remainingSegments:c,positionalParamSegments:l}=Pb(e,o,i);if(!s)return Fc(e);const d=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,l);return o.redirectTo.startsWith("/")?CA(d):this.applyRedirects.lineralizeSegments(o,d).pipe(kr(f=>this.processSegment(n,r,e,f.concat(c),a,!1)))}matchSegmentAgainstRoute(n,e,r,o,i,a){let s;if("**"===r.path){const u=o.length>0?H2(o).parameters:{};s=lt({snapshot:new Ap(o,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,SA(r),Ii(r),r.component??r._loadedComponent??null,r,IA(r)),consumedSegments:[],remainingSegments:[]}),e.children={}}else s=r8(e,r,o,n).pipe(et(({matched:u,consumedSegments:c,remainingSegments:l,parameters:d})=>u?{snapshot:new Ap(c,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,SA(r),Ii(r),r.component??r._loadedComponent??null,r,IA(r)),consumedSegments:c,remainingSegments:l}:null));return s.pipe(pi(u=>null===u?Fc(e):this.getChildConfig(n=r._injector??n,r,o).pipe(pi(({routes:c})=>{const l=r._loadedInjector??n,{snapshot:d,consumedSegments:f,remainingSegments:h}=u,{segmentGroup:p,slicedSegments:g}=EA(e,f,h,c);if(0===g.length&&p.hasChildren())return this.processChildren(l,c,p).pipe(et(v=>null===v?null:[new Pa(d,v)]));if(0===c.length&&0===g.length)return lt([new Pa(d,[])]);const m=Ii(r)===i;return this.processSegment(l,c,p,g,m?It:i,!0).pipe(et(v=>[new Pa(d,v)]))}))))}getChildConfig(n,e,r){return e.children?lt({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?lt({routes:e._loadedRoutes,injector:e._loadedInjector}):function Q5(t,n,e,r){const o=n.canLoad;return void 0===o||0===o.length?lt(!0):lt(o.map(a=>{const s=Rc(a,t);return vs(function B5(t){return t&&Td(t.canLoad)}(s)?s.canLoad(n,e):t.runInContext(()=>s(n,e)))})).pipe(Nc(),wA())}(n,e,r).pipe(kr(o=>o?this.configLoader.loadChildren(n,e).pipe(Br(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):function t8(t){return Lr(mA(!1,3))}())):lt({routes:[],injector:n})}}function h8(t){const n=t.value.routeConfig;return n&&""===n.path}function DA(t){const n=[],e=new Set;for(const r of t){if(!h8(r)){n.push(r);continue}const o=n.find(i=>r.value.routeConfig===i.value.routeConfig);void 0!==o?(o.children.push(...r.children),e.add(o)):n.push(r)}for(const r of e){const o=DA(r.children);n.push(new Pa(r.value,o))}return n.filter(r=>!e.has(r))}function SA(t){return t.data||{}}function IA(t){return t.resolve||{}}function AA(t){return"string"==typeof t.title||null===t.title}function Lb(t){return pi(n=>{const e=t(n);return e?vr(e).pipe(et(()=>n)):lt(n)})}const Oc=new Me("ROUTES");let Bb=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Te(GS)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return lt(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const r=vs(e.loadComponent()).pipe(et(MA),Br(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),hd(()=>{this.componentLoaders.delete(e)})),o=new j2(r,()=>new Nn).pipe(yb());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return lt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const i=function _8(t,n,e,r){return vs(t.loadChildren()).pipe(et(MA),kr(o=>o instanceof ZD||Array.isArray(o)?lt(o):vr(n.compileModuleAsync(o))),et(o=>{r&&r(t);let i,a,s=!1;return Array.isArray(o)?(a=o,!0):(i=o.create(e).injector,a=i.get(Oc,[],{optional:!0,self:!0}).flat()),{routes:a.map(Fb),injector:i}}))}(r,this.compiler,e,this.onLoadEndListener).pipe(hd(()=>{this.childrenLoaders.delete(r)})),a=new j2(i,()=>new Nn).pipe(yb());return this.childrenLoaders.set(r,a),a}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function MA(t){return function w8(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let Fp=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Nn,this.transitionAbortSubject=new Nn,this.configLoader=Te(Bb),this.environmentInjector=Te(Po),this.urlSerializer=Te(yd),this.rootContexts=Te(Dd),this.inputBindingEnabled=null!==Te(Mp,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>lt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new h5(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new f5(o))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:r})}setupNavigations(e,r,o){return this.transitions=new Jo({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:e.urlHandlingStrategy.extract(r),urlAfterRedirects:e.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:xd,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Qi(i=>0!==i.id),et(i=>({...i,extractedUrl:e.urlHandlingStrategy.extract(i.rawUrl)})),pi(i=>{this.currentTransition=i;let a=!1,s=!1;return lt(i).pipe(Br(u=>{this.currentNavigation={id:u.id,initialUrl:u.rawUrl,extractedUrl:u.extractedUrl,trigger:u.source,extras:u.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),pi(u=>{const c=u.currentBrowserUrl.toString(),l=!e.navigated||u.extractedUrl.toString()!==c||c!==u.currentUrlTree.toString();if(!l&&"reload"!==(u.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const f="";return this.events.next(new Tc(u.id,this.urlSerializer.serialize(u.rawUrl),f,0)),u.resolve(null),ji}if(e.urlHandlingStrategy.shouldProcessUrl(u.rawUrl))return lt(u).pipe(pi(f=>{const h=this.transitions?.getValue();return this.events.next(new Cd(f.id,this.urlSerializer.serialize(f.extractedUrl),f.source,f.restoredState)),h!==this.transitions?.getValue()?ji:Promise.resolve(f)}),function p8(t,n,e,r,o,i){return kr(a=>function l8(t,n,e,r,o,i,a="emptyOnly"){return new d8(t,n,e,r,o,a,i).recognize()}(t,n,e,r,a.extractedUrl,o,i).pipe(et(({state:s,tree:u})=>({...a,targetSnapshot:s,urlAfterRedirects:u}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),Br(f=>{i.targetSnapshot=f.targetSnapshot,i.urlAfterRedirects=f.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:f.urlAfterRedirects};const h=new aA(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(h)}));if(l&&e.urlHandlingStrategy.shouldProcessUrl(u.currentRawUrl)){const{id:f,extractedUrl:h,source:p,restoredState:g,extras:m}=u,v=new Cd(f,this.urlSerializer.serialize(h),p,g);this.events.next(v);const b=lA(0,this.rootComponentType).snapshot;return this.currentTransition=i={...u,targetSnapshot:b,urlAfterRedirects:h,extras:{...m,skipLocationChange:!1,replaceUrl:!1}},lt(i)}{const f="";return this.events.next(new Tc(u.id,this.urlSerializer.serialize(u.extractedUrl),f,1)),u.resolve(null),ji}}),Br(u=>{const c=new u5(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}),et(u=>(this.currentTransition=i={...u,guards:N5(u.targetSnapshot,u.currentSnapshot,this.rootContexts)},i)),function W5(t,n){return kr(e=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:a}}=e;return 0===a.length&&0===i.length?lt({...e,guardsResult:!0}):function $5(t,n,e,r){return vr(t).pipe(kr(o=>function Y5(t,n,e,r,o){const i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return i&&0!==i.length?lt(i.map(s=>{const u=Id(n)??o,c=Rc(s,u);return vs(function U5(t){return t&&Td(t.canDeactivate)}(c)?c.canDeactivate(t,n,e,r):u.runInContext(()=>c(t,n,e,r))).pipe(Qs())})).pipe(Nc()):lt(!0)}(o.component,o.route,e,n,r)),Qs(o=>!0!==o,!0))}(a,r,o,t).pipe(kr(s=>s&&function L5(t){return"boolean"==typeof t}(s)?function G5(t,n,e,r){return vr(n).pipe(Ec(o=>vb(function X5(t,n){return null!==t&&n&&n(new p5(t)),lt(!0)}(o.route.parent,r),function q5(t,n){return null!==t&&n&&n(new m5(t)),lt(!0)}(o.route,r),function Z5(t,n,e){const r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(a=>function F5(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(a)).filter(a=>null!==a).map(a=>B2(()=>lt(a.guards.map(u=>{const c=Id(a.node)??e,l=Rc(u,c);return vs(function V5(t){return t&&Td(t.canActivateChild)}(l)?l.canActivateChild(r,t):c.runInContext(()=>l(r,t))).pipe(Qs())})).pipe(Nc())));return lt(i).pipe(Nc())}(t,o.path,e),function K5(t,n,e){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return lt(!0);const o=r.map(i=>B2(()=>{const a=Id(n)??e,s=Rc(i,a);return vs(function j5(t){return t&&Td(t.canActivate)}(s)?s.canActivate(n,t):a.runInContext(()=>s(n,t))).pipe(Qs())}));return lt(o).pipe(Nc())}(t,o.route,e))),Qs(o=>!0!==o,!0))}(r,i,t,n):lt(s)),et(s=>({...e,guardsResult:s})))})}(this.environmentInjector,u=>this.events.next(u)),Br(u=>{if(i.guardsResult=u.guardsResult,eu(u.guardsResult))throw gA(0,u.guardsResult);const c=new c5(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot,!!u.guardsResult);this.events.next(c)}),Qi(u=>!!u.guardsResult||(this.cancelNavigationTransition(u,"",3),!1)),Lb(u=>{if(u.guards.canActivateChecks.length)return lt(u).pipe(Br(c=>{const l=new l5(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),pi(c=>{let l=!1;return lt(c).pipe(function g8(t,n){return kr(e=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return lt(e);let i=0;return vr(o).pipe(Ec(a=>function m8(t,n,e,r){const o=t.routeConfig,i=t._resolve;return void 0!==o?.title&&!AA(o)&&(i[md]=o.title),function v8(t,n,e,r){const o=function y8(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===o.length)return lt({});const i={};return vr(o).pipe(kr(a=>function b8(t,n,e,r){const o=Id(n)??r,i=Rc(t,o);return vs(i.resolve?i.resolve(n,e):o.runInContext(()=>i(n,e)))}(t[a],n,e,r).pipe(Qs(),Br(s=>{i[a]=s}))),bb(1),function RW(t){return et(()=>t)}(i),Le(a=>_A(a)?ji:Lr(a)))}(i,t,n,r).pipe(et(a=>(t._resolvedData=a,t.data=dA(t,e).resolve,o&&AA(o)&&(t.data[md]=o.title),null)))}(a.route,r,t,n)),Br(()=>i++),bb(1),kr(a=>i===o.length?lt(e):ji))})}(e.paramsInheritanceStrategy,this.environmentInjector),Br({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(c,"",2)}}))}),Br(c=>{const l=new d5(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}))}),Lb(u=>{const c=l=>{const d=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(l.routeConfig).pipe(Br(f=>{l.component=f}),et(()=>{})));for(const f of l.children)d.push(...c(f));return d};return mb(c(u.targetSnapshot.root)).pipe(_p(),Ic(1))}),Lb(()=>this.afterPreactivation()),et(u=>{const c=function x5(t,n,e){const r=Sd(t,n._root,e?e._root:void 0);return new cA(r,n)}(e.routeReuseStrategy,u.targetSnapshot,u.currentRouterState);return this.currentTransition=i={...u,targetRouterState:c},i}),Br(()=>{this.events.next(new Db)}),((t,n,e,r)=>et(o=>(new R5(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)))(this.rootContexts,e.routeReuseStrategy,u=>this.events.next(u),this.inputBindingEnabled),Ic(1),Br({next:u=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Oa(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects))),e.titleStrategy?.updateTitle(u.targetRouterState.snapshot),u.resolve(!0)},complete:()=>{a=!0}}),function NW(t){return Ht((n,e)=>{hn(t).subscribe(At(e,()=>e.complete(),Oe)),!e.closed&&n.subscribe(e)})}(this.transitionAbortSubject.pipe(Br(u=>{throw u}))),hd(()=>{a||s||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),Le(u=>{if(s=!0,vA(u))this.events.next(new Ed(i.id,this.urlSerializer.serialize(i.extractedUrl),u.message,u.cancellationCode)),function D5(t){return vA(t)&&eu(t.url)}(u)?this.events.next(new Sb(u.url)):i.resolve(!1);else{this.events.next(new Ip(i.id,this.urlSerializer.serialize(i.extractedUrl),u,i.targetSnapshot??void 0));try{i.resolve(e.errorHandler(u))}catch(c){i.reject(c)}}return ji}))}))}cancelNavigationTransition(e,r,o){const i=new Ed(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function TA(t){return t!==xd}let kA=(()=>{class t{buildTitle(e){let r,o=e.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===It);return r}getResolvedTitleForRoute(e){return e.data[md]}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return Te(x8)},providedIn:"root"})}}return t})(),x8=(()=>{class t extends kA{constructor(e){super(),this.title=e}updateTitle(e){const r=this.buildTitle(e);void 0!==r&&this.title.setTitle(r)}static{this.\u0275fac=function(r){return new(r||t)(Ue(p2))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),C8=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return Te(D8)},providedIn:"root"})}}return t})();class E8{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let D8=(()=>{class t extends E8{static{this.\u0275fac=function(){let e;return function(o){return(e||(e=Pr(t)))(o||t)}}()}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const Op=new Me("",{providedIn:"root",factory:()=>({})});let S8=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:function(){return Te(I8)},providedIn:"root"})}}return t})(),I8=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var kd=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(kd||{});function RA(t,n){t.events.pipe(Qi(e=>e instanceof Oa||e instanceof Ed||e instanceof Ip||e instanceof Tc),et(e=>e instanceof Oa||e instanceof Tc?kd.COMPLETE:e instanceof Ed&&(0===e.code||1===e.code)?kd.REDIRECTING:kd.FAILED),Qi(e=>e!==kd.REDIRECTING),Ic(1)).subscribe(()=>{n()})}function A8(t){throw t}function M8(t,n,e){return n.parse("/")}const T8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},k8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let dr=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Te($S),this.isNgZoneEnabled=!1,this._events=new Nn,this.options=Te(Op,{optional:!0})||{},this.pendingTasks=Te(qh),this.errorHandler=this.options.errorHandler||A8,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||M8,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Te(S8),this.routeReuseStrategy=Te(C8),this.titleStrategy=Te(kA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Te(Oc,{optional:!0})?.flat()??[],this.navigationTransitions=Te(Fp),this.urlSerializer=Te(yd),this.location=Te(Vy),this.componentInputBindingEnabled=!!Te(Mp,{optional:!0}),this.eventsSubscription=new pe,this.isNgZoneEnabled=Te(An)instanceof An&&An.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Mc,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=lA(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:o}=this.navigationTransitions;if(null===o)return void(NA(r)&&this._events.next(r));if(r instanceof Cd)TA(o.source)&&(this.browserUrlTree=o.extractedUrl);else if(r instanceof Tc)this.rawUrlTree=o.rawUrl;else if(r instanceof aA){if("eager"===this.urlUpdateStrategy){if(!o.extras.skipLocationChange){const i=this.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl);this.setBrowserUrl(i,o)}this.browserUrlTree=o.urlAfterRedirects}}else if(r instanceof Db)this.currentUrlTree=o.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl),this.routerState=o.targetRouterState,"deferred"===this.urlUpdateStrategy&&(o.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,o),this.browserUrlTree=o.urlAfterRedirects);else if(r instanceof Ed)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(o);else if(r instanceof Sb){const i=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),a={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||TA(o.source)};this.scheduleNavigation(i,xd,null,a,{resolve:o.resolve,reject:o.reject,promise:o.promise})}r instanceof Ip&&this.restoreHistory(o,!0),r instanceof Oa&&(this.navigated=!0),NA(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),xd,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r="popstate"===e.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,r,e.state)},0)}))}navigateToSyncWithBrowser(e,r,o){const i={replaceUrl:!0},a=o?.navigationId?o:null;if(o){const u={...o};delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(i.state=u)}const s=this.parseUrl(e);this.scheduleNavigation(s,r,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(Fb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){const{relativeTo:o,queryParams:i,fragment:a,queryParamsHandling:s,preserveFragment:u}=r,c=u?this.currentUrlTree.fragment:a;let d,l=null;switch(s){case"merge":l={...this.currentUrlTree.queryParams,...i};break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=i||null}null!==l&&(l=this.removeEmptyProps(l));try{d=J2(o?o.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||!e[0].startsWith("/"))&&(e=[]),d=this.currentUrlTree.root}return eA(d,e,l,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){const o=eu(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,xd,null,r)}navigate(e,r={skipLocationChange:!1}){return function R8(t){for(let n=0;n<t.length;n++)if(null==t[n])throw new de(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,e)}return r}isActive(e,r){let o;if(o=!0===r?{...T8}:!1===r?{...k8}:r,eu(e))return W2(this.currentUrlTree,e,o);const i=this.parseUrl(e);return W2(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.keys(e).reduce((r,o)=>{const i=e[o];return null!=i&&(r[o]=i),r},{})}scheduleNavigation(e,r,o,i,a){if(this.disposed)return Promise.resolve(!1);let s,u,c;a?(s=a.resolve,u=a.reject,c=a.promise):c=new Promise((d,f)=>{s=d,u=f});const l=this.pendingTasks.add();return RA(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(l))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:e,extras:i,resolve:s,reject:u,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(e,r){const o=this.urlSerializer.serialize(e);if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){const a={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(o,"",a)}else{const i={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(o,"",i)}}restoreHistory(e,r=!1){if("computed"===this.canceledNavigationResolution){const i=this.currentPageId-this.browserPageId;0!==i?this.location.historyGo(i):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===i&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function NA(t){return!(t instanceof Db||t instanceof Sb)}class FA{}let O8=(()=>{class t{constructor(e,r,o,i,a){this.router=e,this.injector=o,this.preloadingStrategy=i,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Qi(e=>e instanceof Oa),Ec(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const o=[];for(const i of r){i.providers&&!i._injector&&(i._injector=uy(i.providers,e,`Route: ${i.path}`));const a=i._injector??e,s=i._loadedInjector??a;(i.loadChildren&&!i._loadedRoutes&&void 0===i.canLoad||i.loadComponent&&!i._loadedComponent)&&o.push(this.preloadConfig(a,i)),(i.children||i._loadedRoutes)&&o.push(this.processRoutes(s,i.children??i._loadedRoutes))}return vr(o).pipe(Iu())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(e,r):lt(null);const i=o.pipe(kr(a=>null===a?lt(void 0):(r._loadedRoutes=a.routes,r._loadedInjector=a.injector,this.processRoutes(a.injector??e,a.routes))));return r.loadComponent&&!r._loadedComponent?vr([i,this.loader.loadComponent(r)]).pipe(Iu()):i})}static{this.\u0275fac=function(r){return new(r||t)(Ue(dr),Ue(GS),Ue(Po),Ue(FA),Ue(Bb))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const Vb=new Me("");let OA=(()=>{class t{constructor(e,r,o,i,a={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Cd?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Oa?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Tc&&0===e.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof sA&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new sA(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(r){!function UC(){throw new Error("invalid")}()}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac})}}return t})();function La(t,n){return{\u0275kind:t,\u0275providers:n}}function LA(){const t=Te(Bo);return n=>{const e=t.get(wc);if(n!==e.components[0])return;const r=t.get(dr),o=t.get(BA);1===t.get(Ub)&&r.initialNavigation(),t.get(jA,null,jt.Optional)?.setUpPreloading(),t.get(Vb,null,jt.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const BA=new Me("",{factory:()=>new Nn}),Ub=new Me("",{providedIn:"root",factory:()=>1}),jA=new Me("");function j8(t){return La(0,[{provide:jA,useExisting:O8},{provide:FA,useExisting:t}])}const VA=new Me("ROUTER_FORROOT_GUARD"),U8=[Vy,{provide:yd,useClass:_b},dr,Dd,{provide:Si,useFactory:function PA(t){return t.routerState.root},deps:[dr]},Bb,[]];function H8(){return new JS("Router",dr)}let z8=(()=>{class t{constructor(e){}static forRoot(e,r){return{ngModule:t,providers:[U8,[],{provide:Oc,multi:!0,useValue:e},{provide:VA,useFactory:q8,deps:[[dr,new Kf,new Zf]]},{provide:Op,useValue:r||{}},r?.useHash?{provide:Ks,useClass:EH}:{provide:Ks,useClass:TI},{provide:Vb,useFactory:()=>{const t=Te(Hz),n=Te(An),e=Te(Op),r=Te(Fp),o=Te(yd);return e.scrollOffset&&t.setOffset(e.scrollOffset),new OA(o,r,t,n,e)}},r?.preloadingStrategy?j8(r.preloadingStrategy).\u0275providers:[],{provide:JS,multi:!0,useFactory:H8},r?.initialNavigation?X8(r):[],r?.bindToComponentInputs?La(8,[pA,{provide:Mp,useExisting:pA}]).\u0275providers:[],[{provide:UA,useFactory:LA},{provide:Ty,multi:!0,useExisting:UA}]]}}static forChild(e){return{ngModule:t,providers:[{provide:Oc,multi:!0,useValue:e}]}}static{this.\u0275fac=function(r){return new(r||t)(Ue(VA,8))}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({})}}return t})();function q8(t){return"guarded"}function X8(t){return["disabled"===t.initialNavigation?La(3,[{provide:xy,multi:!0,useFactory:()=>{const n=Te(dr);return()=>{n.setUpLocationChangeListener()}}},{provide:Ub,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?La(2,[{provide:Ub,useValue:0},{provide:xy,multi:!0,deps:[Bo],useFactory:n=>{const e=n.get(xH,Promise.resolve());return()=>e.then(()=>new Promise(r=>{const o=n.get(dr),i=n.get(BA);RA(o,()=>{r(!0)}),n.get(Fp).afterPreactivation=()=>(r(!0),i.closed?lt(void 0):i),o.initialNavigation()}))}}]).\u0275providers:[]]}const UA=new Me("");let HA=(()=>{class t{constructor(e,r){this._renderer=e,this._elementRef=r,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static{this.\u0275fac=function(r){return new(r||t)(q(Ea),q(Lo))}}static{this.\u0275dir=gt({type:t})}}return t})(),tu=(()=>{class t extends HA{static{this.\u0275fac=function(){let e;return function(o){return(e||(e=Pr(t)))(o||t)}}()}static{this.\u0275dir=gt({type:t,features:[gn]})}}return t})();const ta=new Me("NgValueAccessor"),Y8={provide:ta,useExisting:Dn(()=>Hb),multi:!0};let Hb=(()=>{class t extends tu{writeValue(e){this.setProperty("checked",e)}static{this.\u0275fac=function(){let e;return function(o){return(e||(e=Pr(t)))(o||t)}}()}static{this.\u0275dir=gt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){1&r&&Ie("change",function(a){return o.onChange(a.target.checked)})("blur",function(){return o.onTouched()})},features:[Vn([Y8]),gn]})}}return t})();const Q8={provide:ta,useExisting:Dn(()=>nu),multi:!0},e$=new Me("CompositionEventMode");let nu=(()=>{class t extends HA{constructor(e,r,o){super(e,r),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function J8(){const t=ps()?ps().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static{this.\u0275fac=function(r){return new(r||t)(q(Ea),q(Lo),q(e$,8))}}static{this.\u0275dir=gt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){1&r&&Ie("input",function(a){return o._handleInput(a.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(a){return o._compositionEnd(a.target.value)})},features:[Vn([Q8]),gn]})}}return t})();function ys(t){return null==t||("string"==typeof t||Array.isArray(t))&&0===t.length}const qr=new Me("NgValidators"),bs=new Me("NgAsyncValidators");function Pp(t){return null}function QA(t){return null!=t}function JA(t){return Zl(t)?vr(t):t}function eM(t){let n={};return t.forEach(e=>{n=null!=e?{...n,...e}:n}),0===Object.keys(n).length?null:n}function tM(t,n){return n.map(e=>e(t))}function nM(t){return t.map(n=>function n$(t){return!t.validate}(n)?n:e=>n.validate(e))}function zb(t){return null!=t?function rM(t){if(!t)return null;const n=t.filter(QA);return 0==n.length?null:function(e){return eM(tM(e,n))}}(nM(t)):null}function Wb(t){return null!=t?function oM(t){if(!t)return null;const n=t.filter(QA);return 0==n.length?null:function(e){return function Z8(...t){const n=Rw(t),{args:e,keys:r}=F2(t),o=new kt(i=>{const{length:a}=e;if(!a)return void i.complete();const s=new Array(a);let u=a,c=a;for(let l=0;l<a;l++){let d=!1;hn(e[l]).subscribe(At(i,f=>{d||(d=!0,c--),s[l]=f},()=>u--,void 0,()=>{(!u||!d)&&(c||i.next(r?P2(r,s):s),i.complete())}))}});return n?o.pipe(O2(n)):o}(tM(e,n).map(JA)).pipe(et(eM))}}(nM(t)):null}function iM(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function $b(t){return t?Array.isArray(t)?t:[t]:[]}function Lp(t,n){return Array.isArray(t)?t.includes(n):t===n}function uM(t,n){const e=$b(n);return $b(t).forEach(o=>{Lp(e,o)||e.push(o)}),e}function cM(t,n){return $b(n).filter(e=>!Lp(t,e))}class lM{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=zb(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=Wb(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return!!this.control&&this.control.hasError(n,e)}getError(n,e){return this.control?this.control.getError(n,e):null}}class co extends lM{get formDirective(){return null}get path(){return null}}class _s extends lM{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class dM{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Rd=(()=>{class t extends dM{constructor(e){super(e)}static{this.\u0275fac=function(r){return new(r||t)(q(_s,2))}}static{this.\u0275dir=gt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){2&r&&Lh("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},features:[gn]})}}return t})(),ru=(()=>{class t extends dM{constructor(e){super(e)}static{this.\u0275fac=function(r){return new(r||t)(q(co,10))}}static{this.\u0275dir=gt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){2&r&&Lh("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},features:[gn]})}}return t})();const Nd="VALID",jp="INVALID",Pc="PENDING",Fd="DISABLED";function Xb(t){return(Vp(t)?t.validators:t)||null}function Kb(t,n){return(Vp(n)?n.asyncValidators:t)||null}function Vp(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class Zb{constructor(n,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Nd}get invalid(){return this.status===jp}get pending(){return this.status==Pc}get disabled(){return this.status===Fd}get enabled(){return this.status!==Fd}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(uM(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(uM(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(cM(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(cM(n,this._rawAsyncValidators))}hasValidator(n){return Lp(this._rawValidators,n)}hasAsyncValidator(n){return Lp(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Pc,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=Fd,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=Nd,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Nd||this.status===Pc)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Fd:Nd}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Pc,this._hasOwnPendingAsyncValidator=!0;const e=JA(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent)}get(n){let e=n;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){const r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new er,this.statusChanges=new er}_calculateStatus(){return this._allControlsDisabled()?Fd:this.errors?jp:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pc)?Pc:this._anyControlsHaveStatus(jp)?jp:Nd}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Vp(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function a$(t){return Array.isArray(t)?zb(t):t||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function s$(t){return Array.isArray(t)?Wb(t):t||null}(this._rawAsyncValidators)}}class Yb extends Zb{constructor(n,e,r){super(Xb(e),Kb(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){(function pM(t,n,e){t._forEachChild((r,o)=>{if(void 0===e[o])throw new de(1002,"")})})(this,0,n),Object.keys(n).forEach(r=>{(function hM(t,n,e){const r=t.controls;if(!(n?Object.keys(r):r).length)throw new de(1e3,"");if(!r[e])throw new de(1001,"")})(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(r=>{const o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>!!r._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}const ou=new Me("CallSetDisabledState",{providedIn:"root",factory:()=>Od}),Od="always";function Pd(t,n,e=Od){Qb(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&n.valueAccessor.setDisabledState?.(t.disabled),function l$(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&gM(t,n)})}(t,n),function f$(t,n){const e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function d$(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&gM(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function c$(t,n){if(n.valueAccessor.setDisabledState){const e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function zp(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Qb(t,n){const e=function aM(t){return t._rawValidators}(t);null!==n.validator?t.setValidators(iM(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const r=function sM(t){return t._rawAsyncValidators}(t);null!==n.asyncValidator?t.setAsyncValidators(iM(r,n.asyncValidator)):"function"==typeof r&&t.setAsyncValidators([r]);const o=()=>t.updateValueAndValidity();zp(n._rawValidators,o),zp(n._rawAsyncValidators,o)}function gM(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}const v$={provide:co,useExisting:Dn(()=>Ba)},Ld=(()=>Promise.resolve())();let Ba=(()=>{class t extends co{constructor(e,r,o){super(),this.callSetDisabledState=o,this.submitted=!1,this._directives=new Set,this.ngSubmit=new er,this.form=new Yb({},zb(e),Wb(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Ld.then(()=>{const r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),Pd(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Ld.then(()=>{const r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Ld.then(()=>{const r=this._findContainer(e.path),o=new Yb({});(function mM(t,n){Qb(t,n)})(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Ld.then(()=>{const r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){Ld.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,function vM(t,n){t._syncPendingControls(),n.forEach(e=>{const r=e.control;"submit"===r.updateOn&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static{this.\u0275fac=function(r){return new(r||t)(q(qr,10),q(bs,10),q(ou,8))}}static{this.\u0275dir=gt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){1&r&&Ie("submit",function(a){return o.onSubmit(a)})("reset",function(){return o.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Vn([v$]),gn]})}}return t})();function yM(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function bM(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const _M=class extends Zb{constructor(n=null,e,r){super(Xb(e),Kb(r,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Vp(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=bM(n)?n.value:n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){yM(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){yM(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){bM(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},_$={provide:_s,useExisting:Dn(()=>Lc)},CM=(()=>Promise.resolve())();let Lc=(()=>{class t extends _s{constructor(e,r,o,i,a,s){super(),this._changeDetectorRef=a,this.callSetDisabledState=s,this.control=new _M,this._registered=!1,this.name="",this.update=new er,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=function t0(t,n){if(!n)return null;let e,r,o;return Array.isArray(n),n.forEach(i=>{i.constructor===nu?e=i:function g$(t){return Object.getPrototypeOf(t.constructor)===tu}(i)?r=i:o=i}),o||r||e||null}(0,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),function e0(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Pd(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){CM.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const r=e.isDisabled.currentValue,o=0!==r&&function xc(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}(r);CM.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function Up(t,n){return[...n.path,t]}(e,this._parent):[e]}static{this.\u0275fac=function(r){return new(r||t)(q(co,9),q(qr,10),q(bs,10),q(ta,10),q(Yh,8),q(ou,8))}}static{this.\u0275dir=gt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Vn([_$]),gn,ri]})}}return t})(),iu=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275dir=gt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return t})();const w$={provide:ta,useExisting:Dn(()=>n0),multi:!0};let n0=(()=>{class t extends tu{writeValue(e){this.setProperty("value",e??"")}registerOnChange(e){this.onChange=r=>{e(""==r?null:parseFloat(r))}}static{this.\u0275fac=function(){let e;return function(o){return(e||(e=Pr(t)))(o||t)}}()}static{this.\u0275dir=gt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){1&r&&Ie("input",function(a){return o.onChange(a.target.value)})("blur",function(){return o.onTouched()})},features:[Vn([w$]),gn]})}}return t})(),EM=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({})}}return t})();const r0=new Me("NgModelWithFormControlWarning");let au=(()=>{class t{constructor(){this._validator=Pp}ngOnChanges(e){if(this.inputName in e){const r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Pp,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275dir=gt({type:t,features:[ri]})}}return t})();const L$={provide:qr,useExisting:Dn(()=>l0),multi:!0};let l0=(()=>{class t extends au{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=e=>function NM(t){return"number"==typeof t?t:parseFloat(t)}(e),this.createValidator=e=>function WA(t){return n=>{if(ys(n.value)||ys(t))return null;const e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}(e)}static{this.\u0275fac=function(){let e;return function(o){return(e||(e=Pr(t)))(o||t)}}()}static{this.\u0275dir=gt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){2&r&&Xi("min",o._enabled?o.min:null)},inputs:{min:"min"},features:[Vn([L$]),gn]})}}return t})(),VM=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({imports:[EM]})}}return t})(),$$=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:ou,useValue:e.callSetDisabledState??Od}]}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({imports:[VM]})}}return t})(),G$=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:r0,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:ou,useValue:e.callSetDisabledState??Od}]}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t})}static{this.\u0275inj=ti({imports:[VM]})}}return t})();const UM=new Me("Browser storage",{providedIn:"root",factory:()=>localStorage});class q$ extends pe{constructor(n,e){super()}schedule(n,e=0){return this}}const $p={setInterval(t,n,...e){const{delegate:r}=$p;return r?.setInterval?r.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){const{delegate:n}=$p;return(n?.clearInterval||clearInterval)(t)},delegate:void 0},HM={now:()=>(HM.delegate||Date).now(),delegate:void 0};class Bd{constructor(n,e=Bd.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,r){return new this.schedulerActionCtor(this,n).schedule(r,e)}}Bd.now=HM.now;const Z$=new class K$ extends Bd{constructor(n,e=Bd.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,r){for(;n=e.shift();)n.unsubscribe();throw r}}}(class X$ extends q${constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var r;if(this.closed)return this;this.state=n;const o=this.id,i=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(i,o,e)),this.pending=!0,this.delay=e,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,e),this}requestAsyncId(n,e,r=0){return $p.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,e,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return e;null!=e&&$p.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let o,r=!1;try{this.work(n)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,te(r,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}});function at(t=1/0){let n;n=t&&"object"==typeof t?t:{count:t};const{count:e=1/0,delay:r,resetOnSuccess:o=!1}=n;return e<=0?qt:Ht((i,a)=>{let u,s=0;const c=()=>{let l=!1;u=i.subscribe(At(a,d=>{o&&(s=0),a.next(d)},void 0,d=>{if(s++<e){const f=()=>{u?(u.unsubscribe(),u=null,c()):l=!0};if(null!=r){const h="number"==typeof r?function Q$(t=0,n,e=Z$){let r=-1;return null!=n&&(kw(n)?e=n:r=n),new kt(o=>{let i=function Y$(t){return t instanceof Date&&!isNaN(t)}(t)?+t-e.now():t;i<0&&(i=0);let a=0;return e.schedule(function(){o.closed||(o.next(a++),0<=r?this.schedule(void 0,r):o.complete())},i)})}(r):hn(r(d,s)),p=At(a,()=>{p.unsubscribe(),f()},()=>{a.complete()});h.subscribe(p)}else f()}else a.error(d)})),l&&(u.unsubscribe(),u=null,c())};c()})}let ja=(()=>{class t{constructor(e,r){this.storage=e,this.http=r,this.urlBackend="/api",this.urlWalletBackend="http://localhost:4000/api"}getStudentAchievements(e){const r=`${this.urlBackend}/studentAchievements/${e}`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}handleError(e){return window.alert(e.statusText),Lr(()=>e.message||e.statusText)}putSubject(e,r,o,i,a,s,u,c,l){const d=`${this.urlBackend}/subjects/${e}`;let f=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`});return this.http.put(d,{preverjanjaZnanja:r,steviloPreverjanjZnanja:o,vaje:i,seminarji:a,steviloSeminarjev:s,sprotnoDelo:u,domaceNaloge:c,steviloDomacihNalog:l},{headers:f}).pipe(at(1),Le(this.handleError))}postSubjectsAll(e){const r=`${this.urlBackend}/subjectsAddAll`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(r,e,{headers:o}).pipe(at(1),Le(this.handleError))}deleteSubjectsAll(){const e=`${this.urlBackend}/subjectsDeleteAll`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.delete(e,{headers:r}).pipe(at(1),Le(this.handleError))}postStudentAchievementsAll(e){const r=`${this.urlBackend}/studentAchievementsAddAll`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(r,e,{headers:o}).pipe(at(1),Le(this.handleError))}deleteStudentAchievementsAll(){const e=`${this.urlBackend}/studentAchievementsDeleteAll`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.delete(e,{headers:r}).pipe(at(1),Le(this.handleError))}postStudentsAdministrationAll(e){const r=`${this.urlBackend}/studentsAdministrationAddAll`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(r,e,{headers:o}).pipe(at(1),Le(this.handleError))}deleteStudentsAdministrationAll(){const e=`${this.urlBackend}/studentsAdministrationDeleteAll`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.delete(e,{headers:r}).pipe(at(1),Le(this.handleError))}postExamsAll(e){const r=`${this.urlBackend}/examsAddAll`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(r,e,{headers:o}).pipe(at(1),Le(this.handleError))}deleteExamsAll(){const e=`${this.urlBackend}/examsDeleteAll`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.delete(e,{headers:r}).pipe(at(1),Le(this.handleError))}postUsersAll(e){const r=`${this.urlBackend}/usersAddAll`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(r,e,{headers:o}).pipe(at(1),Le(this.handleError))}deleteUsersAll(){const e=`${this.urlBackend}/usersDeleteAll`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.delete(e,{headers:r}).pipe(at(1),Le(this.handleError))}getSubject(e){const r=`${this.urlBackend}/subjects/${e}`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}login(e){return this.makeAuthApiCall("login",e)}makeAuthApiCall(e,r){const o=`${this.urlBackend}/${e}`;let i=new Fa;i=r.name?i.set("email",r.email).set("name",r.name).set("type",r.type):i.set("email",r.email).set("type",r.type),r.password&&(i=i.set("password",r.password)),r.subjectIds&&r.subjectIds.forEach(s=>{i=i.append("subjectIds",s)});let a=(new Ze).set("Content-Type","application/x-www-form-urlencoded");return this.http.post(o,i,{headers:a}).pipe(at(1),Le(this.handleError))}getStudentsAdministrationInitial(){const e=`${this.urlBackend}/studentsAdministration`;let r=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.get(e,{headers:r}).pipe(at(1),Le(this.handleError))}getInvitationQRCode(e){return this.http.post(`${this.urlBackend}/generateQR`,{url:e}).pipe(at(1),Le(this.handleError))}getExam(e){const r=`${this.urlBackend}/exams/${e}`;let o=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}putStudentAchievements(e,r,o,i,a,s){const u=`${this.urlBackend}/studentAchievements/${e}`;let c=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`}),l={};return 0!=r.length&&(l.preverjanjaZnanja=r),0!=o.length&&(l.vaje=o),0!=i.length&&(l.seminarji=i),0!=a.length&&(l.sprotnoDelo=a),0!=s.length&&(l.domaceNaloge=s),this.http.put(u,l,{headers:c}).pipe(at(1),Le(this.handleError))}putStudentAchievementsConnections(e,r){const o=`${this.urlBackend}/studentAchievements/connection/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`});return this.http.put(o,{connection_id:r},{headers:i}).pipe(at(1),Le(this.handleError)).pipe(Le(this.handleError))}sendConnection(e,r,o,i){const a=`${this.urlWalletBackend}/invitations`;let s={studentId:e,invitation:r,description:o,accepted:!1},u=new Ze({accept:"application/json","x-api-key":i});return this.http.post(a,s,{headers:u}).pipe(at(1),Le(this.handleError))}putExamCredentials(e,r){const o=`${this.urlBackend}/exams/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`});return this.http.put(o,{credentialSchemaNames:r},{headers:i}).pipe(at(1),Le(this.handleError))}getExamsBySubject(e){const r=`${this.urlBackend}/exams/subjects/${e}`;let o=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`});return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}postExamRestriction(e,r){const o=`${this.urlBackend}/credentialSchemas/${e}`;let i={credentialSchemaName:r.credentialSchemaName,attributes:r.attributes},a=(new Ze).set("Authorization",`Bearer ${this.storage.getItem("token")}`);return this.http.post(o,i,{headers:a}).pipe(at(1),Le(this.handleError))}getRestrictions(e){const r=`${this.urlBackend}/credentialSchemas/${e}`;let o=new Ze({accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.storage.getItem("token")}`});return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}postWalletUsersAll(e,r){const o=`${this.urlWalletBackend}/studentsAdministrationAddAll`;let i=(new Ze).set("X-api-key",r);return this.http.post(o,e,{headers:i}).pipe(at(1),Le(this.handleError))}deleteWalletUsersAll(e){const r=`${this.urlWalletBackend}/studentsAdministrationDeleteAll`;let o=(new Ze).set("X-api-key",e);return this.http.delete(r,{headers:o}).pipe(at(1),Le(this.handleError))}static{this.\u0275fac=function(r){return new(r||t)(Ue(UM),Ue(pb))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),na=(()=>{class t{constructor(e,r){this.storage=e,this.studentService=r}login(e){return this.studentService.login(e).pipe(Br(r=>{this.saveToken(r.token)}))}logout(){this.storage.removeItem("token")}getToken(){return this.storage.getItem("token")}saveToken(e){this.storage.setItem("token",e)}isLoggedIn(){const e=this.getToken();return!!e&&JSON.parse(window.atob(e.split(".")[1])).exp>Date.now()/1e3}getCurrentUser(){let e;if(this.isLoggedIn()){let r=this.getToken();if(r){let{email:o,type:i,admin_api_key:a,subjectIds:s}=JSON.parse(window.atob(r.split(".")[1]));e={email:o,type:i,admin_api_key:a,subjectIds:s}}}return e}static{this.\u0275fac=function(r){return new(r||t)(Ue(UM),Ue(ja))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function J$(t,n){if(1&t){const e=Mn();j(0,"button",12),Ie("click",function(){return wt(e),xt(ge(2).administration())}),J(1,"Administracija"),V()}}function eG(t,n){if(1&t){const e=Mn();j(0,"button",13),Ie("click",function(){return wt(e),xt(ge(2).other())}),J(1,"Predmeti"),V()}}function tG(t,n){if(1&t){const e=Mn();j(0,"button",14),Ie("click",function(){return wt(e),xt(ge(2).logout())}),J(1,"Odjava"),V()}}function nG(t,n){if(1&t&&(j(0,"div")(1,"nav",2)(2,"div",3)(3,"a",4),J(4," MojIzpit"),V(),j(5,"button",5),bn(6,"span",6),V(),j(7,"div",7)(8,"div",8),xe(9,J$,2,0,"button",9),xe(10,eG,2,0,"button",10),xe(11,tG,2,0,"button",11),V()()()()()),2&t){const e=ge();H(9),ie("ngIf",e.isLoggedIn()&&!e.router.url.includes("administration")&&!e.router.url.includes("exam")&&"admin"!=(null==e.userLoggedIn?null:e.userLoggedIn.type)),H(1),ie("ngIf","/administration"==e.router.url),H(1),ie("ngIf",e.isLoggedIn())}}let rG=(()=>{class t{constructor(e,r,o){this.authenticationService=e,this.router=r,this.activatedRoute=o,this.userLoggingIn={name:"",email:"",type:"",password:""},this.userLoggingInExam={name:"",email:"",type:"",password:""},this.isLoaded=!1}ngOnInit(){this.router.events.pipe(Qi(e=>e instanceof Oa)).subscribe(()=>{this.detectCurrentComponent()})}getCurrentUser(){const e=this.authenticationService.getCurrentUser();this.userLoggedIn=e,this.isLoaded=!0}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}isLoggedIn(){return this.authenticationService.isLoggedIn()}administration(){this.router.navigate(["/administration"]).then(()=>{location.reload()})}other(){this.router.navigate(["/subjects"]).then(()=>{location.reload()})}detectCurrentComponent(){const e=this.activatedRoute.firstChild;e&&(this.currentComponent=e.snapshot.component?.name),this.getCurrentUser()}static{this.\u0275fac=function(r){return new(r||t)(q(na),q(dr),q(Si))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-framework"]],decls:3,vars:1,consts:[["style","",4,"ngIf"],["id","back"],[1,"navbar","navbar-expand-lg","bg-body-tertiary",2,"display","flex !important","justify-content","space-between"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse","d-flex","justify-content-end"],[1,"d-flex","justify-content-evenly"],["class","btn","id","redirectAdministration","type","button",3,"click",4,"ngIf"],["class","btn","id","redirectNotAdministration","type","button",3,"click",4,"ngIf"],["class","btn","id","logOutButton","type","button",3,"click",4,"ngIf"],["id","redirectAdministration","type","button",1,"btn",3,"click"],["id","redirectNotAdministration","type","button",1,"btn",3,"click"],["id","logOutButton","type","button",1,"btn",3,"click"]],template:function(r,o){1&r&&(xe(0,nG,12,3,"div",0),j(1,"div",1),bn(2,"router-outlet"),V()),2&r&&ie("ngIf",o.isLoaded)},dependencies:[Yi,Rb],styles:["nav[_ngcontent-%COMP%]{background-color:#f0edef!important}#back[_ngcontent-%COMP%]{background-color:#fff}#logInButton[_ngcontent-%COMP%]:hover{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#f0edef!important}#logInButton[_ngcontent-%COMP%]{background-color:#f0edef;color:#7e8cbb;border-color:#7e8cbb}#logOutButton[_ngcontent-%COMP%]:hover{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#f0edef!important}#logOutButton[_ngcontent-%COMP%]{background-color:#f0edef;color:#7e8cbb;border-color:#7e8cbb}#preverjanjeButton[_ngcontent-%COMP%]:hover{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#f0edef!important}#preverjanjeButton[_ngcontent-%COMP%]{background-color:#f0edef;color:#7e8cbb;border-color:#7e8cbb}.modal-button[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important}.modal-button[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}#redirectAdministration[_ngcontent-%COMP%]:hover{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#f0edef!important}#redirectAdministration[_ngcontent-%COMP%]{background-color:#f0edef;color:#7e8cbb;border-color:#7e8cbb}#redirectNotAdministration[_ngcontent-%COMP%]:hover{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#f0edef!important}#redirectNotAdministration[_ngcontent-%COMP%]{background-color:#f0edef;color:#7e8cbb;border-color:#7e8cbb}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%}"]})}}return t})();function oG(t){return{type:6,styles:t,offset:null}}let jd=(()=>{class t{constructor(e,r){this.http=e,this.authenticationService=r,this.faberApiUrl="http://localhost:8021",this.additionalAgentApiUrl="http://localhost:8049"}getConnectionByIdFaber(e,r){const o=`${this.faberApiUrl}/connections/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getPublicDidFaber(e){const r=`${this.faberApiUrl}/wallet/did/public`;let o=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":e});return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}getCreatedSchemasByName(e,r){const o=`${this.faberApiUrl}/schemas/created?schema_name=${r}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":e});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getSchemaById(e,r){const o=`${this.faberApiUrl}/schemas/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getCreatedCredentialDefinitionsByName(e,r){const o=`${this.faberApiUrl}/credential-definitions/created?schema_name=${r}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":e});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}handleError(e){return window.alert(e.statusText),Lr(()=>e.error.message||e.statusText)}handleErrorInvitation(e){return window.alert("Invitation not found."),Lr(()=>e.error.message||e.statusText)}handleError2(e){return window.alert(e.statusText),location.reload(),Lr(()=>e.error.message||e.statusText)}postSchemaNew(e,r,o,i){const a=`${this.faberApiUrl}/schemas`;let s=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":i});return this.http.post(a,{attributes:e,schema_name:r,schema_version:o},{headers:s}).pipe(at(1),Le(this.handleError))}postCredentialDefinitions(e,r,o,i,a){const s=`${this.faberApiUrl}/credential-definitions`;let u=new Ze({accept:"application/json","Content-Type":"application/json","x-api-key":a});return this.http.post(s,{revocation_registry_size:e,schema_id:r,support_revocation:o,tag:i},{headers:u}).pipe(at(1),Le(this.handleError))}postIssueCredential(e,r,o,i,a){const s=`${this.faberApiUrl}/issue-credential-2.0/send`;let u=new Ze({accept:"application/json","Content-Type":"application/json","x-api-key":a});return this.http.post(s,{auto_remove:!1,comment:r,connection_id:e,credential_preview:{"@type":"issue-credential/2.0/credential-preview",attributes:o},filter:{indy:i},trace:!1},{headers:u}).pipe(at(1),Le(this.handleError))}postPresentAnyProof(e,r,o,i,a){const s=`${this.faberApiUrl}/present-proof-2.0/send-request`;let u=new Ze({accept:"application/json","Content-Type":"application/json","x-api-key":a});return this.http.post(s,{comment:o,connection_id:e,presentation_request:{indy:{name:"Proof of Education",version:"1.0",requested_attributes:i,requested_predicates:{}}}},{headers:u}).pipe(at(1),Le(this.handleError))}getPresentProofRecordById(e,r){const o=`${this.faberApiUrl}/present-proof-2.0/records/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}issueCredentialNew(e,r,o,i,a){let s,u;this.getCreatedSchemasByName(a,r).subscribe(c=>{s=c.schema_ids[0],this.getCreatedCredentialDefinitionsByName(a,r).subscribe(l=>{u=l.credential_definition_ids[0];let f,d={cred_def_id:u,issuer_did:o,schema_id:s,schema_issuer_did:o,schema_name:"",schema_version:""};this.getSchemaById(s,a).pipe(Le(h=>Lr(()=>h))).subscribe(h=>{f=h.schema,d.schema_name=f.name,d.schema_version=f.version,this.postIssueCredential(i,"message",e,d,a).pipe(Le(p=>(window.alert(p.toString()),Lr(()=>p)))).subscribe(p=>{window.alert("Poverilnica uspe\u0161no poslana.")})})})})}createInvitation2(e){const r=`${this.faberApiUrl}/out-of-band/create-invitation`;let o=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":e});return this.http.post(r,{"@type":"https://didcomm.org/out-of-band/1.1/invitation","@id":"93df2352-f3e9-40de-9234-9d3bb2530fc2",label:"alice.agent",handshake_protocols:["https://didcomm.org/didexchange/1.1"],services:[{id:"#inline",type:"did-communication"}]},{headers:o}).pipe(at(1),Le(this.handleError))}getConnectionByMsgIdFaber(e,r){const o=`${this.faberApiUrl}/connections?invitation_msg_id=${e}&limit=100&offset=0`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleErrorInvitation))}getCredDefBySchemaNameFaber(e,r){const o=`${this.faberApiUrl}/credential-definitions/created?schema_name=${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getSchemaIdByName(e,r){const o=`${this.faberApiUrl}/schemas/created?schema_name=${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getPublicDidAdditionalAgent(){const e=`${this.additionalAgentApiUrl}/wallet/did/public`;let r=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.get(e,{headers:r}).pipe(at(1),Le(this.handleError2))}postSchemaAdditionalAgent(e,r,o){const i=`${this.additionalAgentApiUrl}/schemas`;let a=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.post(i,{attributes:e,schema_name:r,schema_version:o},{headers:a}).pipe(at(1),Le(this.handleError))}postCredentialDefinitionsAdditionalAgent(e,r,o,i){const a=`${this.additionalAgentApiUrl}/credential-definitions`;let s=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.post(a,{revocation_registry_size:e,schema_id:r,support_revocation:o,tag:i},{headers:s}).pipe(at(1),Le(this.handleError2))}postIssueCredentialAdditionalAgent(e,r,o,i){const a=`${this.additionalAgentApiUrl}/issue-credential-2.0/send`;let s=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.post(a,{auto_remove:!0,comment:r,connection_id:e,credential_preview:{"@type":"issue-credential/2.0/credential-preview",attributes:o},filter:{indy:i},trace:!1},{headers:s}).pipe(at(1),Le(this.handleError2))}getLoggedInUserKey(){const e=this.authenticationService.getCurrentUser();return e?.admin_api_key?e?.admin_api_key:""}createInvitation2AdditionalAgent(){const e=`${this.additionalAgentApiUrl}/out-of-band/create-invitation`;let r=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.post(e,{"@type":"https://didcomm.org/out-of-band/1.1/invitation","@id":"93df2352-f3e9-40de-9234-9d3bb2530fc2",label:"alice.agent",handshake_protocols:["https://didcomm.org/didexchange/1.1"],services:[{id:"#inline",type:"did-communication"}]},{headers:r}).pipe(at(1),Le(this.handleError))}getConnectionByMsgIdAdditionalAgent(e){const r=`${this.additionalAgentApiUrl}/connections?invitation_msg_id=${e}&limit=100&offset=0`;let o=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":this.getLoggedInUserKey()});return this.http.get(r,{headers:o}).pipe(at(1),Le(this.handleError))}getSchemaIdByNameAdditionalAgent(e,r){const o=`${this.additionalAgentApiUrl}/schemas/created?schema_name=${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getSchemaByIdAdditionalAgent(e,r){const o=`${this.additionalAgentApiUrl}/schemas/${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getCredDefBySchemaNameAdditionalAgent(e,r){const o=`${this.additionalAgentApiUrl}/credential-definitions/created?schema_name=${e}`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":r});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}getIssueCredentialRecordsFaber(e,r){const o=`${this.faberApiUrl}/issue-credential-2.0/records?connection_id=${r}&offset=0`;let i=new Ze({accept:"application/json","Content-Type":"application/json","X-api-key":e});return this.http.get(o,{headers:i}).pipe(at(1),Le(this.handleError))}static{this.\u0275fac=function(r){return new(r||t)(Ue(pb),Ue(na))}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function iG(t,n){1&t&&(j(0,"td"),J(1,"'No data'"),V())}function aG(t,n){if(1&t&&(_n(0),j(1,"th",14),J(2),V(),wn()),2&t){const e=n.$implicit;H(2),Sr("Preverjanje znanja \u0161t. ",e,"")}}function sG(t,n){if(1&t&&(_n(0),xe(1,aG,3,1,"ng-container",15),wn()),2&t){const e=ge(2);H(1),ie("ngForOf",e.preverjanjaZnanjaCount)}}function uG(t,n){1&t&&(_n(0),j(1,"th",14),J(2,"Vaje"),V(),wn())}function cG(t,n){if(1&t&&(_n(0),j(1,"th",14),J(2),V(),wn()),2&t){const e=n.$implicit;H(2),Sr("Seminar \u0161t. ",e,"")}}function lG(t,n){if(1&t&&(_n(0),xe(1,cG,3,1,"ng-container",15),wn()),2&t){const e=ge(2);H(1),ie("ngForOf",e.seminarjiCount)}}function dG(t,n){1&t&&(_n(0),j(1,"th",14),J(2,"Sprotno delo"),V(),wn())}function fG(t,n){if(1&t&&(_n(0),j(1,"th",14),J(2),V(),wn()),2&t){const e=n.$implicit;H(2),Sr("Doma\u010da naloga \u0161t. ",e,"")}}function hG(t,n){if(1&t&&(_n(0),xe(1,fG,3,1,"ng-container",15),wn()),2&t){const e=ge(2);H(1),ie("ngForOf",e.domaceNalogeCount)}}function pG(t,n){if(1&t&&(j(0,"th"),J(1),V()),2&t){const e=n.$implicit;H(1),Sr(" ",e.name," ")}}function gG(t,n){if(1&t&&(_n(0),j(1,"td",20),J(2),V(),wn()),2&t){const e=n.index,r=ge(2).$implicit;H(2),Wn(r.preverjanjaZnanja[e])}}function mG(t,n){if(1&t&&(_n(0),xe(1,gG,3,1,"ng-container",15),wn()),2&t){const e=ge(3);H(1),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloPreverjanjZnanja))}}function vG(t,n){if(1&t&&(_n(0),j(1,"td",14),J(2),V(),wn()),2&t){const e=ge().$implicit;H(2),Sr(" ",e.vaje[0],"")}}function yG(t,n){if(1&t&&(_n(0),j(1,"td",20),J(2),V(),wn()),2&t){const e=n.index,r=ge(2).$implicit;H(2),Wn(r.seminarji[e])}}function bG(t,n){if(1&t&&(_n(0),xe(1,yG,3,1,"ng-container",15),wn()),2&t){const e=ge(3);H(1),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloSeminarjev))}}function _G(t,n){if(1&t&&(_n(0),j(1,"td",14),J(2),V(),wn()),2&t){const e=ge().$implicit;H(2),Sr(" ",e.sprotnoDelo[0],"")}}function wG(t,n){if(1&t&&(_n(0),j(1,"td",20),J(2),V(),wn()),2&t){const e=n.index,r=ge(2).$implicit;H(2),Wn(r.domaceNaloge[e])}}function xG(t,n){if(1&t&&(_n(0),xe(1,wG,3,1,"ng-container",15),wn()),2&t){const e=ge(3);H(1),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloDomacihNalog))}}function CG(t,n){if(1&t){const e=Mn();j(0,"td")(1,"button",21),Ie("click",function(){const i=wt(e).$implicit,a=ge().$implicit;return xt(ge(2).onIssueCredential(a,i))}),J(2," Izdaj poverilnico "),V()()}if(2&t){const e=ge().$implicit;H(1),ie("disabled",!e.connection_id)}}function EG(t,n){if(1&t){const e=Mn();j(0,"tr")(1,"td"),J(2),V(),xe(3,mG,2,1,"ng-container",11),xe(4,vG,3,1,"ng-container",11),xe(5,bG,2,1,"ng-container",11),xe(6,_G,3,1,"ng-container",11),xe(7,xG,2,1,"ng-container",11),j(8,"td")(9,"form",16),Ie("ngSubmit",function(){const i=wt(e).$implicit;return xt(ge(2).onSelectEditStudent(i))}),j(10,"div",17)(11,"button",18),Ie("click",function(){const i=wt(e).$implicit;return xt(ge(2).onSelectEditStudent(i))}),J(12," Uredi dose\u017eke "),V()()()(),j(13,"td")(14,"form",16),Ie("ngSubmit",function(){const i=wt(e).$implicit;return xt(ge(2).onCreateInvitation2(i))}),j(15,"div",17)(16,"button",19),Ie("click",function(){const i=wt(e).$implicit;return xt(ge(2).onCreateInvitation2(i))}),J(17," Izdaj povabilo "),V()()()(),xe(18,CG,3,1,"td",15),V()}if(2&t){const e=n.$implicit,r=ge(2);H(2),Wn(e.studentId),H(1),ie("ngIf",r.selectedSubject.preverjanjaZnanja),H(1),ie("ngIf",r.selectedSubject.vaje),H(1),ie("ngIf",r.selectedSubject.seminarji),H(1),ie("ngIf",r.selectedSubject.sprotnoDelo),H(1),ie("ngIf",r.selectedSubject.domaceNaloge),H(9),Aa("id","",e._id,"CreateInvitation2Button"),ie("disabled",e.connection_id),H(2),ie("ngForOf",r.schemas)}}function DG(t,n){if(1&t&&(j(0,"table",13)(1,"thead")(2,"tr")(3,"th",14),J(4,"Vpisna \u0161tevilka"),V(),xe(5,sG,2,1,"ng-container",11),xe(6,uG,3,0,"ng-container",11),xe(7,lG,2,1,"ng-container",11),xe(8,dG,3,0,"ng-container",11),xe(9,hG,2,1,"ng-container",11),bn(10,"th")(11,"th"),xe(12,pG,2,1,"th",15),V()(),j(13,"tbody"),xe(14,EG,19,9,"tr",15),V()()),2&t){const e=ge();H(5),ie("ngIf",e.selectedSubject.preverjanjaZnanja),H(1),ie("ngIf",e.selectedSubject.vaje),H(1),ie("ngIf",e.selectedSubject.seminarji),H(1),ie("ngIf",e.selectedSubject.sprotnoDelo),H(1),ie("ngIf",e.selectedSubject.domaceNaloge),H(3),ie("ngForOf",e.schemas),H(2),ie("ngForOf",e.studentAchievements)}}function SG(t,n){if(1&t){const e=Mn();_n(0),j(1,"div",23)(2,"label",24),J(3),V(),j(4,"input",25),Ie("ngModelChange",function(o){const a=wt(e).index;return xt(ge(2).studentEditing.preverjanjaZnanja[a]=o)}),V()(),wn()}if(2&t){const e=n.index,r=ge(2);H(3),Sr("Preverjanje znanja \u0161t. ",e+1,""),H(1),Aa("name","preverjanjaZnanja",e,""),ie("ngModel",r.studentEditing.preverjanjaZnanja[e])}}function IG(t,n){if(1&t&&(_n(0),j(1,"label",22),J(2,"Preverjanja znanja"),V(),xe(3,SG,5,3,"ng-container",15),wn()),2&t){const e=ge();H(3),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloPreverjanjZnanja))}}function AG(t,n){if(1&t){const e=Mn();_n(0),j(1,"label",26),J(2,"Vaje"),V(),j(3,"div",23)(4,"label",27),J(5,"Vaje"),V(),j(6,"input",28),Ie("ngModelChange",function(o){return wt(e),xt(ge().studentEditing.vaje[0]=o)}),V()(),wn()}if(2&t){const e=ge();H(6),ie("ngModel",e.studentEditing.vaje[0])}}function MG(t,n){if(1&t){const e=Mn();_n(0),j(1,"div",23)(2,"label",30),J(3),V(),j(4,"input",31),Ie("ngModelChange",function(o){const a=wt(e).index;return xt(ge(2).studentEditing.seminarji[a]=o)}),V()(),wn()}if(2&t){const e=n.index,r=ge(2);H(3),Sr("Seminar \u0161t. ",e+1,""),H(1),Aa("name","seminarji",e,""),ie("ngModel",r.studentEditing.seminarji[e])}}function TG(t,n){if(1&t&&(_n(0),j(1,"label",29),J(2,"Seminarji"),V(),xe(3,MG,5,3,"ng-container",15),wn()),2&t){const e=ge();H(3),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloSeminarjev))}}function kG(t,n){if(1&t){const e=Mn();_n(0),j(1,"label",32),J(2,"Sprotno delo"),V(),j(3,"div",23)(4,"label",33),J(5,"Sprotno delo"),V(),j(6,"input",34),Ie("ngModelChange",function(o){return wt(e),xt(ge().studentEditing.sprotnoDelo[0]=o)}),V()(),wn()}if(2&t){const e=ge();H(6),ie("ngModel",e.studentEditing.sprotnoDelo[0])}}function RG(t,n){if(1&t){const e=Mn();_n(0),j(1,"div",23)(2,"label",36),J(3),V(),j(4,"input",37),Ie("ngModelChange",function(o){const a=wt(e).index;return xt(ge(2).studentEditing.domaceNaloge[a]=o)}),V()(),wn()}if(2&t){const e=n.index,r=ge(2);H(3),Sr("Doma\u010da naloga \u0161t. ",e+1,""),H(1),Aa("name","domaceNaloge",e,""),ie("ngModel",r.studentEditing.domaceNaloge[e])}}function NG(t,n){if(1&t&&(_n(0),j(1,"label",35),J(2,"Doma\u010de naloge"),V(),xe(3,RG,5,3,"ng-container",15),wn()),2&t){const e=ge();H(3),ie("ngForOf",e.repeatArray(e.selectedSubject.steviloDomacihNalog))}}let FG=(()=>{class t{constructor(e,r,o,i){this.agentsService=e,this.studentService=r,this.activatedRoute=o,this.authenticationService=i,this.createdSchemas={schema_ids:[]},this.schemas=[],this.isLoaded=!1,this.studentEditing={_id:"",studentId:"",predmetId:"",preverjanjaZnanja:[],vaje:[],seminarji:[],sprotnoDelo:[],domaceNaloge:[]},this.location=location}ngOnInit(){this.userLoggedIn=this.authenticationService.getCurrentUser(),this.activatedRoute.params.subscribe(e=>this.selectedSubjectId=e.subjectId),this.getStudentAchievements()}onIssueCredential(e,r){this.studentService.getRestrictions(r.id).subscribe(o=>{let i=!0;o?(o.attributes.forEach(a=>{a.attributeName.includes("Preverjanje znanja")?"="===a.relation?parseFloat(e.preverjanjaZnanja[a.attributeIndex])!=a.value&&(i=!1):">="===a.relation?parseFloat(e.preverjanjaZnanja[a.attributeIndex])<a.value&&(i=!1):">"===a.relation?parseFloat(e.preverjanjaZnanja[a.attributeIndex])<=a.value&&(i=!1):"<="==a.relation?parseFloat(e.preverjanjaZnanja[a.attributeIndex])>a.value&&(i=!1):"<"==a.relation&&parseFloat(e.preverjanjaZnanja[a.attributeIndex])>=a.value&&(i=!1):a.attributeName.includes("Va")?"="===a.relation?parseFloat(e.vaje[a.attributeIndex])!=a.value&&(i=!1):">="===a.relation?parseFloat(e.vaje[a.attributeIndex])<a.value&&(i=!1):">"===a.relation?parseFloat(e.vaje[a.attributeIndex])<=a.value&&(i=!1):"<="==a.relation?parseFloat(e.vaje[a.attributeIndex])>a.value&&(i=!1):"<"==a.relation&&parseFloat(e.vaje[a.attributeIndex])>=a.value&&(i=!1):a.attributeName.includes("Sem")?"="===a.relation?parseFloat(e.seminarji[a.attributeIndex])!=a.value&&(i=!1):">="===a.relation?parseFloat(e.seminarji[a.attributeIndex])<a.value&&(i=!1):">"===a.relation?parseFloat(e.seminarji[a.attributeIndex])<=a.value&&(i=!1):"<="==a.relation?parseFloat(e.seminarji[a.attributeIndex])>a.value&&(i=!1):"<"==a.relation&&parseFloat(e.seminarji[a.attributeIndex])>=a.value&&(i=!1):a.attributeName.includes("Spro")?"="===a.relation?parseFloat(e.sprotnoDelo[a.attributeIndex])!=a.value&&(i=!1):">="===a.relation?parseFloat(e.sprotnoDelo[a.attributeIndex])<a.value&&(i=!1):">"===a.relation?parseFloat(e.sprotnoDelo[a.attributeIndex])<=a.value&&(i=!1):"<="==a.relation?parseFloat(e.sprotnoDelo[a.attributeIndex])>a.value&&(i=!1):"<"==a.relation&&parseFloat(e.sprotnoDelo[a.attributeIndex])>=a.value&&(i=!1):a.attributeName.includes("Dom")&&("="===a.relation?parseFloat(e.domaceNaloge[a.attributeIndex])!=a.value&&(i=!1):">="===a.relation?parseFloat(e.domaceNaloge[a.attributeIndex])<a.value&&(i=!1):">"===a.relation?parseFloat(e.domaceNaloge[a.attributeIndex])<=a.value&&(i=!1):"<="==a.relation?parseFloat(e.domaceNaloge[a.attributeIndex])>a.value&&(i=!1):"<"==a.relation&&parseFloat(e.domaceNaloge[a.attributeIndex])>=a.value&&(i=!1))}),i?this.userLoggedIn?.admin_api_key?this.agentsService.getPublicDidFaber(this.userLoggedIn.admin_api_key).subscribe(a=>{e.connection_id&&this.userLoggedIn?.admin_api_key?this.agentsService.getConnectionByIdFaber(e.connection_id,this.userLoggedIn?.admin_api_key).subscribe(s=>{if("active"==s.state){let u=a.result.did,c=[];r.attrNames.forEach(l=>{if(l.includes("Preverjanje znanja")){let d=this.extractNumberFromString(l);c.push({name:l,value:e.preverjanjaZnanja[d-1]})}else if(l.includes("Vaje")){let d=this.extractNumberFromString(l);c.push({name:l,value:e.vaje[d-1]})}else if(l.includes("Seminar")){let d=this.extractNumberFromString(l);c.push({name:l,value:e.seminarji[d-1]})}else if(l.includes("Sprotno delo")){let d=this.extractNumberFromString(l);c.push({name:l,value:e.sprotnoDelo[d-1]})}else if(l.includes("Domaca naloga")){let d=this.extractNumberFromString(l);c.push({name:l,value:e.domaceNaloge[d-1]})}else c.push({name:l,value:""})}),this.userLoggedIn?.admin_api_key&&e.connection_id?this.agentsService.issueCredentialNew(c,r.name,u,e.connection_id,this.userLoggedIn?.admin_api_key):window.alert("Error.")}else window.alert("\u0160tudent \u0161e ni potrdil povezave.")}):window.alert("Error.")}):window.alert("Unauthorized"):window.alert("\u0160tudent ne izpolnjuje pogojev za pristop.")):window.alert("Nedefinirana pravila.")})}extractNumberFromString(e){const o=e.match(/\d+(\.\d+)?/);return o?parseFloat(o[0]):1}getCreatedSchemasFaber(e){this.studentService.getExamsBySubject(this.selectedSubjectId).subscribe(r=>{r.forEach(o=>{o.credentialSchemaNames.forEach(i=>{i.includes(this.selectedSubject.predmetNaziv)&&this.createdSchemas.schema_ids.push(i)})}),this.getAllSchemas(this.createdSchemas,e)})}getAllSchemas(e,r){this.schemas=[],e.schema_ids.forEach(o=>{this.agentsService.getSchemaById(o,r).subscribe(i=>{this.schemas.push(i.schema)})}),this.isLoaded=!0}getStudentAchievements(){this.studentService.getSubject(this.selectedSubjectId).subscribe(e=>{if(this.selectedSubject=e,this.selectedSubject.preverjanjaZnanja){this.preverjanjaZnanjaCount=new Array(this.selectedSubject.steviloPreverjanjZnanja);for(var r=0;r<this.selectedSubject.steviloPreverjanjZnanja;r++)this.preverjanjaZnanjaCount[r]=r+1}if(this.selectedSubject.seminarji)for(this.seminarjiCount=new Array(this.selectedSubject.steviloSeminarjev),r=0;r<this.selectedSubject.steviloSeminarjev;r++)this.seminarjiCount[r]=r+1;if(this.selectedSubject.domaceNaloge)for(this.domaceNalogeCount=new Array(this.selectedSubject.steviloDomacihNalog),r=0;r<this.selectedSubject.steviloDomacihNalog;r++)this.domaceNalogeCount[r]=r+1;this.studentService.getStudentAchievements(this.selectedSubject.predmetId).subscribe(o=>{this.studentAchievements=o,this.userLoggedIn?.admin_api_key&&this.getCreatedSchemasFaber(this.userLoggedIn.admin_api_key)})})}repeatArray(e){return new Array(e)}onSelectEditStudent(e){this.studentEditing._id=e._id,this.studentEditing.studentId=e.studentId,this.studentEditing.predmetId=e.predmetId,this.studentEditing.preverjanjaZnanja=e.preverjanjaZnanja,this.studentEditing.vaje=e.vaje,this.studentEditing.seminarji=e.seminarji,this.studentEditing.sprotnoDelo=e.sprotnoDelo,this.studentEditing.domaceNaloge=e.domaceNaloge}onEditStudent(){let e=[];this.studentEditing.preverjanjaZnanja&&this.studentEditing.preverjanjaZnanja.forEach((s,u)=>{e.push({index:u.toString(),value:s})});let r=[];this.studentEditing.vaje&&this.studentEditing.vaje.forEach((s,u)=>{r.push({index:u.toString(),value:s})});let o=[];this.studentEditing.seminarji&&this.studentEditing.seminarji.forEach((s,u)=>{o.push({index:u.toString(),value:s})});let i=[];this.studentEditing.sprotnoDelo&&this.studentEditing.sprotnoDelo.forEach((s,u)=>{i.push({index:u.toString(),value:s})});let a=[];this.studentEditing.domaceNaloge&&this.studentEditing.domaceNaloge.forEach((s,u)=>{a.push({index:u.toString(),value:s})}),this.studentService.putStudentAchievements(this.studentEditing._id,e,r,o,i,a).subscribe(s=>{this.studentEditing={_id:"",studentId:"",predmetId:"",preverjanjaZnanja:[],vaje:[],seminarji:[],sprotnoDelo:[],domaceNaloge:[]},location.reload()})}onCreateInvitation2(e){this.userLoggedIn?.admin_api_key?this.agentsService.createInvitation2(this.userLoggedIn.admin_api_key).subscribe(r=>{this.userLoggedIn?.admin_api_key&&this.agentsService.getConnectionByMsgIdFaber(r.invi_msg_id,this.userLoggedIn.admin_api_key).subscribe(o=>{1==o.results.length?this.userLoggedIn?.admin_api_key&&this.studentService.sendConnection(e.studentId,r.invitation,"",this.userLoggedIn.admin_api_key).subscribe(i=>{"Invitation created."!=i.message?window.alert("Error sending invitation."):this.studentService.putStudentAchievementsConnections(e._id,o.results[0].connection_id).subscribe(a=>{"Achievements changed."!=a.message?window.alert("Error sending invitation."):location.reload()})}):window.alert("Error.")})}):window.alert("Unauthorized.")}resetAchievements(){}static{this.\u0275fac=function(r){return new(r||t)(q(jd),q(ja),q(Si),q(na))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-student-list"]],inputs:{subjectNameParam:"subjectNameParam"},decls:20,vars:7,consts:[["emptyCell",""],[2,"overflow-x","auto !important"],["class","table",4,"ngIf"],["id","editStudentModal","tabindex","-1","aria-labelledby","editStudentModal","aria-hidden","true","data-bs-backdrop","static",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["id","editSubjectClose","type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[3,"ngSubmit"],[4,"ngIf"],["type","submit","data-bs-dismiss","modal",1,"btn","modal-submit","change-achievements-modal-button",2,"margin-top","20px",3,"click"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],["autocomplete","off",1,"forms",3,"ngSubmit"],[1,"d-flex"],["type","button","data-bs-toggle","modal","data-bs-target","#editStudentModal",1,"btn","shadow",3,"click"],["type","button",1,"btn","shadow","list-button",3,"id","disabled","click"],["scope","col",2,"width","200px"],[1,"btn","shadow","list-button",3,"disabled","click"],["for","pzs",1,"form-label"],[1,"input-group"],["for","pzs",1,"input-group-text",2,"width","50%"],["type","text","id","pzs",1,"form-control",3,"name","ngModel","ngModelChange"],["for","vaje",1,"form-label"],["for","vaje",1,"input-group-text",2,"width","50%"],["type","text","id","vaje","name","vaje",1,"form-control",3,"ngModel","ngModelChange"],["for","seminars",1,"form-label"],["for","seminars",1,"input-group-text",2,"width","50%"],["type","text","id","seminars",1,"form-control",3,"name","ngModel","ngModelChange"],["for","sprotnoDelo",1,"form-label"],["for","sprotnoDelo",1,"input-group-text",2,"width","50%"],["type","text","id","sprotnoDelo","name","sprotnoDelo",1,"form-control",3,"ngModel","ngModelChange"],["for","domaceNaloge",1,"form-label"],["for","domaceNaloge",1,"input-group-text",2,"width","50%"],["type","text","id","domaceNaloge",1,"form-control",3,"name","ngModel","ngModelChange"]],template:function(r,o){1&r&&(xe(0,iG,2,0,"ng-template",null,0,AS),j(2,"div",1),xe(3,DG,15,7,"table",2),V(),j(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"h5",7),J(9),V(),j(10,"button",8),Ie("click",function(){return o.location.reload()}),V()(),j(11,"div",9)(12,"form",10),Ie("ngSubmit",function(){return o.onEditStudent()}),xe(13,IG,4,1,"ng-container",11),xe(14,AG,7,1,"ng-container",11),xe(15,TG,4,1,"ng-container",11),xe(16,kG,7,1,"ng-container",11),xe(17,NG,4,1,"ng-container",11),j(18,"button",12),Ie("click",function(){return o.onEditStudent()}),J(19,"Spremeni"),V()()()()()()),2&r&&(H(3),ie("ngIf",o.isLoaded),H(6),Sr("\u0160tudent ",o.studentEditing.studentId,""),H(4),ie("ngIf",o.selectedSubject.preverjanjaZnanja),H(1),ie("ngIf",o.selectedSubject.vaje),H(1),ie("ngIf",o.selectedSubject.seminarji),H(1),ie("ngIf",o.selectedSubject.sprotnoDelo),H(1),ie("ngIf",o.selectedSubject.domaceNaloge))},dependencies:[Zs,Yi,iu,nu,Rd,ru,Lc,Ba],styles:["button[_ngcontent-%COMP%]{background-color:#7e8cbb;color:#fff}button[_ngcontent-%COMP%]:hover{border-color:#7e8cbb;background-color:#f0edef;color:#7e8cbb}#editSubjectClose[_ngcontent-%COMP%], #issueCredentialClose[_ngcontent-%COMP%]{background-color:#fff!important}tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background-color:#f0edef!important}input[type=radio][_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{color:#fff!important;background-color:#7e8cbb!important;border-color:#7e8cbb!important}.hidden[_ngcontent-%COMP%]{visibility:hidden}.selection-buttons[_ngcontent-%COMP%]{border-color:#0e1122!important;color:#0e1122!important;background-color:#fff!important;text-align:center!important}.selection-buttons[_ngcontent-%COMP%]:hover{color:#fff!important;background-color:#7e8cbb!important;text-align:center!important;border-color:#7e8cbb!important}#izdajPoverilnicoFinalButton[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important}#izdajPoverilnicoFinalButton[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}.QRAllert[_ngcontent-%COMP%]{width:40em!important}.btn-close-invitation[_ngcontent-%COMP%]{background-color:#8b0000;color:#fff;border-color:#8b0000}.btn-close-invitation[_ngcontent-%COMP%]:hover{background-color:#fff;color:#8b0000;border-color:#8b0000}.change-achievements-modal-button[_ngcontent-%COMP%]:hover{background-color:#fff}"]})}}return t})();function OG(t,n){if(1&t&&(j(0,"div"),bn(1,"input",35),j(2,"label",36),J(3),V()()),2&t){const e=n.$implicit;H(1),ds("id",e.attributeName),H(1),ds("for",e.attributeName),H(1),Wn(e.attributeName)}}function PG(t,n){if(1&t){const e=Mn();j(0,"div")(1,"input",37),Ie("change",function(){const i=wt(e).$implicit;return xt(ge(2).onExamSelect(i.examId))}),V(),j(2,"label",36),J(3),V()()}if(2&t){const e=n.$implicit;H(1),ds("id",e.examId),ie("disabled",e.schemaDefined),H(1),ds("for",e.examId),H(1),Wn(e.examId)}}function LG(t,n){if(1&t&&(j(0,"span",45),J(1),V()),2&t){const e=ge().$implicit;H(1),Wn(e.attributeName)}}function BG(t,n){1&t&&(j(0,"span",45),J(1,"Doma\u010da naloga"),V())}function jG(t,n){if(1&t&&(j(0,"span",45),J(1),V()),2&t){const e=ge().$implicit;H(1),Wn(e.attributeIndex)}}function VG(t,n){if(1&t){const e=Mn();j(0,"div",41),xe(1,LG,2,1,"span",42),xe(2,BG,2,0,"span",42),xe(3,jG,2,1,"span",42),j(4,"input",43),Ie("ngModelChange",function(o){return xt(wt(e).$implicit.relation=o)}),V(),j(5,"input",44),Ie("ngModelChange",function(o){return xt(wt(e).$implicit.value=o)}),V()()}if(2&t){const e=n.$implicit;H(1),ie("ngIf",!e.attributeName.includes("Domaca naloga")),H(1),ie("ngIf",e.attributeName.includes("Domaca naloga")),H(1),ie("ngIf",0!=e.attributeIndex),H(1),ie("ngModel",e.relation),H(1),ie("ngModel",e.value)}}function UG(t,n){if(1&t){const e=Mn();j(0,"div",38)(1,"h4"),J(2),V(),j(3,"p"),J(4),V(),xe(5,VG,6,5,"div",39),j(6,"button",40),Ie("click",function(){const o=wt(e),i=o.$implicit,a=o.index,s=ge(2);return xt(s.defineRules(i.examId,s.examRestrictions[a]))}),J(7,"Uredi zahteve"),V()()}if(2&t){const e=n.$implicit,r=n.index,o=ge(2);H(2),Wn(e.examId),H(2),Ql("od: ",o.dateToString(e.beginning.toString()),", do: ",o.dateToString(e.ending.toString()),""),H(1),ie("ngForOf",o.examRestrictions[r].attributes),H(1),ie("disabled",e.rulesDefined)}}function HG(t,n){if(1&t&&(j(0,"p"),J(1),V()),2&t){const e=ge().$implicit;H(1),Jv("",e.attributeName," ",e.attributeIndex+1," ",e.relation," ",e.value,"")}}function zG(t,n){if(1&t&&(j(0,"p"),J(1),V()),2&t){const e=ge().$implicit;H(1),jh("",e.attributeName," ",e.relation," ",e.value,"")}}function WG(t,n){if(1&t&&(j(0,"p"),J(1),V()),2&t){const e=ge().$implicit;H(1),jh("Doma\u010da naloga ",e.attributeIndex+1," ",e.relation," ",e.value,"")}}function $G(t,n){if(1&t&&(j(0,"div",41),xe(1,HG,2,4,"p",0),xe(2,zG,2,3,"p",0),xe(3,WG,2,3,"p",0),V()),2&t){const e=n.$implicit;H(1),ie("ngIf",!e.attributeName.includes("Domaca naloga")&&!e.attributeName.includes("Sprotno")&&!e.attributeName.includes("Vaj")),H(1),ie("ngIf",e.attributeName.includes("Sprotno")||e.attributeName.includes("Vaj")),H(1),ie("ngIf",e.attributeName.includes("Domaca naloga"))}}function GG(t,n){if(1&t&&(j(0,"div")(1,"h4"),J(2),V(),j(3,"p"),J(4),V(),xe(5,$G,4,3,"div",39),V()),2&t){const e=n.$implicit,r=n.index,o=ge(2);H(2),Wn(e.examId),H(2),Ql("od: ",o.dateToString(e.beginning.toString()),", do: ",o.dateToString(e.ending.toString()),""),H(1),ie("ngForOf",o.definedExamCredentials[r].attributes)}}function qG(t,n){if(1&t){const e=Mn();j(0,"div")(1,"div",1)(2,"div",2)(3,"h1",3),J(4),V()(),j(5,"div",4)(6,"div",5)(7,"button",6),Ie("click",function(){wt(e);const o=ge();return xt(o.getExams(o.selectedSubjectId))}),J(8,"Ustvari shemo"),V(),j(9,"button",7),Ie("click",function(){return wt(e),xt(ge().onGetAllSchemas())}),J(10,"Pregled izpitov"),V(),j(11,"button",8),Ie("click",function(){return wt(e),xt(ge().onGetApplications())}),J(12,"Pregled prijav"),V(),j(13,"button",9),Ie("click",function(){return wt(e),xt(ge().redirectToSubjects())}),J(14,"Nazaj na predmete"),V()()()(),j(15,"div",10)(16,"div",11),bn(17,"app-student-list",12),V()(),j(18,"div",13)(19,"div",14)(20,"div",15)(21,"div",16)(22,"h1",17),J(23,"Ustvarjanje sheme"),V(),bn(24,"button",18),V(),j(25,"div",19)(26,"form",20),Ie("ngSubmit",function(){return wt(e),xt(ge().onAttributesSelected())}),j(27,"div",21)(28,"div",22),xe(29,OG,4,3,"div",23),j(30,"p")(31,"i"),J(32,"Prosimo, izberite izpit"),V()(),xe(33,PG,4,4,"div",23),V()(),j(34,"div",24)(35,"label",25),J(36,"Naziv:"),V()(),j(37,"div",24)(38,"input",26),Ie("ngModelChange",function(o){return wt(e),xt(ge().newSchemaName=o)}),V()(),j(39,"div",27)(40,"button",28),Ie("keyup.enter",function(){return wt(e),xt(ge().onAttributesSelected())}),J(41," Ustvari shemo "),V()()()()()()(),j(42,"div",29)(43,"div",30)(44,"div",31)(45,"div",16)(46,"h1",32),J(47,"Pregled izpitov"),V(),bn(48,"button",33),V(),j(49,"div",19),xe(50,UG,8,5,"div",34),xe(51,GG,6,4,"div",23),V()()()()()}if(2&t){const e=ge();H(4),Wn(e.selectedSubject.predmetNaziv),H(13),ie("subjectNameParam",e.selectedSubject.predmetNaziv),H(12),ie("ngForOf",e.allAttributes),H(4),ie("ngForOf",e.exams),H(5),ie("ngModel",e.newSchemaName),H(12),ie("ngForOf",e.viewExams),H(1),ie("ngForOf",e.definedExams)}}let XG=(()=>{class t{constructor(e,r,o,i,a){this.agentsService=e,this.router=r,this.activatedRoute=o,this.authenticationService=i,this.studentService=a,this.modalPrepared=!1,this.selectedSubject={_id:"",predmetId:"",predmetNaziv:"",preverjanjaZnanja:!1,steviloPreverjanjZnanja:0,vaje:!1,seminarji:!1,steviloSeminarjev:0,sprotnoDelo:!1,domaceNaloge:!1,steviloDomacihNalog:0,defined:!1,students:[]},this.allAttributes=[],this.selectedExamId="",this.isLoaded=!1,this.style=oG,this.viewExamCredentials=[],this.viewExams=[],this.definedExams=[],this.definedExamCredentials=[],this.examRestrictions=[]}ngOnInit(){let e;this.activatedRoute.params.subscribe(o=>e=o.subjectId),this.selectedSubjectId=e;const r=this.authenticationService.getCurrentUser();null==r?this.router.navigate(["/"]).then(()=>{location.reload()}):null!=r.subjectIds&&r.subjectIds.includes(e)?(this.userLoggedIn=r,this.getSubjectInfo()):this.router.navigate(["/subjects"])}onUstvariShemoModalOpen(){this.modalPrepared=!0}rewriteAttribute(e){return e.replace(/\u010d/g,"c").replace(/\u017e/g,"z").replace(/\u0161/g,"s")}onExamSelect(e){this.selectedExamId=e}onAttributesSelected(){let e=[];this.allAttributes.forEach(r=>{document.getElementById(r.attributeName).checked&&e.push(this.rewriteAttribute(r.attributeName))}),this.selectedExamId?this.postSchemaNew(e,this.selectedExamId+"_"+this.newSchemaName,"1.0.0",this.selectedExamId):window.alert("Prosimo, izberite izpitni rok.")}postSchemaNew(e,r,o,i){let a=this.selectedSubject.predmetNaziv+"_"+r;this.userLoggedIn?.admin_api_key?this.agentsService.postSchemaNew(e,a,o,this.userLoggedIn?.admin_api_key).subscribe(s=>{this.postCredentialDefinitions(1e3,s.schema_id,!1,s.schema.name),this.studentService.putExamCredentials(i,s.schema_id).subscribe(u=>{location.reload()})}):window.alert("Unauthorized")}postCredentialDefinitions(e,r,o,i){this.userLoggedIn?.admin_api_key?this.agentsService.postCredentialDefinitions(e,r,o,i,this.userLoggedIn?.admin_api_key).subscribe(a=>{}):window.alert("Unauthorized.")}getSubjectInfo(){this.studentService.getSubject(this.selectedSubjectId).subscribe(e=>{e._id&&(this.selectedSubject._id=e._id),e.predmetId&&(this.selectedSubject.predmetId=e.predmetId),e.predmetNaziv&&(this.selectedSubject.predmetNaziv=e.predmetNaziv),e.preverjanjaZnanja&&(this.selectedSubject.preverjanjaZnanja=e.preverjanjaZnanja),e.steviloPreverjanjZnanja&&(this.selectedSubject.steviloPreverjanjZnanja=e.steviloPreverjanjZnanja),e.vaje&&(this.selectedSubject.vaje=e.vaje),e.seminarji&&(this.selectedSubject.seminarji=e.seminarji),e.steviloSeminarjev&&(this.selectedSubject.steviloSeminarjev=e.steviloSeminarjev),e.sprotnoDelo&&(this.selectedSubject.sprotnoDelo=e.sprotnoDelo),e.domaceNaloge&&(this.selectedSubject.domaceNaloge=e.domaceNaloge),e.steviloDomacihNalog&&(this.selectedSubject.steviloDomacihNalog=e.steviloDomacihNalog),e.defined&&(this.selectedSubject.defined=e.defined),e.students&&(this.selectedSubject.students=e.students),0==this.selectedSubject.defined&&this.router.navigate(["/subjects"]),this.defineAllAttributes()})}defineAllAttributes(){if(this.selectedSubject.preverjanjaZnanja)for(let e=0;e<this.selectedSubject.steviloPreverjanjZnanja;e++)this.allAttributes.push({attributeName:`Preverjanje znanja ${e+1}`,attributeChecked:!1});if(this.selectedSubject.vaje&&this.allAttributes.push({attributeName:"Vaje",attributeChecked:!1}),this.selectedSubject.seminarji)for(let e=0;e<this.selectedSubject.steviloSeminarjev;e++)this.allAttributes.push({attributeName:`Seminarska naloga ${e+1}`,attributeChecked:!1});if(this.selectedSubject.sprotnoDelo&&this.allAttributes.push({attributeName:"Sprotno delo",attributeChecked:!1}),this.selectedSubject.domaceNaloge)for(let e=0;e<this.selectedSubject.steviloDomacihNalog;e++)this.allAttributes.push({attributeName:`Doma\u010da naloga ${e+1}`,attributeChecked:!1});this.isLoaded=!0}onGetAllSchemas(){this.viewExamCredentials=[],this.viewExams=[],this.definedExamCredentials=[],this.definedExams=[],this.examRestrictions=[],this.userLoggedIn?.admin_api_key&&this.studentService.getExamsBySubject(this.selectedSubjectId).subscribe(e=>{e.forEach(r=>{r.credentialSchemaNames.forEach(0==r.rulesDefined?o=>{let i=[];o.includes(r.examId)&&(this.userLoggedIn?.admin_api_key&&this.agentsService.getSchemaById(o,this.userLoggedIn.admin_api_key).subscribe(a=>{a.schema.attrNames.forEach(s=>{i.push({attributeName:this.removeDigitsOnly(s),attributeIndex:this.extractFirstNumber(s),relation:"",value:0})})}),this.examRestrictions.push({credentialSchemaName:o,attributes:i}),this.viewExams.push(r))}:o=>{o.includes(r.examId)&&this.studentService.getRestrictions(o).subscribe(i=>{this.definedExamCredentials.push(i),this.definedExams.push(r)})})})})}getExams(e){this.studentService.getExamsBySubject(e).subscribe(r=>{this.exams=r,this.selectedExamId=""})}dateToString(e){return new Date(e).toLocaleString("sk-SK",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:void 0,hour12:!1})}changeCredentials(e){}redirectToSubjects(){this.router.navigate(["/subjects"])}onGetApplications(){this.router.navigate([`examApplications/${this.selectedSubjectId}`])}extractFirstNumber(e){const r=e.match(/\d+/);return r?parseInt(r[0]):0}removeDigitsOnly(e){return e.replace(/\d/g,"")}defineRules(e,r){let o=!0;r.attributes.forEach(i=>{"<"===i.relation||">"===i.relation||"<="===i.relation||">="===i.relation||"="===i.relation||(o=!1),isNaN(Number(i.value))&&(o=!1)}),r.attributes.forEach(i=>{i.attributeIndex>0&&(i.attributeIndex=i.attributeIndex-1)}),o?this.studentService.postExamRestriction(e,r).subscribe(i=>{window.alert("Uspe\u0161no definirana pravila.")}):window.alert("Invalid input.")}static{this.\u0275fac=function(r){return new(r||t)(q(jd),q(dr),q(Si),q(na),q(ja))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-subject"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"row","g-0","text-center",2,"margin-top","1em"],[1,"col-6","col-md-4"],[1,"display-5"],[1,"col-sm-6","col-md-8"],[1,"btn-group"],["type","button","data-bs-toggle","modal","data-bs-target","#ustvariShemoModal",1,"btn","shadow","mini-navigation-button",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#EditExamModal",1,"btn","shadow","mini-navigation-button",3,"click"],["type","button",1,"btn","shadow","mini-navigation-button",3,"click"],["type","button","data-bs-toggle","modal",1,"btn","shadow","mini-navigation-button",3,"click"],[1,"row","g-0","text-center"],[1,"",2,"width","100%"],[3,"subjectNameParam"],["id","ustvariShemoModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["id","ustvariShemoModalDialog",1,"modal-dialog"],["id","ustvariShemoModalContent",1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","id","ustvariShemoClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["autocomplete","off",1,"forms",3,"ngSubmit"],[1,""],["role","","aria-label",""],[4,"ngFor","ngForOf"],[1,"d-flex","flex-row"],["for","newSchemaName"],["type","text","id","newSchemaName","placeholder","Vpi\u0161ite naziv","name","newSchemaName",1,"form-control",3,"ngModel","ngModelChange"],[1,"d-flex","flex-row","justify-content-evenly"],["type","submit","data-bs-dismiss","modal","aria-label","Close",1,"btn","shadow","rounded-1","mt-4",3,"keyup.enter"],["id","EditExamModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["id","EditExamModalDialog",1,"modal-dialog"],["id","EditExamModalContent",1,"modal-content"],["id","EditExamModalLabel",1,"modal-title","fs-5"],["type","button","id","EditExamModalClose","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],["style","margin-bottom: 10%",4,"ngFor","ngForOf"],["type","checkbox","autocomplete","off",1,"hidden",3,"id"],[1,"btn","selection-buttons","shadow","border","rounded-1",2,"width","100%","margin-bottom","5px",3,"for"],["type","radio","autocomplete","off","name","exam_selection",1,"hidden",3,"id","disabled","change"],[2,"margin-bottom","10%"],["class","input-group",4,"ngFor","ngForOf"],["data-bs-dismiss","modal",1,"btn","btn-purple",2,"margin-top","2%",3,"disabled","click"],[1,"input-group"],["class","input-group-text",4,"ngIf"],["type","text","aria-label","First name","placeholder","Relacija",1,"form-control",3,"ngModel","ngModelChange"],["type","text","aria-label","Last name","placeholder","Vrednost",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-text"]],template:function(r,o){1&r&&xe(0,qG,52,7,"div",0),2&r&&ie("ngIf",o.isLoaded)},dependencies:[Zs,Yi,iu,nu,Rd,ru,Lc,Ba,FG],styles:["button[_ngcontent-%COMP%]{background-color:#7e8cbb;color:#fff}button[_ngcontent-%COMP%]:hover{border-color:#7e8cbb;background-color:#fff;color:#7e8cbb}#ustvariShemoModalContent[_ngcontent-%COMP%]{width:100%}.selection-buttons[_ngcontent-%COMP%]{border-color:#0e1122!important;color:#0e1122!important;background-color:#fff!important;text-align:center!important}.selection-buttons[_ngcontent-%COMP%]:hover{color:#fff!important;background-color:#7e8cbb!important;text-align:center!important;border-color:#7e8cbb!important}input[type=checkbox][_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{color:#fff!important;background-color:#7e8cbb!important;border-color:#7e8cbb!important}input[type=checkbox][_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{color:#fff!important;background-color:#9199b5!important;border-color:#7e8cbb!important}input[type=radio][_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{color:#fff!important;background-color:#7e8cbb!important;border-color:#7e8cbb!important}input[type=radio][_ngcontent-%COMP%]:disabled + label[_ngcontent-%COMP%]{color:#fff!important;background-color:#9199b5!important;border-color:#7e8cbb!important}.hidden[_ngcontent-%COMP%]{visibility:hidden}#ustvariShemoClose[_ngcontent-%COMP%], #EditExamModalClose[_ngcontent-%COMP%]{background-color:#fff!important}.mini-navigation-button[_ngcontent-%COMP%]{background-color:#9e969b;border-color:#9e969b}.mini-navigation-button[_ngcontent-%COMP%]:hover{background-color:#f0edef;color:#9e969b;border-color:#9e969b}"]})}}return t})();function KG(t,n){1&t&&(j(0,"h6",32),J(1,"Doma\u010de naloge"),V())}function ZG(t,n){1&t&&(j(0,"h6",32),J(1,"Preverjanja znanja"),V())}function YG(t,n){1&t&&(j(0,"h6",32),J(1,"Seminar"),V())}function QG(t,n){1&t&&(j(0,"h6",32),J(1,"Sprotno delo"),V())}function JG(t,n){1&t&&(j(0,"h6",32),J(1,"Vaje"),V())}function eq(t,n){1&t&&(j(0,"div",33)(1,"button",34),J(2," Uredi "),V()())}function tq(t,n){if(1&t){const e=Mn();j(0,"div",26)(1,"div",9)(2,"div",27),bn(3,"i",28),V(),j(4,"h5",29),Ie("click",function(){const i=wt(e).$implicit;return xt(ge().redirect(i.predmetId))}),j(5,"a"),J(6),V()(),xe(7,KG,2,0,"h6",30),xe(8,ZG,2,0,"h6",30),xe(9,YG,2,0,"h6",30),xe(10,QG,2,0,"h6",30),xe(11,JG,2,0,"h6",30),j(12,"form",10),Ie("ngSubmit",function(){const i=wt(e).$implicit;return xt(ge().onEditOpen(i.predmetId))}),xe(13,eq,3,0,"div",31),V()()()}if(2&t){const e=n.$implicit;H(6),Wn(e.predmetNaziv),H(1),ie("ngIf",e.domaceNaloge),H(1),ie("ngIf",e.preverjanjaZnanja),H(1),ie("ngIf",e.seminarji),H(1),ie("ngIf",e.sprotnoDelo),H(1),ie("ngIf",e.vaje),H(2),ie("ngIf",0==e.defined)}}function nq(t,n){if(1&t){const e=Mn();j(0,"div",35)(1,"label",36),J(2,"\u0160tevilo preverjanj znanja"),V(),j(3,"input",37),Ie("ngModelChange",function(o){return wt(e),xt(ge().selectedSubject.steviloPreverjanjZnanja=o)}),V()()}if(2&t){const e=ge();H(3),ie("ngModel",e.selectedSubject.steviloPreverjanjZnanja)("disabled",!e.selectedSubject.preverjanjaZnanja)}}function rq(t,n){if(1&t){const e=Mn();j(0,"div",35)(1,"label",38),J(2,"\u0160tevilo seminarjev"),V(),j(3,"input",39),Ie("ngModelChange",function(o){return wt(e),xt(ge().selectedSubject.steviloSeminarjev=o)}),V()()}if(2&t){const e=ge();H(3),ie("ngModel",e.selectedSubject.steviloSeminarjev)("disabled",!e.selectedSubject.seminarji)}}function oq(t,n){if(1&t){const e=Mn();j(0,"div",35)(1,"label",40),J(2,"\u0160tevilo doma\u010dih nalog"),V(),j(3,"input",41),Ie("ngModelChange",function(o){return wt(e),xt(ge().selectedSubject.steviloDomacihNalog=o)}),V()()}if(2&t){const e=ge();H(3),ie("ngModel",e.selectedSubject.steviloDomacihNalog)("disabled",!e.selectedSubject.domaceNaloge)}}let iq=(()=>{class t{constructor(e,r,o){this.studentService=e,this.router=r,this.authenticationService=o,this.subjects=[],this.selectedSubject={_id:"",predmetId:"",predmetNaziv:"",preverjanjaZnanja:!1,steviloPreverjanjZnanja:0,vaje:!1,seminarji:!1,steviloSeminarjev:0,sprotnoDelo:!1,domaceNaloge:!1,steviloDomacihNalog:0,defined:!1,students:[]}}ngOnInit(){this.getCurrentUser(),null==this.userLoggedIn||"pedagoski_delavec"!=this.userLoggedIn.type?this.logout():this.getSubjects()}getCurrentUser(){const e=this.authenticationService.getCurrentUser();this.userLoggedIn=e}getSubjects(){this.userLoggedIn&&"pedagoski_delavec"==this.userLoggedIn?.type?this.userLoggedIn.subjectIds?.forEach(e=>{this.studentService.getSubject(e).subscribe(r=>{this.subjects.push(r)})}):this.logout()}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}onEditSubject(){this.editSubject(this.selectedSubject._id,this.selectedSubject.preverjanjaZnanja,this.selectedSubject.steviloPreverjanjZnanja,this.selectedSubject.vaje,this.selectedSubject.seminarji,this.selectedSubject.steviloSeminarjev,this.selectedSubject.sprotnoDelo,this.selectedSubject.domaceNaloge,this.selectedSubject.steviloDomacihNalog)}onEditOpen(e){this.studentService.getSubject(e).subscribe(r=>{this.selectedSubject=r})}redirect(e){this.router.navigate([`/subjects/${e}`])}editSubject(e,r,o,i,a,s,u,c,l){r||(o=0),a||(s=0),c||(l=0),this.studentService.putSubject(e,r,o,i,a,s,u,c,l).subscribe(d=>{location.reload()})}static{this.\u0275fac=function(r){return new(r||t)(q(ja),q(dr),q(na))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-subjects"]],decls:42,vars:10,consts:[[1,"row",2,"width","100%"],["class","card col-md-12 col-sm-12 shadow rounded-5","style","width: 18rem;",4,"ngFor","ngForOf"],["id","subjectEditModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content","rounded-1"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body","text-center"],[1,"card-body"],["autocomplete","off",1,"forms",3,"ngSubmit"],[1,"list-group"],[1,"list-group-item","lgi-1","shadow"],["type","checkbox","id","preverjanjaZnanja","name","preverjanjaZnanja",3,"ngModel","ngModelChange"],["for","preverjanjaZnanja",1,"form-label"],["class","d-flex justify-content-center list-group-item lgi-2 shadow",4,"ngIf"],[1,"mb-3","list-group-item","lgi-alone","shadow"],["type","checkbox","id","vaje","name","vaje",3,"ngModel","ngModelChange"],["for","vaje",1,"form-label"],["type","checkbox","id","seminarji","name","seminarji",3,"ngModel","ngModelChange"],["for","seminarji",1,"form-label"],["type","checkbox","id","sprotnoDelo","name","sprotnoDelo",3,"ngModel","ngModelChange"],["for","sprotnoDelo",1,"form-label"],["type","checkbox","id","domaceNaloge","name","domaceNaloge",3,"ngModel","ngModelChange"],["for","domaceNaloge",1,"form-label"],["data-bs-dismiss","modal","aria-label","Close","type","submit","id","editSubjectSubmitButton",1,"btn","background-green","shadow","rounded-1","mt-4",3,"keyup.enter"],[1,"card","col-md-12","col-sm-12","shadow","rounded-5",2,"width","18rem"],["id","school-icon",1,"position-relative"],[1,"fa-solid","fa-school","fa-2xl","position-absolute","top-0","start-50","translate-middle"],[1,"card-title",2,"margin-top","3em",3,"click"],["class","card-subtitle mb-2 text-body-secondary",4,"ngIf"],["class","d-flex gumbi",4,"ngIf"],[1,"card-subtitle","mb-2","text-body-secondary"],[1,"d-flex","gumbi"],["data-bs-toggle","modal","data-bs-target","#subjectEditModal","type","submit",1,"btn","rounded-1","mt-4","uredi-button"],[1,"d-flex","justify-content-center","list-group-item","lgi-2","shadow"],["for","steviloPreverjanjZnanja",1,"form-label"],["type","number","min","0","id","steviloPreverjanjZnanja","name","steviloPreverjanjZnanja",1,"form-control",3,"ngModel","disabled","ngModelChange"],["for","steviloSeminarjev",1,"form-label"],["type","number","min","0","id","steviloSeminarjev","name","steviloSeminarjev",1,"form-control",3,"ngModel","disabled","ngModelChange"],["for","steviloDomacihNalog",1,"form-label"],["type","number","min","0","id","steviloDomacihNalog","name","steviloDomacihNalog",1,"form-control",3,"ngModel","disabled","ngModelChange"]],template:function(r,o){1&r&&(j(0,"div",0),xe(1,tq,14,7,"div",1),V(),j(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h1",6),J(7),V(),bn(8,"button",7),V(),j(9,"div",8)(10,"div",9)(11,"form",10),Ie("ngSubmit",function(){return o.onEditSubject()}),j(12,"div",11)(13,"div",12)(14,"input",13),Ie("ngModelChange",function(a){return o.selectedSubject.preverjanjaZnanja=a}),V(),j(15,"label",14),J(16," Preverjanja znanja"),V()(),xe(17,nq,4,2,"div",15),V(),j(18,"div",11)(19,"div",16)(20,"input",17),Ie("ngModelChange",function(a){return o.selectedSubject.vaje=a}),V(),j(21,"label",18),J(22," Vaje"),V()()(),j(23,"div",11)(24,"div",12)(25,"input",19),Ie("ngModelChange",function(a){return o.selectedSubject.seminarji=a}),V(),j(26,"label",20),J(27," Seminarji"),V()(),xe(28,rq,4,2,"div",15),V(),j(29,"div",11)(30,"div",16)(31,"input",21),Ie("ngModelChange",function(a){return o.selectedSubject.sprotnoDelo=a}),V(),j(32,"label",22),J(33," Sprotno delo"),V()()(),j(34,"div",11)(35,"div",12)(36,"input",23),Ie("ngModelChange",function(a){return o.selectedSubject.domaceNaloge=a}),V(),j(37,"label",24),J(38," Doma\u010de naloge"),V()(),xe(39,oq,4,2,"div",15),V(),j(40,"button",25),Ie("keyup.enter",function(){return o.onEditSubject()}),J(41," Uredi "),V()()()()()()()),2&r&&(H(1),ie("ngForOf",o.subjects),H(6),Wn(o.selectedSubject.predmetNaziv),H(7),ie("ngModel",o.selectedSubject.preverjanjaZnanja),H(3),ie("ngIf",o.selectedSubject.preverjanjaZnanja),H(3),ie("ngModel",o.selectedSubject.vaje),H(5),ie("ngModel",o.selectedSubject.seminarji),H(3),ie("ngIf",o.selectedSubject.seminarji),H(3),ie("ngModel",o.selectedSubject.sprotnoDelo),H(5),ie("ngModel",o.selectedSubject.domaceNaloge),H(3),ie("ngIf",o.selectedSubject.domaceNaloge))},dependencies:[Zs,Yi,iu,nu,n0,Hb,Rd,ru,l0,Lc,Ba],styles:[".card[_ngcontent-%COMP%]{margin-top:1em;margin-left:1em;border-color:#0e1122}#school-icon[_ngcontent-%COMP%]{margin-bottom:2em;margin-top:1em}h5[_ngcontent-%COMP%]{color:#0e1122!important}a[_ngcontent-%COMP%]:hover{color:#7e8cbb!important}h6[_ngcontent-%COMP%]{color:#9e969b!important}.uredi-button[_ngcontent-%COMP%]{width:100%;color:#fff;background-color:#7e8cbb}.uredi-button[_ngcontent-%COMP%]:hover{border-color:#7e8cbb;color:#7e8cbb;background-color:#fff}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#0E1122;width:1em;height:1em;margin-right:1em}input[type=number][_ngcontent-%COMP%]{width:4em!important;margin-left:1em}.check-number-group[_ngcontent-%COMP%]{background-color:#d8d6d7;border:white!important}.lgi-1[_ngcontent-%COMP%], .lgi-alone[_ngcontent-%COMP%]{background-color:#d8d6d7}.lgi-2[_ngcontent-%COMP%]{background-color:#fff}.list-group[_ngcontent-%COMP%]{border-color:#d8d6d7!important;padding-top:1em}#editSubjectSubmitButton[_ngcontent-%COMP%]{background-color:#7e8cbb;width:100%;color:#fff}#editSubjectSubmitButton[_ngcontent-%COMP%]:hover{background-color:#fff;border-color:#7e8cbb;color:#7e8cbb}"]})}}return t})();function zM(t,n,e,r,o,i,a){try{var s=t[i](a),u=s.value}catch(c){return void e(c)}s.done?n(u):Promise.resolve(u).then(r,o)}function Do(t){return function(){var n=this,e=arguments;return new Promise(function(r,o){var i=t.apply(n,e);function a(u){zM(i,r,o,a,s,"next",u)}function s(u){zM(i,r,o,a,s,"throw",u)}a(void 0)})}}var WM=function(t,n){return(WM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function Ai(t,n){function e(){this.constructor=t}WM(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function Be(t,n,e,r){return new(e||(e=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new e(function(l){l(c.value)}).then(a,s)}u((r=r.apply(t,n||[])).next())})}function je(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(t,a)}catch(d){l=[6,d],r=0}finally{e=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var aq=function(){function t(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(n,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},t.prototype.registerFlag=function(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},null!=this.urlFlags[n]){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},t.prototype.get=function(n){return n in this.flags||(this.flags[n]=this.evaluateFlag(n)),this.flags[n]},t.prototype.getNumber=function(n){return this.get(n)},t.prototype.getBool=function(n){return this.get(n)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(n,e){if(null==this.flagRegistry[n])throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,null!=this.flagRegistry[n].setHook&&this.flagRegistry[n].setHook(e)},t.prototype.evaluateFlag=function(n){if(null==this.flagRegistry[n])throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},t.prototype.setFlags=function(n){this.flags=Object.assign({},n)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var n=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,o=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return function sq(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0];n.urlFlags[s]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,a[1])})}},t}();function X(){return $M}var $M=null,Bc=new Map,Vd=new Map;function GM(t,n){var e=f0(t,n);return Bc.get(e)}function qM(t){for(var n=Bc.entries(),e=[];;){var r=n.next(),i=r.value;if(r.done)break;var s=i[1];i[0].split("_")[0]===t&&e.push(s)}return e}function XM(t){var n=t.kernelName,e=t.backendName,r=f0(n,e);if(Bc.has(r))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");Bc.set(r,t)}function cq(t){var n=t.kernelName;Vd.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),Vd.set(n,t)}function f0(t,n){return n+"_"+t}function KM(t){for(var n=t.length,e=0,r=0;n>0;)r=Math.random()*n|0,e=t[--n],t[n]=t[r],t[r]=e}function Gp(t,n,e){return Math.max(t,Math.min(n,e))}function h0(t){return t%2==0?t:t+1}function ZM(t){for(var n=0,e=0;e<t.length;e++)n+=t[e];return n}function A(t,n){if(!t)throw new Error("string"==typeof n?n:n())}function Yt(t,n,e){void 0===e&&(e=""),A(fr(t,n),function(){return e+" Shapes "+t+" and "+n+" must match"})}function su(t){A(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Va(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!1),null==n&&(n=[]),Array.isArray(t)||jr(t)&&!e)for(var r=0;r<t.length;++r)Va(t[r],n,e);else n.push(t);return n}function $e(t){if(0===t.length)return 1;for(var n=t[0],e=1;e<t.length;e++)n*=t[e];return n}function fr(t,n){if(t===n)return!0;if(null==t||null==n||t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function $n(t){return t%1==0}function YM(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var n=Math.exp(2*t);return(n-1)/(n+1)}function qp(t){var n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function uu(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function p0(t,n,e){return void 0===n&&(n=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=n(i);null!=e&&i>=e?o():setTimeout(a,s)}};a()})}function QM(t,n){for(var e=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)e*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+t);return t}if(0===e)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var i=t.slice();return i[r]=n/e,i}function hr(t,n){var e=n.length;return A((t=null==t?n.map(function(r,o){return o}):[].concat(t)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+t}),A(t.every(function(r){return $n(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?e+r:r})}function ws(t,n){for(var e=[],r=[],o=null!=n&&Array.isArray(n)&&0===n.length,i=null==n||o?null:hr(n,t).sort(),a=0,s=0;s<t.length;++s){if(null!=i){if(i[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===t[s]&&(e.push(t[s]),r.push(s)),i[a]<=s&&a++}1!==t[s]&&(e.push(t[s]),r.push(s))}return{newShape:e,keptDims:r}}function jc(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);e=new Uint8Array(n)}return e}function Ud(t,n){var e=null;if(null==t||"float32"===t)e=new Float32Array(n);else if("int32"===t)e=new Int32Array(n);else if("bool"===t)e=new Uint8Array(n);else{if("string"!==t)throw new Error("Unknown data type "+t);e=new Array(n)}return e}function JM(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function eT(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function tT(t,n){return!("complex64"===n||"float32"===n&&"complex64"!==t||"int32"===n&&"float32"!==t&&"complex64"!==t||"bool"===n&&"bool"===t)}function jr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function g0(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function nT(t){if(null==t)return 0;var n=0;return t.forEach(function(e){return n+=e.length}),n}function xs(t){return"string"==typeof t||t instanceof String}function rT(t){return"boolean"==typeof t}function oT(t){return"number"==typeof t}function Vc(t){return Array.isArray(t)?Vc(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":oT(t)?"float32":xs(t)?"string":rT(t)?"bool":"float32"}function Cs(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Xp(t,n){for(var e=n;e<t;++e)if(t%e==0)return e;return t}function Mi(t){var n=t.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=t[n-1];for(var r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function m0(t,n,e){if("string"===n)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Va(t)),e&&JM(t,n),a=n,(i=t)instanceof Float32Array&&"float32"===a||i instanceof Int32Array&&"int32"===a||i instanceof Uint8Array&&"bool"===a)return t;var i,a;if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function v0(t,n){if(0===t.length)return n[0];var e=t.reduce(function(r,o){return r*o});if(0===e)return[];if(e!==n.length)throw new Error("["+t+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(1===i.length)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)s[c]=r(o+c*d,l,a)}return s}(0,t,n)}function y0(t,n){for(var e=Uc(t,n),r=0;r<e.length;r++)e[r]=1;return e}function Uc(t,n){if(null==n||"float32"===n||"complex64"===n)return new Float32Array(t);if("int32"===n)return new Int32Array(t);if("bool"===n)return new Uint8Array(t);throw new Error("Unknown data type "+n)}function Ti(){return X().platform.now()}function b0(t){t.forEach(function(n){A(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function iT(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",X().platform.encode(t,n)}function Hd(t,n){return void 0===n&&(n="utf-8"),n=n||"utf-8",X().platform.decode(t,n)}function _0(t,n,e){if(0===n)return 0;if(1===n)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function aT(t,n,e){if(0===n)return[];if(1===n)return[t];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}Object.freeze({shuffle:KM,clamp:Gp,nearestLargerEven:h0,sum:ZM,randUniform:function(t,n){var e=Math.random();return n*e+(1-e)*t},distSquared:function(t,n){for(var e=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(n[r]);e+=o*o}return e},assert:A,assertShapesMatch:Yt,assertNonNull:su,flatten:Va,sizeFromShape:$e,isScalarShape:function(t){return 0===t.length},arraysEqual:fr,isInt:$n,tanh:YM,sizeToSquarishShape:qp,createShuffledIndices:function(t){for(var n=new Uint32Array(t),e=0;e<t;++e)n[e]=e;return KM(n),n},rightPad:uu,repeatedTry:p0,inferFromImplicitShape:QM,parseAxisParam:hr,squeezeShape:ws,getTypedArrayFromDType:jc,getArrayFromDType:Ud,checkConversionForErrors:JM,isValidDtype:eT,hasEncodingLoss:tT,isTypedArray:jr,bytesPerElement:g0,bytesFromStringArray:nT,isString:xs,isBoolean:rT,isNumber:oT,inferDtype:Vc,isFunction:Cs,nearestDivisor:Xp,computeStrides:Mi,toTypedArray:m0,toNestedArray:v0,makeOnesTypedArray:y0,makeZerosTypedArray:Uc,now:Ti,assertNonNegativeIntegerDimensions:b0,fetch:function(t,n){return X().platform.fetch(t,n)},encodeString:iT,decodeString:Hd,locToIndex:_0,indexToLoc:aT});var lq=function(){function t(n,e){this.backendTimer=n,this.logger=e,null==e&&(this.logger=new dq)}return t.prototype.profileKernel=function(n,e,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,d){if("float32"!==l)return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),a.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,e,l)})})}),o},t}(),dq=function(){function t(){}return t.prototype.logKernelProfile=function(n,e,r,o,i,a){var s="number"==typeof o?uu(o+"ms",9):o.error,u=uu(n,25),c=e.rank,l=e.size,d=uu(e.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||e.shape,g=p.length;f+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+d+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function Wd(t,n,e){return uu(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":xs(t)?"'"+t+"'":"bool"===e?uT(t):parseFloat(t.toFixed(7)).toString(),n)}function uT(t){return 0===t?"false":"true"}function $d(t){for(var n=[],e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Gd=function(){function t(n,e,r){var o=this;if(this.dtype=e,this.shape=n.slice(),this.size=$e(n),null!=r){var i=r.length;A(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ud(e,this.size),this.strides=Mi(n)}return t.prototype.set=function(n){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),A(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=n},t.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];0===n.length&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r])throw new Error("Requested out of range element at "+n+".   Buffer shape="+this.shape);r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},t.prototype.locToIndex=function(n){if(0===this.rank)return 0;if(1===this.rank)return n[0];for(var e=n[n.length-1],r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e},t.prototype.indexToLoc=function(n){if(0===this.rank)return[];if(1===this.rank)return[n];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return ra().makeTensor(this.values,this.shape,this.dtype)},t}(),ra=null,$=null,cT=null,Cn=function(){function t(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=$e(n),this.strides=Mi(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},t.prototype.as3D=function(n,e,r){return this.throwIfDisposed(),this.reshape([n,e,r])},t.prototype.as4D=function(n,e,r,o){return this.throwIfDisposed(),this.reshape([n,e,r,o])},t.prototype.as5D=function(n,e,r,o,i){return this.throwIfDisposed(),this.reshape([n,e,r,o,i])},t.prototype.asType=function(n){return this.throwIfDisposed(),$.cast(this,n)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return Be(this,void 0,void 0,function(){var n;return je(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,$.buffer(this.shape,this.dtype,n)]}})})},t.prototype.bufferSync=function(){return $.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return Be(this,void 0,void 0,function(){var n;return je(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,v0(this.shape,n)]}})})},t.prototype.arraySync=function(){return v0(this.shape,this.dataSync())},t.prototype.data=function(){return Be(this,void 0,void 0,function(){var n,e;return je(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=ra().read(this.dataId),"string"!==this.dtype?[3,2]:[4,n];case 1:e=r.sent();try{return[2,e.map(function(o){return Hd(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var n=ra().readSync(this.dataId);if("string"===this.dtype)try{return n.map(function(e){return Hd(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},t.prototype.bytes=function(){return Be(this,void 0,void 0,function(){var n;return je(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,ra().read(this.dataId)];case 1:return n=e.sent(),"string"===this.dtype?[2,n]:[2,new Uint8Array(n.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(ra().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(n){return void 0===n&&(n=!1),$.print(this,n)},t.prototype.reshape=function(n){return this.throwIfDisposed(),$.reshape(this,n)},t.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},t.prototype.expandDims=function(n){return void 0===n&&(n=0),$.expandDims(this,n)},t.prototype.cumsum=function(n,e,r){return void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1),$.cumsum(this,n,e,r)},t.prototype.squeeze=function(n){return this.throwIfDisposed(),$.squeeze(this,n)},t.prototype.clone=function(){return this.throwIfDisposed(),$.clone(this)},t.prototype.oneHot=function(n,e,r){return this.throwIfDisposed(),$.oneHot(this,n,e,r)},t.prototype.toString=function(n){return void 0===n&&(n=!1),function fq(t,n,e,r){var o=Mi(n),i=function(c,l,d,f){var h=$e(l),p=f[f.length-1],g=new Array(p).fill(0),m=l.length,v="complex64"===d?$d(c):c;if(m>1)for(var b=0;b<h/p;b++)for(var w=b*p,_=0;_<p;_++)g[_]=Math.max(g[_],Wd(v[w+_],0,d).length);return g}(t,n,e,o),a=n.length,s=function c(l,d,f,h,p,g){void 0===g&&(g=!0);var m="complex64"===f?2:1,v=d[0],b=d.length;if(0===b)return"complex64"===f?[Wd($d(l)[0],0,f)]:"bool"===f?[uT(l[0])]:[l[0].toString()];if(1===b){if(v>20){var _=Array.from(l.slice(0,3*m)),x=Array.from(l.slice((v-3)*m,v*m));return"complex64"===f&&(_=$d(_),x=$d(x)),["["+_.map(function(Y,se){return Wd(Y,p[se],f)}).join(", ")+", ..., "+x.map(function(Y,se){return Wd(Y,p[v-3+se],f)}).join(", ")+"]"]}return["["+("complex64"===f?$d(l):Array.from(l)).map(function(Y,se){return Wd(Y,p[se],f)}).join(", ")+"]"]}var D=d.slice(1),R=h.slice(1),k=h[0]*m,M=[];if(v>20){for(var T=0;T<3;T++){var B=(P=T*k)+k;M.push.apply(M,c(l.slice(P,B),D,f,R,p,!1))}for(M.push("..."),T=v-3;T<v;T++)B=(P=T*k)+k,M.push.apply(M,c(l.slice(P,B),D,f,R,p,T===v-1))}else for(T=0;T<v;T++){var P;B=(P=T*k)+k,M.push.apply(M,c(l.slice(P,B),D,f,R,p,T===v-1))}var Q=2===b?",":"";for(M[0]="["+M[0]+Q,T=1;T<M.length-1;T++)M[T]=" "+M[T]+Q;var Z=",\n";for(T=2;T<b;T++)Z+="\n";return M[M.length-1]=" "+M[M.length-1]+"]"+(g?"":Z),M}(t,n,e,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,n)},t.prototype.tile=function(n){return this.throwIfDisposed(),$.tile(this,n)},t.prototype.gather=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),$.gather(this,n,e)},t.prototype.matMul=function(n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),$.matMul(this,n,e,r)},t.prototype.dot=function(n){return this.throwIfDisposed(),$.dot(this,n)},t.prototype.norm=function(n,e,r){return void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),$.norm(this,n,e,r)},t.prototype.slice=function(n,e){return this.throwIfDisposed(),$.slice(this,n,e)},t.prototype.reverse=function(n){return this.throwIfDisposed(),$.reverse(this,n)},t.prototype.concat=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),n instanceof t&&(n=[n]),$.concat([this].concat(n),e)},t.prototype.split=function(n,e){return void 0===e&&(e=0),this.throwIfDisposed(),$.split(this,n,e)},t.prototype.stack=function(n,e){return void 0===e&&(e=0),$.stack([this,n],e)},t.prototype.unstack=function(n){return void 0===n&&(n=0),$.unstack(this,n)},t.prototype.pad=function(n,e){return void 0===e&&(e=0),$.pad(this,n,e)},t.prototype.batchNormalization=function(n,e,r,o,i){return void 0===r&&(r=.001),cT("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,i,o,r)},t.prototype.batchNorm=function(n,e,r,o,i){return void 0===i&&(i=.001),this.throwIfDisposed(),$.batchNorm(this,n,e,r,o,i)},t.prototype.all=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.all(this,n,e)},t.prototype.any=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.any(this,n,e)},t.prototype.logSumExp=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.logSumExp(this,n,e)},t.prototype.sum=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.sum(this,n,e)},t.prototype.prod=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.prod(this,n,e)},t.prototype.mean=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.mean(this,n,e)},t.prototype.min=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.min(this,n,e)},t.prototype.max=function(n,e){return void 0===n&&(n=null),void 0===e&&(e=!1),this.throwIfDisposed(),$.max(this,n,e)},t.prototype.argMin=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),$.argMin(this,n)},t.prototype.argMax=function(n){return void 0===n&&(n=null),this.throwIfDisposed(),$.argMax(this,n)},t.prototype.cast=function(n){return this.throwIfDisposed(),$.cast(this,n)},t.prototype.add=function(n){return this.throwIfDisposed(),$.add(this,n)},t.prototype.addStrict=function(n){return this.throwIfDisposed(),$.addStrict(this,n)},t.prototype.atan2=function(n){return this.throwIfDisposed(),$.atan2(this,n)},t.prototype.sub=function(n){return this.throwIfDisposed(),$.sub(this,n)},t.prototype.subStrict=function(n){return this.throwIfDisposed(),$.subStrict(this,n)},t.prototype.pow=function(n){return this.throwIfDisposed(),$.pow(this,n)},t.prototype.powStrict=function(n){return this.throwIfDisposed(),$.powStrict(this,n)},t.prototype.mul=function(n){return this.throwIfDisposed(),$.mul(this,n)},t.prototype.mulStrict=function(n){return this.throwIfDisposed(),$.mulStrict(this,n)},t.prototype.div=function(n){return this.throwIfDisposed(),$.div(this,n)},t.prototype.divNoNan=function(n){return this.throwIfDisposed(),$.divNoNan(this,n)},t.prototype.floorDiv=function(n){return this.throwIfDisposed(),$.floorDiv(this,n)},t.prototype.divStrict=function(n){return this.throwIfDisposed(),$.divStrict(this,n)},t.prototype.minimum=function(n){return this.throwIfDisposed(),$.minimum(this,n)},t.prototype.minimumStrict=function(n){return this.throwIfDisposed(),$.minimumStrict(this,n)},t.prototype.maximum=function(n){return this.throwIfDisposed(),$.maximum(this,n)},t.prototype.maximumStrict=function(n){return this.throwIfDisposed(),$.maximumStrict(this,n)},t.prototype.mod=function(n){return this.throwIfDisposed(),$.mod(this,n)},t.prototype.modStrict=function(n){return this.throwIfDisposed(),$.modStrict(this,n)},t.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),$.squaredDifferenceStrict(this,n)},t.prototype.transpose=function(n){return this.throwIfDisposed(),$.transpose(this,n)},t.prototype.notEqual=function(n){return this.throwIfDisposed(),$.notEqual(this,n)},t.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),$.notEqualStrict(this,n)},t.prototype.less=function(n){return this.throwIfDisposed(),$.less(this,n)},t.prototype.lessStrict=function(n){return this.throwIfDisposed(),$.lessStrict(this,n)},t.prototype.equal=function(n){return this.throwIfDisposed(),$.equal(this,n)},t.prototype.equalStrict=function(n){return this.throwIfDisposed(),$.equalStrict(this,n)},t.prototype.lessEqual=function(n){return this.throwIfDisposed(),$.lessEqual(this,n)},t.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),$.lessEqualStrict(this,n)},t.prototype.greater=function(n){return this.throwIfDisposed(),$.greater(this,n)},t.prototype.greaterStrict=function(n){return this.throwIfDisposed(),$.greaterStrict(this,n)},t.prototype.greaterEqual=function(n){return this.throwIfDisposed(),$.greaterEqual(this,n)},t.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),$.greaterEqualStrict(this,n)},t.prototype.logicalAnd=function(n){return this.throwIfDisposed(),$.logicalAnd(this,n)},t.prototype.logicalOr=function(n){return this.throwIfDisposed(),$.logicalOr(this,n)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),$.logicalNot(this)},t.prototype.logicalXor=function(n){return this.throwIfDisposed(),$.logicalXor(this,n)},t.prototype.where=function(n,e){return this.throwIfDisposed(),$.where(n,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),$.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),$.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),$.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),$.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),$.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),$.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),$.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),$.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),$.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),$.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),$.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),$.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),$.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),$.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),$.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),$.abs(this)},t.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),$.clipByValue(this,n,e)},t.prototype.relu=function(){return this.throwIfDisposed(),$.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),$.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),$.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),$.selu(this)},t.prototype.leakyRelu=function(n){return void 0===n&&(n=.2),this.throwIfDisposed(),$.leakyRelu(this,n)},t.prototype.prelu=function(n){return this.throwIfDisposed(),$.prelu(this,n)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),$.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),$.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),$.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),$.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),$.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),$.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),$.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),$.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),$.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),$.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),$.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),$.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),$.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),$.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),$.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),$.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),$.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),$.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),$.round(this)},t.prototype.step=function(n){return void 0===n&&(n=0),this.throwIfDisposed(),$.step(this,n)},t.prototype.softmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),$.softmax(this,n)},t.prototype.logSoftmax=function(n){return void 0===n&&(n=-1),this.throwIfDisposed(),$.logSoftmax(this,n)},t.prototype.resizeBilinear=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),$.image.resizeBilinear(this,n,e)},t.prototype.resizeNearestNeighbor=function(n,e){return void 0===e&&(e=!1),this.throwIfDisposed(),$.image.resizeNearestNeighbor(this,n,e)},t.prototype.conv1d=function(n,e,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),$.conv1d(this,n,e,r,o,i,a)},t.prototype.conv2d=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),$.conv2d(this,n,e,r,o,i,a)},t.prototype.conv2dTranspose=function(n,e,r,o,i){return this.throwIfDisposed(),$.conv2dTranspose(this,n,e,r,o,i)},t.prototype.depthwiseConv2D=function(n,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),$.depthwiseConv2d(this,n,e,r,o,i,a)},t.prototype.separableConv2d=function(n,e,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),$.separableConv2d(this,n,e,r,o,i,a)},t.prototype.avgPool=function(n,e,r,o){return this.throwIfDisposed(),$.avgPool(this,n,e,r,o)},t.prototype.maxPool=function(n,e,r,o){return this.throwIfDisposed(),$.maxPool(this,n,e,r,o)},t.prototype.localResponseNormalization=function(n,e,r,o){return void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5),$.localResponseNormalization(this,n,e,r,o)},t.prototype.pool=function(n,e,r,o,i){return this.throwIfDisposed(),$.pool(this,n,e,r,o,i)},t.prototype.variable=function(n,e,r){return void 0===n&&(n=!0),this.throwIfDisposed(),ra().makeVariable(this,n,e,r)},t.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),$.unsortedSegmentSum(this,n,e)},t.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),$.batchToSpaceND(this,n,e)},t.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),$.spaceToBatchND(this,n,e)},t.prototype.topk=function(n,e){return void 0===n&&(n=1),void 0===e&&(e=!0),this.throwIfDisposed(),$.topk(this,n,e)},t.prototype.stridedSlice=function(n,e,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),$.stridedSlice(this,n,e,r,o,i,a,s,u)},t.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),$.depthToSpace(this,n,e)},t.prototype.fft=function(){return this.throwIfDisposed(),$.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),$.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),$.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),$.spectral.irfft(this)},t}();Object.defineProperty(Cn,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var lT,x0,C0,E0,D0,t,Hc=function(t){function n(e,r,o,i){var a=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=r,a.name=o,a}return Ai(n,t),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!fr(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");ra().disposeTensor(this),this.dataId=e.dataId,ra().incRef(this,null)},n.prototype.dispose=function(){ra().disposeVariable(this),this.isDisposedInternal=!0},n}(Cn);Object.defineProperty(Hc,Symbol.hasInstance,{value:function(t){return t instanceof Cn&&null!=t.assign&&t.assign instanceof Function}}),(t=lT||(lT={})).R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(x0||(x0={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(C0||(C0={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(E0||(E0={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(D0||(D0={}));var hq={float32:E0,int32:x0,bool:C0,complex64:D0};function Ir(t,n){if("string"===t||"string"===n){if("string"===t&&"string"===n)return"string";throw new Error("Can not upcast "+t+" with "+n)}return hq[t][n]}function S0(t){return Ir(t,"int32")}function Un(t,n){if(t.dtype===n.dtype)return[t,n];var e=Ir(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function dT(t,n){A(t.dtype===n.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+n.dtype+") input must match"})}function I0(t){var n=[];return function e(r,o,i){if(null!=r){if(r instanceof Cn)return void o.push(r);if(a=r,Array.isArray(a)||"object"==typeof a){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,o,i))}}}}(t,n,new Set),n}Object.freeze({makeTypesMatch:Un,assertTypesMatch:dT,isTensorInList:function(t,n){return n.some(function(e){return e.id===t.id})},getTensorsInContainer:I0});var A0,fT=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},t}(),pq=function(){function t(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new fT}return t.prototype.ready=function(){return Be(this,void 0,void 0,function(){var n,e,r;return je(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];n=this.getSortedBackends(),e=0,o.label=1;case 1:return e<n.length?[4,this.initializeBackend(r=n[e]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(n){return n in this.registry||n in this.registryFactory&&!this.initializeBackend(n).asyncInit?this.registry[n]:null},t.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},t.prototype.registerBackend=function(n,e,r){return void 0===r&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:r},!0)},t.prototype.setBackend=function(n){return Be(this,void 0,void 0,function(){var e,r,o;return je(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[n])throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,null!=this.registry[n]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new lq(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var n=this;qM(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(n.backendInstance)})},t.prototype.disposeRegisteredKernels=function(n){var e=this;qM(n).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[n])})},t.prototype.initializeBackend=function(n){var e=this,r=this.registryFactory[n];if(null==r)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<e.pendingBackendInitId||(e.registry[n]=s,e.pendingBackendInit=null,0))}).catch(function(s){return!(i<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var n=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return n.registryFactory[r].priority-n.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var r=n[e],o=this.initializeBackend(r),a=o.asyncInit;if(a||o.success)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(n,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=n,n.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(n,e){var r,o=this,i=null;if(null==e){if("function"!=typeof n)throw new Error("Please provide a function to tidy()");e=n}else{if("string"!=typeof n&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(n,e,r){n();try{var o=r();return e(),o}catch(i){throw e(),i}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype);return this.addTapeNode(this.state.activeScope.name,{x:n},[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},t.prototype.runKernel=function(n,e,r,o,i){return this.runKernelFunc(null,e,null,n,r,o,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(n,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+="complex64"===u.dtype?3:1});var s=o-e-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},t.prototype.runKernelFunc=function(n,e,r,o,i,a,s){var u,c=this;void 0===a&&(a=[]),void 0===s&&(s=[]);var l=[],d=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(b){d&&(l=b.map(function(w){return c.keep(c.clone(w))}))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=GM(o,this.backendName);return f=null!=v?function(){var b=c.backend.numDataIds();m=v.kernelFunc({inputs:e,attrs:i,backend:c.backend});var w=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,w);var _=w.map(function(D){return c.makeTensorFromDataId(D.dataId,D.shape,D.dtype)}),x=_.filter(function(D,R){return s[R]});return h((a||[]).slice().concat(x)),_}:function(){var b=c.backend.numDataIds();m=c.tidy(function(){return n(c.backend,h)});var w=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,w),w},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:u.map(function(b){return b.shape})}),Array.isArray(m)?u:u[0]},t.prototype.makeTensor=function(n,e,r,o){if(null==n)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var i=n;"string"===(r=r||"float32")&&xs(n[0])&&(i=n.map(function(l){return iT(l)}));var a=o.write(i,e,r),s=new Cn(e,r,a,this.nextTensorId());if(this.incRef(s,o),"string"===r){var u=this.state.tensorInfo.get(a),c=nT(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},t.prototype.makeTensorFromDataId=function(n,e,r,o){var i=new Cn(e,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},t.prototype.makeVariable=function(n,e,r,o){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=o&&o!==n.dtype&&(n=n.asType(o));var i=new Hc(n,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(n,e){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,"string"===n.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var o=0;"complex64"!==n.dtype&&"string"!==n.dtype&&(o=n.size*g0(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Hc||this.track(n)},t.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,"string"===n.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?("complex64"!==n.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[n])},t.prototype.disposeVariable=function(n){this.disposeTensor(n),null!=this.state.registeredVariables[n.name]&&delete this.state.registeredVariables[n.name]},t.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,null==n.reasons&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},t.prototype.profile=function(n){return Be(this,void 0,void 0,function(){var e,r;return je(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(n,e,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:r,saved:i},u=function uq(t){return Vd.get(t)}(n);null!=u&&(o=u.gradFunc),null!=o&&(s.gradient=function(c){return c=c.map(function(l,d){if(null==l){var f=r[d],h=Uc(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},t.prototype.keep=function(n){return n.kept=!0,n},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(n){for(var e=this,r=I0(n),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},t.prototype.gradients=function(n,e,r,o){var i=this;if(void 0===o&&(o=!1),A(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",n)});A(a instanceof Cn,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(D=u[h]).inputs;for(var g in p){for(var m=p[g],v=!1,b=0;b<c.length;b++)if(d[m.id]){D.outputs.forEach(function(T){return d[T.id]=!0}),v=!0,f[D.id]=!0;break}if(v)break}}var w={};w[l.id]=!0;var _={};for(h=u.length-1;h>=0;h--)for(p=(D=u[h]).inputs,b=0;b<D.outputs.length;b++)if(w[D.outputs[b].id]){for(var g in p)w[p[g].id]=!0,_[D.id]=!0;break}var x=[];for(h=0;h<u.length;h++){var D;if(f[(D=u[h]).id]&&_[D.id]){var R={};for(var g in D.inputs){var k=D.inputs[g];d[k.id]&&(R[g]=k)}var M=Object.assign({},D);M.inputs=R,M.outputs=D.outputs,x.push(M)}}return x}(this.state.activeTape,e,a);if(!o&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(c=y0($e(u=a.shape),"float32"),N.makeTensor(c,u,"float32")),function(f,h,p){for(var g=function(v){var b=h[v],w=[];if(b.outputs.forEach(function(R){var k=f[R.id];w.push(null!=k?k:null)}),null==b.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var _=b.gradient(w),x=function(R){if(!(R in _))throw new Error("Cannot backprop through input "+R+". Available gradients found: "+Object.keys(_)+".");var k=i.tidy(function(){return _[R]()});if("float32"!==k.dtype)throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+R+" must have 'float32' dtype, but has '"+k.dtype+"'");var M=b.inputs[R];if(!fr(k.shape,M.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+R+"' has shape '"+k.shape+"', which does not match the shape of the input '"+M.shape+"'");if(null==f[M.id])f[M.id]=k;else{var T=f[M.id];f[M.id]=T.add(k),T.dispose()}};for(var D in b.inputs)x(D)},m=h.length-1;m>=0;m--)g(m)}(l,s);var d=e.map(function(f){return l[f.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},t.prototype.customGrad=function(n){var e=this;return A(Cs(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];A(o.every(function(s){return s instanceof Cn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return A((r=n.apply(void 0,o.concat([u]))).value instanceof Cn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),A(Cs(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];A(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),A(l.every(function(f){return f instanceof Cn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},t.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},t.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},t.prototype.time=function(n){return Be(this,void 0,void 0,function(){var e,r;return je(this,function(o){switch(o.label){case 0:return e=Ti(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=Ti()-e,[2,r]}})})},t.prototype.track=function(n){return null!=this.state.activeScope&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new fT,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),N=function(){var t=function(){if(null==A0){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}A0=e}return A0}();if(null==t._tfengine){var n=new aq(t);t._tfengine=new pq(n)}return $M=t._tfengine.ENV,ra=function(){return t._tfengine},t._tfengine}();function hT(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var Ua=X();Ua.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ua.registerFlag("IS_BROWSER",function(){return hT()}),Ua.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),Ua.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ua.registerFlag("PROD",function(){return!1}),Ua.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ua.getBool("DEBUG")}),Ua.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ua.registerFlag("IS_TEST",function(){return!1});var qd,Ho,zo,cu={},M0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function pT(t,n){cu[t]=n}function oa(t){t in cu||(cu[t]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete cu[e]},!1),1===e?r.getContext("webgl",M0)||r.getContext("experimental-webgl",M0):r.getContext("webgl2",M0)}(t));var n=cu[t];return n.isContextLost()?(delete cu[t],oa(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),cu[t])}function Kp(t,n){return[n,t]}function Xd(t){var n=$e(t);return qp(Math.ceil(n/4))}function Kd(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function T0(t,n){var e,r,o,i,a,s,u,c,l,d=t;return 2===X().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=t.RGBA,r=t.RGBA,o=t.RGBA,i=d.RGBA,a=t.RGBA,s=4,u=4,c=null!=n?n.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Pe(t,n,e){var r=e();return n&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+mT(o,i))}(t),r}function gT(t){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function mT(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function Zd(t,n,e){return Ha(t,n,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function vT(t,n,e){var r=Ha(t,n,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Pe(t,n,function(){return t.shaderSource(r,e)}),Pe(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function yT(t,n,e){var r=Ha(t,n,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Pe(t,n,function(){return t.shaderSource(r,e)}),Pe(t,n,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(o,i){var a=vq.exec(i);if(null==a)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split("\n"),c=u.length.toString().length+2,l=u.map(function(m,v){return uu((v+1).toString(),c)+m}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,s-1),p=l.slice(s-1,s),g=l.slice(s);console.log(h.join("\n")),console.log(i.split("\n")[0]),console.log("%c "+uu(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join("\n"))}(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(qd||(qd={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Ho||(Ho={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(zo||(zo={}));var Zp,Yp,vq=/ERROR: [0-9]+:([0-9]+):/g;function bT(t,n){return Ha(t,n,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function _T(t,n,e){if(Pe(t,n,function(){return t.linkProgram(e)}),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Qp(t,n,e){if(Pe(t,n,function(){return t.validateProgram(e)}),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function wT(t,n,e){var r=Ha(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Pe(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Pe(t,n,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function xT(t,n,e){var r=Ha(t,n,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Pe(t,n,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Pe(t,n,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),r}function CT(t,n){return Ha(t,n,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function ET(t,n){var e=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){var r="["+t+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e)throw r="["+t+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function DT(t,n){return Ha(t,n,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function k0(t,n,e,r,o,i,a,s){var u=t.getAttribLocation(e,r);return-1!==u&&(Pe(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),Pe(t,n,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),Pe(t,n,function(){return t.enableVertexAttribArray(u)}),!0)}function ST(t,n,e,r){kT(t,r),Pe(t,n,function(){return t.activeTexture(t.TEXTURE0+r)}),Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function IT(t,n,e,r){return Ha(t,n,function(){return t.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function AT(t,n,e){return t.getUniformLocation(n,e)}function MT(t,n,e,r,o,i){Pe(t,n,function(){return ST(t,n,r,i)}),Pe(t,n,function(){return t.uniform1i(o,i)})}function Jp(t,n,e,r){Pe(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Pe(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function R0(t,n,e){Pe(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),Pe(t,n,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Yd(t){var n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+TT(t,n))}function TT(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function Ha(t,n,e,r){var o=Pe(t,n,function(){return e()});if(null==o)throw new Error(r);return o}function kT(t,n){var e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function Qd(t,n){return void 0===n&&(n=2),$e(t.slice(0,t.length-n))}function Jd(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function eg(t){var n=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(n=[Qd(t)].concat(Jd(t))),n}function RT(t,n){var e;void 0===n&&(n=!1);var r=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,1===(t=t.map(function(c,l){return l>=t.length-2?h0(t[l]):t[l]})).length&&(t=[2,t[0]])),2!==t.length){var o=ws(t);t=o.newShape}var i=$e(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(n){var a=Qd(t),s=2,u=2;return t.length&&(s=(e=Jd(t))[0],u=e[1]),qp(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return qp(i)}function tg(t){return t%2==0}function ef(t,n){if(fr(t=t.slice(-2),n=n.slice(-2))||!t.length||!n.length||0===t[0]||0===t[1]||0===n[0]||0===n[1])return!0;if(t.length!==n.length){var e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||tg(e)&&tg(r)&&(1===t[0]||1===n[0]))return!0}return t[1]===n[1]&&tg(t[0])&&tg(n[0])}function NT(t){if(null==Zp){var n=oa(t);Zp=n.getParameter(n.MAX_TEXTURE_SIZE)}return Zp}function FT(t){if(null==Yp){var n=oa(t);Yp=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Yp)}function OT(t){if(0===t)return 0;var n=oa(t);return Wo(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Wo(n,"EXT_disjoint_timer_query")?1:0}function Wo(t,n){return null!=t.getExtension(n)}function N0(t){try{if(null!=oa(t))return!0}catch{return!1}return!1}function PT(t){if(0===t)return!1;var n=oa(t);if(1===t){if(!Wo(n,"OES_texture_float"))return!1}else if(!Wo(n,"EXT_color_buffer_float"))return!1;return F0(n)}function LT(t){if(0===t)return!1;var n=oa(t);if(1!==t){if(Wo(n,"EXT_color_buffer_float"))return F0(n);if(Wo(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=T0(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(n,e)}return!1}return!!Wo(n,"OES_texture_float")&&!!Wo(n,"WEBGL_color_buffer_float")&&F0(n)}function F0(t){var n=T0(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(r),o}function BT(t){return 2===t&&null!=oa(t).fenceSync}var yq=Object.freeze({callAndCheck:Pe,canBeRepresented:gT,getWebGLErrorMessage:mT,getExtensionOrThrow:Zd,createVertexShader:vT,createFragmentShader:yT,createProgram:bT,linkProgram:_T,validateProgram:Qp,createStaticVertexBuffer:wT,createStaticIndexBuffer:xT,getNumChannels:function(){return 2===X().getNumber("WEBGL_VERSION")?1:4},createTexture:CT,validateTextureSize:ET,createFramebuffer:DT,bindVertexBufferToProgramAttribute:k0,bindTextureUnit:ST,unbindTextureUnit:function(t,n,e){kT(t,e),Pe(t,n,function(){return t.activeTexture(t.TEXTURE0+e)}),Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:IT,getProgramUniformLocation:AT,bindTextureToProgramUniformSampler:MT,bindCanvasToFramebuffer:function(t,n){Pe(t,n,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Pe(t,n,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Pe(t,n,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:Jp,unbindColorTextureFromFramebuffer:R0,validateFramebuffer:Yd,getFramebufferErrorMessage:TT,getBatchDim:Qd,getRowsCols:Jd,getShapeAs3D:eg,getTextureShapeFromLogicalShape:RT,isReshapeFree:ef,getWebGLMaxTextureSize:NT,resetMaxTextureSize:function(){Zp=null},resetMaxTexturesInShader:function(){Yp=null},getMaxTexturesInShader:FT,getWebGLDisjointQueryTimerVersion:OT,hasExtension:Wo,isWebGLVersionEnabled:N0,isCapableOfRenderingToFloatTexture:PT,isDownloadFloatTextureEnabled:LT,isWebGLFenceEnabled:BT}),mt=X();function jT(t){X().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Fe(t,n){return N.tidy(t,n)}function So(t){I0(t).forEach(function(n){return n.dispose()})}function ng(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];X().getBool("IS_TEST")||console.warn.apply(console,t)}function ia(t,n){var e=t;if(jr(t))return"string"===n?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(e)||jr(e)&&"string"!==n;)r.push(e.length),e=e[0];return Array.isArray(t)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],Array.isArray(i)||jr(i)){A(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),A(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}else A(0===a.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}(t,r,[]),r}function VT(t,n,e,r){if(null!=t&&("numeric"!==t&&t!==n||"numeric"===t&&"string"===n))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+t+" tensor, but got "+n+" tensor")}function S(t,n,e,r){if(void 0===r&&(r="numeric"),t instanceof Cn)return VT(r,t.dtype,n,e),t;var o=Vc(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),VT(r,o,n,e),null==t||!jr(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var a=ia(t,o);jr(t)||Array.isArray(t)||(t=[t]);var s="string"!==o?m0(t,o,X().getBool("DEBUG")):Va(t,[],!0);return N.makeTensor(s,a,o)}function tf(t,n,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(o,i){return S(o,n+"["+i+"]",e)},r)}function O0(t,n){for(var e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function UT(t,n,e){for(var r=t.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)-1===e.indexOf(s)?o.push(t[i++]):o.push(n[a++]);return o}function Vr(t,n){for(var e=[],r=t.length,o=0;o<r;o++)-1===n.indexOf(o)&&e.push(t[o]);return[e,n.map(function(i){return t[i]})]}function lo(t,n){return UT(t,n.map(function(e){return 1}),n)}function Io(t,n,e){A(O0(n,e),function(){return t+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function ki(t,n){if(O0(t,n))return null;for(var e=[],r=0;r<n;++r)-1===t.indexOf(r)&&e.push(r);return t.forEach(function(o){return e.push(o)}),e}function rg(t){return t.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function Ri(t,n){for(var e=[],r=n-t;r<n;++r)e.push(r);return e}function HT(t,n){var e=t[0].length;t.forEach(function(o,i){A(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),A(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=t[0];t.forEach(function(o,i){for(var a=0;a<e;a++)A(a===n||o[a]===r[a],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function lu(t,n){for(var e=t[0].slice(),r=1;r<t.length;r++)e[n]+=t[r][n];return e}function F(t){var n=Object.keys(t);if(1!==n.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];N.startScope(e);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),N.endScope(s),s}catch(u){throw N.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}mt.registerFlag("HAS_WEBGL",function(){return mt.getNumber("WEBGL_VERSION")>0}),mt.registerFlag("WEBGL_VERSION",function(){return N0(2)?2:N0(1)?1:0}),mt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===mt.get("WEBGL_VERSION")}),mt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),mt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),mt.registerFlag("WEBGL_PACK",function(){return mt.getBool("HAS_WEBGL")}),mt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_CLIP",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),mt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_PACK_REDUCE",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_CONV_IM2COL",function(){return mt.getBool("WEBGL_PACK")}),mt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return NT(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return FT(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=mt.getNumber("WEBGL_VERSION");return 0===t?0:OT(t)}),mt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return mt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),mt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return PT(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!mt.getBool("WEBGL_FORCE_F16_TEXTURES")&&mt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),mt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return LT(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return BT(mt.getNumber("WEBGL_VERSION"))}),mt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return mt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),cT=jT;var Ur=F({complex_:function(t,n){var e=S(t,"real","complex"),r=S(n,"imag","complex");return Yt(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),N.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),ui=F({real_:function(t){var n=S(t,"input","real");return N.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),aa=F({imag_:function(t){var n=S(t,"input","imag");return N.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function Hr(t,n,e){return Es(t,n,ia(t,e),e)}function Es(t,n,e,r){if(null==r&&(r=Vc(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!jr(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=n){b0(n);var o=$e(n),i=$e(e);A(o===i,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<e.length;++a){var u=a!==e.length-1||e[a]!==$e(n.slice(a));A(e[a]===n[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return jr(t)||Array.isArray(t)||(t=[t]),n=n||e,t="string"!==r?m0(t,r,X().getBool("DEBUG")):Va(t,[],!0),N.makeTensor(t,n,r)}function Ce(t,n){if((jr(t)&&"string"!==n||Array.isArray(t))&&"complex64"!==n)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===n&&jr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Es(t,[],[],n)}function pr(t,n){su(t);var e=ia(t,n);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Es(t,null,e,n)}function Ds(t,n,e){if(su(t),null!=n&&2!==n.length)throw new Error("tensor2d() requires shape to have two numbers");var r=ia(t,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Es(t,n,r,e)}function P0(t,n,e){if(su(t),null!=n&&3!==n.length)throw new Error("tensor3d() requires shape to have three numbers");var r=ia(t,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Es(t,n,r,e)}function Ao(t,n,e){if(su(t),null!=n&&4!==n.length)throw new Error("tensor4d() requires shape to have four numbers");var r=ia(t,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Es(t,n,r,e)}function zc(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=zc(t,"float32"),r=Bn(t,"float32");return Ur(e,r)}var o=y0($e(t),n);return N.makeTensor(o,t,n)}function Bn(t,n){if(void 0===n&&(n="float32"),"complex64"===n){var e=Bn(t,"float32"),r=Bn(t,"float32");return Ur(e,r)}var o=Uc($e(t),n);return N.makeTensor(o,t,n)}function sa(t,n,e){return N.runKernelFunc(function(r){return r.fill(t,n,e)},{})}function og(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(t===n||t<n&&e<0||n<t&&e>1)return Bn([0],r);var o=Uc(Math.abs(Math.ceil((n-t)/e)),r);n<t&&1===e&&(e=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return pr(o,r)}var zT=F({onesLike_:function(t){var n=S(t,"x","onesLike");if("complex64"===n.dtype){var e=zT(ui(n)),r=Qt(aa(n));return Ur(e,r)}return N.runKernelFunc(function(o){return o.onesLike(n)},{$x:n},function(o,i){return{$x:function(){return Qt(o)}}})}}),Qt=F({zerosLike_:function(t){var n=S(t,"x","zerosLike");return N.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,r){return{$x:function(){return Qt(e)}}})}}),wr=F({concat_:function(t,n){void 0===n&&(n=0),A(t.length>=1,function(){return"Pass at least one tensor to concat"});var e=tf(t,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),n=hr(n,e[0].shape)[0];var r=lu(e.map(function(s){return s.shape}),n);if(0===$e(r))return Hr([],r);if(1===(e=e.filter(function(s){return s.size>0})).length)return e[0];var o=e.map(function(s){return s.shape});return HT(o,n),N.runKernelFunc(function(s){return s.concat(e,n)},e,function(s){var u=o.map(function(c){return c[n]});return L0(s,u,n).map(function(c){return function(){return c}})},"Concat",{axis:n})}}),Eq=F({concat1d_:function(t){return wr(t,0)}}),Dq=F({concat2d_:function(t,n){return wr(t,n)}}),Sq=F({concat3d_:function(t,n){return wr(t,n)}}),Iq=F({concat4d_:function(t,n){return wr(t,n)}}),L0=F({split_:function(t,n,e){void 0===e&&(e=0);var r,o=S(t,"x","split");return e=hr(e,o.shape)[0],"number"==typeof n?(A(o.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(o.shape[e]/n)):(A(o.shape[e]===n.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),N.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return wr(i,e)}}})}});function du(t,n){return t(n={exports:{}},n.exports),n.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var Aq=du(function(t){!function(n,e,r){function o(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.alea=a}(0,t)}),Mq=du(function(t){!function(n,e,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor128=a}(0,t)}),Tq=du(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)}),kq=du(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)}),Rq=du(function(t){!function(n,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l=f[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,g,m=[],v=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,v=Math.max(v,l.length)),h=0,p=-32;p<v;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),0===p&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(h=0==(d=m[127&p]^=f+(g=g+1640531527|0))?h+1:0);for(h>=128&&(m[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=m[h+34&127],d=m[h=h+1&127],f^=f<<13,d^=d<<17,m[h]=(f^=f>>>15)^(d^=d>>>12);c.w=g,c.X=m,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)}),Nq=du(function(t){!function(n,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.tychei=a}(0,t)}),fu=du(function(t){!function(n,e){var r,o=this,i=256,s="random",u=e.pow(i,6),c=e.pow(2,52),l=2*c,d=i-1;function f(v,b,w){var _=[],x=g(function k(M,T){var B,P=[],Q=typeof M;if(T&&"object"==Q)for(B in M)try{P.push(k(M[B],T-1))}catch{}return P.length?P:"string"==Q?M:M+"\0"}((b=1==b?{entropy:!0}:b||{}).entropy?[v,m(n)]:v??function(){try{var k;return r&&(k=r.randomBytes)?k=k(i):(k=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(k)),m(k)}catch{var M=o.navigator,T=M&&M.plugins;return[+new Date,o,T,o.screen,m(n)]}}(),3),_),D=new h(_),R=function(){for(var k=D.g(6),M=u,T=0;k<c;)k=(k+T)*i,M*=i,T=D.g(1);for(;k>=l;)k/=2,M/=2,T>>>=1;return(k+T)/M};return R.int32=function(){return 0|D.g(4)},R.quick=function(){return D.g(4)/4294967296},R.double=R,g(m(D.S),n),(b.pass||w||function(k,M,T,B){return B&&(B.S&&p(B,D),k.state=function(){return p(D,{})}),T?(e[s]=k,M):k})(R,x,"global"in b?b.global:this==e,b.state)}function h(v){var b,w=v.length,_=this,x=0,D=_.i=_.j=0,R=_.S=[];for(w||(v=[w++]);x<i;)R[x]=x++;for(x=0;x<i;x++)R[x]=R[D=d&D+v[x%w]+(b=R[x])],R[D]=b;(_.g=function(k){for(var M,T=0,B=_.i,P=_.j,Q=_.S;k--;)M=Q[B=d&B+1],T=T*i+Q[d&(Q[B]=Q[P=d&P+M])+(Q[P]=M)];return _.i=B,_.j=P,T})(i)}function p(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function g(v,b){for(var w,_=v+"",x=0;x<_.length;)b[d&x]=d&(w^=19*b[d&x])+_.charCodeAt(x++);return m(b)}function m(v){return String.fromCharCode.apply(0,v)}if(e["seed"+s]=f,g(e.random(),n),t.exports){t.exports=f;try{r=nt(82)}catch{}}}([],Math)});fu.alea=Aq,fu.xor128=Mq,fu.xorwow=Tq,fu.xorshift7=kq,fu.xor4096=Rq,fu.tychei=Nq;var ig=fu.alea,B0=function(){function t(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=ig(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},t.prototype.convertValue=function(n){return null==this.dtype||"float32"===this.dtype?n:Math.round(n)},t.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},t}(),Fq=function(){function t(n,e,r,o){this.alpha=n,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=ig(i.toString()),this.randn=new B0(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var n,e,r,o,i,a;;){do{o=this.randn.nextValue(),a=1+this.c*o}while(a<=0);if(e=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<e||Math.log(i)<r)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(n){return"float32"===this.dtype?n:Math.round(n)},t}(),Oq=function(){function t(n,e,r,o){var i=this;if(void 0===n&&(n=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=n,this.range=e-n,this.dtype=r,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=ig(o)}return t.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Et(t,n,e){return void 0===n&&(n="float32"),n=n||"float32",b0(t),new Gd(t,n,e)}var WT=F({batchToSpaceND_:function(t,n,e){var r=S(t,"x","batchToSpaceND"),o=n.reduce(function(i,a){return i*a});return A(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),A(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),A(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o}),N.runKernelFunc(function(i){return i.batchToSpaceND(r,n,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(n,e)}}})}}),Lq=F({broadcastTo_:function(t,n){var e=S(t,"broadcastTo","x"),r=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var o=e.shape.slice();o.length<n.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(e.shape[a]===n[a])i[a]=1;else if(1!==e.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===s.length?e.clone():N.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),Bq=F({cast_:function(t,n){var e=S(t,"x","cast");if(!eT(n))throw new Error("Failed to cast to unknown dtype "+n);if("string"===n&&"string"!==e.dtype||"string"!==n&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return N.runKernelFunc(function(o){return o.cast(e,n)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:n})}}),jq=F({clone_:function(t){var n=S(t,"x","clone",null);return N.runKernelFunc(function(){return N.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),Vq=F({cumsum_:function(t,n,e,r){void 0===n&&(n=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var o=S(t,"x","cumsum"),i=ki([n|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Ri(1,o.rank)[0],u=N.runKernelFunc(function(c){return c.cumsum(a,s,e,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(n,e,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),Uq=F({depthToSpace_:function(t,n,e){void 0===e&&(e="NHWC");var r=S(t,"x","depthToSpace"),o="NHWC"===e?r.shape[1]:r.shape[2],i="NHWC"===e?r.shape[2]:r.shape[3],a="NHWC"===e?r.shape[3]:r.shape[1];return A(o*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+n+"  for depthToSpace with input shape\n      "+r.shape}),A(i*n>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+n+" for depthToSpace with input shape\n          "+r.shape}),A(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),N.runKernelFunc(function(s){return s.depthToSpace(r,n,e)},{$x:r})}}),ci=F({expandDims_:function(t,n){void 0===n&&(n=0);var e=S(t,"x","expandDims",null);A(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return n<0&&(A(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),r.splice(n,0,1),Ni(e,r)}}),$T=F({eye_:function(t,n,e,r){void 0===r&&(r="float32"),null==n&&(n=t);for(var o=Et([t,n],r),i=t<=n?t:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,n);if(null==e)return s;if(1===e.length)return Wc(ci(s,0),[e[0],1,1]);if(2===e.length)return Wc(ci(ci(s,0),0),[e[0],e[1],1,1]);if(3===e.length)return Wc(ci(ci(ci(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Hq=F({multinomial_:function(t,n,e,r){void 0===r&&(r=!1);var o=S(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=1===a?o.as2D(1,-1):o,u=N.runKernelFunc(function(c){return c.multinomial(s,r,n,e)},{logits2D:s});return 1===a?u.as1D():u}}),j0=F({oneHot_:function(t,n,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=S(t,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),N.runKernelFunc(function(a){return a.oneHot(o,n,e,r)},{$indices:o},function(a){return{$indices:function(){return Bn(o.shape,"float32")}}}).reshape(i)}}),hu=F({pad_:function(t,n,e){void 0===e&&(e=0);var r=S(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return N.runKernelFunc(function(i){return i.pad(r,n,e)},{x:r},function(i){var a=n.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",{paddings:n,constantValue:e})}}),zq=F({pad1d_:function(t,n,e){return void 0===e&&(e=0),A(2===n.length,function(){return"Invalid number of paddings. Must be length of 2."}),hu(t,[n],e)}}),Wq=F({pad2d_:function(t,n,e){return void 0===e&&(e=0),A(2===n.length&&2===n[0].length&&2===n[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hu(t,n,e)}}),$q=F({pad3d_:function(t,n,e){return void 0===e&&(e=0),A(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hu(t,n,e)}}),Gq=F({pad4d_:function(t,n,e){return void 0===e&&(e=0),A(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),hu(t,n,e)}}),qq=F({rand_:function(t,n,e){var r=$e(t),o=null;if(null==e||"float32"===e)o=new Float32Array(r);else if("int32"===e)o=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return N.makeTensor(o,t,e)}}),Xq=F({randomNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new B0(n,e,r,!1,o),a=Et(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Kq=F({randomGamma_:function(t,n,e,r,o){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new Fq(n,e,r,o),a=Et(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),GT=F({randomUniform_:function(t,n,e,r,o){void 0===n&&(n=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var i=Et(t,r),a=new Oq(n,e,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Ni=F({reshape_:function(t,n){var e=S(t,"x","reshape",null);return n=QM(n,e.size),A(e.size===$e(n),function(){return"new shape and old shape must have the same number of elements."}),N.runKernelFunc(function(o){return o.reshape(e,n)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",{shape:n})}}),qT=F({spaceToBatchND_:function(t,n,e){var r=S(t,"x","spaceToBatchND");return A(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),A(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),A(r.shape.reduce(function(o,i,a){return a>0&&a<=n.length?o&&(i+e[a-1][0]+e[a-1][1])%n[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),N.runKernelFunc(function(o){return o.spaceToBatchND(r,n,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(n,e)}}})}}),XT=F({squeeze_:function(t,n){var e=S(t,"x","squeeze");return Ni(e,ws(e.shape,n).newShape)}}),$o=F({stack_:function(t,n){void 0===n&&(n=0);var e=tf(t,"tensors","stack");if(A(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(n);var o=e[0].shape,i=e[0].dtype;A(n<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Yt(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){A(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(n)});return wr(a,n)}}),Wc=F({tile_:function(t,n){var e=S(t,"x","tile",null);return A(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."}),N.runKernelFunc(function(i,a){var s=i.tile(e,n);return a([e]),s},{x:e},function(i,a){var s=a[0];return{x:function(){var u=Qt(s);if(1===s.rank)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var f=0;f<n[3];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",{reps:n},[e])}}),Zq=F({truncatedNormal_:function(t,n,e,r,o){if(void 0===n&&(n=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new B0(n,e,r,!0,o),a=Et(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),xr=F({unstack_:function(t,n){void 0===n&&(n=0),n=n||0;var e=S(t,"x","unstack");return A(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length),N.runKernelFunc(function(o){return o.unstack(e,n)},{x:e},function(o){return{x:function(){return $o(o,n)}}},"Unpack",{axis:n})}});function ag(t,n,e,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([t[a+1]/n[a],n[a]]);o=o.concat(t.slice(i+1))}return o}function sg(t,n,e){void 0===e&&(e=!0);var r=[];if(e){r.push(n);for(var o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function ug(t,n,e,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/e:t[0]*e);for(var i=1;i<t.length;++i)o.push(i<=n.length?r?n[i-1]*t[i]:t[i]/n[i-1]:t[i]);return o}function KT(t,n){for(var e=[0],r=0;r<n;++r)e.push(t[r][0]);return e}function ZT(t,n,e){for(var r=t.slice(0,1),o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}function V0(t,n){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==n.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var e=n.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var a=t.shape,s=e.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=Mi(t.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}function cg(t){return t<=30?t:Xp(t,Math.floor(Math.sqrt(t)))}function YT(t,n,e){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(e.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+e.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<e.rank-o;++a)if(e.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+e.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function QT(t,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==n.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===n.size)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}YT(e,n,t)}function nf(t,n,e){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,a=1,s=o;s<i;++s)a*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:$e(n.shape)/u,sliceSize:a,strides:Mi(e.slice(0,o)).concat([1]),outputSize:$e(e)}}function JT(t,n,e){A(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+n+" must match the rank of the array ("+t.rank+")."}),A(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of size "+e+" must match the rank of the array ("+t.rank+")."});for(var r=function(i){A(n[i]+e[i]<=t.shape[i],function(){return"Error in slice"+t.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+e[i])+") would overflow input.shape["+i+"] ("+t.shape[i]+")"})},o=0;o<t.rank;++o)r(o)}function H0(t){for(var n=[],e=0;t>0;)1&t&&n.push(e),t/=2,e++;return n}function lg(t,n,e){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function ek(t,n,e,r,o){var i=n[o];(t&1<<o||null==i)&&(i=(e[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),Gp(0,i,s-1)}function tk(t,n,e,r,o){var i=n[o],a=e[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?Gp(0,i,s):Gp(-1,i,s-1)}function z0(t,n,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function W0(t,n){for(var e=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function dg(t){return N.customGrad(t)}Object.freeze({prepareAndValidate:V0}),Object.freeze({validateUpdateShape:YT,validateInput:QT,calculateShapes:nf}),Object.freeze({assertParamsValid:JT,maskToAxes:H0,computeOutShape:lg,startForAxis:ek,stopForAxis:tk,isSliceContinous:z0,computeFlatOffset:W0});var za=F({softmax_:function(t,n){void 0===n&&(n=-1);var e=S(t,"logits","softmax","float32");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return N.runKernelFunc(function(r,o){var i=r.softmax(e,n);return o([i]),i},{logits:e},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}},"Softmax",{dim:n},[],[!0])}}),Jq=F({logSoftmax_:function(t,n){void 0===n&&(n=-1);var e=S(t,"logits","logSoftmax");if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return dg(function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),nk=function(){function t(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},t.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},t.prototype.has=function(n){return this.data.has(n)},t.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),rk=function(){function t(){}return t.prototype.time=function(n){return z("time")},t.prototype.read=function(n){return z("read")},t.prototype.readSync=function(n){return z("readSync")},t.prototype.numDataIds=function(){return z("numDataIds")},t.prototype.disposeData=function(n){return z("disposeData")},t.prototype.write=function(n,e,r){return z("write")},t.prototype.move=function(n,e,r,o){return z("move")},t.prototype.memory=function(){return z("memory")},t.prototype.floatPrecision=function(){return z("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(n,e,r,o){return z("batchMatMul")},t.prototype.fusedBatchMatMul=function(n){return z("fusedBatchMatMul")},t.prototype.slice=function(n,e,r){return z("slice")},t.prototype.stridedSlice=function(n,e,r,o){return z("stridedSlice")},t.prototype.unstack=function(n,e){return z("unstack")},t.prototype.reverse=function(n,e){return z("reverse")},t.prototype.concat=function(n,e){return z("concat")},t.prototype.neg=function(n){return z("neg")},t.prototype.add=function(n,e){return z("add")},t.prototype.addN=function(n){return z("addN")},t.prototype.subtract=function(n,e){return z("subtract")},t.prototype.multiply=function(n,e){return z("multiply")},t.prototype.realDivide=function(n,e){return z("realDivide")},t.prototype.floorDiv=function(n,e){return z("floorDiv")},t.prototype.sum=function(n,e){return z("sum")},t.prototype.prod=function(n,e){return z("prod")},t.prototype.unsortedSegmentSum=function(n,e,r){return z("unsortedSegmentSum")},t.prototype.argMin=function(n,e){return z("argMin")},t.prototype.argMax=function(n,e){return z("argMax")},t.prototype.equal=function(n,e){return z("equal")},t.prototype.notEqual=function(n,e){return z("notEqual")},t.prototype.less=function(n,e){return z("less")},t.prototype.lessEqual=function(n,e){return z("lessEqual")},t.prototype.greater=function(n,e){return z("greater")},t.prototype.greaterEqual=function(n,e){return z("greaterEqual")},t.prototype.logicalNot=function(n){return z("logicalNot")},t.prototype.logicalAnd=function(n,e){return z("logicalAnd")},t.prototype.logicalOr=function(n,e){return z("logicalOr")},t.prototype.where=function(n){return z("where")},t.prototype.select=function(n,e,r){return z("select")},t.prototype.topk=function(n,e,r){return z("topk")},t.prototype.min=function(n,e){return z("min")},t.prototype.minimum=function(n,e){return z("minimum")},t.prototype.mod=function(n,e){return z("mod")},t.prototype.max=function(n,e){return z("max")},t.prototype.maximum=function(n,e){return z("maximum")},t.prototype.all=function(n,e){return z("all")},t.prototype.any=function(n,e){return z("any")},t.prototype.squaredDifference=function(n,e){return z("squaredDifference")},t.prototype.ceil=function(n){return z("ceil")},t.prototype.floor=function(n){return z("floor")},t.prototype.round=function(n){return z("round")},t.prototype.sign=function(n){return z("sign")},t.prototype.isNaN=function(n){return z("isNaN")},t.prototype.isInf=function(n){return z("isInf")},t.prototype.isFinite=function(n){return z("isFinite")},t.prototype.pow=function(n,e){return z("pow")},t.prototype.exp=function(n){return z("exp")},t.prototype.expm1=function(n){return z("expm1")},t.prototype.softmax=function(n,e){return z("softmax")},t.prototype.log=function(n){return z("log")},t.prototype.log1p=function(n){return z("log1p")},t.prototype.sqrt=function(n){return z("sqrt")},t.prototype.rsqrt=function(n){return z("rsqrt")},t.prototype.square=function(n){return z("square")},t.prototype.reciprocal=function(n){return z("reciprocal")},t.prototype.relu=function(n){return z("relu")},t.prototype.relu6=function(n){return z("relu6")},t.prototype.prelu=function(n,e){return z("prelu")},t.prototype.elu=function(n){return z("elu")},t.prototype.eluDer=function(n,e){return z("eluDer")},t.prototype.selu=function(n){return z("selu")},t.prototype.int=function(n){return z("int")},t.prototype.clip=function(n,e,r){return z("clip")},t.prototype.abs=function(n){return z("abs")},t.prototype.complexAbs=function(n){return z("complexAbs")},t.prototype.sigmoid=function(n){return z("sigmoid")},t.prototype.softplus=function(n){return z("softplus")},t.prototype.sin=function(n){return z("sin")},t.prototype.cos=function(n){return z("cos")},t.prototype.tan=function(n){return z("tan")},t.prototype.asin=function(n){return z("asin")},t.prototype.acos=function(n){return z("acos")},t.prototype.atan=function(n){return z("atan")},t.prototype.atan2=function(n,e){return z("atan2")},t.prototype.sinh=function(n){return z("sinh")},t.prototype.cosh=function(n){return z("cosh")},t.prototype.tanh=function(n){return z("tanh")},t.prototype.asinh=function(n){return z("asinh")},t.prototype.acosh=function(n){return z("acosh")},t.prototype.atanh=function(n){return z("atanh")},t.prototype.erf=function(n){return z("erf")},t.prototype.step=function(n,e){return z("step")},t.prototype.fusedConv2d=function(n){return z("fusedConv2d")},t.prototype.conv2d=function(n,e,r){return z("conv2d")},t.prototype.conv2dDerInput=function(n,e,r){return z("conv2dDerInput")},t.prototype.conv2dDerFilter=function(n,e,r){return z("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(n){return z("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(n,e,r){return z("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(n,e,r){return z("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(n,e,r){return z("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(n,e,r){return z("conv3d")},t.prototype.conv3dDerInput=function(n,e,r){return z("conv3dDerInput")},t.prototype.conv3dDerFilter=function(n,e,r){return z("conv3dDerFilter")},t.prototype.maxPool=function(n,e){return z("maxPool")},t.prototype.maxPoolBackprop=function(n,e,r,o){return z("maxPoolBackprop")},t.prototype.avgPool=function(n,e){return z("avgPool")},t.prototype.avgPoolBackprop=function(n,e,r){return z("avgPoolBackprop")},t.prototype.avgPool3d=function(n,e){return z("avgPool3d")},t.prototype.avgPool3dBackprop=function(n,e,r){return z("avgPool3dBackprop")},t.prototype.maxPool3d=function(n,e){return z("maxPool3d")},t.prototype.maxPool3dBackprop=function(n,e,r,o){return z("maxPool3dBackprop")},t.prototype.reshape=function(n,e){return z("reshape")},t.prototype.cast=function(n,e){return z("cast")},t.prototype.tile=function(n,e){return z("tile")},t.prototype.pad=function(n,e,r){return z("pad")},t.prototype.transpose=function(n,e){return z("transpose")},t.prototype.gather=function(n,e,r){return z("gather")},t.prototype.gatherND=function(n,e){return z("gatherND")},t.prototype.scatterND=function(n,e,r){return z("scatterND")},t.prototype.batchToSpaceND=function(n,e,r){return z("batchToSpaceND")},t.prototype.spaceToBatchND=function(n,e,r){return z("spaceToBatchND")},t.prototype.resizeBilinear=function(n,e,r,o){return z("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(n,e,r){return z("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(n,e,r,o){return z("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(n,e,r){return z("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(n,e,r,o,i,a){return z("batchNormalization")},t.prototype.localResponseNormalization4D=function(n,e,r,o,i){return z("localResponseNormalization4D")},t.prototype.LRNGrad=function(n,e,r,o,i,a,s){return z("LRNGrad")},t.prototype.multinomial=function(n,e,r,o){return z("multinomial")},t.prototype.oneHot=function(n,e,r,o){return z("oneHot")},t.prototype.cumsum=function(n,e,r,o){return z("cumsum")},t.prototype.nonMaxSuppression=function(n,e,r,o,i){return z("nonMaxSuppression")},t.prototype.fft=function(n){return z("fft")},t.prototype.ifft=function(n){return z("ifft")},t.prototype.complex=function(n,e){return z("complex")},t.prototype.real=function(n){return z("real")},t.prototype.imag=function(n){return z("imag")},t.prototype.cropAndResize=function(n,e,r,o,i,a){return z("cropAndResize")},t.prototype.depthToSpace=function(n,e,r){return z("depthToSpace")},t.prototype.split=function(n,e,r){return z("split")},t.prototype.sparseToDense=function(n,e,r,o){return z("sparseToDense")},t.prototype.diag=function(n){return z("diag")},t.prototype.fill=function(n,e,r){return z("fill")},t.prototype.onesLike=function(n){return z("onesLike")},t.prototype.zerosLike=function(n){return z("zerosLike")},t.prototype.linspace=function(n,e,r){return z("linspace")},t.prototype.dispose=function(){return z("dispose")},t}();function z(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Wa(t,n){for(var e=t.length,r=[],o=0;o<e;o++){var i=e-1-o;(n[n.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function gr(t,n){for(var e=[],r=0;r<n.length;r++){var o=t[t.length-r-1],i=n.length-r-1;(null==o||1===o&&n[i]>1)&&e.unshift(i)}return e}function Ot(t,n){for(var e=[],r=Math.max(t.length,n.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=n[n.length-o-1];if(null==a&&(a=1),1===i)e.unshift(a);else if(1===a)e.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+n+".");e.unshift(i)}}return e}function $c(t,n,e,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=hg(n),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return Ss(t,s,e,r,o,i,!1,a)}function rf(t,n,e,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=G0(n),l=c[0],d=c[1],f=c[2];if("NDHWC"===a)u="channelsLast",s=[l,d,f,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,d,f,t[1],t[1]]}return af(t,s,e,r,o,!1,u,i)}function Ss(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if("channelsLast"===s)c=t[0],l=t[1],d=t[2],f=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],f=t[1],l=t[2],d=t[3]}var h,p=n[0],g=n[1],m=n[3],v=hg(e),b=v[0],w=v[1],_=hg(r),x=_[0],D=_[1],R=Gc(p,x),k=Gc(g,D),M=function(Z,Y,se,ne,ee,ue,he,Re){var Ye,tt,Nt;if("number"==typeof Z){Ye={top:Z,bottom:Z,left:Z,right:Z,type:0===Z?"VALID":"NUMBER"};var Ft=function(Gt,yn,sn,rr,qn){null==rr&&(rr=$0(Gt,yn,sn));var pa=Gt[1],ga=sf((Gt[0]-yn+2*rr)/sn+1,qn);A($n(ga),function(){return"The output # of rows ("+ga+") must be an integer. Change the stride and/or zero pad parameters"});var Ko=sf((pa-yn+2*rr)/sn+1,qn);return A($n(Ko),function(){return"The output # of columns ("+Ko+") must be an integer. Change the stride and/or zero pad parameters"}),[ga,Ko]}([Y,se],ue,ne,Z,Re);tt=Ft[0],Nt=Ft[1]}else if("same"===Z){tt=Math.ceil(Y/ne),Nt=Math.ceil(se/ee);var Ut=Math.max(0,(tt-1)*ne+ue-Y),Jt=Math.max(0,(Nt-1)*ee+he-se),$t=Math.floor(Ut/2),en=Ut-$t,sr=Math.floor(Jt/2);Ye={top:$t,bottom:en,left:sr,right:Jt-sr,type:"SAME"}}else{if("valid"!==Z)throw Error("Unknown padding parameter: "+Z);Ye={top:0,bottom:0,left:0,right:0,type:"VALID"},tt=Math.ceil((Y-ue+1)/ne),Nt=Math.ceil((se-he+1)/ee)}return{padInfo:Ye,outHeight:tt,outWidth:Nt}}(o,l,d,b,w,R,k,i),B=M.outHeight,P=M.outWidth,Q=a?m*f:m;return"channelsFirst"===s?h=[c,Q,B,P]:"channelsLast"===s&&(h=[c,B,P,Q]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:B,outWidth:P,outChannels:Q,padInfo:M.padInfo,strideHeight:b,strideWidth:w,filterHeight:p,filterWidth:g,effectiveFilterHeight:R,effectiveFilterWidth:k,dilationHeight:x,dilationWidth:D,inShape:t,outShape:h,filterShape:n}}function af(t,n,e,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if("channelsLast"===a)c=t[0],l=t[1],d=t[2],f=t[3],h=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],h=t[1],l=t[2],d=t[3],f=t[4]}var p,g=n[0],m=n[1],v=n[2],b=n[4],w=G0(e),_=w[0],x=w[1],D=w[2],R=G0(r),k=R[0],M=R[1],T=R[2],B=Gc(g,k),P=Gc(m,M),Q=Gc(v,T),Z=function(he,Re,Ye,tt,Nt,Ft,Ut,Jt,$t,en,sr){var Gt,yn,sn,rr;if("number"==typeof he){Gt={top:he,bottom:he,left:he,right:he,front:he,back:he,type:0===he?"VALID":"NUMBER"};var qn=function(sl,Ja,Sw,ul,ma,Iw){null==ma&&(ma=$0(sl,Ja,ul));var XQ=sl[1],KQ=sl[2],Aw=sf((sl[0]-Ja+2*ma)/ul+1,Iw);A($n(Aw),function(){return"The output # of depths ("+Aw+") must be an integer. Change the stride and/or zero pad parameters"});var Mw=sf((XQ-Ja+2*ma)/ul+1,Iw);A($n(Mw),function(){return"The output # of rows ("+Mw+") must be an integer. Change the stride and/or zero pad parameters"});var Tw=sf((KQ-Ja+2*ma)/ul+1,Iw);return A($n(Tw),function(){return"The output # of columns ("+Tw+") must be an integer. Change the stride and/or zero pad parameters"}),[Aw,Mw,Tw,1]}([Re,Ye,tt,1],Jt,0,Nt,he,sr);yn=qn[0],sn=qn[1],rr=qn[2]}else if("same"===he){var Xn=((yn=Math.ceil(Re/Nt))-1)*Nt+Jt-Re,pa=((sn=Math.ceil(Ye/Ft))-1)*Ft+$t-Ye,ga=((rr=Math.ceil(tt/Ut))-1)*Ut+en-tt,Ko=Math.floor(Xn/2),al=Xn-Ko,Ya=Math.floor(pa/2),Os=pa-Ya,Qa=Math.floor(ga/2);Gt={top:Ya,bottom:Os,left:Qa,right:ga-Qa,front:Ko,back:al,type:"SAME"}}else{if("valid"!==he)throw Error("Unknown padding parameter: "+he);Gt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},yn=Math.ceil((Re-Jt+1)/Nt),sn=Math.ceil((Ye-$t+1)/Ft),rr=Math.ceil((tt-en+1)/Ut)}return{padInfo:Gt,outDepth:yn,outHeight:sn,outWidth:rr}}(o,l,d,f,_,x,D,B,P,Q,s),se=Z.outDepth,ne=Z.outHeight,ee=Z.outWidth,ue=i?b*h:b;return"channelsFirst"===a?p=[c,ue,se,ne,ee]:"channelsLast"===a&&(p=[c,se,ne,ee,ue]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:se,outHeight:ne,outWidth:ee,outChannels:ue,padInfo:Z.padInfo,strideDepth:_,strideHeight:x,strideWidth:D,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:B,effectiveFilterHeight:P,effectiveFilterWidth:Q,dilationDepth:k,dilationHeight:M,dilationWidth:T,inShape:t,outShape:p,filterShape:n}}function $0(t,n,e,r){void 0===r&&(r=1);var o=Gc(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function hg(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function G0(t){return"number"==typeof t?[t,t,t]:t}function Gc(t,n){return n<=1?t:t+(t-1)*(n-1)}function sf(t,n){if(!n)return t;switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+n)}}function pu(t){var n=hg(t);return 1===n[0]&&1===n[1]&&1===n[2]}function fo(t,n){return pu(t)||pu(n)}function pg(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function q0(t,n,e){if("complex64"===n){if("complex64"===t.dtype)return t.clone();var r=Bn(t.shape),o=t.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!tT(t.dtype,n))return N.makeTensorFromDataId(t.dataId,t.shape,n);if("complex64"===t.dtype){var a=e.real(t);return i=a.cast(n),a.dispose(),i}if("int32"===n)return e.int(t);if("bool"===n){var s=Ce(0,t.dtype);return i=e.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+n)}function gg(t,n){return N.makeTensorFromDataId(t.dataId,n,t.dtype)}function X0(t,n,e){var r=(n-t)/(e-1),o=Uc(e,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return pr(o,"float32")}function K0(t,n){if(t.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+n.length+".");for(var e=new Float32Array(2*t.length),r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function ok(t,n){return{real:t[2*n],imag:t[2*n+1]}}function e7(t,n,e,r){t[2*r]=n,t[2*r+1]=e}function t7(t,n,e){var r=(e?2:-2)*Math.PI*(t/n);return{real:Math.cos(r),imag:Math.sin(r)}}function n7(t,n,e){var r=function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var g=l(c,u[h=d+(f-d>>>1)]);g>0?d=h+1:(f=h,p=!g)}return p?d:-d-1}(t,n,e||r7);t.splice(r<0?-(r+1):r,0,n)}function r7(t,n){return t>n?1:t<n?-1:0}function Z0(t,n,e,r,o){return ik(t,n,e,r,o,0).selectedIndices}function Y0(t,n,e,r,o,i){var a=ik(t,n,e,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function ik(t,n,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(n).map(function(_,x){return{score:_,boxIndex:x,suppressBeginIndex:0}}).filter(function(_){return _.score>o}).sort(ak),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,g=f.suppressBeginIndex;if(h<o)break;for(var m=!1,v=l.length-1;v>=g;--v){var b=o7(t,p,l[v]);if(b>=r){m=!0;break}if(f.score=f.score*i7(r,c,b),f.score<=o)break}f.suppressBeginIndex=l.length,m||(f.score===h?(l.push(p),d.push(f.score)):f.score>o&&n7(u,f,ak))}var w=l.length;return s&&(l.fill(0,w),d.fill(0,w)),{selectedIndices:pr(l,"int32"),selectedScores:pr(d,"float32"),numValidOutputs:Ce(w,"int32")}}function o7(t,n,e){var r=t.subarray(4*n,4*n+4),o=t.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var g=Math.max(i,c),m=Math.max(a,l),v=Math.min(s,d),b=Math.min(u,f),w=Math.max(v-g,0)*Math.max(b-m,0);return w/(h+p-w)}function i7(t,n,e){var r=Math.exp(n*e*e);return e<=t?r:0}function ak(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function sk(t,n,e){var r=new Array(t.rank).fill(0),o=t.shape.slice();return n.map(function(i){o[e]=i;var a=t.slice(r,o);return r[e]+=i,a})}function uk(t,n){for(var e=new Array(t.rank),r=0;r<e.length;r++)e[r]=t.shape[r]*n[r];var o=Et(e,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function ck(t,n,e,r,o){for(var i=n[n.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=jc(e,s*r),l=jc("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=t.subarray(f,f+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(_,x){return x.value-_.value});var m=d*r,v=c.subarray(m,m+r),b=l.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,b[g]=p[g].index}var w=n.slice();return w[w.length-1]=r,[Hr(c,w,e),Hr(l,w,"int32")]}function Q0(t,n){for(var e=[],r=0;r<n.length;r++)n[r]&&e.push(r);var o=Et(t,"int32"),i=Et([e.length,t.length],"int32");for(r=0;r<e.length;r++){var a=o.indexToLoc(e[r]);i.values.set(a,r*t.length)}return i.toTensor()}Object.freeze({castTensor:q0,reshapeTensor:gg,linspaceImpl:X0,upcastType:Ir,axesAreInnerMostDims:O0,combineLocations:UT,computeOutAndReduceShapes:Vr,expandShapeToKeepDim:lo,assertAxesAreInnerMostDims:Io,getAxesPermutation:ki,getUndoAxesPermutation:rg,getInnerMostAxes:Ri,getBroadcastDims:Wa,getReductionAxes:gr,assertAndGetBroadcastShape:Ot,assertParamsConsistent:HT,computeOutShape:lu,computePool2DInfo:$c,computePool3DInfo:rf,computeConv2DInfo:Ss,computeConv3DInfo:af,computeDefaultPad:$0,tupleValuesAreOne:pu,eitherStridesOrDilationsAreOne:fo,convertConv2DDataFormat:pg,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:cg});var a7=function(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},s7=function(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},u7=function(t,n,e){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,a=Math.ceil(t.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===n?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function lk(t,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return t+"."+e})}function Mo(t,n){return 1===n?[t]:lk(t,n)}function Xr(){var t,n,e,r,o,i,a,s,u,c;return 2===X().getNumber("WEBGL_VERSION")?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function gu(t,n,e){void 0===e&&(e="index");var r=Mi(n);return r.map(function(o,i){return"int "+t[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+t[i+1]+" = "+e+" - "+t[i]+" * "+o:"index -= "+t[i]+" * "+o)+";"}).join("")}function J0(t){var n=Mi(t).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+n[0]+" + coords.y * "+n[1]+" + coords.z;\n  }\n"}var dk="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function c7(t,n,e,r){var o=[];t.forEach(function(h){var p=$e(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,h,s=o.join("\n"),u=t.map(function(h){return function(p,g,m){void 0===m&&(m=!1);var v="";return v+=m?fk(p):qc(p),p.shapeInfo.logicalShape.length<=g.logicalShape.length&&(v+=m?function(_,x){var D,se,R=_.name,k=R.charAt(0).toUpperCase()+R.slice(1),M="get"+k+"AtOutCoords",T=_.shapeInfo.logicalShape.length,B=x.logicalShape.length,P=Wa(_.shapeInfo.logicalShape,x.logicalShape),Q=Rn(B),Z=B-T,Y=["x","y","z","w","u","v"];D=0===T?"":B<2&&P.length>=1?"coords = 0;":P.map(function(Ye){return"coords."+Y[Ye+Z]+" = 0;"}).join("\n"),se=B<2&&T>0?"coords":_.shapeInfo.logicalShape.map(function(Ye,tt){return"coords."+Y[tt+Z]}).join(", ");var ne="return outputValue;",ee=1===$e(_.shapeInfo.logicalShape),ue=1===$e(x.logicalShape);if(1!==T||ee||ue){if(ee&&!ue)ne=1===B?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(P.length){var he=T-2,Re=T-1;P.indexOf(he)>-1&&P.indexOf(Re)>-1?ne="return vec4(outputValue.x);":P.indexOf(he)>-1?ne="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(Re)>-1&&(ne="return vec4(outputValue.xx, outputValue.zz);")}}else ne="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+M+"() {\n      "+Q+" coords = getOutputCoords();\n      "+D+"\n      vec4 outputValue = get"+k+"("+se+");\n      "+ne+"\n    }\n  "}(p,g):function(_,x){var D=_.name,R=D.charAt(0).toUpperCase()+D.slice(1),k="get"+R+"AtOutCoords",B=_.shapeInfo.logicalShape.length,P=x.logicalShape.length;if(!_.shapeInfo.isUniform&&B===P&&null==_.shapeInfo.flatOffset&&fr(_.shapeInfo.texShape,x.texShape))return"\n      float "+k+"() {\n        return sampleTexture("+D+", resultUV);\n      }\n    ";var Z=Rn(P),Y=Wa(_.shapeInfo.logicalShape,x.logicalShape),se=P-B,ne=["x","y","z","w","u","v"];return"\n    float "+k+"() {\n      "+Z+" coords = getOutputCoords();\n      "+(0===B?"":P<2&&Y.length>=1?"coords = 0;":Y.map(function(ue){return"coords."+ne[ue+se]+" = 0;"}).join("\n"))+"\n      return get"+R+"("+(P<2&&B>0?"coords":_.shapeInfo.logicalShape.map(function(ue,he){return"coords."+ne[he+se]}).join(", "))+");\n    }\n  "}(p,g)),v}(h,n,r)}).join("\n"),c=n.texShape,l=Xr(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+l7+"\n    "+d7+"\n    "+f7+"\n  ";return n.isPacked?(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return x=p,1===(D=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+D[1]+".0);\n      }\n    ":1===D[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+D[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+D[0]+", "+D[1]+"));\n      return 2 * (resTexRC.x * "+D[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(_,x){var D=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(fr(_,x))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+D[0]+", "+D[1]+"));\n      }\n    ";var R=Math.ceil(_[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+D[0]+", "+D[1]+"));\n\n      int index = resTexRC.x * "+D[1]+" + resTexRC.y;\n      int r = 2 * (index / "+R+");\n      int c = imod(index, "+R+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=h,m=p,v=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],w=(b=Math.ceil(g[2]/2))*Math.ceil(g[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      int b = index / "+w+";\n      index -= b * "+w+";\n\n      int r = 2 * (index / "+b+");\n      int c = imod(index, "+b+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(_,x){for(var D=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],R=Math.ceil(_[_.length-1]/2),k=R*Math.ceil(_[_.length-2]/2),M=k,T="",B="b, r, c",P=2;P<_.length-1;P++)T="\n      int b"+P+" = index / "+(M*=_[_.length-P-1])+";\n      index -= b"+P+" * "+M+";\n    "+T,B="b"+P+", "+B;return"\n    ivec"+_.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+D[0]+", "+D[1]+"));\n      int index = resTexRC.x * "+D[1]+" + resTexRC.y;\n\n      "+T+"\n\n      int b = index / "+k+";\n      index -= b * "+k+";\n\n      int r = 2 * (index / "+R+");\n      int c = imod(index, "+R+") * 2;\n\n      return ivec"+_.length+"("+B+");\n    }\n  "}(h,p)}var x,D,g,m,v,b,w}(n.logicalShape,c),a=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(b=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+b[1]+".0);\n      }\n    ":1===b[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+b[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      return resTexRC.x * "+b[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(v,b){return fr(v,b)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+b[0]+", "+b[1]+"));\n      }\n    ":1===v[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===v[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+b[0]+", "+b[1]+"));\n        int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      int r = index / "+v[1]+";\n      int c = index - r * "+v[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return g=p,m=gu(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+g[0]+", "+g[1]+"));\n      int index = resTexRC.x * "+g[1]+" + resTexRC.y;\n      "+m+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(v,b){var w=gu(["r","c","d","d2"],v);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n      "+w+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(v,b){var w=gu(["r","c","d","d2","d3"],v);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+b[0]+",\n                             "+b[1]+"));\n\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(v,b){var w=gu(["r","c","d","d2","d3","d4"],v);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      "+w+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var b,g,m}(n.logicalShape,c),a=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=h7),[f,d,a,s,i,u,e].join("\n")}function qc(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape;if(1===i[0]&&1===i[1])return"\n      float "+o+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+mu(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+Xc(e)+"\n      }\n    ";var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float "+o+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=mu(r);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+a+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===a?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+s+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=e.shapeInfo.texShape;if(null!=a&&fr(r,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=ws(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+qc(Kc(e,l))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+Zc(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Xc(e)+"\n      }\n    ";var p=a[0],g=a[1],m=mu(o);return 1===g?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+m+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+g+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+m+";\n    vec2 uv = uvFromFlat("+p+", "+g+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(t);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=ws(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+qc(Kc(e,c))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+Zc(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+s+", 1)));\n        "+Xc(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],g=h[1],m=e.shapeInfo.flatOffset;return g===a&&null==m?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+g+".0, "+p+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":g===s&&null==m?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+g+".0, "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+s+" + depth + "+mu(o)+";\n        vec2 uv = uvFromFlat("+p+", "+g+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(t);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=ws(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+qc(Kc(e,l))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+Zc(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+a+", 1)));\n        "+Xc(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,g=p[0],m=p[1];return m===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":m===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+g+", "+m+", index + "+mu(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=ws(r),d=l.newShape,f=l.keptDims;if(d.length<r.length)return"\n      "+qc(Kc(e,d))+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+Zc(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          depth3;\n        "+Xc(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,m=g[0],v=g[1];return v===c&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":v===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+a+" + depth3 + "+mu(o)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=ws(r),s=a.newShape,u=a.keptDims;if(s.length<r.length)return"\n      "+qc(Kc(e,s))+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+Zc(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+Xc(e)+"\n      }\n    ";var g=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],b=m[1];return b===p&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+d+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+b+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":b===l&&null==g?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+b+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+l+" + depth4 + "+mu(o)+";\n      vec2 uv = uvFromFlat("+v+", "+b+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function fk(t){var n,o,i,a,s,u,c;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+Xr().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return a="get"+(i=(o=t).name).charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Xr(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+i+", uv);\n    }\n  ";case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],d=Xr();if(null!=u&&fr(i,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+d.texture2D+"("+a+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(i[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+a+", uv);\n    }\n  "}(t);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===i[0])return"\n        "+fk(Kc(o,i.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+Zc(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],h=c[1],p=Math.ceil(i[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+h+", "+p*Math.ceil(i[1]/2)+", "+p+", b, row, col);\n      return "+Xr().texture2D+"("+a+", uv);\n    }\n  "}(t);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),g="int b, int row, int col",m="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<a-1;v++)g="int b"+v+", "+g,m="b"+v+" * "+(p*=i[a-v-1])+" + "+m;return"\n    vec4 "+u+"("+g+") {\n      int index = "+m+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+Xr().texture2D+"("+s+", uv);\n    }\n  "}(t)}}var l7="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",d7="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",f7="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",h7="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function mu(t){return"offset"+t}function Xc(t){var n=t.name,e=$e(t.shapeInfo.logicalShape);return e<2?"return "+n+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+n+"[i];\n      }\n    }\n  "}function Rn(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Kc(t,n){var e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function Zc(t,n){return n.map(function(e){return t[e]}).join(", ")}var p7=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(t.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Rn(c),d=Mo("coords",c);if(1===i){var f=Rn(s=c+1);a="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],g=h.map(function(k){return"int "+k}),m=Mo("sourceLocR",s-1).concat("inIdx.r"),v=Mo("sourceLocG",s-1).concat("inIdx.g"),b=Mo("sourceLocB",s-1).concat("inIdx.b"),w=Mo("sourceLocA",s-1).concat("inIdx.a"),_="max"===e?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+b.join()+"),\n                             getBestIndicesAChannel("+w.join()+")));",D="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+b.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+w.join()+") : 0.)",R=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+R+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+n+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+D+";\n\n        for (int i = 0; i < "+n+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+D+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+_+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},g7=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var s=t.effectiveFilterHeight,u=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-t.padInfo.top)+", "+(u-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},m7=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-t.padInfo.front)+", "+(d-1-t.padInfo.top)+", "+(f-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},v7=function(t,n,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ot(t,n),Ot(t,e);var a="0.0";null!=r&&(Ot(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Ot(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},y7=function(t,n,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ot(t,n),Ot(t,e);var a="vec4(0.0)";null!=r&&(Ot(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Ot(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},hk=function(t,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ot(n,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},e_="return a + b;",t_="return a - b;",pk="return a * b;",gk="return (a < 0.) ? b * a : a;",nr=function(t,n,e){this.variableNames=["A","B"],this.outputShape=Ot(n,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},mk="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",$a=function(t,n,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ot(n,e);var o=this.outputShape.length,i="";if(r)if(0===o||1===$e(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+Rn(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Mo("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},w7=function(){function t(n){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),x7=function(){function t(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,e)}},t}(),C7=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},E7=function(t){this.outputShape=[],this.outputShape=lu(t,1),this.variableNames=t.map(function(s,u){return"T"+u});var n=new Array(t.length-1);n[0]=t[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+t[e][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++)r.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+n[e-1]+"));");r.push("else setOutput(getT"+n.length+"(yR, yC-"+n[n.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},D7=function(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=lu(t,n);var e=this.outputShape,r=e.length,o=Rn(r),i=Mo("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(m,v){return"T"+v});var s=new Array(t.length-1);s[0]=t[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][n];var c=a[n],l=a.slice(-2),d=a.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+mg(a,c,h)+"),\n            vec2("+mg(l,c,h)+"));\n        }"}var g=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+mg(a,c,g)+"),\n          vec2("+mg(l,c,g)+"));",this.userCode="\n      float getValue("+a.map(function(m){return"int "+m})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+e[r-2]+" &&\n            "+i[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function mg(t,n,e){var r=t.indexOf(n);return t.map(function(o,i){return i===r?o+" - "+e:o}).join()}var S7=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},I7=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,i="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(i?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(i?1:2)+"], coords["+(i?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},A7=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},M7=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,e=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(n-1-t.padInfo.front)+", "+(e-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+n+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+n+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},T7=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},k7=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,e=t.filterWidth,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(n-1-t.padInfo.top)+", "+(e-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+n+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+n+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vk=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),h=t.inChannels%4,p="channelsLast"===t.dataFormat,g=p?1:2,m=p?2:3,v=p?3:1,b="",w="";e&&(b=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",w="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+_+"\n        "+w+"\n        setOutput(result);\n      }\n    "},R7=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,e=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+n+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},yk=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=t.outChannels/t.inChannels,g="",m="";e&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",m="result = activation(result);");var v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+m+"\n        setOutput(result);\n      }\n    "},bk=function(t,n,e,r){void 0===n&&(n=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,h=t.filterWidth,p=h,g="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var v=0;v<h;v++)g+="\n          vec4 xTexelR"+m+"C"+2*v+" = vec4(0.);\n          vec4 wR"+m+"C"+v+" = vec4(0.);\n          vec4 xR"+m+"C"+v+" = vec4(0.);";for(m=0;m<f;m++)for(var b=0;b<p;b++){if(g+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(v=2*b)*d+";\n        ",1===c){if(v<h&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+m+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+".xy);\n                } else {\n                  xR"+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = xTexelR"+m+"C"+v+";\n              ",v+1<h)){var w=s%2==0?h0(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+w+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+v+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+w+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+";\n                "}}else v<h&&(g+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n              ",v+1<h&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+".xy);\n              ",v+1<h&&(g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n                ")),g+="}");v<h&&(g+="\n            vec4 wTexelR"+m+"C"+v+" = getW("+m+", "+v+", d1, q);\n            wR"+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+".xz);\n          ",v+1<h&&(g+="\n              vec4 wTexelR"+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+", d1, q);\n              wR"+m+"C"+(v+1)+" =\n                vec4(wTexelR"+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<f;m++)for(v=0;v<h;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var _="",x="";e&&(_=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",x="result = activation(result);");var D=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+_+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+D+"\n        "+x+"\n        setOutput(result);\n      }\n    "},N7=function(t,n,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],l=e[0],d=e[1];this.outputShape=[n[0],l,d,t[3]];var h=[a-1+".0",s-1+".0"],p=h[0],g=h[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],_=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g];this.userCode="\n      const float height_ratio = float("+m[0]+");\n      const float width_ratio = float("+_[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+m[1]+";\n        float width_scale = "+_[1]+";\n\n        float in_y = "+m[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+_[2]+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},F7=function(t,n,e){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Rn(r)+" coords = getOutputCoords();\n        int end = "+_k(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+n+") {\n            continue;\n          }\n          "+_k(r,"coords")+" = idx;\n          val += getX("+function(a,s){if(1===a)return""+s;if(2===a)return s+".x, "+s+".y";if(3===a)return s+".x, "+s+".y, "+s+".z";if(4===a)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function _k(t,n){if(1===t)return""+n;if(2===t)return n+".y";if(3===t)return n+".z";if(4===t)return n+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var O7=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qd.DENSE;var n=Xd(t),e=Xr();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+gu(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},P7=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qd.DENSE;var n=Xd(t),e=Xr();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+gu(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+n[0]+", "+n[1]+"));\n        int index = 4 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},L7=function(){function t(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),B7=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},j7=function(t){this.variableNames=["A"],this.outTexUsage=Ho.DOWNLOAD;var n=Xr();this.outputShape=t,this.userCode="\n      "+dk+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+n.output+" = encode_float(x);\n      }\n    "},V7=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ho.DOWNLOAD;var n=Xr();this.outputShape=t,this.userCode="\n      "+dk+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+n.output+" = encode_float(x);\n      }\n    "},U7=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=Xr(),o=n[0],i=n[1];this.outputShape=t;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+J0(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},H7=function(t,n,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Xr(),o=n[0],i=n[1];this.outputShape=t;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+J0(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},wk=function(t,n,e){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},$7=function(){function t(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,n)}},t}(),G7=function(t,n,e){this.variableNames=["A","indices"];var r=t.slice();r[e]=n,this.outputShape=r,this.rank=r.length;var o=Rn(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)l.push(d===s?"int(getIndices("+c[d]+"))":""+c[d]);return l.join()}(t,e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},q7=function(t,n,e){this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var r=Rn(n.length),o=Rn(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function xk(t,n){var e=Xr();return vT(t,n,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ck(t,n){return wT(t,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ek(t,n){return xT(t,n,new Uint16Array([0,1,2,2,1,3]))}function uf(t,n,e,r,o,i,a){ET(e,r);var s=CT(t,n),u=t.TEXTURE_2D;return Pe(t,n,function(){return t.bindTexture(u,s)}),Pe(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Pe(t,n,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Pe(t,n,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Pe(t,n,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Pe(t,n,function(){return t.texImage2D(u,0,o,e,r,0,i,a,null)}),Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function Dk(t,n,e,r,o){var i=Kp(e,r);return uf(t,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function Sk(t,n,e,r,o){var i=Kp(e,r);return uf(t,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Ik(t,n,e,r,o){var i=Kp(e,r);return uf(t,n,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Ak(t,n,e,r,o){var i=Kd(e,r);return uf(t,n,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Mk(t,n,e,r,o){var i=Kd(e,r);return uf(t,n,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function Tk(t,n,e,r){return Pe(t,n,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),k0(t,n,e,"clipSpacePos",r,3,20,0)&&k0(t,n,e,"uv",r,2,20,12)}function kk(t,n,e,r,o,i,a){var s,u,c;Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),Pe(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)}),Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Rk(t,n,e,r){Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,e)}),r.data instanceof Uint8Array?Pe(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Pe(t,n,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Pe(t,n,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Nk(t,n,e,r,o){var i=t.createBuffer();Pe(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*e*r;return Pe(t,n,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),Pe(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)}),Pe(t,n,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function Fk(t,n,e){var r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Ok(t,n,e,r,o){var i=Kp(e,r),a=i[0],s=i[1],u=new Uint8Array(e*r*4);return Pe(t,n,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Pk(t,n,e,r,o,i,a,s){var f,u=t,c=new Float32Array((f=Kd(i,a))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Lk(t,n,e,r){var o=new Float32Array(e*r*4);return Pe(t,n,function(){return t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,o)}),o}var X7=Object.freeze({createVertexShader:xk,createVertexBuffer:Ck,createIndexBuffer:Ek,createFloat32MatrixTexture:Dk,createFloat16MatrixTexture:Sk,createUnsignedBytesMatrixTexture:Ik,createPackedMatrixTexture:Ak,createFloat16PackedMatrixTexture:Mk,bindVertexProgramAttributeStreams:Tk,uploadDenseMatrixToTexture:kk,uploadPixelDataToTexture:Rk,createBufferFromOutputTexture:Nk,downloadFloat32MatrixFromBuffer:Fk,downloadByteEncodedFloatMatrixFromOutputTexture:Ok,downloadPackedMatrixFromBuffer:Pk,downloadMatrixFromPackedOutputTexture:Lk}),Bk=function(){function t(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=X().getNumber("WEBGL_VERSION");null!=n?(this.gl=n,pT(e,n)):this.gl=oa(e);var r="WEBGL_color_buffer_float";if(1===X().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Zd(this.gl,this.debug,"OES_texture_float"),Wo(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Zd(this.gl,this.debug,"OES_texture_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Wo(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Zd(this.gl,this.debug,"EXT_color_buffer_half_float");else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Wo(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Wo(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ck(this.gl,this.debug),this.indexBuffer=Ek(this.gl,this.debug),this.framebuffer=DT(this.gl,this.debug),this.textureConfig=T0(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return X().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var n=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Pe(e,this.debug,function(){return e.finish()}),Pe(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Pe(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),Pe(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Pe(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Pe(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),Dk(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),Sk(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),Ik(this.gl,this.debug,n,e)},t.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),Rk(this.gl,this.debug,n,e)},t.prototype.uploadDenseMatrixToTexture=function(n,e,r,o){this.throwIfDisposed(),kk(this.gl,this.debug,n,e,r,o,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),Mk(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),Ak(this.gl,this.debug,n,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(R0(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Pe(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return Ok(o.gl,o.debug,e,r,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(n,e,r,o,i,a){return Pk(this.gl,n,0,0,0,i,a)},t.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return Fk(this.gl,n,e)},t.prototype.createBufferFromTexture=function(n,e,r){this.bindTextureToFrameBuffer(n);var o=Nk(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},t.prototype.createFence=function(n){var e,r,o=this;if(X().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=a}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(n,e,r){var o=this;return this.downloadMatrixDriver(n,function(){return Lk(o.gl,o.debug,e,r)})},t.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,r=yT(e,this.debug,n),o=xk(e,this.debug),i=bT(e,this.debug);return Pe(e,this.debug,function(){return e.attachShader(i,o)}),Pe(e,this.debug,function(){return e.attachShader(i,r)}),_T(e,this.debug,i),this.debug&&Qp(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Tk(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),null!=n&&Pe(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},t.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,null!=this.program&&this.debug&&Qp(this.gl,this.debug,this.program),Pe(this.gl,this.debug,function(){return e.gl.useProgram(n)})},t.prototype.getUniformLocation=function(n,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?IT(this.gl,this.debug,n,e):AT(this.gl,n,e)},t.prototype.getAttributeLocation=function(n,e){var r=this;return this.throwIfDisposed(),Pe(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,e)})},t.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},t.prototype.setInputMatrixTexture=function(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),MT(this.gl,this.debug,0,n,e,r)},t.prototype.setOutputMatrixTexture=function(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)},t.prototype.setOutputPackedMatrixTexture=function(n,e,r){this.throwIfDisposed();var o=Kd(e,r);this.setOutputMatrixTextureDriver(n,o[0],o[1])},t.prototype.setOutputMatrixWriteRegion=function(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Qp(this.gl,this.debug,this.program),Yd(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Pe(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Pe(this.gl,this.debug,function(){return n.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Zd(this.gl,this.debug,2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(n){return Be(this,void 0,void 0,function(){var e=this;return je(this,function(r){switch(r.label){case 0:return[4,p0(function(){return e.disposed||e.isQueryAvailable(n,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(n,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(n,e){if(0===e)return!0;if(2===e){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(n){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var n=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},t.prototype.addItemToPoll=function(n,e){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||p0(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Jp(this.gl,this.debug,n,this.framebuffer),this.debug&&Yd(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Jp(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Yd(this.gl)):R0(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var r=e();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(n,e,r){this.throwIfDisposed();var o=this.gl;Jp(o,this.debug,n,this.framebuffer),this.debug&&Yd(o),this.outputTexture=n,Pe(o,this.debug,function(){return o.viewport(0,0,e,r)}),Pe(o,this.debug,function(){return o.scissor(0,0,e,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(n,e,r,o){var i=this;this.throwIfDisposed(),Pe(this.gl,this.debug,function(){return i.gl.scissor(n,e,r,o)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function jk(t,n){if(t.length!==n.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+n.length+" inputs");t.forEach(function(e,r){var o=e.logicalShape,i=n[r],a=i.shape;if(!fr(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!fr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var K7=function(t,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var o=e.inChannels,i=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=s.left,h=s.top,p=o*e.filterWidth,g=Xr(),m="channelsLast"===d,v=m?0:1,b=m?1:2,w="",_=0;_<=1;_++)for(var x=0;x<=1;x++)w+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+_+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+n[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+n[b]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*_+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*_+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+w+"\n\n        "+g.output+" = result;\n      }\n    "},Z7=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[];var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Y7=function(t,n,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=e,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+n+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+n+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Q7=function(t,n,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=n,s=t[3]-1;this.outputShape=t;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},J7=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var o=t.effectiveFilterHeight,i=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-t.padInfo.top)+", "+(i-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},e9=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-t.padInfo.front)+", "+(u-1-t.padInfo.top)+", "+(c-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},n_=function(t,n,e,r,o,i,a){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((e?t[1]:t[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},t9=function(){function t(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;return function(r,o){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,n)}},t}(),n9=function(t,n,e,r){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},r9=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var s,c,l,n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=Mo("rc",n),r=Rn(n),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(n,t,e),i=function(s,u,c,l){if(1===s)return"";var d=l.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(n,t[t.length-1],t[t.length-2],e),a=(l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var m=(0===p?"r":"rp1")+", "+(0===g?"c":"cp1"),v=2;v<d;v++)m=f[f.length-1-v]+","+m;h.push(m)}return h}(c=(s=t).length,e),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},o9=function(t,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+t[c]+u[1]});var r=t.length,o=Rn(r),i=n.map(function(u){return u[0]}).join(","),a=n.map(function(u,c){return u[0]+t[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},i9=function(t,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(m,v){return m[0]+t[v]+m[1]});for(var r=t.length,o=Rn(r),i=n.map(function(m){return m[0]}).join(","),a=n.map(function(m,v){return m[0]+t[v]}).join(","),s=Mo("rc",r),u=Mo("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=1===r?2:4;p<g;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},r_=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var f="avg"===n,h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},o_=function(t,n,e){if(this.variableNames=["x"],"avg"===n&&e)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / count");var w=4*Math.floor(r/4),_=r%4,x="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+g+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},a9=function(t,n){this.variableNames=["x"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var a="0.0",s="";"prod"===n?a="1.0":"min"===n?(a="1.0 / 1e-20",s="min"):"max"===n&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?u="sumValue":"prod"===n?u="prodValue":"all"===n?u="allValue":"any"===n&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d="\n      if ("+("sum"===n)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===n)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===n?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";o%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},s9=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+gu(["r","c","d"],n)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+J0(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},u9=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},c9=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},l9=function(t,n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[1],a=t[2],s=t[3];this.outputShape=[t[0],n,e,s];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},d9=function(t,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},f9=function(t,n,e,r){this.variableNames=["A"],this.outputShape=[];var i=t[1],a=t[2];this.outputShape=[t[0],n,e,t[3]];var u=[r&&n>1?i-1:i,r&&e>1?a-1:a],c=[r&&n>1?n-1:n,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},h9=function(t,n){this.variableNames=["x"];var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=t,1!==e){var r=t.map(function(i,a){return-1!==n.indexOf(s=a)&&1!==t[s]?t[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=Rn(e);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},p9=function(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=t.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=t;var u,r=Mo("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],a=Rn(e);function s(u){var c=t.map(function(l,d){return h=u,-1!==n.indexOf(f=d)&&1!==t[f]?t[f]+" - "+h[f]+" - 1":""+h[f];var f,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Vk=function(t,n,e,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Rn(o.length),u=Rn(i.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+n+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(n>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},g9=function(t,n){this.variableNames=["x","segmentIds"];var e=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/e);this.outputShape=[r,a];var s=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%e>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},m9=function(t,n,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Rn(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},v9=function(){function t(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,r=Rn(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(1===a)return"sourceLoc";if(a<=6)return i_.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+n.map(function(a,s){return"sourceLoc."+i_[s]+" = start["+s+"] + coords."+i_[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),i_=["x","y","z","w","u","v"],y9=function(){function t(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=Rn(this.rank),r=Mo("coords",this.rank),o=Mo("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+n[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+n[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,n)}},t}(),b9=function(t,n,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=Rn(e.length),i=Rn(e.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+n+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},_9=function(){function t(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(n,e,r){var o,i=Uk(e,r),a=Hk(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===zo.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===zo.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===zo.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===zo.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===zo.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},t.prototype.releaseTexture=function(n,e,r,o){if(null!=this.freeTextures){var i=Hk(e,Uk(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var n=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){n.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Uk(t,n){if(t===Ho.UPLOAD)return zo.PACKED_2X2_FLOAT32;if(t===Ho.RENDER||null==t)return e=n,X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?zo.PACKED_2X2_FLOAT32:zo.UNPACKED_FLOAT32:e?zo.PACKED_2X2_FLOAT16:zo.UNPACKED_FLOAT16;var e;if(t===Ho.DOWNLOAD||t===Ho.PIXELS)return zo.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Hk(t,n,e){return t[0]+"_"+t[1]+"_"+n+"_"+e}var w9=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[r]*n[r];this.outputShape=e,this.rank=e.length;var o=Rn(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},x9=function(t,n){this.variableNames=["A"];for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];this.outputShape=e,this.rank=e.length;var o=Rn(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(n);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},C9=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=t[n[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Rn(this.rank),i=lk("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},a_=1.7580993408473768,s_=1.0507009873554805,Mt=function(t,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+n+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Fi="if (isnan(x)) return x;",zk="return abs(x);",Wk=Fi+"\n  return (x < 0.0) ? 0.0 : x;\n",$k=Fi+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Gk="return (x >= 0.0) ? x : (exp(x) - 1.0);",D9="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+a_+";\n  float scale = "+s_+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",qk="return -x;",Xk="return ceil(x);",Kk="return floor(x);",Zk="return exp(x);",Yk="return exp(x) - 1.0;",S9=Fi+"\n  return sin(x);\n",I9=Fi+"\n  return cos(x);\n",A9=Fi+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",M9=Fi+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",T9=Fi+"\n  return atan(x);\n",k9=Fi+"return log(x + sqrt(x * x + 1.0));",R9=Fi+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",N9=Fi+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",vg="return x;",Qk="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Jk="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",eR="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",cf=function(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},O9=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,e=Mo("rc",n),r=Rn(n),o=function(s,u){if(1===s)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(n,e),i=e.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},yg={};function bg(t,n){if(void 0===n&&(n=!1),"linear"===t)return"return x;";if("relu"===t)return n?Qk:Wk;if("elu"===t)return n?eR:Gk;if("relu6"===t)return n?Jk:$k;if("prelu"===t)return n?mk:gk;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var tR=function(t){function n(e){var r,o=t.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=oa(X().getNumber("WEBGL_VERSION"));o.binaryCache=((r=X().getNumber("WEBGL_VERSION"))in yg||(yg[r]={}),yg[r]),o.gpgpu=new Bk(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new _9(o.gpgpu),o.numMBBeforeWarning=null==X().global.screen?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*600/1024/1024,o.texData=new nk(o,N),o}return Ai(n,t),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,r,o){if(X().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===o&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Ho.UPLOAD}),i},n.prototype.move=function(e,r,o,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Ho.UPLOAD})},n.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,a=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new cf(u,vg):new Mt(u,vg);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=o)return this.convertAndCacheOnCPU(e);if("string"===i)return o;var h,p,g=null!=this.activeTimers;return g&&(h=Ti()),p="complex64"===i?K0(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),g&&(this.downloadWaitMs+=Ti()-h),this.convertAndCacheOnCPU(e,p)},n.prototype.read=function(e){return Be(this,void 0,void 0,function(){var r,o,i,a,u,c,l,d,f,h,p,g,m,v,b,x,D,R,k;return je(this,function(M){switch(M.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(T){return r.push(T)})];if(o=this.texData.get(e),i=o.values,a=o.shape,u=o.dtype,c=o.complexTensors,l=o.isPacked,null!=o.slice)return d=l?new cf(a,vg):new Mt(a,vg),f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===X().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&X().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),m=this.texData.get(g.dataId),p=(k=this.gpgpu).createBufferFromTexture.apply(k,[m.texture].concat(Xd(a)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:M.sent(),M.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=M.sent(),v=K0(b[0],b[1]),[3,5];case 4:null==p?v=this.getValuesFromTexture(e):(x=$e(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),M.label=5;case 5:return null!=g&&this.disposeData(g.dataId),D=this.convertAndCacheOnCPU(e,v),R=this.pendingRead.get(e),this.pendingRead.delete(e),R.forEach(function(T){return T(D)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,D]}})})},n.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var o=e[r];if(!gT(o))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.isPacked,u=$e(i);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(Xd(i))).subarray(0,u);return this.disposeData(c.dataId),d}var f=X().getBool("WEBGL_PACK")&&!0===s,h=f?eg(i):i,p=f?new V7(h):new j7(h),g=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:e}],"float32"),m=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),v},n.prototype.time=function(e){return Be(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return je(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,null==this.programTimersStack?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),a=Va(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),s=Va(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=ZM(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ti(),endMs:null}},n.prototype.endTimer=function(e){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ti(),e)},n.prototype.getQueryTime=function(e){return Be(this,void 0,void 0,function(){var r;return je(this,function(o){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),null!=o&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return X().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=N.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(i){return null==o.texData.get(i.dataId).texture&&i.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:N.keep(e.clone()),imag:N.keep(r.clone())},o},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(0===$e(o))return Hr([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,a=z0(e.shape,r,o);if(i||!a){var s=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new y9(o):new v9(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},n.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),a=this.makeOutput(o,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=e.dtype;var u=W0(r,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var a=lg(r,o,i);if(a.some(function(u){return 0===u}))return Hr([],a);var s=new b9(r,i,a);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,r){var o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p9(e.shape,r):new h9(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var o=e.map(function(h){return ui(h)}),i=e.map(function(h){return aa(h)});return Ur(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),r),u=this.concat(e.slice(a),r);return this.concat([s,u],r)}if(X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new D7(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=lu(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,$e(h.shape.slice(r)))}),f=new E7(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,qk,e.dtype);var r=new Mt(e.shape,qk);return this.compileAndRun(r,[e])},n.prototype.batchMatMul=function(e,r,o,i){var a=o?e.shape[2]:e.shape[1],s=i?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((1===a||1===s)&&u>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=1===s?e:e.as3D(c,u,1),d=1===s?2:1,f=1===s?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Ir(e.dtype,r.dtype),p=new n_(e.shape,[c,a,s],o,i);return this.compileAndRun(p,[e,r],h)},n.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Ir(r.dtype,o.dtype),p=null!=s,g=null!=c,m=u?bg(u,!0):null,v=new n_(r.shape,[f,l,d],i,a,p,m,g),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(v,b,h)},n.prototype.multiply=function(e,r){if("complex64"===e.dtype){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),a=new hk("return areal * breal - aimag * bimag;",e.shape,r.shape),s=new hk("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,pk,e.dtype);var f=new nr(pk,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){var u=[e,r,o],c=null;null!=s&&(c=s.shape,u.push(s));var l=null;if(null!=a&&(l=a.shape,u.push(a)),X().getBool("WEBGL_PACK_NORMALIZATION")){var d=new y7(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)}var f=new v7(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){var s=X().getBool("WEBGL_PACK_NORMALIZATION")?new Q7(e.shape,r,o,i,a):new Z7(e.shape,r,o,i,a);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){var c=new Y7(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,e])},n.prototype.tile=function(e,r){if("string"===e.dtype){var o=this.readSync(e.dataId).map(function(a){return Hd(a)});return uk(Et(e.shape,e.dtype,o),r)}var i=new w9(e.shape,r);return this.compileAndRun(i,[e])},n.prototype.pad=function(e,r,o){var i=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new i9(e.shape,r,o):new o9(e.shape,r,o);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new C9(e.shape,r):new x9(e.shape,r);return this.compileAndRun(o,[e])},n.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new G7(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},n.prototype.batchToSpaceND=function(e,r,o){A(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=ag(e.shape,r,i),s=sg(a.length,r.length),u=ug(e.shape,r,i),c=KT(o,r.length),l=ZT(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){A(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=ag(u.shape,r,i,!1),l=sg(c.length,r.length,!1),d=ug(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,r,o){var i=e.shape[0],a=e.shape[1],s=cg(a),u=new a9({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[e],o);return 1===c.shape[1]?c:this.reduce(c,r,o)},n.prototype.argReduce=function(e,r,o){void 0===o&&(o=null);var i=e.shape[0],a=e.shape[1];null!=o&&(i=o.shape[0],a=o.shape[1]);var s=cg(a),u=new u7({windowSize:s,inSize:a,batchSize:i},r,null==o),c=[e];null!=o&&c.push(o);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,r,l)},n.prototype.argReducePacked=function(e,r,o){void 0===o&&(o=null);var i=null!=o?o.shape:e.shape,a=cg(i[i.length-1]),s=new p7(i,a,r,null==o),c=this.compileAndRun(s,null==o?[e]:[e,o],"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},n.prototype.sum=function(e,r){Io("sum",r,e.rank);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a),u=S0(e.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a),u=S0(e.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(e,r,o){var i=0,a=ki([i],e.rank),s=e;null!=a&&(s=e.transpose(a),i=Ri(1,e.rank)[0]);var u=function(h,p,g){for(var m=[],v=h.length,b=0;b<v;b++)m.push(b!==p?h[b]:g);return m}(s.shape,i,o),c=$e([s.shape[i]]),l=s.as2D(-1,c),d=S0(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,o).reshape(u);return null!=a&&(f=f.transpose(rg(a))),f},n.prototype.segOpCompute=function(e,r,o,i,a){var s=e.shape[0],u=e.shape[1],c=function(f,h){var p,g=!1;for(f<=30?(p=f,g=!0):p=Xp(f,Math.floor(Math.sqrt(f)));!g;)p>h||p===f?g=!0:p=Xp(f,p+1);return p}(u,a),l=new g9({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),d=this.compileAndRun(l,[e,o],i);return d.shape[1]===a?d:(o=og(0,a).tile([u/c]),this.segOpCompute(d,r,o,i,a))},n.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(Io("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!X().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=Vr(e.shape,i),s=a[0],u=$e(a[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},n.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},n.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},n.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var a=new F7(e.shape,o,i);return this.compileAndRun(a,[e])},n.prototype.equal=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var o=new nr("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.notEqual=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var o=new nr("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var o=new nr("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.lessEqual=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new nr("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new nr("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.greaterEqual=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new nr("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalNot=function(e){var r=new Mt(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},n.prototype.logicalAnd=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new nr("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.logicalOr=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new nr("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},n.prototype.select=function(e,r,o){var i=new m9(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Ir(r.dtype,o.dtype))},n.prototype.where=function(e){ng("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return Q0(e.shape,r)},n.prototype.topk=function(e,r,o){return ck(e.dataSync(),e.shape,e.dtype,r)},n.prototype.min=function(e,r){Io("min",r,e.rank);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new nr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.mod=function(e,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new nr("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);Io("max",r,e.rank);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new nr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.all=function(e,r){Io("all",r,e.rank);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,r){Io("any",r,e.rank);var o=Vr(e.shape,r),i=o[0],a=$e(o[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var o=new nr("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},n.prototype.floorDiv=function(e,r){if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new nr("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},n.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,e_);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Ir(e.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,e_,o);var i=new nr(e_,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.packedUnaryOp=function(e,r,o){var i=new cf(e.shape,r);return this.compileAndRun(i,[e],o)},n.prototype.packedBinaryOp=function(e,r,o,i,a){void 0===a&&(a=!1);var s=new $a(o,e.shape,r.shape,a);return this.compileAndRun(s,[e,r],i)},n.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,a=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],g=i.makeComplexComponentTensorInfo(e,h),m=i.makeComplexComponentTensorInfo(r,p),v=new nr(o,e.shape,r.shape);return i.compileAndRun(v,[g,m],Ir(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},n.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>X().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var a=e.map(function(c){return c.dtype}).reduce(function(c,l){return Ir(c,l)}),s=e.map(function(c){return c.shape}),u=X().getBool("WEBGL_PACK")?new s7(e[0].shape,s):new a7(e[0].shape,s);return this.compileAndRun(u,e,a)},n.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,t_);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Ir(e.dtype,r.dtype);if(X().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,t_,e.dtype);var i=new nr(t_,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},n.prototype.pow=function(e,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new nr("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),i=Ir(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Xk,e.dtype);var r=new Mt(e.shape,Xk);return this.compileAndRun(r,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Kk,e.dtype);var r=new Mt(e.shape,Kk);return this.compileAndRun(r,[e])},n.prototype.sign=function(e){var r=new Mt(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},n.prototype.isNaN=function(e){var r=new Mt(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isInf=function(e){var r=new Mt(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.isFinite=function(e){var r=new Mt(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},n.prototype.round=function(e){var r=new Mt(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Zk,e.dtype);var r=new Mt(e.shape,Zk);return this.compileAndRun(r,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Yk,e.dtype);var r=new Mt(e.shape,Yk);return this.compileAndRun(r,[e])},n.prototype.softmax=function(e,r){var o=hr([r],e.shape),i=this.max(e,o),a=lo(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new Mt(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},n.prototype.log1p=function(e){var r=new Mt(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},n.prototype.sqrt=function(e){var r=new Mt(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Mt(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},n.prototype.reciprocal=function(e){var r=new Mt(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},n.prototype.relu=function(e){var r;return r=X().getBool("WEBGL_PACK")?new cf(e.shape,Qk):new Mt(e.shape,Wk),this.compileAndRun(r,[e])},n.prototype.relu6=function(e){var r;return r=X().getBool("WEBGL_PACK")?new cf(e.shape,Jk):new Mt(e.shape,$k),this.compileAndRun(r,[e])},n.prototype.prelu=function(e,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a(mk,e.shape,r.shape):new nr(gk,e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.elu=function(e){if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,eR,e.dtype);var r=new Mt(e.shape,Gk);return this.compileAndRun(r,[e])},n.prototype.eluDer=function(e,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new nr("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.selu=function(e){var r=new Mt(e.shape,D9);return this.compileAndRun(r,[e])},n.prototype.int=function(e){var r=new Mt(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},n.prototype.clip=function(e,r,o){var i,a=(i=X().getBool("WEBGL_PACK_CLIP")?new x7(e.shape):new w7(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,a)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,zk,e.dtype);var r=new Mt(e.shape,zk);return this.compileAndRun(r,[e])},n.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new C7(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(e){var r=new Mt(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},n.prototype.softplus=function(e){var r=new Mt(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},n.prototype.sin=function(e){var r=new Mt(e.shape,S9);return this.compileAndRun(r,[e])},n.prototype.cos=function(e){var r=new Mt(e.shape,I9);return this.compileAndRun(r,[e])},n.prototype.tan=function(e){var r=new Mt(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},n.prototype.asin=function(e){var r=new Mt(e.shape,A9);return this.compileAndRun(r,[e])},n.prototype.acos=function(e){var r=new Mt(e.shape,M9);return this.compileAndRun(r,[e])},n.prototype.atan=function(e){var r=new Mt(e.shape,T9);return this.compileAndRun(r,[e])},n.prototype.atan2=function(e,r){var o=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new nr("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},n.prototype.sinh=function(e){var r=new Mt(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.cosh=function(e){var r=new Mt(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},n.prototype.tanh=function(e){var r=new Mt(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},n.prototype.asinh=function(e){var r=new Mt(e.shape,k9);return this.compileAndRun(r,[e])},n.prototype.acosh=function(e){var r=new Mt(e.shape,R9);return this.compileAndRun(r,[e])},n.prototype.atanh=function(e){var r=new Mt(e.shape,N9);return this.compileAndRun(r,[e])},n.prototype.erf=function(e){var r=new Mt(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},n.prototype.step=function(e,r){var i,o=new Mt(e.shape,(void 0===(i=r)&&(i=0),Fi+"\n    return x > 0.0 ? 1.0 : float("+i+");\n  "));return this.compileAndRun(o,[e])},n.prototype.conv2dByMatMul=function(e,r,o,i,a,s){var u=e.shape,c=this.texData.get(e.dataId),h="channelsLast"===o.dataFormat,g=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!X().getBool("WEBGL_LAZILY_UNPACK")||!X().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var v=this.reshape(e,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var _={dataId:e.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:e.dtype},x=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,A(ef(c.shape,_.shape),function(){return"packed reshape "+c.shape+" to "+_.shape+" isn't free"});var D=this.reshape(r,[1,o.inChannels,o.outChannels]),R=this.fusedBatchMatMul({a:_,b:D,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),k=this.texData.get(R.dataId);return A(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=x,k.shape=o.outShape,N.makeTensorFromDataId(R.dataId,o.outShape,R.dtype)},n.prototype.conv2dWithIm2Row=function(e,r,o,i,a,s){var d=o.outWidth,f=o.outHeight,h="channelsLast"===o.dataFormat,p=o.filterWidth*o.filterHeight*o.inChannels,g=f*d,m=[p,g],v=e.squeeze([0]),b=r.reshape([1,p,-1]),w=new K7(m,v.shape,o),_=this.compileAndRun(w,[v]).reshape([1,m[0],m[1]]),x=null!=i,D=null!=s,R=a?bg(a,!0):null,k=new n_(_.shape,[1,g,o.outChannels],!0,!1,x,R,D),M=[_,b];return i&&M.push(i),D&&M.push(s),this.compileAndRun(k,M).reshape(h?[1,f,d,o.outChannels]:[1,o.outChannels,f,d])},n.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(r,o,i,a,s,u);if(X().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=null!=a,l=null!=u,d=s?bg(s,!1):null,f=new vk(i,c,d,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},n.prototype.conv2d=function(e,r,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(e,r,o);if(X().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,o);var i=new vk(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerInput=function(e,r,o){var i=new I7(o);return this.compileAndRun(i,[e,r])},n.prototype.conv2dDerFilter=function(e,r,o){var i=new S7(o);return this.compileAndRun(i,[e,r])},n.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?bg(u,l):null,f=[o,i],h=null!=s,p=null!=c;return h&&f.push(s),p&&f.push(c),l?(r=new bk(a,h,d,p),this.compileAndRun(r,f)):(r=new yk(a,h,d,p),this.compileAndRun(r,f))},n.prototype.depthwiseConv2D=function(e,r,o){var i;return X().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new bk(o),this.compileAndRun(i,[e,r])):(i=new yk(o),this.compileAndRun(i,[e,r]))},n.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new k7(o);return this.compileAndRun(i,[e,r])},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new T7(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3d=function(e,r,o){var i=new R7(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerInput=function(e,r,o){var i=new M7(o);return this.compileAndRun(i,[e,r])},n.prototype.conv3dDerFilter=function(e,r,o){var i=new A7(o);return this.compileAndRun(i,[e,r])},n.prototype.maxPool=function(e,r){var o=new r_(r,"max",!1);return this.compileAndRun(o,[e])},n.prototype.avgPool=function(e,r){var o=new r_(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPoolBackprop=function(e,r,o,i){var a=new r_(i,"max",!0),s=this.compileAndRun(a,[r]),u=new J7(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,r,o){var i=new g7(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.cast=function(e,r){return q0(e,r,this)},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.avgPool3d=function(e,r){var o=new o_(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,r,o){var i=new m7(o);return this.compileAndRun(i,[e],r.dtype)},n.prototype.maxPool3d=function(e,r){var o=new o_(r,"max",!1);return this.compileAndRun(o,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,r,o,i){var a=new o_(i,"max",!0),s=this.compileAndRun(a,[r]),u=new e9(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!ef(e.shape,r)&&(null===o.texture||!ef(o.shape,r))){var i=this.packedReshape(e,r);return N.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return gg(e,r)},n.prototype.resizeBilinear=function(e,r,o,i){var a=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new l9(e.shape,r,o,i):new c9(e.shape,r,o,i);return this.compileAndRun(a,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,r,o){var i=new u9(e,r,o);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,r,o,i){var a=new f9(e.shape,r,o,i);return this.compileAndRun(a,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new d9(e,r,o);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,r,o,i){var a=r?e:za(e),c=new t9(a.shape[0],a.shape[1],o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(e,r,o,i){var a=new n9(e.size,r,o,i);return this.compileAndRun(a,[e])},n.prototype.diag=function(e){var r=new B7(e.size);return this.compileAndRun(r,[e])},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return ng("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Z0(e.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(e,r,o,i,a,s){var u=new N7(e.shape,r.shape,i,a,s);return this.compileAndRun(u,[e,r,o],"float32")},n.prototype.depthToSpace=function(e,r,o){A(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],c=("NHWC"===o?e.shape[1]:e.shape[2])*r,l=("NHWC"===o?e.shape[2]:e.shape[3])*r,d=("NHWC"===o?e.shape[3]:e.shape[1])/(r*r),f=new L7("NHWC"===o?[i,c,l,d]:[i,d,c,l],r,o);return this.compileAndRun(f,[e])},n.prototype.split=function(e,r,o){return sk(e,r,o)},n.prototype.scatterND=function(e,r,o){var i=nf(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],f=e.reshape([s,a]),h=r.reshape([s,u]);if(0===l)return gg(Hr([]),o);var p=Ce(0),g=new Vk(s,a,f.rank,h.rank,c,d);return this.compileAndRun(g,[h,f,p]).reshape(o)},n.prototype.sparseToDense=function(e,r,o,i){var a=nf(0,e,o),d=new Vk(a.numUpdates,a.sliceRank,e.rank,r.rank,a.strides,[a.outputSize,1],!1);return this.compileAndRun(d,[r,e,i]).reshape(o)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new wk("return real * expR - imag * expI;",e.shape,r),a=new wk("return real * expI + imag * expR;",e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=V0(e,r),s=a[0],u=a[1],c=a[2],l=a[3],d=r.reshape([u,i]),f=e.reshape([e.size/c,c]),h=new q7(i,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(s)},n.prototype.fill=function(e,r,o){if("string"===(o=o||Vc(r))){var i=Ud(o,$e(e));return i.fill(r),N.makeTensor(i,e,o,this)}var a=new $7(e,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},n.prototype.linspace=function(e,r,o){return X0(e,r,o)},n.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},n.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return N.makeTensorFromDataId(o,e,r,this)},n.prototype.unpackTensor=function(e){var r=new O9(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},n.prototype.packTensor=function(e){var r=new r9(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,r){var o=[Qd(e.shape)].concat(Jd(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},a=[Qd(r)].concat(Jd(r)),s=new s9(a,o),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,a=o.shape,s=o.dtype,u=eg(a);return r=i?new P7(u):new O7(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,r,o,i,a){var s=this;void 0===a&&(a=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===qd.DENSE){var l=Xd(e.outputShape);c.texShape=l.map(function(w){return 2*w})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===$e(u.shape))return c.values=jc(u.dtype,0),u;var d=[],f=r.map(function(w){if("complex64"===w.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _=s.texData.get(w.dataId);if(null==_.texture){if(!e.packedInputs&&$e(w.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:_.values};e.packedInputs&&(_.isPacked=!0,_.shape=w.shape)}else if(!!_.isPacked!=!!e.packedInputs)w=_.isPacked?s.unpackTensor(w):s.packTensor(w),d.push(w),_=s.texData.get(w.dataId);else if(_.isPacked&&!ef(_.shape,w.shape)){var x=w,D=w.shape;w.shape=_.shape,w=s.packedReshape(w,D),d.push(w),_=s.texData.get(w.dataId),x.shape=D}return s.uploadToGPU(w.dataId),{shape:w.shape,texData:_,isUniform:!1}});this.uploadToGPU(u.dataId);var h,w,D,p={shape:u.shape,texData:c,isUniform:!1},g=(w=e,D="",f.concat(p).forEach(function(M){D+=M.shape+"_"+(M.isUniform?"uniform":M.texData.texShape)+"_"+(null!=M.texData&&null!=M.texData.slice&&M.texData.slice.flatOffset>0)}),w.constructor.name+"_"+D+"_"+w.userCode),m=this.getAndSaveBinary(g,function(){return function(w,_,x,D){var R=_.userCode,k=x.map(function(ee,ue){var he={logicalShape:ee.shape,texShape:ee.isUniform?null:ee.texData.texShape,isUniform:ee.isUniform,isPacked:!ee.isUniform&&ee.texData.isPacked,flatOffset:null};return null!=ee.texData&&null!=ee.texData.slice&&ee.texData.slice.flatOffset>0&&(he.flatOffset=ee.texData.slice.flatOffset),{name:_.variableNames[ue],shapeInfo:he}}),M=k.map(function(ee){return ee.shapeInfo}),T={logicalShape:D.shape,texShape:D.texData.texShape,isUniform:!1,isPacked:D.texData.isPacked,flatOffset:null},B=c7(k,T,R,_.packedInputs),P=w.createProgram(B),Q=null,Z=w.getUniformLocation(P,"NAN",!1);1===X().getNumber("WEBGL_VERSION")&&(Q=w.getUniformLocation(P,"INFINITY",!1));for(var Y={},se=0;se<_.variableNames.length;se++){var ne=_.variableNames[se];Y[ne]=w.getUniformLocation(P,ne,!1),Y["offset"+ne]=w.getUniformLocation(P,"offset"+ne,!1)}return{program:_,source:B,webGLProgram:P,uniformLocations:Y,inShapeInfos:M,outShapeInfo:T,infLoc:Q,nanLoc:Z}}(s.gpgpu,e,f,p)}),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),function(w,_,x,D,R){jk(_.inShapeInfos,x),jk([_.outShapeInfo],[D]);var k=D.texData.texture,M=D.texData.texShape;D.texData.isPacked?w.setOutputPackedMatrixTexture(k,M[0],M[1]):w.setOutputMatrixTexture(k,M[0],M[1]),w.setProgram(_.webGLProgram),1===X().getNumber("WEBGL_VERSION")&&null!==_.infLoc&&w.gl.uniform1f(_.infLoc,1/0),null!==_.nanLoc&&w.gl.uniform1f(_.nanLoc,NaN),x.forEach(function(T,B){var P=_.program.variableNames[B],Q=_.uniformLocations[P],Z=_.uniformLocations["offset"+P];if(null!=Q)if(T.isUniform)if($e(T.shape)<2)w.gl.uniform1f(Q,T.uniformValues[0]);else{var Y=T.uniformValues;Y instanceof Float32Array||(Y=new Float32Array(Y)),w.gl.uniform1fv(Q,Y)}else null!=T.texData.slice&&null!=Z&&w.gl.uniform1i(Z,T.texData.slice.flatOffset),w.setInputMatrixTexture(T.texData.texture,Q,B)}),R?.(w,_.webGLProgram),w.executeProgram()}(this.gpgpu,m,f,p,i),d.forEach(function(w){return s.disposeData(w.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!X().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(e,r,o,i,a){void 0===a&&(a=!1);var s=this.runWebGLProgram(e,r,o=o||r[0].dtype,i,a);return N.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Fe(function(){if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=X().getBool("DEBUG");X().set("DEBUG",!1);var o=e.abs(Ce(1e-8)).dataSync()[0];if(X().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.values,c=o.usage,l=o.isPacked;if(null==o.texture){var d,f=null!=this.activeTimers;f&&(d=Ti());var h=o.texShape;if(null==h&&(h=RT(i,l),o.texShape=h),null!=s){var p=eg(i),g=void 0,m=h[1],v=h[0],b=s instanceof Uint8Array;l?(m=(r=Kd(h[0],h[1]))[0],g=new H7(p,[v=r[1],m],b)):g=new U7(p,[v,m],b);var w=this.makeTensorInfo([v,m],a);this.texData.get(w.dataId).usage=b?Ho.PIXELS:Ho.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,v,s);var _=this.runWebGLProgram(g,[w],a,null,!0),x=this.texData.get(_.dataId);o.texture=x.texture,o.texShape=x.texShape,o.isPacked=x.isPacked,o.usage=x.usage,this.disposeData(w.dataId),this.texData.delete(_.dataId),o.values=null,f&&(this.uploadWaitMs+=Ti()-d)}else{var D=this.acquireTexture(h,c,a,l);o.texture=D}}},n.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),null!=r&&(o.values=function(a,s){if("float32"===s||"complex64"===s)return a;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},n.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},n.prototype.computeBytes=function(e,r){return e[0]*e[1]*g0(r)},n}(rk);hT()&&N.registerBackend("webgl",function(){return new tR},2);var L9=F({square_:function(t){var n=S(t,"x","square");return N.runKernelFunc(function(r,o){return o([n]),r.square(n)},{x:n},null,"Square",{},[n],[])}}),lf="SquaredDifference",nR=F({squaredDifference_:function(t,n){var e,r=S(t,"a","squaredDifference"),o=S(n,"b","squaredDifference");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=Ce(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},lf,{},[r,o],[])}}),B9=F({abs_:function(t){var n=S(t,"x","abs");return"complex64"===n.dtype?N.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):N.runKernelFunc(function(e,r){var o=e.abs(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),j9=F({acos_:function(t){var n=S(t,"x","acos");return N.runKernelFunc(function(e,r){var o=e.acos(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Ce(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),V9=F({acosh_:function(t){var n=S(t,"x","acosh");return N.runKernelFunc(function(e,r){var o=e.acosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),U9=F({asin_:function(t){var n=S(t,"x","asin");return N.runKernelFunc(function(e,r){var o=e.asin(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Ce(1).sub(o.toFloat().square()).sqrt())}}})}}),H9=F({asinh_:function(t){var n=S(t,"x","asinh");return N.runKernelFunc(function(e,r){var o=e.asinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(Ce(1).add(o.toFloat().square()).sqrt())}}})}}),z9=F({atan_:function(t){var n=S(t,"x","atan");return N.runKernelFunc(function(e,r){var o=e.atan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),W9=F({atanh_:function(t){var n=S(t,"x","atanh");return N.runKernelFunc(function(e,r){var o=e.atanh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(Ce(1).sub(o.toFloat().square()))}}})}}),$9=F({ceil_:function(t){var n=S(t,"x","ceil");return N.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),u_=F({clipByValue_:function(t,n,e){var r=S(t,"x","clipByValue");return A(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."}),N.runKernelFunc(function(a,s){var u=a.clip(r,n,e);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),Qt(a))}}},"ClipByValue",{min:n,max:e},[r])}}),G9=F({cos_:function(t){var n=S(t,"x","cos");return N.runKernelFunc(function(r,o){var i=r.cos(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},[n])}}),q9=F({cosh_:function(t){var n=S(t,"x","cosh");return N.runKernelFunc(function(e,r){var o=e.cosh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),X9=F({erf_:function(t){var n=S(t,"x","erf");return A("int32"===n.dtype||"float32"===n.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===n.dtype&&(n=n.toFloat()),N.runKernelFunc(function(e,r){var o=e.erf(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),c_=F({exp_:function(t){var n=S(t,"x","exp");return N.runKernelFunc(function(e,r){var o=e.exp(n);return r([o]),o},{x:n},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),K9=F({expm1_:function(t){var n=S(t,"x","expm1");return N.runKernelFunc(function(e,r){var o=e.expm1(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),Z9=F({floor_:function(t){var n=S(t,"x","floor");return N.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),Y9=F({log_:function(t){var n=S(t,"x","log");return N.runKernelFunc(function(r,o){var i=r.log(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},[n])}}),Q9=F({log1p_:function(t){var n=S(t,"x","log1p");return N.runKernelFunc(function(e,r){var o=e.log1p(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),J9=F({logSigmoid_:function(t){var n=S(t,"x","logSigmoid");return N.runKernelFunc(function(e,r){var o=e.softplus(n.neg()).neg();return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),_g=F({neg_:function(t){var n=S(t,"x","neg");return N.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},[n])}}),eX=F({reciprocal_:function(t){var n=S(t,"x","reciprocal");return N.runKernelFunc(function(e,r){var o=e.reciprocal(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),tX=F({round_:function(t){var n=S(t,"x","round");return N.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),rR=F({rsqrt_:function(t){var n=S(t,"x","rsqrt");return N.runKernelFunc(function(r,o){var i=r.rsqrt(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[n])}}),oR=F({sigmoid_:function(t){var n=S(t,"x","sigmoid");return N.runKernelFunc(function(e,r){var o=e.sigmoid(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(Ce(1).sub(o)))}}},"Sigmoid")}}),nX=F({sign_:function(t){var n=S(t,"x","sign");return N.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),rX=F({isNaN_:function(t){var n=S(t,"x","isNaN");return N.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),oX=F({isInf_:function(t){var n=S(t,"x","isInf");return N.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),iX=F({isFinite_:function(t){var n=S(t,"x","isFinite");return N.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return Qt(e)}}})}}),aX=F({sin_:function(t){var n=S(t,"x","sin");return N.runKernelFunc(function(r,o){var i=r.sin(n);return o([n]),i},{x:n},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},[n])}}),sX=F({sinh_:function(t){var n=S(t,"x","sinh");return N.runKernelFunc(function(e,r){var o=e.sinh(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),uX=F({softplus_:function(t){var n=S(t,"x","softplus");return N.runKernelFunc(function(e,r){var o=e.softplus(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),cX=F({sqrt_:function(t){var n=S(t,"x","sqrt");return N.runKernelFunc(function(e,r){var o=e.sqrt(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),lX=F({step_:function(t,n){void 0===n&&(n=0);var e=S(t,"x","step");return N.runKernelFunc(function(r){return r.step(e,n)},{$x:e},function(r){return{$x:function(){return Qt(r)}}})}}),dX=F({tan_:function(t){var n=S(t,"x","tan");return N.runKernelFunc(function(e,r){var o=e.tan(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),fX=F({tanh_:function(t){var n=S(t,"x","tanh");return N.runKernelFunc(function(e,r){var o=e.tanh(n);return r([o]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return Ce(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function iR(t,n,e,r,o,i){var a,s,u=S(t,"x","batchNorm"),c=S(n,"mean","batchNorm"),l=S(e,"variance","batchNorm");return null!=o&&(a=S(o,"scale","batchNorm")),null!=r&&(s=S(r,"offset","batchNorm")),A(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),A(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),A(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&A(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&A(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),df(u,c,l,s,a,i)}function aR(t,n,e,r,o,i){var a,s,u=S(t,"x","batchNorm"),c=S(n,"mean","batchNorm"),l=S(e,"variance","batchNorm");return null!=o&&(a=S(o,"scale","batchNorm")),null!=r&&(s=S(r,"offset","batchNorm")),A(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),A(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),A(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&A(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&A(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),df(u,c,l,s,a,i)}function sR(t,n,e,r,o,i){var a,s,u=S(t,"x","batchNorm"),c=S(n,"mean","batchNorm"),l=S(e,"variance","batchNorm");return null!=o&&(a=S(o,"scale","batchNorm")),null!=r&&(s=S(r,"offset","batchNorm")),A(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),A(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),A(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&A(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&A(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),df(u,c,l,s,a,i)}function df(t,n,e,r,o,i){null==i&&(i=.001);var a,s,u,c=S(t,"x","batchNorm"),l=S(n,"mean","batchNorm"),d=S(e,"variance","batchNorm");return null!=o&&(a=S(o,"scale","batchNorm")),null!=r&&(s=S(r,"offset","batchNorm")),A(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),A(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),A(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,N.runKernelFunc(function(h,p){var g=h.batchNormalization(u,wg(l),wg(d),i,wg(a),wg(s));return p([c,l,d,a]),g},{x:c,mean:l,variance:d,scale:a,offset:s},function(h,p){var m=p[0],v=p[1],b=p[2],_=p[3]??Ce(1),x=gr(v.shape,u.shape),D=[];if(1===v.rank){for(var R=0;R<u.shape.length-1;++R)D.push(u.shape[R]);D.push(1)}var k=m.sub(v),M=h.mul(_),T=rR(b.add(Ce(i))),B=T.mul(T).mul(T).mul(Ce(-.5));return{x:function(){return 1===v.rank?h.mul(Wc(T.as4D(1,1,1,v.shape[0]),D)).mul(_).reshape(m.shape):h.mul(T).mul(_).reshape(m.shape)},mean:function(){var P=T.mul(Ce(-1)).mul(M);return 1===v.rank&&(P=P.sum(x)),P.reshape(v.shape)},variance:function(){var P=B.mul(k).mul(M);return 1===v.rank&&(P=P.sum(x)),P.reshape(v.shape)},scale:function(){var P=k.mul(T),Q=h.mul(P);return 1===v.rank&&(Q=Q.sum(x)),Q.reshape(v.shape)},offset:function(){var P=h;return 1===v.rank&&(P=P.sum(x)),P.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:i},[c,l,d,a]).reshape(c.shape)}function wg(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function xg(){jT("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var hX=F({batchNormalization2d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),xg(),iR(t,n,e,i,o,r)}}),pX=F({batchNormalization3d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),xg(),aR(t,n,e,i,o,r)}}),gX=F({batchNormalization4d_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),xg(),sR(t,n,e,i,o,r)}}),mX=F({batchNormalization_:function(t,n,e,r,o,i){return void 0===r&&(r=.001),xg(),df(t,n,e,i,o,r)}}),uR=F({batchNorm_:df}),vX=F({batchNorm2d_:iR}),yX=F({batchNorm3d_:aR}),bX=F({batchNorm4d_:sR}),Cg=F({logicalAnd_:function(t,n){var e=S(t,"a","logicalAnd","bool"),r=S(n,"b","logicalAnd","bool");return Ot(e.shape,r.shape),N.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),_X=F({logicalNot_:function(t){var n=S(t,"x","logicalNot","bool");return N.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),cR=F({logicalOr_:function(t,n){var e=S(t,"a","logicalOr","bool"),r=S(n,"b","logicalOr","bool");return Ot(e.shape,r.shape),N.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),wX=F({logicalXor_:function(t,n){var e=S(t,"a","logicalXor","bool"),r=S(n,"b","logicalXor","bool");return Ot(e.shape,r.shape),cR(t,n).logicalAnd(Cg(t,n).logicalNot())}}),vu=F({where_:function(t,n,e){var r=S(n,"a","where"),o=S(e,"b","where"),i=S(t,"condition","where","bool");return Yt(r.shape,o.shape,"Error in where: "),1===i.rank?A(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Yt(i.shape,o.shape,"Error in where: "),N.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Qt(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),lR=function(t){return Be(this,void 0,void 0,function(){var n,e,r;return je(this,function(o){switch(o.label){case 0:return[4,(n=S(t,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=Q0(n.shape,e),t!==n&&n.dispose(),[2,r]}})})},Pt=F({add_:function(t,n){var e,r=S(t,"a","add"),o=S(n,"b","add");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=gr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=gr(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),xX=F({addN_:function(t){A(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),A(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var n=t.map(function(o,i){return S(o,"tensors"+i,"addN")}),e=n[0];return n.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(o){if(!fr(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),N.runKernelFunc(function(o){return o.addN(n)},n,function(o){var i={};return n.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),CX=F({addStrict_:function(t,n){var e=S(t,"a","addStrict"),r=S(n,"b","addStrict");return Yt(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),EX=F({atan2_:function(t,n){var e,r=S(t,"a","atan2"),o=S(n,"b","atan2");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Pt(u.square(),c.square()),d=a.mul(c.div(l)),f=gr(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Pt(u.square(),c.square()),d=_g(a.mul(u.div(l))),f=gr(c.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),Oi=F({div_:function(t,n){var e,r=S(t,"a","div"),o=S(n,"b","div");if(e=Un(r,o),o=e[1],"int32"===(r=e[0]).dtype&&"int32"===o.dtype)return dR(r,o);var i=Ot(r.shape,o.shape);return N.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=gr(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=gr(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),DX=F({divNoNan_:function(t,n){var e,r=S(t,"a","div"),o=S(n,"b","div");r=(e=Un(r,o))[0];var i=Oi(r,o=e[1]),a=Qt(i),s=o.equal(a);return vu(s,a,i)}}),SX=F({divStrict_:function(t,n){var e=S(t,"a","div"),r=S(n,"b","div");return Yt(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),dR=F({floorDiv_:function(t,n){var e,r=S(t,"a","floorDiv"),o=S(n,"b","floorDiv");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=gr(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=gr(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),l_=F({maximum_:function(t,n){var e,r=S(t,"a","maximum"),o=S(n,"b","maximum");return e=Un(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ot(r.shape,o.shape),N.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),IX=F({maximumStrict_:function(t,n){var e=S(t,"a","maximumStrict"),r=S(n,"b","maximumStrict");return Yt(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),fR=F({minimum_:function(t,n){var e,r=S(t,"a","minimum"),o=S(n,"b","minimum");return e=Un(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ot(r.shape,o.shape),N.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),AX=F({minimumStrict_:function(t,n){var e=S(t,"a","minimumStrict"),r=S(n,"b","minimumStrict");return Yt(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),MX=F({mod_:function(t,n){var e,r=S(t,"a","mod"),o=S(n,"b","mod");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=gr(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),d=gr(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),TX=F({modStrict_:function(t,n){var e=S(t,"a","modStrict"),r=S(n,"b","modStrict");return Yt(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),Kr=F({mul_:function(t,n){var e,r=S(t,"a","mul"),o=S(n,"b","mul");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),d=gr(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=gr(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),kX=F({mulStrict_:function(t,n){var e=S(t,"a","mul"),r=S(n,"b","mul");return Yt(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),Eg=F({pow_:function(t,n){var e,r=S(t,"base","pow"),o=S(n,"exp","pow");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=s.mul(f.mul(c.pow(f.sub(Ce(1))))),p=gr(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,Qt(c)),p=s.mul(d.mul(h)),g=gr(l.shape,i);return g.length>0&&(p=p.sum(g)),p.reshape(l.shape)}}},"Pow",{},[r,o],[!0])}}),RX=F({powStrict_:function(t,n){return Yt(t.shape,n.shape,"Error in powStrict: "),t.pow(n)}}),NX=F({squaredDifferenceStrict_:function(t,n){var e=S(t,"a","squaredDifferenceStrict"),r=S(n,"b","squaredDifferenceStrict");return Yt(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Cr=F({sub_:function(t,n){var e,r=S(t,"a","sub"),o=S(n,"b","sub");e=Un(r,o);var i=Ot((r=e[0]).shape,(o=e[1]).shape);return N.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=gr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=gr(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),FX=F({subStrict_:function(t,n){var e=S(t,"a","subStrict"),r=S(n,"b","subStrict");return Yt(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),hR=F({equal_:function(t,n){var e,r=S(t,"a","equal"),o=S(n,"b","equal");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),OX=F({equalStrict_:function(t,n){var e=S(t,"a","equalStrict"),r=S(n,"b","equalStrict");return Yt(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),PX=F({greater_:function(t,n){var e,r=S(t,"a","greater"),o=S(n,"b","greater");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),pR=F({greaterEqual_:function(t,n){var e,r=S(t,"a","greaterEqual"),o=S(n,"b","greaterEqual");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Qt(s)},b:function(){return Qt(u)}}},"GreaterEqual")}}),LX=F({greaterEqualStrict_:function(t,n){var e=S(t,"a","greaterEqualStrict"),r=S(n,"b","greaterEqualStrict");return Yt(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),BX=F({greaterStrict_:function(t,n){var e=S(t,"a","greaterStrict"),r=S(n,"b","greaterStrict");return Yt(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),jX=F({less_:function(t,n){var e,r=S(t,"a","less"),o=S(n,"b","less");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),VX=F({lessEqual_:function(t,n){var e,r=S(t,"a","lessEqual"),o=S(n,"b","lessEqual");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),UX=F({lessEqualStrict_:function(t,n){var e=S(t,"a","lessEqualStrict"),r=S(n,"b","lessEqualStrict");return Yt(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),HX=F({lessStrict_:function(t,n){var e=S(t,"a","lessStrict"),r=S(n,"b","lessStrict");return Yt(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),zX=F({notEqual_:function(t,n){var e,r=S(t,"a","notEqual"),o=S(n,"b","notEqual");return e=Un(r,o),Ot((r=e[0]).shape,(o=e[1]).shape),N.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),WX=F({notEqualStrict_:function(t,n){var e=S(t,"a","notEqualStrict"),r=S(n,"b","notEqualStrict");return Yt(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function gR(t,n){for(var e=[],r=t;r<n;++r)e.push(r);return e}function mR(t){for(var n=[],e=0;e<t.length;++e)for(var r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var d_=F({gather_:function(t,n,e){void 0===e&&(e=0);var r=S(t,"x","gather"),o=S(n,"indices","gather","int32");e=hr(e,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,o,e);return N.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,g=gR(0,f),m=gR(f+1,f+1+p),v=mR([d,[l],h]),b=a.reshape(v),w=u.reshape([l]),_=mR([[f],g,m]),x=b.transpose(_),D=vR(x,w,r.shape[e]),R=rg(_);return D.transpose(R)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),vR=F({unsortedSegmentSum_:function(t,n,e){var r=S(t,"x","unsortedSegmentSum"),o=S(n,"segmentIds","unsortedSegmentSum","int32");return A($n(e),function(){return"numSegments must be of dtype int"}),N.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,e);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=l_(c,Qt(c)),d=d_(u,l),f=pR(c,Ce(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=ci(f,p+1);f=Cg(f,zc(d.shape,"bool"));var g=Qt(d);return vu(f,d,g)}(i,s)}}})}});function yR(t,n,e,r,o,i,a){void 0===i&&(i="NHWC"),A(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var s=t,u=n,c=!1;3===n.rank&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,t[0],t[1],t[2]]),A(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),A(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),A(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];A(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),A(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=a&&A($n(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=pg(i),h=Ss(s,e.shape,r,1,o,a,!1,f),p=N.runKernelFunc(function(g,m){var v=g.conv2dDerInput(u,e,h);return m([e,u]),v},{dy4D:u,filter:e},function(g,m){var v=m[0],b=m[1];return{dy4D:function(){return li(g,v,r,o,i,1,a)},filter:function(){return h_(g,b,v.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function f_(t){var i,n="number"==typeof(i=t)?[i,i,i]:2===i.length?[i[0],i[1],1]:i;return 1===n[0]&&1===n[1]&&1===n[2]}function bR(t,n,e,r,o){A(t.length===n.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+n.rank+") must match"});var i=t,a=n,s=!1;4===n.rank&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];A(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),A(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),A(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),A(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),A(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=af(i,e.shape,r,1,o),d=N.runKernelFunc(function(f){return f.conv3dDerInput(a,e,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var GX=F({conv1d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=S(t,"x","conv1d"),u=S(n,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),A(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),A(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&A($n(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),A(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),A(fo(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),A("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=li(f,d,[1,e],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),li=F({conv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=S(t,"x","conv2d"),u=S(n,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),A(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&A($n(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d="NHWC"===o?c.shape[3]:c.shape[1];A(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),A(fo(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var f=pg(o),h=Ss(c.shape,u.shape,e,i,r,a,!1,f),g=N.runKernelFunc(function(m,v){var b=m.conv2d(c,u,h);return v([u,c]),b},{x:c,filter:u},function(m,v){var w=v[0],_=v[1];return A(pu(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return _R(_.shape,m,w,e,r,o)},filter:function(){return h_(_,m,w.shape,e,r,o)}}},"Conv2D",h,[u,c]);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),qX=F({conv3d_:function(t,n,e,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var h,a=S(t,"x","conv3d"),s=S(n,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),A(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),A(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),A(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),A((h=i,f_(e)||f_(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),A("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=af(u.shape,s.shape,e,i,r),d=N.runKernelFunc(function(f,h){var p=f.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(f,h){A(f_(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],g=h[1];return{x:function(){return bR(p.shape,f,g,e,r)},$filter:function(){return function(m,v,b,w,_){var x=m;4===m.rank&&(x=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var D=v;4===D.rank&&(D=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),A(5===x.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),A(5===D.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+D.shape+"."}),A(5===b.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),A(x.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+b[3]+"."}),A(D.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+D.shape[4]+") must match output depth for filter ("+b[4]+")."});var R=af(x.shape,b,w,1,_);return N.runKernelFunc(function(k){return k.conv3dDerFilter(x,D,R)},{x5D:x,dy5D:D})}(p,f,g.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),h_=F({conv2dDerFilter_:function(t,n,e,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=n;3===u.rank&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),A(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),A(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),A(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];A(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),A(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),null!=a&&A($n(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=pg(i),f=Ss(s.shape,e,r,1,o,a,!1,d);return N.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),_R=F({conv2dDerInput_:yR}),Dg=F({depthwiseConv2d_:function(t,n,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=S(t,"x","depthwiseConv2d"),u=S(n,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),A(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),A(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),A(fo(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=a&&A($n(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Ss(c.shape,u.shape,e,i,r,a,!0),h=N.runKernelFunc(function(p,g){var m=p.depthwiseConv2D(c,u,d);return g([c,u]),m},{x:c,filter:u},function(p,g){A(pu(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var m=g[0],v=g[1];return{x:function(){return wR(m.shape,p,v,d)},filter:function(){return xR(m,p,v.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),wR=F({depthwiseConv2dDerInput_:function(t,n,e,r){var o=n,i=!1;3===n.rank&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=N.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),xR=F({depthwiseConv2dDerFilter_:function(t,n,e,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=n;return 3===i.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),N.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),p_=F({separableConv2d_:function(t,n,e,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=S(t,"x","separableConv2d"),u=S(n,"depthwiseFilter","separableConv2d"),c=S(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),A(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),A(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),A(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),A(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];A(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=Dg(l,u,r,o,a,i),g=li(p,c,1,"valid",a);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),XX=F({conv2dTranspose_:function(t,n,e,r,o,i){return yR(e,S(t,"x","conv2dTranspose"),S(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),KX=F({conv3dTranspose_:function(t,n,e,r,o){return bR(e,S(t,"x","conv3dTranspose"),S(n,"filter","conv3dTranspose"),r,o)}}),Sg=F({matMul_:function(t,n,e,r){var o;void 0===e&&(e=!1),void 0===r&&(r=!1);var i=S(t,"a","matMul"),a=S(n,"b","matMul");o=Un(i,a),i=o[0],a=o[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=$e(d),p=$e(f);A(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),A(fr(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),A(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),m=e?i.as3D(h,s,c):i.as3D(h,c,s),v=r?a.as3D(p,l,u):a.as3D(p,u,l);return N.runKernelFunc(function(w,_){var x=w.batchMatMul(m,v,e,r);return _([m,v]),x},{a:m,b:v},function(w,_){var D=_[0],R=_[1];return e||r?!e&&r?{a:function(){return w.matMul(R,!1,!1)},b:function(){return w.matMul(D,!0,!1)}}:e&&!r?{a:function(){return R.matMul(w,!1,!0)},b:function(){return D.matMul(w,!1,!1)}}:{a:function(){return R.matMul(w,!0,!0)},b:function(){return w.matMul(D,!0,!0)}}:{a:function(){return w.matMul(R,!1,!0)},b:function(){return D.matMul(w,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(g)}}),ZX=F({dot_:function(t,n){var e=S(t,"t1","dot"),r=S(n,"t2","dot");A(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=1===e.rank?e.size:e.shape[1],i=1===r.rank?r.size:r.shape[0];return A(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),YX=F({outerProduct_:function(t,n){var e=S(t,"v1","outerProduct"),r=S(n,"v2","outerProduct");return A(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),ff=F({reverse_:function(t,n){var e=S(t,"x","reverse");if(0===e.rank)return e.clone();var r=hr(n,e.shape);return N.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),QX=F({reverse1d_:function(t){var n=S(t,"x","reverse");return A(1===n.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),ff(n,0)}}),JX=F({reverse2d_:function(t,n){var e=S(t,"x","reverse");return A(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),ff(e,n)}}),eK=F({reverse3d_:function(t,n){var e=S(t,"x","reverse");return A(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),ff(e,n)}}),tK=F({reverse4d_:function(t,n){var e=S(t,"x","reverse");return A(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),ff(e,n)}});function CR(t,n,e,r,o,i){var a=S(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),A(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),A(fo(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=i&&A($n(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=$c(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&fr(c.inShape,c.outShape))return a.clone();var d=N.runKernelFunc(function(f,h){var p=f.maxPool(s,c);return h([s,p]),p},{x:s},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,b,w,_,x,D,R){var k=S(m,"dy","maxPoolBackprop"),M=S(v,"input","maxPoolBackprop"),T=S(b,"output","maxPoolBackprop");A(M.rank===k.rank,function(){return"Rank of input ("+M.rank+") does not match rank of dy ("+k.rank+")"}),null==x&&(x=[1,1]),A(fo(_,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+x+"'"}),A(4===k.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),A(4===M.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+M.rank+"."});var B=$c(M.shape,w,_,x,D,void 0);return N.runKernelFunc(function(P){return P.maxPoolBackprop(k,M,T,B)},{$dy:k,$input:M})}(f,p,g,n,e,r,o)}}},"MaxPool",c,[s]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function ER(t,n,e,r,o,i){var a=S(t,"x","avgPool","float32");null==r&&(r=[1,1]),A(fo(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&A($n(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=$c(s.shape,n,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&fr(c.inShape,c.outShape))return a.clone();var l=N.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,h,p,g,m,v){var b=S(f,"dy","avgPoolBackprop"),w=S(h,"input","avgPoolBackprop");A(w.rank===b.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+b.rank+")"}),null==m&&(m=[1,1]),A(fo(g,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"});var _=w,x=b,D=!1;3===w.rank&&(D=!0,_=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),A(4===x.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),A(4===_.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var R=$c(_.shape,p,g,m,v),k=N.runKernelFunc(function(M){return M.avgPoolBackprop(x,_,R)},{dy4D:x,input4D:_});return D?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}(d,s,n,e,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Ar=F({maxPool_:function(t,n,e,r,o){return CR(t,n,e,1,r,o)}}),hf=F({avgPool_:function(t,n,e,r,o){return ER(t,n,e,1,r,o)}}),nK=F({pool_:function(t,n,e,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=S(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(fo(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,x,D,R,k,l=$c(s.shape,n,i,o,r),d=[l.dilationHeight,l.dilationWidth];c="same"===r?(x=d,D=[l.filterHeight,l.filterWidth].map(function(M,T){return M+(M-1)*(x[T]-1)}).map(function(M){return M-1}),R=D.map(function(M){return Math.floor(M/2)}),k=D.map(function(M,T){return M-R[T]}),D.map(function(M,T){return[R[T],k[T]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(_,x,D){var R=D.map(function(Z){return Z[0]}),k=D.map(function(Z){return Z[1]}),M=_.concat(R,k),T=x.map(function(Z,Y){return(Z-M[Y]%Z)%Z}),B=k.map(function(Z,Y){return Z+T[Y]});return[x.map(function(Z,Y){return[R[Y],B[Y]]}),x.map(function(Z,Y){return[0,T[Y]]})]}([l.inHeight,l.inWidth],d,c),g=h[1],m=f?r:"valid",v=f?s:qT(s,d,h[0]),b=("avg"===e?function(){return ER(v,n,i,1,m)}:function(){return CR(v,n,i,1,m)})(),w=f?b:WT(b,d,g);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),rK=F({maxPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=S(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),A(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),A("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),A(fo(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&A($n(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=rf(u.shape,n,e,a,r,o,i),d=N.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,b,w,_,x,D,R){var k=S(m,"dy","maxPool3dBackprop"),M=S(v,"input","maxPool3dBackprop"),T=S(b,"output","maxPool3dBackprop"),B=k,P=M,Q=T,Z=!1;4===M.rank&&(Z=!0,B=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),P=M.as5D(1,M.shape[0],M.shape[1],M.shape[2],M.shape[3]),Q=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),A(5===B.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+B.rank+"."}),A(5===P.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),A(5===Q.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+Q.rank+"."}),null==x&&(x=[1,1,1]),A(fo(_,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+x+"'"}),null!=R&&A($n(D),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+R+" but got pad "+D+"."});var Y=rf(P.shape,w,_,x,D,R),se=N.runKernelFunc(function(ne){return ne.maxPool3dBackprop(B,P,Q,Y)},{dy5D:B,input5D:P});return Z?se.as4D(se.shape[1],se.shape[2],se.shape[3],se.shape[4]):se}(f,p,g,n,e,a,r,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),oK=F({avgPool3d_:function(t,n,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=S(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),A(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),A("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),A(fo(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&A($n(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=rf(u.shape,n,e,a,r,o,i),d=N.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,g,m,v,b,w){var _=S(h,"dy","avgPool3dBackprop"),x=S(p,"input","avgPool3dBackprop"),D=_,R=x,k=!1;4===x.rank&&(k=!0,D=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),R=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),A(5===D.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),A(5===R.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."}),null==v&&(v=[1,1,1]),A(fo(m,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"}),null!=w&&A($n(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+b+"."});var M=rf(R.shape,g,m,v,b,w),T=N.runKernelFunc(function(B){return B.avgPool3dBackprop(D,R,M)},{dy5D:D,input5D:R});return k?T.as4D(T.shape[1],T.shape[2],T.shape[3],T.shape[4]):T}(f,u,n,e,a,r,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),ua=F({slice_:function(t,n,e){var r,o,i=S(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof n?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach(function(u){A(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==e?new Array(i.rank).fill(-1):"number"==typeof e?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(A(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),JT(i,r,o);var a=i.shape;return N.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:o})}}),iK=F({slice1d_:function(t,n,e){var r=S(t,"x","slice1d");return A(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,[n],[e])}}),aK=F({slice2d_:function(t,n,e){var r=S(t,"x","slice2d");return A(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,n,e)}}),DR=F({slice3d_:function(t,n,e){var r=S(t,"x","slice3d");return A(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,n,e)}}),sK=F({slice4d_:function(t,n,e){var r=S(t,"x","slice4d");return A(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ua(r,n,e)}});function SR(t,n,e,r,o){return n.rank<e.rank&&(n=n.reshape(lo(n.shape,r))),t.rank<e.rank&&(t=t.reshape(lo(t.shape,r))),{x:function(){var i=t.mul(e.equal(n).cast(t.dtype));return null==o?i:i.transpose(o)}}}var uK=F({all_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","all","bool"),o=hr(n,r.shape),i=o,a=ki(i,r.rank);null!=a&&(r=r.transpose(a),i=Ri(i.length,r.rank));var s=N.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(e){var u=lo(s.shape,o);return s.reshape(u)}return s}}),cK=F({any_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","any","bool"),o=hr(n,r.shape),i=o,a=ki(i,r.rank);null!=a&&(r=r.transpose(a),i=Ri(i.length,r.rank));var s=N.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(e){var u=lo(s.shape,o);return s.reshape(u)}return s}}),lK=F({argMax_:function(t,n){void 0===n&&(n=0);var e=S(t,"x","argMax");null==n&&(n=0);var r=hr(n,e.shape),o=ki(r,e.rank);return null!=o&&(e=e.transpose(o),r=Ri(r.length,e.rank)),N.runKernelFunc(function(s,u){var c=s.argMax(e,r[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return Qt(c)}}},"ArgMax",{axis:r[0]},[e])}}),dK=F({argMin_:function(t,n){void 0===n&&(n=0);var e=S(t,"x","argMin");null==n&&(n=0);var r=hr(n,e.shape),o=ki(r,e.rank);return null!=o&&(e=e.transpose(o),r=Ri(r.length,e.rank)),N.runKernelFunc(function(i,a){var s=i.argMin(e,r[0]);return a([e]),s},{$x:e},function(i,a){var s=a[0];return{$x:function(){return Qt(s)}}})}}),fK=F({logSumExp_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","logSumExp"),o=hr(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(e){var u=lo(s.shape,o);return s.reshape(u)}return s}}),Ig=F({max_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","max"),o=r,i=hr(n,r.shape),a=i,s=ki(a,r.rank);null!=s&&(r=r.transpose(s),a=Ri(a.length,r.rank));var c=N.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return SR(d,f[1],f[0],i,s)},"Max",{axes:a},[r],[!0]);if(e){var l=lo(c.shape,i);c=c.reshape(l)}return c}}),hK=F({mean_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","mean"),o=hr(n,r.shape),i=$e(Vr(r.shape,o)[1]);return dg(function(a){var s=Ce(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(zc(a.shape,"float32")).div(i)}}})(r)}}),pK=F({min_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","min"),o=r,i=hr(n,r.shape),a=i,s=ki(a,r.rank);null!=s&&(r=r.transpose(s),a=Ri(a.length,r.rank));var c=N.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return SR(d,f[1],f[0],i,s)},"Min",{axes:a},[r],[!0]);if(e){var l=lo(c.shape,i);c=c.reshape(l)}return c}}),gK=F({moments_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=hr(n,(t=S(t,"x","moments")).shape),o=t.mean(r,e),i=o.shape;e||(i=lo(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,e)}}}),IR=F({sum_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=hr(n,r.shape);return dg(function(i){var a=ki(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=Ri(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(g){p[g]=1}),h.reshape(p).mul(zc(i.shape,"float32"))},d=N.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:s});if(e){var f=lo(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),mK=F({prod_:function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!1);var r=S(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=hr(n,r.shape),i=ki(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Ri(a.length,r.rank));var u=N.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(e){var c=lo(u.shape,o);u=u.reshape(c)}return u}}),AR=F({elu_:function(t){var n=S(t,"x","elu");return N.runKernelFunc(function(e,r){var o=e.elu(n);return r([o]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){return N.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),vK=F({leakyRelu_:function(t,n){void 0===n&&(n=.2);var e=S(t,"x","leakyRelu");return l_(Ce(n).mul(e),e)}}),MR=F({prelu_:function(t,n){var e=S(t,"x","prelu"),r=S(n,"alpha","prelu");return N.runKernelFunc(function(o,i){var a=o.prelu(e,r);return i([e,r]),a},{x:e,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return vu(u,o,o.mul(s))},alpha:function(){var c=vu(u,Qt(o),o.mul(a)),l=gr(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),Gn=F({relu_:function(t){var n=S(t,"x","relu");return"bool"===n.dtype?n.toInt():N.runKernelFunc(function(e,r){var o=e.relu(n);return r([n]),o},{x:n},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),TR=F({relu6_:function(t){var n=S(t,"x","relu6");return"bool"===n.dtype?n.toInt():N.runKernelFunc(function(e,r){var o=e.relu6(n);return r([n]),o},{x:n},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),yK=F({selu_:function(t){var n=S(t,"x","selu");return N.runKernelFunc(function(e,r){var o=e.selu(n);return r([n]),o},{$x:n},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(Ce(0)),a=Ce(a_),s=Ce(s_),u=e.mul(s),c=e.mul(a).mul(o.toFloat().exp());return vu(i,u,c)}}})}}),Is=F({transpose_:function(t,n){var e=S(t,"x","transpose");return null==n&&(n=e.shape.map(function(o,i){return i}).reverse()),A(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(o){A(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1?e.clone():N.runKernelFunc(function(o){return o.transpose(e,n)},{x:e},function(o){var i=rg(n);return{x:function(){return o.transpose(i)}}},"Transpose",{perm:n})}}),bK=F({localResponseNormalization_:function(t,n,e,r,o){void 0===n&&(n=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=S(t,"x","localResponseNormalization");A(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),A($n(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=N.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(a,n,e,r,o);return l([a,d]),d},{x4D:a},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return N.runKernelFunc(function(h){return h.LRNGrad(c,d,f,n,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),kR=F({norm_:function(t,n,e,r){void 0===n&&(n="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var o=function s(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return s(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(Ce(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(t=S(t,"x","norm"),n,e),i=o.shape;if(r){var a=hr(e,t.shape);i=lo(o.shape,a)}return o.reshape(i)}}),_K=F({basicLSTMCell_:function(t,n,e,r,o,i){var a=S(t,"forgetBias","basicLSTMCell"),s=S(n,"lstmKernel","basicLSTMCell"),u=S(e,"lstmBias","basicLSTMCell"),c=S(r,"data","basicLSTMCell"),l=S(o,"c","basicLSTMCell"),d=S(i,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),p=f.shape[1]/4,g=[f.shape[0],p],m=f.slice([0,0],g),v=f.slice([0,p],g),b=f.slice([0,2*p],g),w=f.slice([0,3*p],g),_=m.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),x=_.tanh().mulStrict(w.sigmoid());return[_,x]}}),wK=F({multiRNNCell_:function(t,n,e,r){for(var o=S(n,"data","multiRNNCell"),i=tf(e,"c","multiRNNCell"),a=tf(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),xK=F({movingAverage_:function(t,n,e,r,o){void 0===o&&(o=!0);var i=S(t,"v","movingAverage"),a=S(n,"x","movingAverage"),s=S(e,"decay","movingAverage");dT(i,a),A(fr(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Ce(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){A(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=S(r,"step","movingAverage");l=l.div(u.sub(Eg(s,d)))}return i.add(l)}}),CK=F({stridedSlice_:function(t,n,e,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(n.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=S(t,"x","stridedSlice"),l=H0(s),d=c.shape.slice();l.forEach(function(m){n[m]=0,e[m]=1,d.splice(m,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)n[f]=ek(o,n,r,c.shape,f),e[f]=tk(i,e,r,c.shape,f),r[f]=r[f]||1;var h=H0(u);h.forEach(function(m){e[m]=n[m]+1,r[m]=1});var p=lg(n,e,r),g=p.filter(function(m,v){return-1===h.indexOf(v)});return r.every(function(m){return 1===m})?ua(c,n,p).reshape(g):N.runKernelFunc(function(m){return m.stridedSlice(c,n,e,r)},{$x:c}).reshape(g)}}),EK=F({topk_:function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=!0);var r=S(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=N.runKernelFunc(function(a){return a.topk(r,n,e)},{$x:r});return{values:i[0],indices:i[1]}}}),DK=F({scatterND_:function(t,n,e){var r=S(t,"indices","scatterND","int32"),o=S(n,"updates","scatterND");return QT(o,r,e),N.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),g_=F({fft_:function(t){A("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return N.runKernelFunc(function(o){return o.fft(r)},{input:t}).reshape(t.shape)}}),Ag=F({ifft_:function(t){A("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return N.runKernelFunc(function(o){return o.ifft(r)},{input:t}).reshape(t.shape)}}),m_=F({rfft_:function(t,n){A("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var e,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=n&&n<r){var i=t.shape.map(function(v){return 0}),a=t.shape.map(function(v){return v});a[t.shape.length-1]=n,e=t.slice(i,a),r=n}else if(null!=n&&n>r){var s=t.shape.map(function(v){return v});s[t.shape.length-1]=n-r,e=t.concat(Bn(s),t.shape.length-1),r=n}else e=t;var u=e.zerosLike(),c=Ur(e,u).as2D(o,r),l=g_(c),d=Math.floor(r/2)+1,f=ui(l),h=aa(l),p=f.split([d,r-d],f.shape.length-1),g=h.split([d,r-d],h.shape.length-1),m=e.shape.slice();return m[e.shape.length-1]=d,Ur(p[0],g[0]).reshape(m)}}),RR=F({irfft_:function(t){var n=t.shape[t.shape.length-1],e=t.size/n;if(n<=2){var r=t.as2D(e,n),o=Ag(r);return ui(o)}var i=[e,2*(n-1)],a=ui(t).as2D(e,n),s=aa(t).as2D(e,n),u=a.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(Ce(-1)),l=a.concat(u,1),d=s.concat(c,1);return r=Ur(l,d).as2D(i[0],i[1]),o=Ag(r),ui(o)}}),SK=Object.freeze({fft:g_,ifft:Ag,rfft:m_,irfft:RR}),IK=F({sparseToDense_:function(t,n,e,r){void 0===r&&(r=0);var o=S(t,"sparseIndices","sparseToDense","int32"),i=S(n,"sparseValues","sparseToDense"),a=S(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,a),N.runKernelFunc(function(s){return s.sparseToDense(o,i,e,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),AK=F({gatherND_:function(t,n){var e=S(n,"indices","gatherND","int32"),r=S(t,"x","gatherND");return N.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),MK=F({diag_:function(t){var n=S(t,"x","diag").flatten(),e=t.shape.concat(t.shape);return N.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(e)}}),TK=F({dropout_:function(t,n,e,r){var o=S(t,"x","dropout");if(A("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),A(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),0===n)return t instanceof Cn?o.clone():o;var i=function(u,c){if(null==c)return u.shape.slice();if(fr(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)l.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return l}return c}(o,e),a=1-n,s=GT(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function NR(t,n,e){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=n-e*Math.cos(a)}return pr(o,"float32")}var Zr,v_=F({hannWindow_:function(t){return NR(t,.5,.5)}}),FR=F({hammingWindow_:function(t){return NR(t,.54,.46)}}),y_=F({frame_:function(t,n,e,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+n<=t.size;)a.push(ua(t,i,n)),i+=e;if(r)for(;i<t.size;){var s=i+n-t.size,u=wr([ua(t,i,n-s),sa([s],o)]);a.push(u),i+=e}return 0===a.length?Ds([],[0,n]):wr(a).as2D(a.length,n)}}),OR=F({stft_:function(t,n,e,r,o){void 0===o&&(o=v_),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))));for(var a=y_(t,n,e),s=Kr(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(m_(s.slice([c,0],[1,n]),r));return wr(u)}}),kK=Object.freeze({hannWindow:v_,hammingWindow:FR,frame:y_,stft:OR});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Zr||(Zr={}));var NK=F({absoluteDifference_:function(t,n,e,r){void 0===r&&(r=Zr.SUM_BY_NONZERO_WEIGHTS);var o=S(t,"labels","absoluteDifference"),i=S(n,"predictions","absoluteDifference"),a=null;null!=e&&(a=S(e,"weights","absoluteDifference")),Yt(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Ga(s,a,r)}}),Ga=F({computeWeightedLoss_:function(t,n,e){void 0===e&&(e=Zr.SUM_BY_NONZERO_WEIGHTS);var r=S(t,"losses","computeWeightedLoss"),o=null;null!=n&&(o=S(n,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(e===Zr.NONE)return i;if(e===Zr.SUM)return i.sum();if(e===Zr.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Ce(a)):s}if(e===Zr.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(Ce(r.size));var u=o.mul(zc(r.shape)).notEqual(Ce(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),FK=F({cosineDistance_:function(t,n,e,r,o){void 0===o&&(o=Zr.SUM_BY_NONZERO_WEIGHTS);var i=S(t,"labels","cosineDistance"),a=S(n,"predictions","cosineDistance"),s=null;null!=r&&(s=S(r,"weights","cosineDistance")),Yt(i.shape,a.shape,"Error in cosineDistance: ");var u=Ce(1).sub(i.mul(a).sum(e,!0));return Ga(u,s,o)}}),OK=F({hingeLoss_:function(t,n,e,r){void 0===r&&(r=Zr.SUM_BY_NONZERO_WEIGHTS);var o=S(t,"labels","hingeLoss"),i=S(n,"predictions","hingeLoss"),a=null;null!=e&&(a=S(e,"weights","hingeLoss")),Yt(o.shape,i.shape,"Error in hingeLoss: ");var s=Ce(1);o=Ce(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Ga(u,a,r)}}),PK=F({huberLoss_:function(t,n,e,r,o){void 0===r&&(r=1),void 0===o&&(o=Zr.SUM_BY_NONZERO_WEIGHTS);var i=S(t,"labels","huberLoss"),a=S(n,"predictions","huberLoss"),s=null;null!=e&&(s=S(e,"weights","huberLoss")),Yt(i.shape,a.shape,"Error in huberLoss: ");var u=Ce(r),c=a.sub(i).abs(),l=fR(c,u),d=c.sub(l),f=Ce(.5).mul(l.square()).add(u.mul(d));return Ga(f,s,o)}}),LK=F({logLoss_:function(t,n,e,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Zr.SUM_BY_NONZERO_WEIGHTS);var i=S(t,"labels","logLoss"),a=S(n,"predictions","logLoss"),s=null;null!=e&&(s=S(e,"weights","logLoss")),Yt(i.shape,a.shape,"Error in logLoss: ");var u=Ce(1),c=Ce(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Ga(l,s,o)}}),BK=F({meanSquaredError_:function(t,n,e,r){void 0===r&&(r=Zr.SUM_BY_NONZERO_WEIGHTS);var o=S(t,"labels","meanSquaredError"),i=S(n,"predictions","meanSquaredError"),a=null;null!=e&&(a=S(e,"weights","meanSquaredError")),Yt(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Ga(s,a,r)}}),jK=F({sigmoidCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=Zr.SUM_BY_NONZERO_WEIGHTS);var i=S(t,"multiClassLabels","sigmoidCrossEntropy"),a=S(n,"logits","sigmoidCrossEntropy"),s=null;if(null!=e&&(s=S(e,"weights","sigmoidCrossEntropy")),Yt(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Ce(r),c=Ce(1),l=Ce(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=S(f,"labels","sigmoidCrossEntropyWithLogits"),g=S(h,"logits","sigmoidCrossEntropyWithLogits");Yt(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=g.relu(),v=g.mul(p),b=g.abs().neg().exp().log1p();return m.sub(v).add(b)}(i,a);return Ga(d,s,o)}}),VK=F({softmaxCrossEntropy_:function(t,n,e,r,o){void 0===r&&(r=0),void 0===o&&(o=Zr.SUM_BY_NONZERO_WEIGHTS);var i=S(t,"onehotLabels","softmaxCrossEntropy"),a=S(n,"logits","softmaxCrossEntropy"),s=null;if(null!=e&&(s=S(e,"weights","softmaxCrossEntropy")),Yt(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Ce(r),c=Ce(1),l=Ce(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return dg(function(g,m,v){var b=m.logSumExp([p],!0),w=m.toFloat().sub(b);return v([g,w]),{value:w.mul(g).neg().sum([p]),gradFunc:function(_,x){var D=x[0],R=x[1],k=lo(_.shape,[p]);return[_.reshape(k).mul(D.toFloat().sub(R.exp())),_.reshape(k).mul(R.exp().sub(D.toFloat()))]}}})(f,h)}(i,a);return Ga(d,s,o)}}),UK=Object.freeze({get Reduction(){return Zr},absoluteDifference:NK,computeWeightedLoss:Ga,cosineDistance:FK,hingeLoss:OK,huberLoss:PK,logLoss:LK,meanSquaredError:BK,sigmoidCrossEntropy:jK,softmaxCrossEntropy:VK});function PR(t,n){return void 0===n&&(n=!1),N.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var e=t.shape[0],r=t.shape[1],o=$T(e),i=t.clone(),a=Ds([[1]],[1,1]),s=a.clone(),u=e>=r?r:e,c=function(d){var f,h=i,p=s,g=o;f=N.tidy(function(){var m=i.slice([d,d],[e-d,1]),v=m.norm(),b=i.slice([d,d],[1,1]),w=Ds([[-1]]).where(b.greater(0),Ds([[1]])),_=b.sub(w.mul(v)),x=m.div(_);s=1===x.shape[0]?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var D=w.matMul(_).div(v).neg(),R=i.slice([d,0],[e-d,r]),k=D.mul(s);if(0===d)i=R.sub(k.matMul(s.transpose().matMul(R)));else{var M=R.sub(k.matMul(s.transpose().matMul(R)));i=i.slice([0,0],[d,r]).concat(M,0)}var T=o.slice([0,d],[e,o.shape[1]-d]);if(0===d)o=T.sub(T.matMul(s).matMul(k.transpose()));else{var B=T.sub(T.matMul(s).matMul(k.transpose()));o=o.slice([0,0],[e,d]).concat(B,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],So([h,p,g])},l=0;l<u;++l)c(l);return!n&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var HK=F({bandPart_:function(t,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=S(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),e<0&&(e=s);var u=og(0,a,1,"int32").reshape([-1,1]),c=og(0,s,1,"int32"),l=Cr(u,c),d=Cg(l.lessEqual(Ce(+n,"int32")),l.greaterEqual(Ce(-e,"int32"))),f=Bn([a,s],r.dtype);return $o(xr(r.reshape([-1,a,s])).map(function(h){return vu(d,h,f)})).reshape(o)}}),zK=F({gramSchmidt_:function(t){var n;if(Array.isArray(t)){n=!1,A(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=t[0].shape[0],r=function(u){A(t[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+e+")"})},o=1;o<t.length;++o)r(o)}else n=!0,t=L0(t,t.shape[0],0).map(function(u){return XT(u,[0])});A(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(u){i.push(N.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var d=IR(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(kR(c,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return n?$o(i,0):i}}),WK=F({qr_:function(t,n){if(void 0===n&&(n=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return PR(t,n);var e=t.shape.slice(0,t.shape.length-2).reduce(function(a,s){return a*s}),r=xr(t.reshape([e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=PR(a,n),c=s[1];o.push(s[0]),i.push(c)}),[$o(o,0).reshape(t.shape),$o(i,0).reshape(t.shape)]}}),$K=Object.freeze({bandPart:HK,gramSchmidt:zK,qr:WK});function Mg(t,n,e,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=t.shape[0];return e=Math.min(e,a),A(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),A(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),A(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),A(1===n.rank,function(){return"scores must be a 1D tensor"}),A(n.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]}),A(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var GK=F({resizeBilinear_:function(t,n,e){void 0===e&&(e=!1);var r=S(t,"images","resizeBilinear");A(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),A(2===n.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=N.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,e)},{x:o},function(c,l){return{x:function(){return N.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),qK=F({resizeNearestNeighbor_:function(t,n,e){void 0===e&&(e=!1);var r=S(t,"images","resizeNearestNeighbor");A(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),A(2===n.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),A("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=N.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,e)},{batchImages:o},function(c,l){return{batchImages:function(){return N.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),XK=F({nonMaxSuppression_:function(t,n,e,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=S(t,"boxes","nonMaxSuppression"),a=S(n,"scores","nonMaxSuppression"),s=Mg(i,a,e,r,o);return N.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,e,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:e=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),ZK=F({nonMaxSuppressionWithScore_:function(t,n,e,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=S(t,"boxes","nonMaxSuppression"),s=S(n,"scores","nonMaxSuppression"),u=Mg(a,s,e,r,o,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=N.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),QK=F({cropAndResize_:function(t,n,e,r,o,i){var a=S(t,"image","cropAndResize"),s=S(n,"boxes","cropAndResize","float32"),u=S(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return A(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),A(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),A(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),A(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),A(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),A("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),N.runKernelFunc(function(l,d){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),b_=Object.freeze({resizeBilinear:GK,resizeNearestNeighbor:qK,nonMaxSuppression:XK,nonMaxSuppressionAsync:function(t,n,e,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),Be(this,void 0,void 0,function(){var i,a,s,u,d;return je(this,function(f){switch(f.label){case 0:return i=S(t,"boxes","nonMaxSuppressionAsync"),a=S(n,"scores","nonMaxSuppressionAsync"),s=Mg(i,a,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),d=Z0(u[0],u[1],e,r,o),i!==t&&i.dispose(),a!==n&&a.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:ZK,nonMaxSuppressionWithScoreAsync:function(t,n,e,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),Be(this,void 0,void 0,function(){var a,s,u,c,f;return je(this,function(h){switch(h.label){case 0:return a=S(t,"boxes","nonMaxSuppressionAsync"),s=S(n,"scores","nonMaxSuppressionAsync"),u=Mg(a,s,e,r,o,i),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),f=Y0(c[0],c[1],e,r,o,i),a!==t&&a.dispose(),s!==n&&s.dispose(),[2,f]}})})},cropAndResize:QK}),__=function(t,n){return!(t>0)||"linear"===n},w_=function(t,n,e){if(null==e||"linear"===e)return t;if("relu"===e)return t.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},x_=function(t,n){var e=n,r=gr(t.shape,n.shape);return r.length>0&&(e=e.sum(r)),e.reshape(t.shape)},C_=function(t,n,e){if("linear"===n)return t;if("relu"===n)return Gn(t);if("elu"===n)return AR(t);if("relu6"===n)return TR(t);if("prelu"===n)return MR(t,e);throw new Error("Unknown fused activation "+n+".")},JK=F({fusedMatMul_:function(t){var n,e=t.a,r=t.b,o=t.transposeA,i=void 0!==o&&o,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,d=t.preluActivationWeights;if(!1===__(N.state.gradientDepth,l)){var f=Sg(e,r,i,s);return null!=u&&(f=Pt(f,u)),C_(f,l,d)}var h=S(e,"a","fused matMul"),p=S(r,"b","fused matMul");n=Un(h,p),h=n[0],p=n[1];var g=i?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],w=h.shape.slice(0,-2),_=p.shape.slice(0,-2),x=$e(w),D=$e(_);A(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),A(fr(w,_),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+_+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),A(g===m,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var R,k,M=h.shape.slice(0,-2).concat([v,b]),T=i?h.as3D(x,g,v):h.as3D(x,v,g),B=s?p.as3D(D,b,m):p.as3D(D,m,b);null!=u&&Ot(M,(R=Un(R=S(u,"bias","fused matMul"),h)[0]).shape),null!=d&&(k=S(d,"prelu weights","fused matMul"));var P={a:T,b:B};return null!=u&&(P.bias=R),null!=d&&(P.preluActivationWeights=k),N.runKernelFunc(function(Z,Y){var se=Z.fusedBatchMatMul({a:T,b:B,transposeA:i,transposeB:s,bias:R,activation:l,preluActivationWeights:k});return Y([T,B,se]),se},P,function(Z,Y){var se=Y[0],ne=Y[1],ue=w_(Z,Y[2],l),he={};return null!=u&&(he={bias:function(){return x_(R,ue)}}),Object.assign(i||s?!i&&s?{a:function(){return ue.matMul(ne,!1,!1)},b:function(){return ue.matMul(se,!0,!1)}}:i&&!s?{a:function(){return ne.matMul(ue,!1,!0)},b:function(){return se.matMul(ue,!1,!1)}}:{a:function(){return ne.matMul(ue,!0,!0)},b:function(){return ue.matMul(se,!0,!0)}}:{a:function(){return ue.matMul(ne,!1,!0)},b:function(){return se.matMul(ue,!0,!1)}},he)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[T,B],[!0]).reshape(M)}}),eZ=F({fusedConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===__(N.state.gradientDepth,f=f||"linear")){var p=li(n,e,r,o,a,u,c);return null!=l&&(p=Pt(p,l)),C_(p,f,h)}var g=S(n,"x","conv2d"),m=S(e,"filter","conv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),A(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),A(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=c&&A($n(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),A(v.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),A(fo(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),A("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var w,_,x=Ss(v.shape,m.shape,r,u,o,c);null!=l&&(w=Un(w=S(l,"bias","fused conv2d"),g)[0],Ot(x.outShape,w.shape)),null!=h&&(_=S(h,"prelu weights","fused conv2d"));var D={x:v,filter:m};null!=l&&(D.bias=w),null!=h&&(D.preluActivationWeights=_);var k=N.runKernelFunc(function(M,T){var B=M.fusedConv2d({input:v,filter:m,convInfo:x,bias:w,activation:f,preluActivationWeights:_});return T([m,v,B]),B},D,function(M,T){var P=T[0],Q=T[1],Y=w_(M,T[2],f);A(pu(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var se={};return null!=l&&(se={bias:function(){return x_(w,Y)}}),Object.assign({x:function(){return _R(Q.shape,Y,P,r,o)},filter:function(){return h_(Q,Y,P.shape,r,o)}},se)},"FusedConv2D",{convInfo:x,activation:f},[m,v],[!0]);return b?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),tZ=F({fusedDepthwiseConv2d_:function(t){var n=t.x,e=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,d=t.activation,f=void 0===d?"linear":d,h=t.preluActivationWeights;if(!1===__(N.state.gradientDepth,f)){var p=Dg(n,e,r,o,a,u,c);return null!=l&&(p=Pt(p,l)),C_(p,f,h)}var g=S(n,"x","depthwiseConv2d"),m=S(e,"filter","depthwiseConv2d"),v=g,b=!1;3===g.rank&&(b=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),A(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),A(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),A(v.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),A(fo(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&A($n(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var w,_,x=Ss(v.shape,m.shape,r,u,o,c,!0);null!=l&&(w=Un(w=S(l,"bias","fused conv2d"),g)[0],Ot(x.outShape,w.shape)),null!=h&&(_=S(h,"prelu weights","fused depthwiseConv2d"));var D={x:v,filter:m};null!=l&&(D.bias=w),null!=h&&(D.preluActivationWeights=_);var k=N.runKernelFunc(function(M,T){var B=M.fusedDepthwiseConv2D({input:v,filter:m,convInfo:x,bias:w,activation:f,preluActivationWeights:_});return T([m,v,B]),B},D,function(M,T){A(pu(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var B=T[0],P=T[1],Z=w_(M,T[2],f),Y={};return null!=l&&(Y={bias:function(){return x_(w,Z)}}),Object.assign({x:function(){return wR(P.shape,Z,B,x)},filter:function(){return xR(P,Z,B.shape,x)}},Y)},"FusedDepthwiseConv2D",{convInfo:x,activation:f},[m,v],[!0]);return b?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),nZ=Object.freeze({matMul:JK,conv2d:eZ,depthwiseConv2d:tZ}),rZ=Object.freeze({image:b_,linalg:$K,losses:UK,spectral:SK,fused:nZ,signal:kK,square:L9,squaredDifference:nR,conv1d:GX,conv2d:li,conv3d:qX,depthwiseConv2d:Dg,separableConv2d:p_,conv2dTranspose:XX,conv3dTranspose:KX,op:F,batchNormalization2d:hX,batchNormalization3d:pX,batchNormalization4d:gX,batchNormalization:mX,batchNorm:uR,batchNorm2d:vX,batchNorm3d:yX,batchNorm4d:bX,booleanMaskAsync:function(t,n,e){return Be(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g;return je(this,function(m){switch(m.label){case 0:for(r=S(t,"tensor","boolMask"),o=S(n,"mask","boolMask","bool"),i=e??0,s=r.shape,A((a=o.rank)>0,function(){return"mask cannot be scalar"}),Yt(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(l),f=o.reshape([-1]),[4,lR(f)];case 1:return h=m.sent(),p=h.squeeze([1]),g=d_(d,p,i),t!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,g]}})})},complex:Ur,real:ui,imag:aa,concat:wr,concat1d:Eq,concat2d:Dq,concat3d:Sq,concat4d:Iq,split:L0,matMul:Sg,dot:ZX,outerProduct:YX,reverse:ff,reverse1d:QX,reverse2d:JX,reverse3d:eK,reverse4d:tK,maxPool:Ar,avgPool:hf,pool:nK,maxPool3d:rK,avgPool3d:oK,slice:ua,slice1d:iK,slice2d:aK,slice3d:DR,slice4d:sK,abs:B9,acos:j9,acosh:V9,asin:U9,asinh:H9,atan:z9,atanh:W9,ceil:$9,clipByValue:u_,cos:G9,cosh:q9,erf:X9,exp:c_,expm1:K9,floor:Z9,log:Y9,log1p:Q9,logSigmoid:J9,neg:_g,reciprocal:eX,round:tX,rsqrt:rR,sigmoid:oR,sign:nX,isNaN:rX,isInf:oX,isFinite:iX,sin:aX,sinh:sX,softplus:uX,sqrt:cX,step:lX,tan:dX,tanh:fX,all:uK,any:cK,argMax:lK,argMin:dK,logSumExp:fK,max:Ig,mean:hK,min:pK,moments:gK,sum:IR,prod:mK,equal:hR,equalStrict:OX,greater:PX,greaterEqual:pR,greaterEqualStrict:LX,greaterStrict:BX,less:jX,lessEqual:VX,lessEqualStrict:UX,lessStrict:HX,notEqual:zX,notEqualStrict:WX,add:Pt,addN:xX,addStrict:CX,atan2:EX,div:Oi,divNoNan:DX,divStrict:SX,floorDiv:dR,maximum:l_,maximumStrict:IX,minimum:fR,minimumStrict:AX,mod:MX,modStrict:TX,mul:Kr,mulStrict:kX,pow:Eg,powStrict:RX,squaredDifferenceStrict:NX,sub:Cr,subStrict:FX,elu:AR,leakyRelu:vK,prelu:MR,relu:Gn,relu6:TR,selu:yK,logicalAnd:Cg,logicalNot:_X,logicalOr:cR,logicalXor:wX,where:vu,whereAsync:lR,buffer:Et,print:function Pq(t,n){void 0===n&&(n=!1),console.log(t.toString(n))},batchToSpaceND:WT,broadcastTo:Lq,cast:Bq,clone:jq,cumsum:Vq,depthToSpace:Uq,expandDims:ci,eye:$T,multinomial:Hq,oneHot:j0,pad:hu,pad1d:zq,pad2d:Wq,pad3d:$q,pad4d:Gq,rand:qq,randomNormal:Xq,randomGamma:Kq,randomUniform:GT,reshape:Ni,spaceToBatchND:qT,squeeze:XT,stack:$o,tile:Wc,truncatedNormal:Zq,unstack:xr,setdiff1dAsync:function(t,n){return Be(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return je(this,function(f){switch(f.label){case 0:return e=S(t,"x","setdiff1d"),r=S(n,"y","setdiff1d"),A(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),A(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),A(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Gd([s],e.dtype),c=new Gd([s],"int32"),l=0,d=0;l<o.length;l++)a.has(o[l])||(u.values[d]=o[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:sa,linspace:function Cq(t,n,e){if(e<=0)throw new Error("The number of values should be positive.");return N.runKernelFunc(function(r){return r.linspace(t,n,e)},{})},ones:zc,range:og,scalar:Ce,tensor:Hr,tensor1d:pr,tensor2d:Ds,tensor3d:P0,tensor4d:Ao,tensor5d:function _q(t,n,e){if(su(t),null!=n&&5!==n.length)throw new Error("tensor5d() requires shape to have five numbers");var r=ia(t,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Es(t,n,r,e)},tensor6d:function wq(t,n,e){if(su(t),null!=n&&6!==n.length)throw new Error("tensor6d() requires shape to have six numbers");var r=ia(t,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==n)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Es(t,n=n||r,r,e)},variable:function xq(t,n,e,r){return void 0===n&&(n=!0),N.makeVariable(t,n,e,r)},zeros:Bn,onesLike:zT,zerosLike:Qt,transpose:Is,softmax:za,logSoftmax:Jq,localResponseNormalization:bK,norm:kR,gather:d_,unsortedSegmentSum:vR,basicLSTMCell:_K,multiRNNCell:wK,movingAverage:xK,stridedSlice:CK,topk:EK,scatterND:DK,fft:g_,ifft:Ag,rfft:m_,irfft:RR,sparseToDense:IK,gatherND:AK,diag:MK,dropout:TK,hannWindow:v_,hammingWindow:FR,frame:y_,stft:OR,inTopKAsync:function(t,n,e){return void 0===e&&(e=1),Be(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,g,m;return je(this,function(v){switch(v.label){case 0:return r=S(t,"predictions","inTopK"),o=S(n,"targets","inTopK"),A(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),A(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Yt(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],A(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),l=(u=[a.length/i,i])[1],d=jc("bool",c=u[0]),f=0;f<c;f++){for(p=a.subarray(h=f*l,h+l),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort(function(b,w){return w.value-b.value}),d[f]=0,m=0;m<e;m++)if(g[m].index===s[f]){d[f]=1;break}}return t!==r&&r.dispose(),n!==o&&o.dispose(),[2,Hr(d,o.shape,"bool")]}})})}});function ae(t,n){Array.isArray(t)||(t=[t]),t.forEach(function(e){null!=e&&A("complex64"!==e.dtype,function(){return n+" does not support complex64 tensors."})})}function E_(t,n,e,r){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);if("elu"===e)return t.elu(n);if("relu6"===e)return t.relu6(n);if("prelu"===e)return t.prelu(n,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var oZ=function(t){function n(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new nk(e,N),e}return Ai(n,t),n.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&ng("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var i={};return this.data.set(i,{values:e,dtype:o}),i},n.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var r=this.data.get(e),i=r.complexTensors;return"complex64"===r.dtype?K0(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if("string"===e.dtype)try{o=r.map(function(i){return Hd(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Et(e.shape,e.dtype,o)},n.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return N.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return Be(this,void 0,void 0,function(){var r;return je(this,function(o){return r=Ti(),e(),[2,{kernelMs:Ti()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:N.keep(e.clone()),imag:N.keep(r.clone())},o},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,r,o){if(ae(e,"slice"),z0(e.shape,r,o)){var i=W0(r,e.strides),a=$e(o);return Hr(this.readSync(e.dataId).subarray(i,i+a),o,e.dtype)}for(var s=Et(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,f){return d+r[f]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,r,o,i){ae(e,"stridedSlice");var a=lg(r,o,i);if(a.some(function(h){return 0===h}))return Hr([],a);for(var s=Et(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=Et([e.size,e.size],e.dtype),i=o.values,a=0;a<r.length;a++)i[a*e.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.reverse=function(e,r){ae(e,"reverse");for(var o=Et(e.shape,e.dtype),i=this.bufferSync(e),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(e,r){var o=this;if("complex64"===e[0].dtype){var i=e.map(function(h){return ui(h)}),a=e.map(function(h){return aa(h)});return Ur(this.concat(i,r),this.concat(a,r))}var s=e.map(function(h){var p=$e(h.shape.slice(r));return h.as2D(-1,p)}),u=lu(s.map(function(h){return h.shape}),1),c=Et(u,e[0].dtype).values;if(1===s[0].shape[0]){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),g=0,m=0;m<h.shape[0];++m)for(var v=m*u[1]+d,b=0;b<h.shape[1];++b)c[v+b]=p[g++];d+=h.shape[1]})}var f=lu(e.map(function(h){return h.shape}),r);return Hr(c,f,e[0].dtype)},n.prototype.neg=function(e){return ae(e,"neg"),this.multiply(Ce(-1),e)},n.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(e,r,Ir(e.dtype,r.dtype),function(o,i){return o+i})},n.prototype.addN=function(e){var r=this;ae(e,"addN");for(var o=e.map(function(l){return r.readSync(l.dataId)}),i=Et(e[0].shape,e[0].dtype),a=i.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(e,r){var o=hr([r],e.shape),i=this.max(e,o),a=lo(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(e,r,Ir(e.dtype,r.dtype),function(o,i){return o-i})},n.prototype.pow=function(e,r){return ae([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},n.prototype.batchMatMul=function(e,r,o,i){ae([e,r],"matMul");for(var a=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],g=f[2],m=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=m[0],b=m[1],w=m[2],_=s*u,x=Et([c,s,u],e.dtype),D=x.values,R=this.blockSize,k=0;k<c;k++)for(var M=0;M<s;M+=R)for(var T=0;T<u;T+=R)for(var B=0;B<a;B+=R)for(var P=Math.min(M+R,s),Q=Math.min(T+R,u),Z=Math.min(B+R,a),Y=M;Y<P;Y++)for(var se=T;se<Q;se++){for(var ne=0,ee=B;ee<Z;ee++)ne+=l[k*h+Y*p+ee*g]*d[ee*v+se*b+k*w];D[k*_+(Y*u+se)]+=ne}return x.toTensor()},n.prototype.fusedBatchMatMul=function(e){var s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return s&&(l=this.add(l,s)),u&&(l=E_(this,l,u,c)),l},n.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(e,r,Ir(e.dtype,r.dtype),function(o,i){return o*i})},n.prototype.realDivide=function(e,r){return ae([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},n.prototype.floorDiv=function(e,r){return ae([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},n.prototype.sum=function(e,r){ae(e,"sum"),Io("sum",r,e.rank);for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],Ir(e.dtype,"int32")),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return s},n.prototype.prod=function(e,r){ae(e,"sum");for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],Ir(e.dtype,"int32")),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return s},n.prototype.unsortedSegmentSum=function(e,r,o){ae(e,"unsortedSegmentSum");for(var i=[],a=e.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=Ce(s,"int32"),c=hR(u,r).asType("float32").mul(e).sum(0);i.push(c)}return $o(i)},n.prototype.argMin=function(e,r){ae(e,"argMin");var o=[r];Io("argMin",o,e.rank);for(var i=Vr(e.shape,o),s=i[1],u=Bn(i[0],"int32"),c=$e(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v<p&&(p=v,g=m)}l[f]=g}return u},n.prototype.argMax=function(e,r){ae(e,"argMax");var o=[r];Io("argMax",o,e.rank);for(var i=Vr(e.shape,o),s=i[1],u=Bn(i[0],"int32"),c=$e(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],g=0,m=0;m<c;++m){var v=d[h+m];v>p&&(p=v,g=m)}l[f]=g}return u},n.prototype.cumsum=function(e,r,o,i){if(ae(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var a=Ir(e.dtype,"int32"),s=Bn(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(m,v){return m+l-v-1}:function(m,v){return m+v},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(0===h)u[p]=o?0:c[p];else{var g=d(f,h-1);u[p]=o?c[g]+u[g]:c[p]+u[g]}}return s},n.prototype.equal=function(e,r){return ae([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},n.prototype.notEqual=function(e,r){return ae([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},n.prototype.less=function(e,r){return ae([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},n.prototype.lessEqual=function(e,r){return ae([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},n.prototype.greater=function(e,r){return ae([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},n.prototype.greaterEqual=function(e,r){return ae([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},n.prototype.logicalNot=function(e){ae(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},n.prototype.logicalAnd=function(e,r){return ae([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},n.prototype.logicalOr=function(e,r){return ae([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},n.prototype.select=function(e,r,o){ae([e,r,o],"select");for(var i=this.readSync(e.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Bn(r.shape,Ir(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,d=0===e.rank||e.rank>1||1===r.rank?1:$e(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)c[l++]=1===i[f]?a[f]:s[f];return u},n.prototype.where=function(e){ae([e],"where");var r=this.readSync(e.dataId);return Q0(e.shape,r)},n.prototype.topk=function(e,r,o){return ae(e,"topk"),ck(this.readSync(e.dataId),e.shape,e.dtype,r)},n.prototype.min=function(e,r){ae(e,"min"),Io("min",r,e.rank);for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],e.dtype),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g<h&&(h=g)}c[d]=h}return s},n.prototype.minimum=function(e,r){return ae([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},n.prototype.mod=function(e,r){return ae([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},n.prototype.max=function(e,r){ae(e,"max"),Io("max",r,e.rank);for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],e.dtype),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var g=l[f+p];g>h&&(h=g)}c[d]=h}return s},n.prototype.maximum=function(e,r){return ae([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},n.prototype.all=function(e,r){ae(e,"all"),Io("all",r,e.rank);for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],e.dtype),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h&&l[f+p];c[d]=h}return s},n.prototype.any=function(e,r){ae(e,"any"),Io("any",r,e.rank);for(var o=Vr(e.shape,r),a=o[1],s=Bn(o[0],e.dtype),u=$e(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h||l[f+p];c[d]=h}return s},n.prototype.squaredDifference=function(e,r){return ae([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o-i;return a*a})},n.prototype.ceil=function(e){ae(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.floor=function(e){ae(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sign=function(e){ae(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=r[i]<0?-1:r[i]>0?1:0;return this.makeOutput(o,e.shape,"float32")},n.prototype.isNaN=function(e){ae(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isInf=function(e){ae(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.isFinite=function(e){ae(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},n.prototype.round=function(e){ae(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);o[i]=r[i]-a<.5?Math.floor(r[i]):r[i]-a>.5?Math.ceil(r[i]):a%2==0?a:a+1}return this.makeOutput(o,e.shape,"float32")},n.prototype.exp=function(e){ae(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.expm1=function(e){ae(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log=function(e){ae(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.log1p=function(e){ae(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log1p(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.sqrt=function(e){ae(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.rsqrt=function(e){ae(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},n.prototype.reciprocal=function(e){ae(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){ae(e,"relu");for(var r=Bn(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(e){ae(e,"relu");for(var r=Bn(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(e,r){return ae([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},n.prototype.elu=function(e){ae(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,e.shape,"float32")},n.prototype.eluDer=function(e,r){ae([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(e){ae(e,"selu");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},n.prototype.clip=function(e,r,o){ae(e,"clip");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,e.shape,"float32")},n.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i)r[i]=Math.hypot(o[2*i],o[2*i+1]);return this.makeOutput(r,e.shape,"float32")},n.prototype.int=function(e){ae(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},n.prototype.sigmoid=function(e){ae(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},n.prototype.softplus=function(e){ae(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var l,s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]);l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,e.shape,"float32")},n.prototype.sin=function(e){ae(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cos=function(e){ae(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tan=function(e){ae(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asin=function(e){ae(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acos=function(e){ae(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan=function(e){ae(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atan2=function(e,r){return ae([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},n.prototype.sinh=function(e){ae(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.cosh=function(e){ae(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.tanh=function(e){ae(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=YM(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.asinh=function(e){ae(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.acosh=function(e){ae(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.atanh=function(e){ae(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},n.prototype.erf=function(e){ae(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},n.prototype.step=function(e,r){void 0===r&&(r=0),ae(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];o[a]=isNaN(s)?NaN:s>0?1:r}return this.makeOutput(o,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=E_(this,c,s,u)),c},n.prototype.conv2d=function(e,r,o){ae([e,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d="channelsLast"===o.dataFormat,f=Et(o.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],g=d?e.strides[2]:1,m=d?1:e.strides[1],v=f.strides[0],b=d?f.strides[1]:f.strides[2],w=d?f.strides[2]:1,_=d?1:f.strides[1],x=this.readSync(e.dataId),D=this.readSync(r.dataId),R=f.values,k=0;k<o.batchSize;++k)for(var M=k*h,T=k*v,B=0;B<o.outHeight;++B)for(var P=T+B*b,Q=B*o.strideHeight-l,Z=0;Z<i;Z++){var Y=Q+Z*s;if(!(Y<0||Y>=o.inHeight))for(var se=Z*r.strides[0],ne=M+Y*p,ee=0;ee<o.outWidth;++ee)for(var ue=P+ee*w,he=ee*o.strideWidth-c,Re=0;Re<a;Re++){var Ye=he+Re*u;if(!(Ye<0||Ye>=o.inWidth))for(var tt=ne+Ye*g,Nt=se+Re*r.strides[1],Ft=0;Ft<o.inChannels;++Ft){for(var Ut=x[tt+Ft*m],Jt=0;Jt<o.outChannels;++Jt)R[ue+Jt*_]+=Ut*D[Nt+Jt];Nt+=o.outChannels}}}return f.toTensor()},n.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=Et(o.outShape,e.dtype),g=this.readSync(e.dataId),m=this.readSync(r.dataId),v=p.values,b=0;b<o.batchSize;++b)for(var w=b*e.strides[0],_=b*p.strides[0],x=0;x<o.outDepth;++x)for(var D=_+x*p.strides[1],R=x*o.strideDepth-d,k=0;k<i;k++){var M=R+k*u;if(!(M<0||M>=o.inDepth))for(var T=k*r.strides[0],B=w+M*e.strides[1],P=0;P<o.outHeight;++P)for(var Q=D+P*p.strides[2],Z=P*o.strideHeight-h,Y=0;Y<a;Y++){var se=Z+Y*c;if(!(se<0||se>=o.inHeight))for(var ne=T+Y*r.strides[1],ee=B+se*e.strides[2],ue=0;ue<o.outWidth;++ue)for(var he=Q+ue*o.outChannels,Re=ue*o.strideWidth-f,Ye=0;Ye<s;Ye++){var tt=Re+Ye*l;if(!(tt<0||tt>=o.inWidth))for(var Ft=ee+tt*o.inChannels,Ut=ne+Ye*r.strides[2],Jt=0;Jt<o.inChannels;++Jt){for(var $t=g[Ft+Jt],en=0;en<o.outChannels;++en)v[he+en]+=$t*m[Ut+en];Ut+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(e,r,o){ae([e,r],"conv2dDerInput");for(var i=Et(o.inShape,"float32"),a=i.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=o.batchSize,p=o.filterHeight,g=o.filterWidth,m=o.inChannels,v=o.inHeight,b=o.inWidth,w=o.outChannels,_=o.outHeight,x=o.outWidth,D=o.strideHeight,R=o.strideWidth,M=p-1-o.padInfo.top,T=g-1-o.padInfo.left,B="channelsLast"===o.dataFormat,P=i.strides[0],Q=B?i.strides[1]:i.strides[2],Z=B?i.strides[2]:1,Y=B?1:i.strides[1],se=e.strides[0],ne=B?e.strides[1]:e.strides[2],ee=B?e.strides[2]:1,ue=B?1:e.strides[1],he=0;he<h;++he)for(var Re=0;Re<m;++Re)for(var Ye=0;Ye<v;++Ye)for(var tt=Ye-M,Nt=Math.max(0,Math.ceil(tt/D)),Ft=Math.min(_,(p+tt)/D),Ut=0;Ut<b;++Ut){for(var Jt=Ut-T,$t=Math.max(0,Math.ceil(Jt/R)),en=Math.min(x,(g+Jt)/R),sr=0,Gt=Nt;Gt<Ft;++Gt)for(var yn=Gt*D-tt,sn=$t;sn<en;++sn)for(var rr=se*he+ne*Gt+ee*sn,qn=l*(p-1-yn)+d*(g-1-(sn*R-Jt))+f*Re,Xn=0;Xn<w;++Xn)sr+=s[rr+ue*Xn]*u[qn+Xn];a[P*he+Q*Ye+Z*Ut+Y*Re]=sr}return i.toTensor()},n.prototype.conv3dDerInput=function(e,r,o){for(var i=Et(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],g=h[1],m=h[2],v=h[3],b=this.readSync(r.dataId),w=r.strides,_=w[0],x=w[1],D=w[2],R=w[3],k=o.batchSize,M=o.filterDepth,T=o.filterHeight,B=o.filterWidth,P=o.inChannels,Q=o.inDepth,Z=o.inHeight,Y=o.inWidth,se=o.outChannels,ne=o.outDepth,ee=o.outHeight,ue=o.outWidth,he=o.strideDepth,Re=o.strideHeight,Ye=o.strideWidth,tt=M-1-o.padInfo.front,Nt=T-1-o.padInfo.top,Ft=B-1-o.padInfo.left,Ut=0;Ut<k;++Ut)for(var Jt=0;Jt<P;++Jt)for(var $t=0;$t<Q;++$t)for(var en=$t-tt,sr=Math.max(0,Math.ceil(en/he)),Gt=Math.min(ne,(M+en)/he),yn=0;yn<Z;++yn)for(var sn=yn-Nt,rr=Math.max(0,Math.ceil(sn/Re)),qn=Math.min(ee,(T+sn)/Re),Xn=0;Xn<Y;++Xn){for(var pa=Xn-Ft,ga=Math.max(0,Math.ceil(pa/Ye)),Ko=Math.min(ue,(B+pa)/Ye),al=0,Ya=sr;Ya<Gt;++Ya)for(var Os=Ya*he-en,Qa=rr;Qa<qn;++Qa)for(var sl=Qa*Re-sn,Ja=ga;Ja<Ko;++Ja)for(var Sw=p*Ut+g*Ya+m*Qa+v*Ja,ul=_*(M-1-Os)+x*(T-1-sl)+D*(B-1-(Ja*Ye-pa))+R*Jt,ma=0;ma<se;++ma)al+=f[Sw+ma]*b[ul+ma];a[u*Ut+c*$t+l*yn+d*Xn+Jt]=al}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,r,o){ae([e,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,l=Et(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var m=Math.max(0,Math.ceil((f-g)/i)),v=Math.min(o.outHeight,(o.inHeight+f-g)/i),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((d-b)/a)),_=Math.min(o.outWidth,(o.inWidth+d-b)/a),x=0;x<o.inChannels;++x)for(var D=0;D<o.outChannels;++D){for(var R=0,k=0;k<o.batchSize;++k)for(var M=m;M<v;++M)for(var T=g+M*i-f,B=w;B<_;++B){var P=b+B*a-d;R+=c?h.get(k,T,P,x)*p.get(k,M,B,D):h.get(k,x,T,P)*p.get(k,D,M,B)}l.set(R,g,b,x,D)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=Et(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],g=h[1],m=h[2],v=h[3],b=this.readSync(r.dataId),w=r.strides,_=w[0],x=w[1],D=w[2],R=w[3],k=this.readSync(e.dataId),M=e.strides,T=M[0],B=M[1],P=M[2],Q=M[3],Z=o.padInfo.front,Y=o.padInfo.left,se=o.padInfo.top,ne=0;ne<u;++ne)for(var ee=Math.max(0,Math.ceil((Z-ne)/i)),ue=Math.min(o.outDepth,(o.inDepth+Z-ne)/i),he=ne*p,Re=0;Re<c;++Re)for(var Ye=Math.max(0,Math.ceil((se-Re)/a)),tt=Math.min(o.outHeight,(o.inHeight+se-Re)/a),Nt=Re*g+he,Ft=0;Ft<l;++Ft)for(var Ut=Math.max(0,Math.ceil((Y-Ft)/s)),Jt=Math.min(o.outWidth,(o.inWidth+Y-Ft)/s),$t=Ft*m+Nt,en=0;en<o.inChannels;++en)for(var sr=en*v+$t,Gt=0;Gt<o.outChannels;++Gt){for(var yn=0,sn=0;sn<o.batchSize;++sn)for(var rr=sn*T,qn=sn*_,Xn=ee;Xn<ue;++Xn)for(var pa=(ne+Xn*i-Z)*B+rr,ga=Xn*x+qn,Ko=Ye;Ko<tt;++Ko)for(var al=(Re+Ko*a-se)*P+pa,Ya=Ko*D+ga,Os=Ut;Os<Jt;++Os)yn+=k[(Ft+Os*s-Y)*Q+al+en]*b[Os*R+Ya+Gt];f[sr+Gt]=yn}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=E_(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,r,o){ae([e,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.outChannels/o.inChannels,f=Et(o.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),g=f.values,m=0;m<o.batchSize;++m)for(var v=m*e.strides[0],b=m*f.strides[0],w=0;w<o.outHeight;++w)for(var _=b+w*f.strides[1],x=w*o.strideHeight-c,D=0;D<i;++D){var R=x+D*s;if(!(R<0||R>=o.inHeight))for(var k=D*r.strides[0],M=v+R*e.strides[1],T=0;T<o.outWidth;++T)for(var B=_+T*f.strides[2],P=T*o.strideWidth-l,Q=0;Q<a;++Q){var Z=P+Q*u;if(!(Z<0||Z>=o.inWidth))for(var se=M+Z*o.inChannels,ne=B,ee=k+Q*r.strides[1],ue=0;ue<o.inChannels;++ue){for(var he=h[se+ue],Re=0;Re<d;++Re)g[ne+Re]+=he*p[ee+Re];ne+=d,ee+=d}}}return f.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,r,o){ae([e,r],"depthwiseConv2DDerInput");for(var i=Et(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],g=f[2],m=this.readSync(r.dataId),v=r.strides,b=v[0],w=v[1],_=v[2],x=o.batchSize,D=o.filterHeight,R=o.filterWidth,k=o.inChannels,M=o.inHeight,T=o.inWidth,P=o.outHeight,Q=o.outWidth,Z=o.strideHeight,Y=o.strideWidth,se=D-1-o.padInfo.top,ne=R-1-o.padInfo.left,ee=o.outChannels/k,ue=0;ue<x;++ue)for(var he=0;he<k;++he)for(var Re=0;Re<M;++Re)for(var Ye=Re-se,tt=Math.max(0,Math.ceil(Ye/Z)),Nt=Math.min(P,(D+Ye)/Z),Ft=0;Ft<T;++Ft){for(var Ut=Ft-ne,Jt=Math.max(0,Math.ceil(Ut/Y)),$t=Math.min(Q,(R+Ut)/Y),en=0,sr=tt;sr<Nt;++sr)for(var Gt=sr*Z-Ye,yn=Jt;yn<$t;++yn)for(var sn=h*ue+p*sr+g*yn,rr=b*(D-1-Gt)+w*(R-1-(yn*Y-Ut))+_*he,qn=0;qn<ee;++qn)en+=d[sn+(he*ee+qn)]*m[rr+qn];a[u*ue+c*Re+l*Ft+he]=en}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,r,o){ae([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Et(o.filterShape,"float32"),l=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),g=0;g<s;++g)for(var m=Math.max(0,Math.ceil((d-g)/i)),v=Math.min(o.outHeight,(o.inHeight+d-g)/i),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((l-b)/a)),_=Math.min(o.outWidth,(o.inWidth+l-b)/a),x=0;x<o.outChannels;++x){for(var D=Math.trunc(x/f),R=x%f,k=0,M=0;M<o.batchSize;++M)for(var T=m;T<v;++T)for(var B=g+T*i-d,P=w;P<_;++P)k+=h.get(M,B,b+P*a-l,D)*p.get(M,T,P,x);c.set(k,g,b,D,R)}return c.toTensor()},n.prototype.tile=function(e,r){return ae(e,"tile"),uk(this.bufferSync(e),r)},n.prototype.pad=function(e,r,o){ae(e,"pad");var i=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=Et(i,e.dtype);0!==o&&u.values.fill(o);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,r){ae(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var a=this.readSync(e.dataId),s=Et(o,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=s.locToIndex(l);s.values[f]=a[i]}return s.toTensor()},n.prototype.gather=function(e,r,o){ae([e,r],"gather");var i=e.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Et(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[o]=a[l[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,r,o){ae([e],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=ag(e.shape,r,i),s=sg(a.length,r.length),u=ug(e.shape,r,i),c=KT(o,r.length),l=ZT(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,r,o){ae([e],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=ag(u.shape,r,i,!1),l=sg(c.length,r.length,!1),d=ug(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,r,o){ae(e,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),g=Et(r.outShape,e.dtype),m=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],w=r.outShape[3],_=0;_<r.batchSize;++_)for(var x=_*v,D=_*e.strides[0],R=0;R<r.inChannels;++R)for(var k=0;k<r.outHeight;++k)for(var M=k*i-d,T=Math.max(0,M),B=Math.min(r.inHeight,c+M),P=x+k*b,Q=0;Q<r.outWidth;++Q){for(var Z=Q*a-f,Y=Math.max(0,Z),se=Math.min(r.inWidth,l+Z),ne=h,ee=0,ue=0,he=T;he<B;he+=s){for(var Re=D+he*e.strides[1],Ye=Y;Ye<se;Ye+=u){var tt=p[Re+Ye*e.strides[2]+R];"max"===o&&tt>ne?ne=tt:"avg"===o&&(ee+=tt,ue++)}if(isNaN(ne))break}m[P+Q*w+R]="avg"===o?ee/ue:ne}return g.toTensor()},n.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},n.prototype.maxPoolPositions=function(e,r){for(var o=Et(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var m=0;m<r.outHeight;++m){for(var v=m*i-d,b=v;b<0;)b+=s;for(var w=Math.min(r.inHeight,c+v),_=0;_<r.outWidth;++_){for(var x=_*a-f,D=x;D<0;)D+=u;for(var R=Math.min(r.inWidth,l+x),k=Number.NEGATIVE_INFINITY,M=-1,T=b;T<w;T+=s)for(var B=T-v,P=D;P<R;P+=u){var Q=P-x,Z=h.get(p,T,P,g);Z>k&&(k=Z,M=B*l+Q)}o.set(M,p,m,_,g)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(e,r,o,i){ae([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,g=Et(r.shape,"float32"),m=this.bufferSync(a),v=this.bufferSync(e),b=0;b<i.batchSize;++b)for(var w=0;w<i.inChannels;++w)for(var _=0;_<i.inHeight;++_)for(var x=0;x<i.inWidth;++x){for(var D=_-p,R=x-h,k=0,M=0;M<d;M+=c){var T=(D+M)/s;if(!(T<0||T>=i.outHeight||Math.floor(T)!==T))for(var B=0;B<f;B+=l){var P=(R+B)/u;if(!(P<0||P>=i.outWidth||Math.floor(P)!==P)){var Q=d*f-1-m.get(b,T,P,w)===M*f+B?1:0;0!==Q&&(k+=v.get(b,T,P,w)*Q)}}}g.set(k,b,_,x,w)}return g.toTensor()},n.prototype.avgPoolBackprop=function(e,r,o){ae([e,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,g=Et(r.shape,"float32"),m=1/(s*u),v=this.bufferSync(e),b=0;b<o.batchSize;++b)for(var w=0;w<o.inChannels;++w)for(var _=0;_<o.inHeight;++_)for(var x=0;x<o.inWidth;++x){for(var D=_-p,R=x-h,k=0,M=0;M<d;M+=c){var T=(D+M)/i;if(!(T<0||T>=o.outHeight||Math.floor(T)!==T))for(var B=0;B<f;B+=l){var P=(R+B)/a;P<0||P>=o.outWidth||Math.floor(P)!==P||(k+=v.get(b,T,P,w))}}g.set(k*m,b,_,x,w)}return g.toTensor()},n.prototype.pool3d=function(e,r,o){ae(e,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),w=Et(r.outShape,e.dtype),_=w.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],D=r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[3]*r.outShape[4],k=r.outShape[4],M=0;M<r.batchSize;++M)for(var T=M*x,B=M*e.strides[0],P=0;P<r.inChannels;++P)for(var Q=0;Q<r.outDepth;++Q){for(var Z=Q*i-p,Y=Z;Y<0;)Y+=u;for(var se=Math.min(r.inDepth,d+Z),ne=T+Q*D,ee=0;ee<r.outHeight;++ee){for(var ue=ee*a-g,he=ue;he<0;)he+=c;for(var Re=Math.min(r.inHeight,f+ue),Ye=ne+ee*R,tt=0;tt<r.outWidth;++tt){for(var Nt=tt*s-m,Ft=Nt;Ft<0;)Ft+=l;for(var Ut=Math.min(r.inWidth,h+Nt),Jt=Ye+tt*k,$t=v,en=0,sr=0,Gt=Y;Gt<se;Gt+=u){for(var yn=B+Gt*e.strides[1],sn=he;sn<Re;sn+=c){for(var rr=yn+sn*e.strides[2],qn=Ft;qn<Ut;qn+=l){var Xn=b[rr+qn*e.strides[3]+P];if("max"===o&&Xn>$t?$t=Xn:"avg"===o&&(en+=Xn,sr++),isNaN($t))break}if(isNaN($t))break}if(isNaN($t))break}_[Jt+P]="avg"===o?en/sr:$t}}}return w.toTensor()},n.prototype.avgPool3d=function(e,r){return ae(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,r,o){ae([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,g=o.effectiveFilterHeight,m=o.effectiveFilterWidth,v=p-1-o.padInfo.front,b=m-1-o.padInfo.left,w=g-1-o.padInfo.top,_=Et(r.shape,"float32"),x=1/(u*c*l),D=this.bufferSync(e),R=0;R<o.batchSize;++R)for(var k=0;k<o.inChannels;++k)for(var M=0;M<o.inDepth;++M)for(var T=0;T<o.inHeight;++T)for(var B=0;B<o.inWidth;++B){for(var P=M-v,Q=T-w,Z=B-b,Y=0,se=0;se<p;se+=d){var ne=(P+se)/i;if(!(ne<0||ne>=o.outDepth||Math.floor(ne)!==ne))for(var ee=0;ee<g;ee+=f){var ue=(Q+ee)/a;if(!(ue<0||ue>=o.outHeight||Math.floor(ue)!==ue))for(var he=0;he<m;he+=h){var Re=(Z+he)/s;Re<0||Re>=o.outWidth||Math.floor(Re)!==Re||(Y+=D.get(R,ne,ue,Re,k))}}}_.set(Y*x,R,M,T,B,k)}return _.toTensor()},n.prototype.maxPool3d=function(e,r){return ae(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,r){for(var o=Et(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.outDepth;++_){for(var x=_*i-p,D=x;D<0;)D+=u;for(var R=Math.min(r.inDepth,d+x),k=0;k<r.outHeight;++k){for(var M=k*a-g,T=M;T<0;)T+=c;for(var B=Math.min(r.inHeight,f+M),P=0;P<r.outWidth;++P){for(var Q=P*s-m,Z=Q;Z<0;)Z+=l;for(var Y=Math.min(r.inWidth,h+Q),se=Number.NEGATIVE_INFINITY,ne=-1,ee=D;ee<R;ee+=u)for(var ue=ee-x,he=T;he<B;he+=c)for(var Re=he-M,Ye=Z;Ye<Y;Ye+=l){var tt=Ye-Q,Nt=v.get(b,ee,he,Ye,w);Nt>=se&&(se=Nt,ne=ue*f*h+Re*f+tt)}o.set(ne,b,_,k,P,w)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(e,r,o,i){ae([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,g=i.effectiveFilterWidth,m=h-1-i.padInfo.front,v=g-1-i.padInfo.left,b=p-1-i.padInfo.top,w=Et(r.shape,"float32"),_=this.bufferSync(a),x=this.bufferSync(e),D=0;D<i.batchSize;++D)for(var R=0;R<i.inChannels;++R)for(var k=0;k<i.inDepth;++k)for(var M=0;M<i.inHeight;++M)for(var T=0;T<i.inWidth;++T){for(var B=k-m,P=M-b,Q=T-v,Z=0,Y=0;Y<h;Y+=l){var se=(B+Y)/s;if(!(se<0||se>=i.outDepth||Math.floor(se)!==se))for(var ne=0;ne<p;ne+=d){var ee=(P+ne)/u;if(!(ee<0||ee>=i.outHeight||Math.floor(ee)!==ee))for(var ue=0;ue<g;ue+=f){var he=(Q+ue)/c;if(!(he<0||he>=i.outWidth||Math.floor(he)!==he)){var Re=h*p*g-1-_.get(D,se,ee,he,R)===Y*p*g+ne*g+ue?1:0;0!==Re&&(Z+=x.get(D,se,ee,he,R)*Re)}}}}w.set(Z,D,k,M,T,R)}return w.toTensor()},n.prototype.cast=function(e,r){return q0(e,r,this)},n.prototype.reshape=function(e,r){return gg(e,r)},n.prototype.avgPool=function(e,r){return ae(e,"avgPool"),this.pool(e,r,"avg").toFloat()},n.prototype.resizeBilinear=function(e,r,o,i){ae(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array($e([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=0,m=h[0]/p[0],v=h[1]/p[1],b=0;b<s;b++)for(var w=0;w<r;w++)for(var _=m*w,x=Math.floor(_),D=_-x,R=Math.min(u-1,Math.ceil(_)),k=b*e.strides[0]+x*e.strides[1],M=b*e.strides[0]+R*e.strides[1],T=0;T<o;T++)for(var B=v*T,P=Math.floor(B),Q=B-P,Z=Math.min(c-1,Math.ceil(B)),Y=k+P*e.strides[2],se=M+P*e.strides[2],ne=k+Z*e.strides[2],ee=M+Z*e.strides[2],ue=0;ue<l;ue++){var he=d[Y+ue],Re=d[se+ue],Ye=he+(d[ne+ue]-he)*Q;f[g++]=Ye+(Re+(d[ee+ue]-Re)*Q-Ye)*D}return Hr(f,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(e,r,o){ae([e,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=p[0]/g[0],v=p[1]/g[1],b=this.readSync(e.dataId),w=0,_=0;_<a;_++)for(var x=_*r.strides[0],D=0;D<d;D++)for(var R=D*m,k=Math.floor(R),M=Math.min(Math.ceil(R),s-1),T=x+k*r.strides[1],B=x+M*r.strides[1],P=R-k,Q=1-P,Z=0;Z<f;Z++)for(var Y=Z*v,se=Math.floor(Y),ne=Math.min(Math.ceil(Y),u-1),ee=Y-se,ue=1-ee,he=T+se*r.strides[2],Re=T+ne*r.strides[2],Ye=B+se*r.strides[2],tt=B+ne*r.strides[2],Nt=Q*ue,Ft=Q*ee,Ut=P*ue,Jt=P*ee,$t=0;$t<c;$t++){var en=b[w++];h[he+$t]+=en*Nt,h[Re+$t]+=en*Ft,h[Ye+$t]+=en*Ut,h[tt+$t]+=en*Jt}return Ao(h,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(e,r,o,i){ae(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],g=h[0]/p[0],m=h[1]/p[1],v=0,b=0;b<s;b++)for(var w=b*e.strides[0],_=0;_<r;_++)for(var x=g*_,D=w+Math.min(u-1,i?Math.round(x):Math.floor(x))*e.strides[1],R=0;R<o;R++)for(var k=m*R,M=D+Math.min(c-1,i?Math.round(k):Math.floor(k))*e.strides[2],T=0;T<l;T++)f[v++]=d[M+T];return Hr(f,[s,r,o,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,r,o){ae([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(e.dataId),g=[o&&d>1?s-1:s,o&&f>1?u-1:u],m=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=g[0]/m[0],b=g[1]/m[1],w=1/v,_=1/b,x=2*Math.ceil(w)+2,D=2*Math.ceil(_)+2,R=0;R<a;R++)for(var k=R*r.strides[0],M=0;M<s;M++)for(var T=k+M*r.strides[1],B=Math.floor(M*w),P=Math.floor(B-x/2),Q=0;Q<u;Q++)for(var Z=T+Q*r.strides[2],Y=Math.floor(Q*_),se=Math.floor(Y-D/2),ne=0;ne<c;ne++){for(var ee=0,ue=0;ue<x;ue++){var he=ue+P;if(!(he<0||he>=d)){var Re=k+he*e.strides[1],Ye=he*v;if(M===Math.min(s-1,o?Math.round(Ye):Math.floor(Ye)))for(var tt=0;tt<D;tt++){var Nt=tt+se;if(!(Nt<0||Nt>=f)){var Ft=Re+Nt*e.strides[2],Ut=Nt*b;Q===Math.min(u-1,o?Math.round(Ut):Math.floor(Ut))&&(ee+=p[Ft+ne])}}}}h[Z+ne]=ee}return Ao(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(e,r,o,i,a,s){ae([e,r,o,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,g=d.length,m=l.length,v=c.length,b=0,w=0,_=0,x=0,D=0;D<u.length;++D)h[D]=f[b++]+(u[D]-c[w++])*d[_++]/Math.sqrt(l[x++]+i),b>=p&&(b=0),w>=v&&(w=0),_>=g&&(_=0),x>=m&&(x=0);return Ao(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,r,o,i,a){ae(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(m){for(var v=m%s,b=m-v+Math.max(0,v-r),w=m-v+Math.min(v+r,u),_=0;b<=w;b++){var x=c[b];_+=x*x}return _}for(var h=0;h<l;h++){var p=f(h),g=c[h]*Math.pow(o+i*p,-a);d[h]=g}return Ao(d,e.shape)},n.prototype.LRNGrad=function(e,r,o,i,a,s,u){ae(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(e.size),p=e.size,g=0;g<p;g++){for(var m=g%c,v=g-m+Math.max(0,m-i),b=g-m+Math.min(c,m+i+1),w=0,_=v;_<b;_++)w+=Math.pow(d[_],2);for(w=s*w+a,_=v;_<b;_++){var x=-2*s*u*d[_]*f[g]/w;g===_&&(x+=Math.pow(w,-u)),h[_]+=x*=l[g]}}return Ao(h,e.shape)},n.prototype.multinomial=function(e,r,o,i){ae(e,"multinomial");for(var a=r?e:za(e),s=a.shape[0],u=a.shape[1],c=Bn([s,o],"int32"),l=this.readSync(c.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[h+g];for(var m=ig(i.toString()),v=f*o,b=0;b<o;++b){var w=m();l[v+b]=p.length;for(var _=0;_<p.length;_++)if(w<p[_]){l[v+b]=_;break}}}return c},n.prototype.oneHot=function(e,r,o,i){ae(e,"oneHot");var a=new Float32Array(e.size*r);a.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Ds(a,[e.size,r],"int32")},n.prototype.nonMaxSuppression=function(e,r,o,i,a){return ae(e,"nonMaxSuppression"),Z0(this.readSync(e.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],a=Et(e.shape,"float32"),s=Et(e.shape,"float32"),u=ui(e).as2D(o,i),c=aa(e).as2D(o,i),l=0;l<o;l++)for(var d=u.slice([l,0],[1,i]),f=c.slice([l,0],[1,i]),h=Ur(d,f),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<i;g++){var m=ok(p,g);a.values[l*i+g]=m.real,s.values[l*i+g]=m.imag}return Ur(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(a=Ur(ui(a).div(Ce(i)),aa(a).div(Ce(i)))),a}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,r));return Ur(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return 0==(e&e-1)},n.prototype.fftRadix2=function(e,r,o){if(1===r)return e;var i=this.readSync(e.dataId),a=r/2,s=function(v){for(var b=Math.ceil(v.length/4),w=new Float32Array(b),_=new Float32Array(b),x=0;x<v.length;x+=4)w[Math.floor(x/4)]=v[x],_[Math.floor(x/4)]=v[x+1];return{real:w,imag:_}}(i),u=Ur(s.real,s.imag).as1D(),c=function(v){for(var b=Math.floor(v.length/4),w=new Float32Array(b),_=new Float32Array(b),x=2;x<v.length;x+=4)w[Math.floor(x/4)]=v[x],_[Math.floor(x/4)]=v[x+1];return{real:w,imag:_}}(i),l=Ur(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var d=function(v,b){for(var w=new Float32Array(v/2),_=new Float32Array(v/2),x=0;x<Math.ceil(v/2);x++){var D=(b?2:-2)*Math.PI*(x/v);w[x]=Math.cos(D),_[x]=Math.sin(D)}return{real:w,imag:_}}(r,o),f=Ur(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),g=ui(h).concat(ui(p)),m=aa(h).concat(aa(p));return Ur(g,m).as1D()},n.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=t7(a*c,r,o),d=ok(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}o&&(s/=r,u/=r),e7(i,s,u,a)}return i},n.prototype.depthToSpace=function(e,r,o){A("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),A(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*r,l=s*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),p=0,g=0;g<i;++g)for(var m=0;m<c;++m)for(var v=Math.floor(m/r),b=m%r,w=0;w<l;++w)for(var _=Math.floor(w/r),x=(b*r+w%r)*d,D=0;D<d;++D)h[p++]=f[D+x+u*(_+s*(v+a*g))];return Ao(h,[i,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,r,o,i){var a=Ot(e.shape,r.shape),s=Et(a,o),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Wa(e.shape,a),d=Wa(r.shape,a),f=s.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),g=this.bufferSync(r),m=function(v){var b=s.indexToLoc(v),w=b.slice(-e.rank);l.forEach(function(R){return w[R]=0});var _=p.locToIndex(w),x=b.slice(-r.rank);d.forEach(function(R){return x[R]=0});var D=g.locToIndex(x);f[v]=i(u[_],c[D])};for(h=0;h<f.length;++h)m(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=Ot(e.shape,r.shape),a=Et(i,"float32"),s=Et(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Wa(e.shape,i),d=Wa(r.shape,i),f=a.values,h=s.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var g=p%u.length,m=p%c.length,v=o(u[2*g],u[2*g+1],c[2*m],c[2*m+1]);f[p]=v.real,h[p]=v.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),_=function(x){var D=a.indexToLoc(x),R=D.slice(-e.rank);l.forEach(function(P){return R[P]=0});var k=b.locToIndex(R),M=D.slice(-r.rank);d.forEach(function(P){return M[P]=0});var T=w.locToIndex(M),B=o(u[2*k],u[2*k+1],c[2*T],c[2*T+1]);f[x]=B.real,h[x]=B.imag};for(p=0;p<f.length;p++)_(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(e,r,o){return sk(e,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,r,o,i,a,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],g=i[1],m=Et([h,p,g,f],"float32"),v=this.readSync(r.dataId),b=this.readSync(o.dataId),w=this.readSync(e.dataId),_=e.strides,x=m.strides,D=0;D<h;D++){var R=4*D,k=v[R],M=v[R+1],T=v[R+2],B=v[R+3],P=b[D];if(!(P>=c))for(var Q=p>1?(T-k)*(l-1)/(p-1):0,Z=g>1?(B-M)*(d-1)/(g-1):0,Y=0;Y<p;Y++){var se=p>1?k*(l-1)+Y*Q:.5*(k+T)*(l-1);if(se<0||se>l-1)for(var ne=0;ne<g;ne++)for(var ee=0;ee<f;ee++){var ue=ee+ne*x[2]+Y*x[1]+D*x[0];m.values[ue]=s}else if("bilinear"===a){var he=Math.floor(se),Re=Math.ceil(se),Ye=se-he;for(ne=0;ne<g;ne++)if((Gt=g>1?M*(d-1)+ne*Z:.5*(M+B)*(d-1))<0||Gt>d-1)for(ee=0;ee<f;ee++)m.values[ue=ee+ne*x[2]+Y*x[1]+D*x[0]]=s;else{var tt=Math.floor(Gt),Nt=Math.ceil(Gt),Ft=Gt-tt;for(ee=0;ee<f;ee++){var Ut=w[ue=ee+tt*_[2]+he*_[1]+P*_[0]],Jt=w[ue=ee+Nt*_[2]+he*_[1]+P*_[0]],$t=w[ue=ee+tt*_[2]+Re*_[1]+P*_[0]],en=Ut+(Jt-Ut)*Ft,sr=$t+(w[ue=ee+Nt*_[2]+Re*_[1]+P*_[0]]-$t)*Ft;m.values[ue=ee+ne*x[2]+Y*x[1]+D*x[0]]=en+(sr-en)*Ye}}}else for(ne=0;ne<g;++ne){var Gt;if((Gt=g>1?M*(d-1)+ne*Z:.5*(M+B)*(d-1))<0||Gt>d-1)for(ee=0;ee<f;ee++)m.values[ue=ee+ne*x[2]+Y*x[1]+D*x[0]]=s;else{var yn=Math.round(Gt),sn=Math.round(se);for(ee=0;ee<f;ee++)m.values[ee+ne*x[2]+Y*x[1]+D*x[0]]=w[ee+yn*_[2]+sn*_[1]+P*_[0]]}}}}return m.toTensor()},n.prototype.sparseToDense=function(e,r,o,i){var a=nf(0,e,o);return this.scatter(e,r,o,a.outputSize,a.sliceSize,a.numUpdates,a.sliceRank,a.strides,i,!1)},n.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=V0(e,r),s=a[0],u=a[1],c=a[2],l=a[3];if(0===u)return Hr([],s,e.dtype);for(var d=new Gd([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var g=[],m=0,v=0;v<i;v++){var b=f[p*i+v];m+=b*l[v],g.push(b)}if(m<0||m>=e.size/c)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var w=0;w<c;w++)d.values[p*c+w]=h[m*c+w]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,r,o){var i=nf(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=Ce(0);return this.scatter(e,r,o,l,u,s,a,c,d,!0)},n.prototype.fill=function(e,r,o){var i=Ud(o=o||Vc(r),$e(e));return i.fill(r),N.makeTensor(i,e,o,this)},n.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var r=Ud(e.dtype,$e(e.shape));return this.makeOutput(r,e.shape,e.dtype)},n.prototype.linspace=function(e,r,o){return X0(e,r,o)},n.prototype.scatter=function(e,r,o,i,a,s,u,c,l,d){var f=[i/a,a],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===i)return Hr([],o,r.dtype);var g=new Gd(f,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var v=[],b=0,w=0;w<u;w++){var _=h[m*u+w];v.push(_),b+=_*c[w]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+v+" does not index into "+o);for(var x=0;x<a;x++)d?g.values[b*a+x]+=p[m*a+x]:g.values[b*a+x]=0===r.rank?p[0]:p[m*a+x]}return g.toTensor().reshape(o)},n}(rk);N.registerBackend("cpu",function(){return new oZ},1);for(var D_=0,LR=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var n=t.inputs,r=t.attrs,i=n.boxes,a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=t.backend;ae(i,"NonMaxSuppressionWithScore");var h=Y0(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var r=t.inputs.x,o=t.backend;ae(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:lf,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend;ae([o,i],lf);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(f,h,p,g,m,v){var b=Ot(f,h),w=b.length,_=Mi(b),x=jc(m,$e(b)),D=f.length,R=h.length,k=Mi(f),M=Mi(h),T=Wa(f,b),B=Wa(h,b);if(T.length+B.length===0)for(var P=0;P<x.length;++P)x[P]=v(p[P%p.length],g[P%g.length]);else{var Q=function(Z){var Y=aT(Z,w,_),se=Y.slice(-D);T.forEach(function(he){return se[he]=0});var ne=_0(se,D,k),ee=Y.slice(-R);B.forEach(function(he){return ee[he]=0});var ue=_0(ee,R,M);x[Z]=v(p[ne],g[ue])};for(P=0;P<x.length;++P)Q(P)}return[x,b]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),d=c[1];return{dataId:a.write(c[0],d,o.dtype),shape:d,dtype:o.dtype}}}];D_<LR.length;D_++)XM(LR[D_]);for(var Yc,iZ=function(t){this.variableNames=["A"];var n=Xr(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+n.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},aZ=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Xr(),e=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+n.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+n.output+" = result;\n      }\n    "},S_=0,BR=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.backend,o=t.inputs.pixels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],d=[l,c],f=[l,c,t.attrs.numChannels];(s||a)&&(null==Yc&&(Yc=document.createElement("canvas").getContext("2d")),Yc.canvas.width=c,Yc.canvas.height=l,Yc.drawImage(o,0,0,c,l),o=Yc.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=Ho.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),o);var p=X().getBool("WEBGL_PACK")?new aZ(f):new iZ(f),g=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var n=t.inputs,e=t.backend,r=t.attrs;ng("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=e,h=Y0(f.readSync(n.boxes.dataId),f.readSync(a.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var r=t.inputs.x,o=t.backend,i=new Mt(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:lf,backendName:"webgl",kernelFunc:function(t){var n=t.inputs,o=n.a,i=n.b,a=t.backend,s=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $a("return (a - b) * (a - b);",o.shape,i.shape):new nr("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];S_<BR.length;S_++)XM(BR[S_]);for(var I_=0,jR=[{kernelName:"Square",gradFunc:function(t,n){var e=n[0];return{x:function(){return t.mul(e.toFloat().mul(2))}}}},{kernelName:lf,gradFunc:function(t,n){var e=n[0],r=n[1],o=Ce(2);return{a:function(){return Kr(t,Kr(o,Cr(e,r)))},b:function(){return Kr(t,Kr(o,Cr(r,e)))}}}}];I_<jR.length;I_++)cq(jR[I_]);var sZ=function(){function t(){}return t.prototype.fetch=function(n,e){return fetch(n,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},t}();X().get("IS_BROWSER")&&X().setPlatform("browser",new sZ);var A_,cZ=function(){function t(){this.util=nt(745),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(n,e){return null!=X().global.fetch?X().global.fetch(n,e):(null==A_&&(A_=nt(318)),A_(n,e))},t.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},t.prototype.encode=function(n,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},t.prototype.decode=function(n,e){return 0===n.length?"":new this.util.TextDecoder(e).decode(n)},t}();X().get("IS_NODE")&&X().setPlatform("node",new cZ);var M_={float32:4,int32:4,uint16:2,uint8:1,bool:1},Tg=4;function VR(t,n){for(var e={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,d=$e(l),f=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=M_[h.dtype],g=t.slice(r,r+d*p),m="uint8"===h.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===c)f=Float32Array.from(m,function(D){return D*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(m,function(D){return Math.round(D*h.scale+h.min)})}r+=d*p}else if("string"===c){var v=$e(s.shape);f=[];for(var b=0;b<v;b++){var w=new Uint32Array(t.slice(r,r+Tg))[0];r+=Tg;var _=new Uint8Array(t.slice(r,r+w));f.push(_),r+=w}}else{var x=M_[c];if(g=t.slice(r,r+d*x),"float32"===c)f=new Float32Array(g);else if("int32"===c)f=new Int32Array(g);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(g)}r+=d*x}e[u]=Hr(f,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return e}function lZ(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var n=0,e=[];t.forEach(function(i){if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(n),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var T_=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function UR(t){return T_?Buffer.byteLength(t):new Blob([t]).size}function k_(t){var n=0;t.forEach(function(o){n+=o.byteLength});var e=new Uint8Array(n),r=0;return t.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function HR(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var n=t.split("/");return n[n.length-1]}function pf(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:UR(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:UR(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var Go=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(n){t.getInstance().saveRouters.push(n)},t.registerLoadRouter=function(n){t.getInstance().loadRouters.push(n)},t.getSaveHandlers=function(n){return t.getHandlers(n,"save")},t.getLoadHandlers=function(n,e){return t.getHandlers(n,"load",e)},t.getHandlers=function(n,e,r){var o=[];return("load"===e?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(i){var a=i(n,r);null!==a&&o.push(a)}),o},t}(),Qc="://",As=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(n,e){A(null!=n,function(){return"scheme must not be undefined or null."}),n.endsWith(Qc)&&(n=n.slice(0,n.indexOf(Qc))),A(n.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();A(null==r.managers[n],function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=e},t.getManager=function(n){var e=this.getInstance().managers[n];if(null==e)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function kg(t){if(-1===t.indexOf(Qc))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+As.getSchemes().join(","));return{scheme:t.split(Qc)[0],path:t.split(Qc)[1]}}function zR(t,n,e){return void 0===e&&(e=!1),Be(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d;return je(this,function(f){switch(f.label){case 0:return A(t!==n,function(){return"Old path and new path are the same: '"+t+"'"}),A((r=Go.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),A(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],A((i=Go.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),A(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),a=i[0],s=kg(t).scheme,u=kg(t).path,c=s===kg(t).scheme,[4,o.load()];case 1:return l=f.sent(),e&&c?[4,As.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,As.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var yu="models_store",Ms="model_info_store";function WR(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==n)throw new Error("The current browser does not appear to support IndexedDB.");return n}function R_(t){var n=t.result;n.createObjectStore(yu,{keyPath:"modelPath"}),n.createObjectStore(Ms,{keyPath:"modelPath"})}var Jc=function(){function t(n){if(this.indexedDB=WR(),null==n||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return t.prototype.save=function(n){return Be(this,void 0,void 0,function(){return je(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},t.prototype.load=function(){return Be(this,void 0,void 0,function(){return je(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(n,e){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return R_(a)},a.onsuccess=function(){var s=a.result;if(null==e){var u=s.transaction(yu,"readonly"),c=u.objectStore(yu).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(g){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=pf(e),f=s.transaction(Ms,"readwrite"),h=f.objectStore(Ms),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(l=s.transaction(yu,"readwrite")).objectStore(yu).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});g.onsuccess=function(){return o({modelArtifactsInfo:d})},g.onerror=function(m){var v=(h=f.objectStore(Ms)).delete(r.modelPath);v.onsuccess=function(){return s.close(),i(g.error)},v.onerror=function(b){return s.close(),i(g.error)}}},p.onerror=function(g){return s.close(),i(p.error)},f.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},t.URL_SCHEME="indexeddb://",t}(),$R=function(t){return X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Jc.URL_SCHEME)?(n=t.slice(Jc.URL_SCHEME.length),new Jc(n)):null;var n};Go.registerSaveRouter($R),Go.registerLoadRouter($R);var dZ=function(){function t(){this.indexedDB=WR()}return t.prototype.listModels=function(){return Be(this,void 0,void 0,function(){var n=this;return je(this,function(e){return[2,new Promise(function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return R_(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Ms,"readonly"),u=s.objectStore(Ms).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},t.prototype.removeModel=function(n){return Be(this,void 0,void 0,function(){var e=this;return je(this,function(r){var o;return n=(o=n).startsWith(Jc.URL_SCHEME)?o.slice(Jc.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return R_(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Ms,"readwrite"),d=l.objectStore(Ms),f=d.get(n);f.onsuccess=function(){if(null==f.result)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),p=function(){var g=(u=c.transaction(yu,"readwrite")).objectStore(yu).delete(n);g.onsuccess=function(){return i(f.result.modelArtifactsInfo)},g.onerror=function(m){return a(f.error)}};h.onsuccess=p,h.onerror=function(g){return p(),c.close(),a(f.error)}},f.onerror=function(h){return c.close(),a(f.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},t}();if(X().getBool("IS_BROWSER"))try{As.registerManager(Jc.URL_SCHEME,new dZ)}catch{}var qa="/",el="tensorflowjs_models",GR="info",fZ="model_topology",hZ="weight_specs",pZ="weight_data",gZ="model_metadata";function qR(t){return{info:[el,t,GR].join(qa),topology:[el,t,fZ].join(qa),weightSpecs:[el,t,hZ].join(qa),weightData:[el,t,pZ].join(qa),modelMetadata:[el,t,gZ].join(qa)}}function mZ(t){var n=t.split(qa);if(n.length<3)throw new Error("Invalid key format: "+t);return n.slice(1,n.length-1).join(qa)}var tl=function(){function t(n){if(!X().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==n||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=qR(this.modelPath)}return t.prototype.save=function(n){return Be(this,void 0,void 0,function(){var e,r,o;return je(this,function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=pf(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(T_)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return Be(this,void 0,void 0,function(){var n,e,r,o,i,a,s;return je(this,function(u){if(null==(n=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==n.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(T_){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),XR=function(t){return X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(tl.URL_SCHEME)?(n=t.slice(tl.URL_SCHEME.length),new tl(n)):null;var n};Go.registerSaveRouter(XR),Go.registerLoadRouter(XR);var vZ=function(){function t(){A(X().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),A(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return Be(this,void 0,void 0,function(){var n,e,r,o,i,a;return je(this,function(s){for(n={},e=el+qa,r=qa+GR,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(a=mZ(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]})})},t.prototype.removeModel=function(n){return Be(this,void 0,void 0,function(){var e,r;return je(this,function(o){var i;if(n=(i=n).startsWith(tl.URL_SCHEME)?i.slice(tl.URL_SCHEME.length):i,e=qR(n),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},t}();if(X().getBool("IS_BROWSER"))try{As.registerManager(tl.URL_SCHEME,new vZ)}catch{}function KR(t){return new Promise(function(n){return setTimeout(n)}).then(t)}var N_=function(){function t(n){if(!X().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(t.URL_SCHEME)&&(n=n.slice(t.URL_SCHEME.length)),null!=n&&0!==n.length||(n="model"),this.modelTopologyFileName=n+".json",this.weightDataFileName=n+".weights.bin"}return t.prototype.save=function(n){return Be(this,void 0,void 0,function(){var e,i,a,s;return je(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,KR(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==n.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,KR(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:pf(n)}]}})})},t.URL_SCHEME="downloads://",t}(),wZ=function(){function t(n){if(null==n||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return t.prototype.load=function(){return Be(this,void 0,void 0,function(){var n,e,r=this;return je(this,function(o){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===e.length&&i({modelTopology:l});var d=c.weightsManifest;if(null!=d){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(m){return void a(m)}var h=[],p=[],g=[];d.forEach(function(m){m.paths.forEach(function(v){p.push(v),g.push(null)}),h.push.apply(h,m.weights)}),d.forEach(function(m){m.paths.forEach(function(v){var b=new FileReader;b.onload=function(w){var _=w.target.result,x=p.indexOf(v);g[x]=_,-1===g.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:k_(g),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(w){return a("Failed to weights data from file of path '"+v+"'.")},b.readAsArrayBuffer(f[v])})})}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(n,e){for(var r=[],o=e.map(function(u){return HR(u.name)}),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach(function(u){var c=HR(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[o.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},t}();function ZR(t,n,e,r){var i;A(null!=(i=t)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){A(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),A(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),A(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(e=e??0,r=r??1);var o=0;return Promise.all(t.map(function(i){return i.then(function(a){var s=e+ ++o/t.length*(r-e);return n(s),a}),i}))}function YR(t,n){return Be(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l;return je(this,function(d){switch(d.label){case 0:return null==n&&(n={}),e=null==n.fetchFunc?X().platform.fetch:n.fetchFunc,r=t.map(function(f){return e(f,n.requestInit,{isBinary:!0})}),o=0,i=.5,null!=n.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,ZR(r,n.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=n.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,ZR(s,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function QR(t){var n=this;return function(e,r,o){return void 0===r&&(r=""),Be(n,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p;return je(this,function(g){switch(g.label){case 0:if(i=e.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],e.forEach(function(m,v){var b=0;m.weights.forEach(function(w){var x=M_["quantization"in w?w.quantization.dtype:w.dtype]*$e(w.shape),D=function(){i[v]=!0,null==a[v]&&(a[v]=[]),a[v].push({manifestEntry:w,groupOffset:b,sizeBytes:x})};null!=o?o.forEach(function(R,k){R===w.name&&(D(),s[k]=!0)}):D(),u.push(w.name),b+=x})}),!s.every(function(m){return m}))throw c=o.filter(function(m,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(m,v,b){return v&&m.push(b),m},[]),d=[],l.forEach(function(m){e[m].paths.forEach(function(v){var b=r+(r.endsWith("/")?"":"/")+v;d.push(b)})}),[4,t(d)];case 1:return f=g.sent(),h={},p=0,l.forEach(function(m){for(var v=e[m].paths.length,b=0,w=0;w<v;w++)b+=f[p+w].byteLength;for(var _=new ArrayBuffer(b),x=new Uint8Array(_),D=0,R=0;R<v;R++){var k=new Uint8Array(f[p+R]);x.set(k,D),D+=k.byteLength}a[m].forEach(function(M){var T=VR(_.slice(M.groupOffset,M.groupOffset+M.sizeBytes),[M.manifestEntry]);for(var B in T)h[B]=T[B]}),p+=v}),[2,h]}})})}}Go.registerSaveRouter(function(t){return X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(N_.URL_SCHEME)?(void 0===(n=t.slice(N_.URL_SCHEME.length))&&(n="model"),new N_(n)):null;var n});var JR=function(){function t(n,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(A("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=X().platform.fetch,A(null!=n&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&A(2===n.length,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(n){return Be(this,void 0,void 0,function(){var e,i;return je(this,function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:n.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=n.weightData&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:pf(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return Be(this,void 0,void 0,function(){var n,e,r,o,i,a,s,u,c,l,d,f;return je(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(o=e.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},t.prototype.loadWeights=function(n){return Be(this,void 0,void 0,function(){var r,o,i,a,s,u,c,d,f;return je(this,function(h){switch(h.label){case 0:for(void 0,void 0,g=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),m=p.lastIndexOf("?"),r=[p.substring(0,g)+"/",m>g?p.substring(m):""],o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)s.push.apply(s,c[u].weights);return d=[],n.forEach(function(p){p.paths.forEach(function(g){d.push(a+g+i)})}),[4,YR(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,k_(f)]]}var p,g,m})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function F_(t){return null!=t.match(JR.URL_SCHEME_REGEX)}var eN=function(t,n){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(e){return F_(e)}):F_(t))?O_(t,{onProgress:n}):null};function O_(t,n){return new JR(t,n)}Go.registerSaveRouter(eN),Go.registerLoadRouter(eN);var nl,P_=function(){function t(n){this.modelArtifacts=n}return t.prototype.load=function(){return Be(this,void 0,void 0,function(){return je(this,function(n){return[2,this.modelArtifacts]})})},t}(),xZ=function(){function t(n){this.saveHandler=n}return t.prototype.save=function(n){return Be(this,void 0,void 0,function(){return je(this,function(e){return[2,this.saveHandler(n)]})})},t}(),tN=Object.freeze({browserFiles:function(t){return new wZ(t)},browserHTTPRequest:function(t,n){return O_(t,n)},concatenateArrayBuffers:k_,decodeWeights:VR,encodeWeights:function(t,n){return Be(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return je(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(t)?t.map(function(c){return c.name}):Object.keys(t),i=function(c){var l=o[c],d=Array.isArray(t)?t[c].tensor:t[l];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var h=new Promise(function(p){return Be(s,void 0,void 0,function(){var g,m,v,b,w,_,x;return je(this,function(D){switch(D.label){case 0:return[4,d.bytes()];case 1:for(g=D.sent(),m=g.reduce(function(R,k){return R+k.length},0)+Tg*g.length,v=new Uint8Array(m),b=0,w=0;w<g.length;w++)_=g[w],x=new Uint8Array(new Uint32Array([_.length]).buffer),v.set(x,b),v.set(_,b+=Tg),b+=_.length;return p(v),[2]}})})});r.push(h)}else r.push(d.data());null!=n&&(f.group=n),e.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:lZ(u.sent()),specs:e}]}})})},fromMemory:function(t,n,e,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new P_(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new P_({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new P_({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))},getLoadHandlers:function(t,n){return Go.getLoadHandlers(t,n)},getModelArtifactsInfoForJSON:pf,getSaveHandlers:function(t){return Go.getSaveHandlers(t)},http:O_,isHTTPScheme:F_,loadWeights:function(t,n,e,r){return void 0===n&&(n=""),Be(this,void 0,void 0,function(){return je(this,function(o){return[2,QR(function(i){return YR(i,{requestInit:r})})(t,n,e)]})})},registerLoadRouter:function(t){return Go.registerLoadRouter(t)},registerSaveRouter:function(t){return Go.registerSaveRouter(t)},weightsLoaderFactory:QR,withSaveHandler:function(t){return new xZ(t)},copyModel:function(t,n){return Be(this,void 0,void 0,function(){return je(this,function(e){return[2,zR(t,n,!1)]})})},listModels:function(){return Be(this,void 0,void 0,function(){var t,n,e,r,o,i,a;return je(this,function(s){switch(s.label){case 0:t=As.getSchemes(),n={},e=0,r=t,s.label=1;case 1:return e<r.length?[4,As.getManager(o=r[e]).listModels()]:[3,4];case 2:for(a in i=s.sent())n[o+Qc+a]=i[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(t,n){return Be(this,void 0,void 0,function(){return je(this,function(e){return[2,zR(t,n,!0)]})})},removeModel:function(t){return Be(this,void 0,void 0,function(){var n;return je(this,function(e){return n=kg(t),[2,As.getManager(n.scheme).removeModel(n.path)]})})}}),CZ=F({confusionMatrix_:function(t,n,e){var r=S(t,"labels","confusionMatrix"),o=S(n,"predictions","confusionMatrix");A(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),A(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),A(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),A(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),A(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=j0(r.asType("int32"),e),a=j0(o.asType("int32"),e);return i.transpose().matMul(a).asType("int32")}}),EZ=(Object.freeze({confusionMatrix:CZ}),F({fromPixels_:function(t,n){if(void 0===n&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=GM("FromPixels",N.backendName))return N.runKernel("FromPixels",{pixels:t},{numChannels:n});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],d=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,d).data:r||e?s=t.data:(i||o)&&(null==nl&&(nl=document.createElement("canvas").getContext("2d")),nl.canvas.width=l,nl.canvas.height=d,nl.drawImage(t,0,0,l,d),s=nl.getImageData(0,0,l,d).data),4===n)u=new Int32Array(s);else{var f=l*d;u=new Int32Array(f*n);for(var h=0;h<f;h++)for(var p=0;p<n;++p)u[h*n+p]=s[4*h+p]}return P0(u,[d,l,n],"int32")}})),L_=Object.freeze({toPixels:function(t,n){return Be(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,h,p,g,m,v,b,w,_,x,D,R,k;return je(this,function(M){switch(M.label){case 0:if(e=S(t,"img","toPixels"),t instanceof Cn||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(a=2===e.rank?1:e.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=M.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=M.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g="float32"===e.dtype?255:1,m=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)b=void 0,w=void 0,_=void 0,x=void 0,1===a?(b=s[v]*g,w=s[v]*g,_=s[v]*g,x=255):3===a?(b=s[3*v]*g,w=s[3*v+1]*g,_=s[3*v+2]*g,x=255):4===a&&(b=s[4*v]*g,w=s[4*v+1]*g,_=s[4*v+2]*g,x=s[4*v+3]*g),m[0+(D=4*v)]=Math.round(b),m[D+1]=Math.round(w),m[D+2]=Math.round(_),m[D+3]=Math.round(x);return null!=n&&(n.width=i,n.height=o,R=n.getContext("2d"),k=new ImageData(m,i,o),R.putImageData(k,0,0)),e!==t&&e.dispose(),[2,m]}})})},fromPixels:EZ}),nN=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(n,e){return new n(e)},t}(),rN=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]},t}();function Ts(t){A(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),A("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),A(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),rN.register(t)}function B_(){return 32===N.backend.floatPrecision()?.001:.1}function j_(t,n,e){var r=!0;if((jr(t)||jr(n))&&(r=!1),jr(t)&&jr(n)&&(r=!0),r){var o=t.constructor.name,i=n.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(n)){var a=ia(t),s=ia(n);if(!fr(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=jr(t)?t:Va(t),c=jr(n)?n:Va(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function V_(t,n,e){return!isFinite(t)&&!isFinite(n)||!(isNaN(t)||isNaN(n)||Math.abs(t-n)>e)}Object.freeze({Serializable:nN,SerializationMap:rN,registerClass:Ts}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,n,e){return null==e&&(e=B_()),j_(t,n,function(r,o){return V_(r,o,e)})},testEpsilon:B_,expectPromiseToFail:function(t,n){t().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(t,n){var e="string"==typeof n||"number"==typeof n||"boolean"==typeof n?[n]:n;return xs(t)||xs(t[0])||xs(n)||xs(n[0])?j_(t,e,function(r,o){return r==o}):j_(t,n,function(r,o){return V_(r,o,0)})},expectNumbersClose:function(t,n,e){if(null==e&&(e=B_()),!V_(t,n,e))throw new Error("Numbers differ: actual === "+t+", expected === "+n)},expectValuesInRange:function(t,n,e){for(var r=0;r<t.length;r++)if(t[r]<n||t[r]>e)throw new Error("Value out of range:"+t[r]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(t,n){expect(new Float32Array(t)).toEqual(new Float32Array(n))}}),Object.freeze({gpgpu_util:X7,webgl_util:yq,forceHalfFloat:function(){X().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:tR,setWebGLContext:pT,GPGPUContext:Bk});var bu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Ai(n,t),n.prototype.minimize=function(e,r,o){void 0===r&&(r=!1);var i=this.computeGradients(e,o),a=i.value,s=i.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return So(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,r){return function Qq(t,n){A(Cs(t),function(){return"The f passed in variableGrads(f) must be a function"}),A(null==n||Array.isArray(n)&&n.every(function(l){return l instanceof Hc}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=n;if(!e)for(var r in n=[],N.registeredVariables)n.push(N.registeredVariables[r]);var o=e?n.filter(function(l){return!l.trainable}):null,i=n.length;A((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=N.gradients(t,n,null,!0),s=a.value,u=a.grads;A(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),A(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(l,d){null!=u[d]&&(c[l.name]=u[d])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}(e,r)},n.prototype.dispose=function(){null!=this.iterations_&&So(this.iterations_)},n.prototype.saveIterations=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Ce(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return Be(this,void 0,void 0,function(){var r;return je(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},n}(nN);Object.defineProperty(bu,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var iN=function(t){function n(e,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==o&&(i.epsilon=N.backend.epsilon()),i}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=N.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:Fe(function(){return Qt(a).variable(!1)})}),null==r.accumulatedUpdates[i]&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:Fe(function(){return Qt(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;Fe(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedUpdates&&(So(this.accumulatedGrads.map(function(e){return e.variable})),So(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var e;return je(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){var r;return je(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(bu);Ts(iN);var aN=function(t){function n(e,r){void 0===r&&(r=.1);var o=t.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=N.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:Fe(function(){return sa(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable;Fe(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(N.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedGrads&&So(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(bu);Ts(aN);var sN=function(t){function n(e,r,o,i){void 0===i&&(i=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Fe(function(){a.accBeta1=Ce(r).variable(),a.accBeta2=Ce(o).variable()}),null==i&&(a.epsilon=N.backend.epsilon()),a}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);Fe(function(){var i=Cr(1,r.accBeta1),a=Cr(1,r.accBeta2);o.forEach(function(s,u){var c=N.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Fe(function(){return Qt(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Fe(function(){return Qt(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=h.div(i),m=p.div(a);d.assign(h),f.assign(p);var v=g.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&So(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&So(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var e;return je(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){var r,o=this;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),Fe(function(){o.accBeta1.assign(Eg(o.beta1,o.iterations_+1)),o.accBeta2.assign(Eg(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(bu);Ts(sN);var uN=function(t){function n(e,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=t.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Fe(function(){s.iteration=Ce(0).variable(),s.accBeta1=Ce(r).variable()}),null==i&&(s.epsilon=N.backend.epsilon()),s}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);Fe(function(){var i=Cr(1,r.accBeta1),a=Oi(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=N.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Qt(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Qt(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),g=l.abs(),m=p.maximum(g);d.assign(h),f.assign(m);var v=a.div(i).mul(h.div(m.add(r.epsilon))).add(c);c.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&So(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&So(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(bu);Ts(uN);var U_=function(t){function n(e){var r=t.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=Array.isArray(e)?e[i].tensor:e[o];if(null!=a){var s=N.registeredVariables[o];Fe(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function bq(t){return N.keep(t)}(Ce(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,r){return new e(r.learningRate)},n.className="SGD",n}(bu);Ts(U_);var cN=function(t){function n(e,r,o){void 0===o&&(o=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=Ce(i.momentum),i}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=N.registeredVariables[o];null==r.accumulations[i]&&(r.accumulations[i]={originalName:o+"/momentum",variable:Fe(function(){return Qt(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[o];null!=u&&Fe(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&So(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){return je(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(U_);Ts(cN);var lN=function(t){function n(e,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=t.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==i&&(s.epsilon=N.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Ai(n,t),n.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=N.registeredVariables[o];null==r.accumulatedMeanSquares[i]&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:Fe(function(){return Qt(a).variable(!1)})}),null==r.accumulatedMoments[i]&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:Fe(function(){return Qt(a).variable(!1)})}),null==r.accumulatedMeanGrads[i]&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:Fe(function(){return Qt(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;Fe(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=a.sub(h);a.assign(p)}else{var g=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},n.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&So(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&So(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&So(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return Be(this,void 0,void 0,function(){var e;return je(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},n.prototype.setWeights=function(e){return Be(this,void 0,void 0,function(){var r;return je(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(bu);function wu(t,n,e){if(void 0===e&&(e=!1),t.beginPath(),n.slice(1).forEach(function(i,a){var s=i.x,u=i.y,c=n[a];t.moveTo(c.x,c.y),t.lineTo(s,u)}),e){var r=n[n.length-1],o=n[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}Ts(lN),function(){function t(){}t.sgd=function(n){return new U_(n)},t.momentum=function(n,e,r){return void 0===r&&(r=!1),new cN(n,e,r)},t.rmsprop=function(n,e,r,o,i){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new lN(n,e,r,o,i)},t.adam=function(n,e,r,o){return void 0===n&&(n=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new sN(n,e,r,o)},t.adadelta=function(n,e,r){return void 0===n&&(n=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new iN(n,e,r)},t.adamax=function(n,e,r,o,i){return void 0===n&&(n=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new uN(n,e,r,o,i)},t.adagrad=function(n,e){return void 0===e&&(e=.1),new aN(n,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,Cn.prototype.squaredDifference=function(t){return nR(this,t)},$=rZ;var H_=function(t,n){return(H_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(t,n)};function _t(t,n){function e(){this.constructor=t}H_(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var Yr=function(){return Yr=Object.assign||function(n){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},Yr.apply(this,arguments)};function Xe(t,n,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(t,n||[])).next())})}function Ke(t,n){var r,o,i,a,e={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(i=(i=e.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(6===c[0]&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(t,e)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function gf(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var xu=function(){function t(n,e){if(!Cu(n)||!Cu(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function mf(t,n){return t instanceof Cn&&t.shape.length===n}function Ng(t){return mf(t,3)}function ks(t){return mf(t,4)}function fN(t){return t%2==0}function z_(t,n){void 0===n&&(n=2);var e=Math.pow(10,n);return Math.floor(t*e)/e}function hN(t){return t&&t.width&&t.height}function W_(t){return t.reduce(function(n,e){return n.add(e)},new rn(0,0)).div(new rn(t.length,t.length))}function vf(t,n,e){return Array(t).fill(0).map(function(r,o){return n+o*e})}function Cu(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function pN(t){return Cu(t)&&0<=t&&t<=1}var rn=function(){function t(n,e){this._x=n,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(n){return new t(this.x+n.x,this.y+n.y)},t.prototype.sub=function(n){return new t(this.x-n.x,this.y-n.y)},t.prototype.mul=function(n){return new t(this.x*n.x,this.y*n.y)},t.prototype.div=function(n){return new t(this.x/n.x,this.y/n.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),ca=function(){function t(n,e){void 0===e&&(e=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(Cu),i=[r.x,r.y,r.width,r.height].every(Cu);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(Cu)},t.assertIsValidBox=function(n,e,r){if(void 0===r&&(r=!1),!t.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new rn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new rn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new rn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new rn(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.toSquare=function(){var n=this,e=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(e-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:e,y:r,width:o,height:i})},t.prototype.rescale=function(n){var e=hN(n)?n.width:n,r=hN(n)?n.height:n;return new t({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},t.prototype.pad=function(n,e){var r=[this.x-n/2,this.y-e/2,this.width+n,this.height+e];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(n,e){var r=this,i=r.y,a=r.right,s=r.bottom,u=Math.max(r.x,0),c=Math.max(i,0),d=s-c;return new t({x:u,y:c,width:Math.min(a-u,n-u),height:Math.min(d,e-c)}).floor()},t.prototype.shift=function(n,e){return new t({x:this.x+n,y:this.y+e,width:this.width,height:this.height})},t.prototype.padAtBorders=function(n,e){var r=this.width+1,o=this.height+1,s=r,u=o,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+r,d=e),f>n&&(u=-f+n+o,f=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:s,y:l,ey:f,x:c,ex:d,w:r,h:o}},t.prototype.calibrate=function(n){return new t({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},t}(),Fg=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{left:e,top:r,right:o,bottom:i},a)||this}return _t(n,t),n}(ca),gN=function(){function t(n,e,r,o,i){this._imageDims=new xu(i.width,i.height),this._score=n,this._classScore=e,this._className=r,this._box=new ca(o).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new ca(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},t}(),qo=function(t){function n(e,r,o){return t.call(this,e,e,"",r,o)||this}return _t(n,t),n.prototype.forSize=function(e,r){var o=t.prototype.forSize.call(this,e,r);return new n(o.score,o.relativeBox,o.imageDims)},n}(gN);function RZ(t,n,e){void 0===e&&(e=!0);var i=Math.max(0,Math.min(t.right,n.right)-Math.max(t.left,n.left))*Math.max(0,Math.min(t.bottom,n.bottom)-Math.max(t.top,n.top));return e?i/(t.area+n.area-i):i/Math.min(t.area,n.area)}function yf(t,n,e,r){void 0===r&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++)c.push(RZ(t[s],t[u[l]],r));o=o.filter(function(p,g){return c[g]<=e})};o.length>0;)a();return i}function bf(t,n){return Fe(function(){var e=n[0],r=n[1],o=n[2],i=sa(gf(t.shape.slice(0,3),[1]),e),a=sa(gf(t.shape.slice(0,3),[1]),r),s=sa(gf(t.shape.slice(0,3),[1]),o),u=wr([i,a,s],3);return Cr(t,u)})}function $_(t){return 1/(1+Math.exp(-t))}var Er,G_=function(t){function n(e,r,o,i,a){return void 0===a&&(a=!1),t.call(this,{x:e,y:r,width:o,height:i},a)||this}return _t(n,t),n}(ca),rl=function(){function t(n,e,r){void 0===r&&(r=new rn(0,0));var o=e.width,i=e.height;this._imgDims=new xu(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new rn(o,i)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new rn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new rn(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},t.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new rn(n,e))},t.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},t.prototype.align=function(n,e){if(void 0===e&&(e={}),n){var r=n instanceof qo?n.box.floor():new ca(n);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(a)},t.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),r=n[1],o=n[2],i=function(d){return o.sub(d).magnitude()},a=(i(n[0])+i(r))/2,s=Math.floor(a/.45),u=W_(n),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new G_(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},t.prototype.alignMinBbox=function(n){var e=function kZ(t){var n=t.map(function(s){return s.x}),e=t.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=e.reduce(function(s,u){return s<u?u:s},0);return new Fg(r,o,i,a)}(this.positions);return e.pad(e.width*n,e.height*n)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),LZ=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],W_([e[3],e[4]])]},n}(rl),mN=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(W_)},n}(rl),vN=function(){function t(n,e){this._label=n,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(n){return void 0===n&&(n=!0),this.label+(n?" ("+z_(this.distance)+")":"")},t}(),yN=function(t){function n(e,r){var o=t.call(this,e)||this;return o._label=r,o}return _t(n,t),n.assertIsValidLabeledBox=function(e,r){if(ca.assertIsValidBox(e,r),!Cu(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(ca),Og=function(){function t(n,e){if("string"!=typeof n)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},t.fromJSON=function(n){var e=n.descriptors.map(function(r){return new Float32Array(r)});return new t(n.label,e)},t}();function _f(t){return t.detection instanceof qo}function wf(t,n){return Object.assign({},t,{detection:n})}function bN(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function _N(t){var n="";if(!t)try{t=nt(Object(function(){var o=new Error("Cannot find module 'fs'");throw o.code="MODULE_NOT_FOUND",o}()))}catch(r){n=r.toString()}return{readFile:t?function(r){return new Promise(function(o,i){t.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)}}}function wN(){var t=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=_N();return Yr({Canvas:t||function a(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function a(){},Image:n||function a(){},ImageData:global.ImageData||function a(){},Video:global.HTMLVideoElement||function a(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}function xN(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function CN(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function q_(t){Er=t}function X_(){xN()&&q_(bN()),CN()&&q_(wN())}!function(t){function n(e,r,o,i){var a=t.call(this,e,r)||this;return a._score=o,a._classScore=i,a}_t(n,t),n.assertIsValidPredictedBox=function(e,r){if(yN.assertIsValidLabeledBox(e,r),!pN(e.score)||!pN(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(yN);var Qr={getEnv:function BZ(){if(!Er)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Er},setEnv:q_,initialize:X_,createBrowserEnv:bN,createFileSystem:_N,createNodejsEnv:wN,monkeyPatch:function jZ(t){if(Er||X_(),!Er)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=t.Canvas,e=void 0===n?Er.Canvas:n,r=t.Image,o=void 0===r?Er.Image:r;Er.Canvas=e,Er.Image=o,Er.createCanvasElement=t.createCanvasElement||function(){return new e},Er.createImageElement=t.createImageElement||function(){return new o},Er.ImageData=t.ImageData||Er.ImageData,Er.Video=t.Video||Er.Video,Er.fetch=t.fetch||Er.fetch,Er.readFile=t.readFile||Er.readFile},isBrowser:xN,isNodejs:CN};function K_(t){return Qr.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function la(t){var n=Qr.getEnv(),e=n.Canvas;if(t instanceof n.CanvasRenderingContext2D)return t;var o=K_(t);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}X_();var Eu=function(t){return t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT",t}(Eu||{}),EN=function t(n){void 0===n&&(n={});var r=n.backgroundColor,o=n.fontColor,i=n.fontSize,a=n.fontStyle,s=n.padding;this.anchorPosition=n.anchorPosition||Eu.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4},DN=function(){function t(n,e,r){void 0===r&&(r={}),this.text="string"==typeof n?[n]:n instanceof t?n.text:n,this.anchor=e,this.options=new EN(r)}return t.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(r){return n.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},t.prototype.measureHeight=function(){var n=this.options;return this.text.length*n.fontSize+2*n.padding},t.prototype.getUpperLeft=function(n,e){var r=this.options.anchorPosition,o=r===Eu.BOTTOM_RIGHT||r===Eu.TOP_RIGHT,i=r===Eu.BOTTOM_LEFT||r===Eu.BOTTOM_RIGHT,a=this.measureWidth(n),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-a),0),y:Math.max(Math.min(c,d-s),0)}}return{x:u,y:c}},t.prototype.draw=function(n){var e=K_(n),r=la(e),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,c=o.padding;r.font=s+"px "+o.fontStyle;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=a,this.text.forEach(function(h,p){r.fillText(h,c+f.x,c+f.y+(p+1)*s)})},t}(),VZ=function t(n){void 0===n&&(n={});var r=n.lineWidth,o=n.label,i=n.drawLabelOptions;this.boxColor=n.boxColor||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o,this.drawLabelOptions=new EN(Object.assign({},{anchorPosition:Eu.BOTTOM_LEFT,backgroundColor:this.boxColor},i))},UZ=function(){function t(n,e){void 0===e&&(e={}),this.box=new ca(n),this.options=new VZ(e)}return t.prototype.draw=function(n){var e=la(n),r=this.options,i=r.lineWidth,a=this.box,s=a.x,u=a.y,c=a.width,l=a.height;e.strokeStyle=r.boxColor,e.lineWidth=i,e.strokeRect(s,u,c,l);var d=this.options.label;d&&new DN([d],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(n)},t}();function SN(t){var n=Qr.getEnv();return t instanceof n.Image&&t.complete||t instanceof n.Video&&t.readyState>=3}function Z_(t){var n=Qr.getEnv(),r=n.Video;return t instanceof n.Image?new xu(t.naturalWidth,t.naturalHeight):t instanceof r?new xu(t.videoWidth,t.videoHeight):new xu(t.width,t.height)}function Pg(t){var n=t.width,e=t.height,o=(0,Qr.getEnv().createCanvasElement)();return o.width=n,o.height=e,o}function Lg(t,n){var e=Qr.getEnv().ImageData;if(!(t instanceof e||SN(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=n||Z_(t),o=r.width,i=r.height,a=Pg({width:o,height:i});return t instanceof e?la(a).putImageData(t,0,0):la(a).drawImage(t,0,0,o,i),a}function WZ(t,n){return Xe(this,void 0,void 0,function(){var e,r,o,i,a,s;return Ke(this,function(u){switch(u.label){case 0:return e=n||Qr.getEnv().createCanvasElement(),r=t.shape.slice(ks(t)?1:0),o=r[0],i=r[1],a=r[2],s=Fe(function(){return t.as3D(o,i,a).toInt()}),[4,L_.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function IN(t){var n=Qr.getEnv();return t instanceof n.Image||t instanceof n.Canvas||t instanceof n.Video}var Bg=function(){function t(n,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(o,i){if(Ng(o))return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape);if(ks(o)){var a=o.shape[0];if(1!==a)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape.slice(1))}var s=o instanceof Qr.getEnv().Canvas?o:Lg(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var n=this;return vf(this.batchSize,0,1).map(function(e,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},t.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},t.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},t.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},t.prototype.getReshapedInputDimensions=function(n){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function TZ(t,n){var e=t.width,r=t.height,o=n/Math.max(r,e);return new xu(Math.round(e*o),Math.round(r*o))}({width:this.getInputWidth(n),height:this.getInputHeight(n)},this.inputSize)},t.prototype.toBatchTensor=function(n,e){var r=this;return void 0===e&&(e=!0),this._inputSize=n,Fe(function(){var o=vf(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Cn){var u=ks(s)?s:s.expandDims();return u=function NZ(t,n){return void 0===n&&(n=!1),Fe(function(){var e=t.shape.slice(1),r=e[0],o=e[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(h){var p=t.shape.slice();return p[s]=h,sa(p,0)},c=u(a),l=i-c.shape[s],f=[n&&l?u(l):null,t,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return wr(f,s)})}(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=b_.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof Qr.getEnv().Canvas)return L_.fromPixels(function $Z(t,n,e){void 0===e&&(e=!1);var r=Qr.getEnv(),i=r.Canvas;if(!(t instanceof r.Image||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Z_(t),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Pg({width:n,height:n}),d=t instanceof i?t:Lg(t),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return la(l).drawImage(d,h,p,u,c),l}(s,n,e));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return $o(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3)})},t}();function Mr(t){return Xe(this,void 0,void 0,function(){var n,e,r;return Ke(this,function(o){switch(o.label){case 0:if(t instanceof Bg)return[2,t];if(!(n=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(t)?" at input index "+i+":":""},(r=n.map(K_)).forEach(function(i,a){if(!IN(i)&&!Ng(i)&&!ks(i))throw"string"==typeof n[a]?new Error("toNetInput -"+e(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+e(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ks(i)){var s=i.shape[0];if(1!==s)throw new Error("toNetInput -"+e(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return IN(i)&&function zZ(t){return new Promise(function(n,e){if(t instanceof Qr.getEnv().Canvas||SN(t))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}t.addEventListener("load",r),t.addEventListener("error",o)})}(i)}))];case 1:return o.sent(),[2,new Bg(r,Array.isArray(t))]}})})}function Y_(t,n){return Xe(this,void 0,void 0,function(){var e,r,o,i,a,s;return Ke(this,function(c){switch(c.label){case 0:return e=Qr.getEnv().Canvas,r=t,t instanceof e?[3,5]:[4,Mr(t)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof e?(a=i,[3,4]):[3,2];case 2:return[4,WZ(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=la(r),[2,n.map(function(l){return l instanceof qo?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,g=Pg({width:h,height:p});return la(g).putImageData(s.getImageData(d,f,h,p),0,0),g})]}})})}function Q_(t,n){return Xe(this,void 0,void 0,function(){return Ke(this,function(e){if(!Ng(t)&&!ks(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ks(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Fe(function(){var r=t.shape.slice(ks(t)?1:0),o=r[0],i=r[1],a=r[2];return n.map(function(c){return c instanceof qo?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}).map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return DR(t.as3D(o,i,a),[d,l,0],[h,f,a])})})]})})}function GZ(t,n){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return[4,(0,Qr.getEnv().fetch)(t,n)];case 1:if(!((r=o.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function qZ(t){return Xe(this,void 0,void 0,function(){return Ke(this,function(n){switch(n.label){case 0:return[4,GZ(t)];case 1:return[2,n.sent().json()]}})})}function AN(t,n){var e=n+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:e};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+e};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(s){return s}),i=t.endsWith(".json")?o[o.length-1]:e,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function XZ(t,n){return Xe(this,void 0,void 0,function(){var e,o,i;return Ke(this,function(a){switch(a.label){case 0:return e=AN(t,n),o=e.modelBaseUri,[4,qZ(e.manifestUri)];case 1:return i=a.sent(),[2,tN.loadWeights(i,o)]}})})}function MN(t,n,e){void 0===e&&(e=!1);var r=e?Z_(n):n,o=r.width,i=r.height;return t.width=o,t.height=i,{width:o,height:i}}var Xa=function(){function t(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(n,e){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},t.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Hc})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Hc)})},t.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){n.reassignParamFromPath(e.path,e.tensor.variable())})},t.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=Hr(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},t.prototype.dispose=function(n){void 0===n&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){return Array.from(n.tensor.dataSync())}).reduce(function(n,e){return n.concat(e)}))},t.prototype.load=function(n){return Xe(this,void 0,void 0,function(){return Ke(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(n){return Xe(this,void 0,void 0,function(){var e;return Ke(this,function(r){switch(r.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromUri - expected model uri");return[4,XZ(n,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(n){return Xe(this,void 0,void 0,function(){var e,r,o,i,s,u,c,l,d;return Ke(this,function(f){switch(f.label){case 0:if(n&&"string"!=typeof n)throw new Error(this._name+".loadFromDisk - expected model file path");return e=Qr.getEnv().readFile,r=AN(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=tN.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return e(p).then(function(g){return g.buffer})}))}),l=(c=JSON).parse,[4,e(o)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.extractWeights=function(n){var e=this.extractParams(n),o=e.params;this._paramMappings=e.paramMappings,this._params=o},t.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!(r&&o&&r[o]instanceof Cn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},t}();function Xo(t,n,e){return Fe(function(){var r=p_(t,n.depthwise_filter,n.pointwise_filter,e,"same");return Pt(r,n.bias)})}function J_(t,n,e){return void 0===e&&(e=!1),Fe(function(){var r=Gn(e?Pt(li(t,n.conv0.filters,[2,2],"same"),n.conv0.bias):Xo(t,n.conv0,[2,2])),o=Xo(r,n.conv1,[1,1]),a=Xo(Gn(Pt(r,o)),n.conv2,[1,1]);return Gn(Pt(r,Pt(o,a)))})}function jg(t,n,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),Fe(function(){var o=Gn(e?Pt(li(t,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):Xo(t,n.conv0,r?[2,2]:[1,1])),i=Xo(o,n.conv1,[1,1]),s=Xo(Gn(Pt(o,i)),n.conv2,[1,1]),c=Xo(Gn(Pt(o,Pt(i,s))),n.conv3,[1,1]);return Gn(Pt(o,Pt(i,Pt(s,c))))})}function Pi(t,n,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),Fe(function(){var o=Pt(li(t,n.filters,[1,1],e),n.bias);return r?Gn(o):o})}function Ka(t,n){Object.keys(t).forEach(function(e){n.some(function(r){return r.originalPath===e})||t[e].dispose()})}function Vg(t,n){return function(e,r,o,i){var a=Ao(t(e*r*o*o),[o,o,e,r]),s=pr(t(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function ew(t,n){return function(e,r,o){var i=Ds(t(e*r),[e,r]),a=pr(t(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var TN=function t(n,e,r){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=r};function tw(t,n){return function(e,r,o){var i=Ao(t(9*e),[3,3,e,1]),a=Ao(t(e*r),[1,1,e,r]),s=pr(t(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new TN(i,a,s)}}function nw(t){return function(n){var e=t(n+"/depthwise_filter",4),r=t(n+"/pointwise_filter",4),o=t(n+"/bias",1);return new TN(e,r,o)}}function Rs(t,n){return function(e,r,o){var i=t[e];if(!mf(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:e,paramPath:o||e}),i}}function Za(t){var n=t;return{extractWeights:function e(o){var i=n.slice(0,o);return n=n.slice(o),i},getRemainingWeights:function r(){return n}}}function kN(t,n){var e=Vg(t,n),r=tw(t,n);function o(a,s,u,c){return void 0===c&&(c=!1),{conv0:c?e(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),conv1:r(s,s,u+"/conv1"),conv2:r(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function i(a,s,u,c){void 0===c&&(c=!1);var l=o(a,s,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(s,s,u+"/conv3")}}}}function RN(t){return function(n){return{filters:t(n+"/filters",4),bias:t(n+"/bias",1)}}}function NN(t,n){var e=Rs(t,n),r=RN(e),o=nw(e);return{extractDenseBlock3Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var FN=function(t){function n(){return t.call(this,"FaceFeatureExtractor")||this}return _t(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Fe(function(){var s=jg(bf(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ce(255)),r.dense0,!0);return s=jg(s,r.dense1),s=jg(s,r.dense2),s=jg(s,r.dense3),hf(s,[7,7],[2,2],"valid")})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function ZZ(t){var n=[],e=NN(t,n).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return Ka(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function KZ(t){var n=[],e=Za(t),o=e.getRemainingWeights,i=kN(e.extractWeights,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(e)},n}(Xa);function da(t,n){return Fe(function(){return Pt(Sg(t,n.weights),n.bias)})}function ON(t){var n={},e={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?e:n)[r]=t[r]}),{featureExtractorMap:n,classifierMap:e}}var PN=function(t){function n(e,r){var o=t.call(this,e)||this;return o._faceFeatureExtractor=r,o}return _t(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Fe(function(){var i=e instanceof Bg?r.faceFeatureExtractor.forwardInput(e):e;return da(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function YZ(t,n,e){var r=[],o=Za(t),a=o.getRemainingWeights,u=ew(o.extractWeights,r)(n,e,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var r=ON(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function QZ(t){var n=[],e=Rs(t,n),o={fc:function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}("fc")};return Ka(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n}(Xa),LN=["neutral","happy","sad","angry","fearful","disgusted","surprised"],rw=function(){function t(n){var e=this;if(7!==n.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);LN.forEach(function(r,o){e[r]=n[o]})}return t.prototype.asSortedArray=function(){var n=this;return LN.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,r){return r.probability-e.probability})},t}(),JZ=function(t){function n(e){return void 0===e&&(e=new FN),t.call(this,"FaceExpressionNet",e)||this}return _t(n,t),n.prototype.forwardInput=function(e){var r=this;return Fe(function(){return za(r.runNet(e))})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(e){return Xe(this,void 0,void 0,function(){var r,o,i,a,s=this;return Ke(this,function(u){switch(u.label){case 0:return[4,Mr(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(xr(o).map(function(c){return Xe(s,void 0,void 0,function(){var l;return Ke(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new rw(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(PN);function BN(t,n){return Object.assign({},t,{expressions:n})}function ow(t){return _f(t)&&t.landmarks instanceof rl&&t.unshiftedLandmarks instanceof rl&&t.alignedRect instanceof qo}function Ug(t,n){var e=t.detection.box,r=n.shiftBy(e.x,e.y),o=r.align(),i=t.detection.imageDims,a=new qo(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:n,alignedRect:a})}var tY=function t(n){void 0===n&&(n={});var e=n.drawLines,o=n.drawPoints,i=void 0===o||o,a=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;this.drawLines=void 0===e||e,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},nY=function(){function t(n,e){void 0===e&&(e={}),this.faceLandmarks=n,this.options=new tY(e)}return t.prototype.draw=function(n){var e=la(n),r=this.options,i=r.drawPoints,a=r.lineWidth,u=r.pointSize,c=r.pointColor;r.drawLines&&this.faceLandmarks instanceof mN&&(e.strokeStyle=r.lineColor,e.lineWidth=a,wu(e,this.faceLandmarks.getJawOutline()),wu(e,this.faceLandmarks.getLeftEyeBrow()),wu(e,this.faceLandmarks.getRightEyeBrow()),wu(e,this.faceLandmarks.getNose()),wu(e,this.faceLandmarks.getLeftEye(),!0),wu(e,this.faceLandmarks.getRightEye(),!0),wu(e,this.faceLandmarks.getMouth(),!0)),i&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(d){e.beginPath(),e.arc(d.x,d.y,u,0,2*Math.PI),e.fill()}))},t}();function jN(t,n,e){return Pt(li(t,n.filters,e,"same"),n.bias)}function iw(t,n,e){void 0===e&&(e=!0);var r=e?Gn(t):t;return r=Xo(r,n.separable_conv0,[1,1]),r=Xo(Gn(r),n.separable_conv1,[1,1]),r=Ar(r,[3,3],[2,2],"same"),Pt(r,jN(t,n.expansion_conv,[2,2]))}var cY=function(t){function n(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return _t(n,t),n.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return Fe(function(){var s=bf(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ce(256)),u=Gn(jN(s,o.entry_flow.conv_in,[2,2]));return u=iw(u,o.entry_flow.reduction_block_0,!1),u=iw(u,o.entry_flow.reduction_block_1),vf(r._numMainBlocks,0,1).forEach(function(c){u=function uY(t,n){var e=Xo(Gn(t),n.separable_conv0,[1,1]);return e=Xo(Gn(e),n.separable_conv1,[1,1]),e=Xo(Gn(e),n.separable_conv2,[1,1]),Pt(e,t)}(u,o.middle_flow["main_block_"+c])}),u=iw(u,o.exit_flow.reduction_block),u=Gn(Xo(u,o.exit_flow.separable_conv,[1,1]))})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function sY(t,n){var e=[],r=function aY(t,n){var e=Rs(t,n),r=RN(e),o=nw(e);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:r(s+"/expansion_conv")}},extractMainBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(t,e),i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},f={};vf(n,0,1).forEach(function(m){f["main_block_"+m]=s("middle_flow/main_block_"+m)});var g={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Ka(t,e),{params:{entry_flow:d,middle_flow:f,exit_flow:g},paramMappings:e}}(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return function iY(t,n){var e=[],r=Za(t),i=r.getRemainingWeights,a=function oY(t,n){var e=Vg(t,n),r=tw(t,n);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function o(a,s,u){return{separable_conv0:r(a,s,u+"/separable_conv0"),separable_conv1:r(s,s,u+"/separable_conv1"),expansion_conv:e(a,s,1,u+"/expansion_conv")}},extractMainBlockParams:function i(a,s){return{separable_conv0:r(a,a,s+"/separable_conv0"),separable_conv1:r(a,a,s+"/separable_conv1"),separable_conv2:r(a,a,s+"/separable_conv2")}}}}(r.extractWeights,e),u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,p={conv_in:(0,a.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},g={};vf(n,0,1).forEach(function(w){g["main_block_"+w]=l(128,"middle_flow/main_block_"+w)});var b={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:g,exit_flow:b}}}(e,this._numMainBlocks)},n}(Xa),aw=function(t){return t.FEMALE="female",t.MALE="male",t}(aw||{}),fY=function(t){function n(e){void 0===e&&(e=new cY(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return _t(n,t),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Fe(function(){var i=e instanceof Bg?r.faceFeatureExtractor.forwardInput(e):e,a=hf(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:da(a,o.fc.age).as1D(),gender:da(a,o.fc.gender)}})},n.prototype.forwardInput=function(e){var r=this;return Fe(function(){var o=r.runNet(e);return{age:o.age,gender:za(o.gender)}})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return Xe(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return Ke(this,function(l){switch(l.label){case 0:return[4,Mr(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=xr(o.age),a=xr(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return Xe(c,void 0,void 0,function(){var p,g,m,v,b;return Ke(this,function(w){switch(w.label){case 0:return[4,f.data()];case 1:return p=w.sent()[0],[4,h.data()];case 2:return g=w.sent()[0],v=(m=g>.5)?aw.MALE:aw.FEMALE,b=m?g:1-g,f.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return function lY(t){var n=[],e=Za(t),o=e.getRemainingWeights,i=ew(e.extractWeights,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}(e)},n.prototype.extractParamsFromWeigthMap=function(e){var r=ON(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function dY(t){var n=[],e=Rs(t,n);function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Ka(t,n),{params:o,paramMappings:n}}(i)},n.prototype.extractParams=function(e){var o=e.slice(0,e.length-1539),i=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n}(Xa),VN=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.postProcess=function(e,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return Fe(function(){var s=function(f,h){return $o([sa([68],f),sa([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],g=p.width,m=p.height;return h(g,m)?Math.abs(g-m)/2:0};return e.mul(sa([a,136],r)).sub($o(Array.from(Array(a),function(f,h){return s(function(f){return u(f,function(h,p){return h<p})}(h),function(f){return u(f,function(h,p){return p<h})}(h))}))).div($o(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})))})},n.prototype.forwardInput=function(e){var r=this;return Fe(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){return{height:i[0],width:i[1]}}))})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(e){return Xe(this,void 0,void 0,function(){var r,o,i,a=this;return Ke(this,function(s){switch(s.label){case 0:return[4,Mr(e)];case 1:return r=s.sent(),o=Fe(function(){return xr(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return Xe(a,void 0,void 0,function(){var l,d,f,h,p;return Ke(this,function(g){switch(g.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[g.sent()]),h=l.filter(function(m,v){return fN(v)}),p=l.filter(function(m,v){return!fN(v)}),[2,new mN(Array(68).fill(0).map(function(m,v){return new rn(h[v],p[v])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(PN),UN=function(t){function n(e){return void 0===e&&(e=new FN),t.call(this,"FaceLandmark68Net",e)||this}return _t(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(VN),gY=function(t){function n(){return t.call(this,"TinyFaceFeatureExtractor")||this}return _t(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Fe(function(){var s=J_(bf(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Ce(255)),r.dense0,!0);return s=J_(s,r.dense1),s=J_(s,r.dense2),hf(s,[14,14],[2,2],"valid")})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function hY(t){var n=[],e=NN(t,n).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return Ka(t,n),{params:r,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function pY(t){var n=[],e=Za(t),o=e.getRemainingWeights,i=kN(e.extractWeights,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}(e)},n}(Xa),mY=function(t){function n(e){return void 0===e&&(e=new gY),t.call(this,"FaceLandmark68TinyNet",e)||this}return _t(n,t),n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(VN);function sw(t,n,e,r,o){void 0===o&&(o="same");var i=n.conv,s=i.bias,u=li(t,i.filters,e,o);return u=function vY(t,n){return Pt(Kr(t,n.weights),n.biases)}(u=Pt(u,s),n.scale),r?Gn(u):u}function HN(t,n){return sw(t,n,[1,1],!1)}function zN(t,n){return sw(t,n,[2,2],!0,"valid")}function bY(t,n){function i(s,u,c,l){var d=function r(s,u,c,l){var d=function e(s,u,c){var l=t(s),d=l.length/(u*c*c);if(function MZ(t){return t%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return Fe(function(){return Is(Ao(l,[u,d,c,c]),[2,3,1,0])})}(s,u,c),f=pr(t(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}(s,u,c,l+"/conv"),f=function o(s,u){var c=pr(t(s)),l=pr(t(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:i,extractResidualLayerParams:function a(s,u,c,l,d){return void 0===d&&(d=!1),{conv1:i((d?.5:1)*s,u,c,l+"/conv1"),conv2:i(s,u,c,l+"/conv2")}}}}function xY(t){var n=[],e=function wY(t,n){var e=Rs(t,n);function o(a){var s=e(a+"/conv/filters",4),u=e(a+"/conv/bias",1),c=function r(a){return{weights:e(a+"/scale/weights",1),biases:e(a+"/scale/biases",1)}}(a);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}}}(t,n),o=e.extractResidualLayerParams,i=(0,e.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),g=o("conv128_2"),m=o("conv256_down"),v=o("conv256_1"),b=o("conv256_2"),w=o("conv256_down_out"),_=t.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!function AZ(t){return mf(t,2)}(_))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:b,conv256_down_out:w,fc:_};return Ka(t,n),{params:x,paramMappings:n}}function fa(t,n){var e=function yY(t,n){return sw(t,n,[1,1],!0)}(t,n.conv1);return e=HN(e,n.conv2),e=Pt(e,t),Gn(e)}function Hg(t,n){var e=zN(t,n.conv1);e=HN(e,n.conv2);var r=hf(t,2,2,"valid"),o=Bn(r.shape),i=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var s=gf(e.shape);s[1]=1;var u=Bn(s),c=gf((e=wr([e,u],1)).shape);c[2]=1;var l=Bn(c);e=wr([e,l],2)}return r=i?wr([r,o],3):r,e=Pt(r,e),Gn(e)}!function(t){_t(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(UN);var CY=function(t){function n(){return t.call(this,"FaceRecognitionNet")||this}return _t(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Fe(function(){var s=zN(bf(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Ce(256)),r.conv32_down);s=fa(s=Ar(s,3,2,"valid"),r.conv32_1),s=fa(s,r.conv32_2),s=fa(s,r.conv32_3),s=fa(s=Hg(s,r.conv64_down),r.conv64_1),s=fa(s,r.conv64_2),s=fa(s,r.conv64_3),s=fa(s=Hg(s,r.conv128_down),r.conv128_1),s=fa(s,r.conv128_2),s=fa(s=Hg(s,r.conv256_down),r.conv256_1);var u=(s=Hg(s=fa(s,r.conv256_2),r.conv256_down_out)).mean([1,2]);return Sg(u,r.fc)})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return Xe(this,void 0,void 0,function(){var r,o,i,a=this;return Ke(this,function(s){switch(s.label){case 0:return[4,Mr(e)];case 1:return r=s.sent(),o=Fe(function(){return xr(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return xY(e)},n.prototype.extractParams=function(e){return function _Y(t){var n=Za(t),e=n.extractWeights,r=n.getRemainingWeights,o=[],i=bY(e,o),s=i.extractResidualLayerParams,u=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),_=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),D=s(589824,256,3,"conv256_down_out"),R=Fe(function(){return Is(Ds(e(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:b,conv256_down:w,conv256_1:_,conv256_2:x,conv256_down_out:D,fc:R},paramMappings:o}}(e)},n}(Xa);function WN(t,n,e){return Object.assign({},t,{gender:n,genderProbability:e})}var $N=function(){function t(n){var e=void 0===n?{}:n,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,a=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function ha(t,n,e){return Fe(function(){var r=li(t,n.filters,e,"same");return r=Pt(r,n.batch_norm_offset),u_(r,0,6)})}function NY(t,n,e){var r=t.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(a-o)*(s-i),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(o,u),g=Math.max(i,c),m=Math.min(a,l),v=Math.min(s,d),b=Math.max(m-p,0)*Math.max(v-g,0);return b/(f+h-b)}function ol(t,n){return Fe(function(){var e=t.shape[0];return{boxPredictionEncoding:Ni(Pi(t,n.box_encoding_predictor),[e,-1,1,4]),classPrediction:Ni(Pi(t,n.class_predictor),[e,-1,3])}})}var zg=function(){function t(n){var e=void 0===n?{}:n,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),GN=function(t){function n(){return t.call(this,"SsdMobilenetv1")||this}return _t(n,t),n.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Fe(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=function kY(t,n){return Fe(function(){var e=null,r=ha(t,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(i,a){var s=a+1,u=function TY(t){return[2,4,6,12].some(function(n){return n===t})?[2,2]:[1,1]}(s);r=function MY(t,n,e){return Fe(function(){var r=Dg(t,n.filters,e,"same");return r=uR(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,.0010000000474974513),u_(r,0,6)})}(r,i.depthwise_conv,u),r=ha(r,i.pointwise_conv,[1,1]),11===s&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(Cr(Kr(o,Ce(.007843137718737125)),Ce(1)),r.mobilenetv1),s=function LY(t,n,e){return Fe(function(){var r=ha(t,e.conv_0,[1,1]),o=ha(r,e.conv_1,[2,2]),i=ha(o,e.conv_2,[1,1]),a=ha(i,e.conv_3,[2,2]),s=ha(a,e.conv_4,[1,1]),u=ha(s,e.conv_5,[2,2]),c=ha(u,e.conv_6,[1,1]),l=ha(c,e.conv_7,[2,2]),d=ol(n,e.box_predictor_0),f=ol(t,e.box_predictor_1),h=ol(o,e.box_predictor_2),p=ol(a,e.box_predictor_3),g=ol(u,e.box_predictor_4),m=ol(l,e.box_predictor_5);return{boxPredictions:wr([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:wr([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1)}})}(a.out,a.conv11,r.prediction_layer);return function PY(t,n,e){return Fe(function(){var r=t.shape[0],o=function OY(t,n){var e=function FY(t){var n=xr(Is(t,[1,0])),e=[Cr(n[2],n[0]),Cr(n[3],n[1])];return{sizes:e,centers:[Pt(n[0],Oi(e[0],Ce(2))),Pt(n[1],Oi(e[1],Ce(2)))]}}(t),r=e.sizes,o=e.centers,i=xr(Is(n,[1,0])),a=Oi(Kr(c_(Oi(i[2],Ce(5))),r[0]),Ce(2)),s=Pt(Kr(Oi(i[0],Ce(10)),r[0]),o[0]),u=Oi(Kr(c_(Oi(i[3],Ce(5))),r[1]),Ce(2)),c=Pt(Kr(Oi(i[1],Ce(10)),r[1]),o[1]);return Is($o([Cr(s,a),Cr(c,u),Pt(s,a),Pt(c,u)]),[1,0])}(Ni(Wc(e.extra_dim,[r,1,1]),[-1,4]),Ni(t,[-1,4]));o=Ni(o,[r,o.shape[0]/r,4]);var i=oR(ua(n,[0,0,1],[-1,-1,-1])),a=ua(i,[0,0,0],[-1,-1,1]);return a=Ni(a,[r,a.shape[1]]),{boxes:xr(o),scores:xr(a)}})}(s.boxPredictions,s.classPredictions,r.output_layer)})},n.prototype.forward=function(e){return Xe(this,void 0,void 0,function(){var r;return Ke(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,Mr(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),Xe(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,m,b,w,_,x,D,R,k;return Ke(this,function(M){switch(M.label){case 0:return o=new zg(r),i=o.maxResults,a=o.minConfidence,[4,Mr(e)];case 1:for(s=M.sent(),u=this.forwardInput(s),d=(c=u.boxes)[0],f=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return m=(g=Array).from,[4,f.data()];case 2:return p=m.apply(g,[M.sent()]),b=function RY(t,n,e,r,o){var a=Math.min(e,t.shape[0]),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>o}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=NY(t,l.boxIndex,c[f]);if(0!==h&&(l.score*=u(h),l.score<=o))break}d===l.score&&c.push(l.boxIndex)}}),c}(d,p,i,.5,a),w=s.getReshapedInputDimensions(0),x=(_=s.inputSize)/w.width,D=_/w.height,R=d.arraySync(),k=b.map(function(T){var B=[Math.max(0,R[T][0]),Math.min(1,R[T][2])].map(function(ne){return ne*D}),P=B[0],Q=B[1],Z=[Math.max(0,R[T][1]),Math.min(1,R[T][3])].map(function(ne){return ne*x}),Y=Z[0];return new qo(p[T],new G_(Y,P,Z[1]-Y,Q-P),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,k]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function IY(t){var n=[],e=function SY(t,n){var e=Rs(t,n);function r(c,l,d){return{filters:e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function o(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function a(c,l){return{filters:e(c+"/weights",4,l+"/filters"),bias:e(c+"/biases",1,l+"/bias")}}function s(c){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(t,n),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=t["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ng(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Ka(t,n),{params:a,paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function DY(t){var n=[],e=Za(t),r=e.extractWeights,o=e.getRemainingWeights,i=function EY(t,n){function r(u,c,l,d,f){var h=Ao(t(u*c*l*l),[l,l,u,c]),p=pr(t(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,d){var f=r(u,c,l,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function i(u,c,l){var d=function e(u,c){var l=Ao(t(9*u),[3,3,u,1]),d=pr(t(u)),f=pr(t(u)),h=pr(t(u)),p=pr(t(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:o(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function a(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,n),s=i.extractPredictionLayerParams,u=(0,i.extractMobilenetV1Params)(),c=s(),d={extra_dim:P0(r(20472),[1,5118,4])};if(n.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}(e)},n}(Xa);!function(t){_t(function n(){return null!==t&&t.apply(this,arguments)||this},t)}(GN);var VY=[new rn(.738768,.874946),new rn(2.42204,2.65704),new rn(4.30971,7.04493),new rn(10.246,4.59428),new rn(12.6868,11.8741)],UY=[new rn(1.603231,2.094468),new rn(6.041143,7.080126),new rn(2.882459,3.518061),new rn(4.266906,5.178857),new rn(9.041765,10.66308)],HY=[117.001,114.697,97.404],Wg=function(t){return"number"==typeof t};function uw(t){return Fe(function(){var n=Kr(t,Ce(.10000000149011612));return Pt(Gn(Cr(t,n)),n)})}function Ns(t,n){return Fe(function(){var e=hu(t,[[0,0],[1,1],[1,1],[0,0]]);return e=li(e,n.conv.filters,[1,1],"valid"),e=Cr(e,n.bn.sub),e=Kr(e,n.bn.truediv),uw(e=Pt(e,n.conv.bias))})}function Fs(t,n){return Fe(function(){var e=hu(t,[[0,0],[1,1],[1,1],[0,0]]);return e=p_(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),uw(e=Pt(e,n.bias))})}var cw=function(){function t(n){var e=void 0===n?{}:n,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),qN=function(t){function n(e){var r=t.call(this,"TinyYolov2")||this;return function $Y(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!Wg(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(n){return"string"==typeof n}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(n){return n||{}}).every(function(n){return Wg(n.x)&&Wg(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(Wg)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),r._config=e,r}return _t(n,t),Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,r){var o=Ns(e,r.conv0);return o=Ns(o=Ar(o,[2,2],[2,2],"same"),r.conv1),o=Ns(o=Ar(o,[2,2],[2,2],"same"),r.conv2),o=Ns(o=Ar(o,[2,2],[2,2],"same"),r.conv3),o=Ns(o=Ar(o,[2,2],[2,2],"same"),r.conv4),o=Ns(o=Ar(o,[2,2],[2,2],"same"),r.conv5),o=Ns(o=Ar(o,[2,2],[1,1],"same"),r.conv6),Pi(o=Ns(o,r.conv7),r.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?uw(Pi(e,r.conv0,"valid",!1)):Fs(e,r.conv0);return o=Fs(o=Ar(o,[2,2],[2,2],"same"),r.conv1),o=Fs(o=Ar(o,[2,2],[2,2],"same"),r.conv2),o=Fs(o=Ar(o,[2,2],[2,2],"same"),r.conv3),o=Fs(o=Ar(o,[2,2],[2,2],"same"),r.conv4),o=Fs(o=Ar(o,[2,2],[2,2],"same"),r.conv5),o=Ar(o,[2,2],[1,1],"same"),o=r.conv6?Fs(o,r.conv6):o,Pi(o=r.conv7?Fs(o,r.conv7):o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Fe(function(){var a=e.toBatchTensor(r,!1).toFloat();return a=(a=o.config.meanRgb?bf(a,o.config.meanRgb):a).div(Ce(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(e,r){return Xe(this,void 0,void 0,function(){var o;return Ke(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mr(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(e,r){return void 0===r&&(r={}),Xe(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,b=this;return Ke(this,function(w){switch(w.label){case 0:return o=new cw(r),i=o.inputSize,a=o.scoreThreshold,[4,Mr(e)];case 1:return s=w.sent(),[4,this.forwardInput(s,i)];case 2:return u=w.sent(),c=Fe(function(){return xr(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return d=w.sent(),u.dispose(),c.dispose(),f=d.map(function(_){return _.box}),h=d.map(function(_){return _.score}),p=d.map(function(_){return _.classScore}),g=d.map(function(_){return b.config.classes[_.label]}),[2,yf(f.map(function(_){return _.rescale(i)}),h,this.config.iouThreshold,!0).map(function(_){return new gN(h[_],p[_],g[_],f[_],l)})]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return function KY(t,n){var s,e=[],r=function XY(t,n){var e=Rs(t,n);function o(s){return{filters:e(s+"/filters",4),bias:e(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function i(s){var u=o(s+"/conv"),c=function r(s){return{sub:e(s+"/sub",1),truediv:e(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:nw(e)}}(t,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return Ka(t,e),{params:s,paramMappings:e}}(e,this.config)},n.prototype.extractParams=function(e){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function qY(t,n,e,r){var f,o=Za(t),a=o.getRemainingWeights,s=[],u=function GY(t,n){var e=Vg(t,n),i=tw(t,n);return{extractConvParams:e,extractConvWithBatchNormParams:function o(a,s,u){var c=e(a,s,3,u+"/conv"),l=function r(a,s){var u=pr(t(a)),c=pr(t(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:i}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(n.withSeparableConvs){var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],b=r[5],w=r[6],_=r[7],x=r[8];f={conv0:n.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,m,"conv2"),conv3:d(m,v,"conv3"),conv4:d(v,b,"conv4"),conv5:d(b,w,"conv5"),conv6:_?d(w,_,"conv6"):void 0,conv7:x?d(_,x,"conv7"):void 0,conv8:c(x||_||w,5*e,1,"conv8")}}else g=r[2],m=r[3],v=r[4],b=r[5],w=r[6],_=r[7],x=r[8],f={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,g,"conv1"),conv2:l(g,m,"conv2"),conv3:l(m,v,"conv3"),conv4:l(v,b,"conv4"),conv5:l(b,w,"conv5"),conv6:l(w,_,"conv6"),conv7:l(_,x,"conv7"),conv8:c(x,5*e,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}(e,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(e,r,o){return Xe(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b,w,_,x,D,R,k,M,T,B,P,Q,Z,Y,se,ne,ee=this;return Ke(this,function(ue){switch(ue.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=e.shape[1],d=this.config.anchors.length,f=Fe(function(){var he=e.reshape([l,l,d,ee.boxEncodingSize]);return[he.slice([0,0,0,0],[l,l,d,4]),he.slice([0,0,0,4],[l,l,d,1]),ee.withClassScores?za(he.slice([0,0,0,5],[l,l,d,ee.config.classes.length]),3):Ce(0)]}),h=f[0],g=f[2],m=[],[4,(p=f[1]).array()];case 1:return v=ue.sent(),[4,h.array()];case 2:b=ue.sent(),w=0,ue.label=3;case 3:if(!(w<l))return[3,12];_=0,ue.label=4;case 4:if(!(_<l))return[3,11];x=0,ue.label=5;case 5:return x<d?(D=$_(v[w][_][x][0]),!o||D>o?(R=(_+$_(b[w][_][x][0]))/l*u,k=(w+$_(b[w][_][x][1]))/l*c,M=Math.exp(b[w][_][x][2])*this.config.anchors[x].x/l*u,T=Math.exp(b[w][_][x][3])*this.config.anchors[x].y/l*c,B=R-M/2,P=k-T/2,Q={row:w,col:_,anchor:x},this.withClassScores?[4,this.extractPredictedClass(g,Q)]:[3,7]):[3,9]):[3,10];case 6:return ne=ue.sent(),[3,8];case 7:ne={classScore:1,label:0},ue.label=8;case 8:Y=(Z=ne).classScore,se=Z.label,m.push(Yr({box:new Fg(B,P,B+M,P+T),score:D,classScore:D*Y,label:se},Q)),ue.label=9;case 9:return x++,[3,5];case 10:return _++,[3,4];case 11:return w++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(e,r){return Xe(this,void 0,void 0,function(){var o,i,a,s;return Ke(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(Xa),YY=function(t){function n(e){void 0===e&&(e=!0);var o=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:UY,meanRgb:HY}:{anchors:VY,withClassScores:!0});return t.call(this,o)||this}return _t(n,t),Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return Xe(this,void 0,void 0,function(){return Ke(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new qo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(qN),lw=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return _t(n,t),n}(cw),xf=function(){function t(){}return t.prototype.then=function(n){return Xe(this,void 0,void 0,function(){var e;return Ke(this,function(r){switch(r.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return Xe(this,void 0,void 0,function(){return Ke(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},t}();function XN(t,n){return Object.assign({},t,{descriptor:n})}function $g(t,n,e,r,o){return void 0===o&&(o=function(i){return i.alignedRect}),Xe(this,void 0,void 0,function(){var i,a,s,u,c;return Ke(this,function(l){switch(l.label){case 0:return i=t.map(function(d){return ow(d)?o(d):d.detection}),(s=r)?[3,5]:n instanceof Cn?[4,Q_(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Y_(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,e(a=s)];case 6:return c=l.sent(),a.forEach(function(d){return d instanceof Cn&&d.dispose()}),[2,c]}})})}function dw(t,n,e,r,o){return Xe(this,void 0,void 0,function(){var i=this;return Ke(this,function(a){return[2,$g([t],n,function(s){return Xe(i,void 0,void 0,function(){return Ke(this,function(u){return[2,e(s[0])]})})},r,o)]})})}function fw(t,n){var r=n[1];return{height:Math.floor(n[0]*t),width:Math.floor(r*t)}}var hw=function(t){function n(e,r,o,i){return t.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return _t(n,t),n}(ca);function KN(t){return Fe(function(){return Kr(Cr(t,Ce(127.5)),Ce(.0078125))})}function il(t,n){return Fe(function(){return Pt(Gn(t),Kr(n,_g(Gn(_g(t)))))})}function pw(t,n,e){return void 0===e&&(e=!1),Fe(function(){var r=Pi(t,n.conv1,"valid");return r=il(r,n.prelu1_alpha),r=il(r=Pi(r=Ar(r,e?[2,2]:[3,3],[2,2],"same"),n.conv2,"valid"),n.prelu2_alpha),il(r=Pi(r=e?r:Ar(r,[3,3],[2,2],"valid"),n.conv3,"valid"),n.prelu3_alpha)})}function sQ(t,n,e,r,o){o.stage1=[];var i=n.map(function(f){return Fe(function(){var h={scale:f},p=function iQ(t,n){return Fe(function(){var e=fw(n,t.shape.slice(1)),a=KN(b_.resizeBilinear(t,[e.height,e.width]));return Is(a,[0,2,1,3])})}(t,f),g=Date.now(),m=function oQ(t,n){return Fe(function(){var e=pw(t,n,!0),r=Pi(e,n.conv4_1,"valid"),o=ci(Ig(r,3),3);return{prob:za(Cr(r,o),3),regions:Pi(e,n.conv4_2,"valid")}})}(p,r),v=m.prob,b=m.regions;return h.pnet=Date.now()-g,{scoresTensor:xr(xr(v,3)[1])[0],regionsTensor:xr(b)[0],scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,m=f.statsForScale,v=function aQ(t,n,e,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new rn(s,a));return o.map(function(c){var l=new Fg(Math.round((2*c.y+1)/e),Math.round((2*c.x+1)/e),Math.round((2*c.y+12)/e),Math.round((2*c.x+12)/e)),d=i[c.y][c.x],f=n.arraySync();return{cell:l,score:d,region:new hw(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(h,p,f.scale,e);if(h.dispose(),p.dispose(),!v.length)return o.stage1.push(m),[];var b=Date.now(),w=yf(v.map(function(_){return _.cell}),v.map(function(_){return _.score}),.5);return m.nms=Date.now()-b,m.numBoxes=w.length,o.stage1.push(m),w.map(function(_){return v[_]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=yf(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-l,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new Fg(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function ZN(t,n,e){var r=e.width,o=e.height;return Xe(this,void 0,void 0,function(){var i,a,s,u=this;return Ke(this,function(c){switch(c.label){case 0:return i=la(t),[4,Promise.all(n.map(function(l){return Xe(u,void 0,void 0,function(){var d,m,v,b;return Ke(this,function(w){return d=l.padAtBorders(t.height,t.width),b=i.getImageData(m=d.x-1,v=d.y-1,d.ex-m,d.ey-v),[2,Qr.isNodejs()?Lg(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=la(Pg({width:r,height:o}));f.drawImage(l,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);s.push(p)}),[2,s.map(function(l){return Fe(function(){return KN(Is(Ao(l,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function cQ(t,n,e,r,o){return Xe(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b;return Ke(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,ZN(t,n,{width:24,height:24})];case 1:return a=w.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(_){var x=function uQ(t,n){return Fe(function(){var e=pw(t,n),i=il(da(Ni(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),a=da(i,n.fc2_1),s=ci(Ig(a,1),1),u=za(Cr(a,s),1),c=da(i,n.fc2_2);return{scores:xr(u,1)[1],regions:c}})}(_,r);return _.dispose(),x}),o.stage2_rnet=Date.now()-i,u=s.length>1?wr(s.map(function(_){return _.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[w.sent()]),u.dispose(),f=c.map(function(_,x){return{score:_,idx:x}}).filter(function(_){return _.score>e}).map(function(_){return _.idx}),h=f.map(function(_){return n[_]}),p=f.map(function(_){return c[_]}),g=[],m=[],h.length>0&&(i=Date.now(),v=yf(h,p,.7),o.stage2_nms=Date.now()-i,b=v.map(function(_){var x=s[f[_]].regions.arraySync();return new hw(x[0][0],x[0][1],x[0][2],x[0][3])}),m=v.map(function(_){return p[_]}),g=v.map(function(_,x){return h[_].calibrate(b[x])})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function dQ(t,n,e,r,o){return Xe(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,g,m,v,b,w;return Ke(this,function(_){switch(_.label){case 0:return i=Date.now(),[4,ZN(t,n,{width:48,height:48})];case 1:return a=_.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(x){var D=function lQ(t,n){return Fe(function(){var e=pw(t,n);e=il(e=Pi(e=Ar(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var i=il(da(Ni(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),a=da(i,n.fc2_1),s=ci(Ig(a,1),1),u=za(Cr(a,s),1),c=da(i,n.fc2_2),l=da(i,n.fc2_3);return{scores:xr(u,1)[1],regions:c,points:l}})}(x,r);return x.dispose(),D}),o.stage3_onet=Date.now()-i,u=s.length>1?wr(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[_.sent()]),u.dispose(),f=c.map(function(x,D){return{score:x,idx:D}}).filter(function(x){return x.score>e}).map(function(x){return x.idx}),h=f.map(function(x){var D=s[x].regions.arraySync();return new hw(D[0][0],D[0][1],D[0][2],D[0][3])}),p=f.map(function(x,D){return n[x].calibrate(h[D])}),g=f.map(function(x){return c[x]}),m=[],v=[],b=[],p.length>0&&(i=Date.now(),w=yf(p,g,.7,!1),o.stage3_nms=Date.now()-i,m=w.map(function(x){return p[x]}),v=w.map(function(x){return g[x]}),b=w.map(function(x,D){return Array(5).fill(0).map(function(R,k){var M=s[x].points.arraySync();return new rn(M[0][k]*(m[D].width+1)+m[D].left,M[0][k+5]*(m[D].height+1)+m[D].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:m,scores:v,points:b}]}})})}var fQ=function(t){function n(){return t.call(this,"Mtcnn")||this}return _t(n,t),n.prototype.load=function(e){return Xe(this,void 0,void 0,function(){return Ke(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return Xe(this,void 0,void 0,function(){return Ke(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),Xe(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,g,m,v,w,_,x,D,R,k;return Ke(this,function(M){switch(M.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Fe(function(){return function QY(t){return Fe(function(){return $o(xr(t,3).reverse(),3)})}(ci(L_.fromPixels(i)).toFloat())}),c=function(T){return u.dispose(),a.total=Date.now()-s,T},l=u.shape.slice(1),d=l[0],f=l[1],h=new $N(r),p=h.minFaceSize,g=h.scaleFactor,m=h.maxNumScales,v=h.scoreThresholds,w=(h.scaleSteps||function rQ(t,n,e){for(var i=12/t,a=[],s=Math.min(e[0],e[1])*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s*=n,u+=1;return a}(p,g,[d,f])).filter(function(T){var B=fw(T,[d,f]);return Math.min(B.width,B.height)>12}).slice(0,m),a.scales=w,a.pyramid=w.map(function(T){return fw(T,[d,f])}),_=Date.now(),[4,sQ(u,w,v[0],o.pnet,a)];case 1:return x=M.sent(),a.total_stage1=Date.now()-_,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,_=Date.now(),[4,cQ(i,x.boxes,v[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return D=M.sent(),a.total_stage2=Date.now()-_,D.boxes.length?(a.stage3_numInputBoxes=D.boxes.length,_=Date.now(),[4,dQ(i,D.boxes,v[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return R=M.sent(),a.total_stage3=Date.now()-_,k=R.boxes.map(function(T,B){return Ug(wf({},new qo(R.scores[B],new G_(T.left/f,T.top/d,T.width/f,T.height/d),{height:d,width:f})),new LZ(R.points[B].map(function(P){return P.sub(new rn(T.left,T.top)).div(new rn(T.width,T.height))}),{width:T.width,height:T.height}))}),[2,c({results:k,stats:a})]}})})},n.prototype.forward=function(e,r){return void 0===r&&(r={}),Xe(this,void 0,void 0,function(){var o;return Ke(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mr(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),Xe(this,void 0,void 0,function(){var o;return Ke(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,Mr(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return function nQ(t){var n=[],e=function tQ(t,n){var e=Rs(t,n);function r(l){return{filters:e(l+"/weights",4,l+"/filters"),bias:e(l+"/bias",1)}}function o(l){return{weights:e(l+"/weights",2),bias:e(l+"/bias",1)}}function i(l){return e(l,1)}function a(l){return{conv1:r(l+"/conv1"),prelu1_alpha:i(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:i(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:i(l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var l=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Yr(Yr({},l),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var l=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Yr(Yr({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),g=o("onet/fc2_1"),m=o("onet/fc2_2"),v=o("onet/fc2_3");return Yr(Yr({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:m,fc2_3:v})}}}(t,n),o=e.extractRNetParams,i=e.extractONetParams,a=(0,e.extractPNetParams)(),s=o(),u=i();return Ka(t,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}(e)},n.prototype.extractParams=function(e){return function eQ(t){var n=Za(t),r=n.getRemainingWeights,o=[],i=function JY(t,n){var e=Vg(t,n),r=ew(t,n);function o(c,l){var d=pr(t(c));return n.push({paramPath:l}),d}function i(c,l,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,l+"/conv1"),prelu1_alpha:o(c[1],l+"/prelu1_alpha"),conv2:e(c[1],c[2],3,l+"/conv2"),prelu2_alpha:o(c[2],l+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,l+"/conv3"),prelu3_alpha:o(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return Yr(Yr({},c),{conv4_1:l,conv4_2:d})},extractRNetParams:function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Yr(Yr({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})},extractONetParams:function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return Yr(Yr({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:m})}}}(n.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:o}}(e)},n}(Xa),pQ=[new rn(1.603231,2.094468),new rn(6.041143,7.080126),new rn(2.882459,3.518061),new rn(4.266906,5.178857),new rn(9.041765,10.66308)],gQ=[117.001,114.697,97.404],mQ=function(t){function n(){return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:pQ,meanRgb:gQ,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return _t(n,t),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,r){return Xe(this,void 0,void 0,function(){return Ke(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new qo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},n}(qN),Wt={ssdMobilenetv1:new GN,tinyFaceDetector:new mQ,tinyYolov2:new YY,mtcnn:new fQ,faceLandmark68Net:new UN,faceLandmark68TinyNet:new mY,faceRecognitionNet:new CY,faceExpressionNet:new JZ,ageGenderNet:new fY};function YN(t,n){return Object.assign({},t,{age:n})}var QN=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _t(n,t),n}(xf),gw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o=this;return Ke(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,$g(e=i.sent(),this.input,function(a){return Xe(o,void 0,void 0,function(){return Ke(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Wt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){return BN(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new bw(this,this.input)},n}(QN),mw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r;return Ke(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,dw(e,this.input,function(i){return Wt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,BN(e,r)]}})})},n.prototype.withAgeAndGender=function(){return new _w(this,this.input)},n}(QN),vw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.withAgeAndGender=function(){return new ww(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Cw(this,this.input)},n}(gw),yw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.withAgeAndGender=function(){return new xw(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ew(this,this.input)},n}(mw),JN=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return _t(n,t),n}(xf),bw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o=this;return Ke(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,$g(e=i.sent(),this.input,function(a){return Xe(o,void 0,void 0,function(){return Ke(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Wt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){var u=r[s],c=u.age;return YN(WN(a,u.gender,u.genderProbability),c)})]}})})},n.prototype.withFaceExpressions=function(){return new gw(this,this.input)},n}(JN),_w=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o;return Ke(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?[4,dw(e,this.input,function(u){return Wt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,[2,YN(WN(e,r.gender,r.genderProbability),o)]}})})},n.prototype.withFaceExpressions=function(){return new mw(this,this.input)},n}(JN),ww=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.withFaceExpressions=function(){return new vw(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Cw(this,this.input)},n}(bw),xw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.withFaceExpressions=function(){return new yw(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ew(this,this.input)},n}(_w),eF=function(t){function n(e,r){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o}return _t(n,t),n}(xf),Cw=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e;return Ke(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,$g(e=o.sent(),this.input,function(i){return Promise.all(i.map(function(a){return Wt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(i,a){return XN(e[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new vw(this,this.input)},n.prototype.withAgeAndGender=function(){return new ww(this,this.input)},n}(eF),Ew=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r;return Ke(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,dw(e,this.input,function(i){return Wt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,XN(e,r)]}})})},n.prototype.withFaceExpressions=function(){return new yw(this,this.input)},n.prototype.withAgeAndGender=function(){return new xw(this,this.input)},n}(eF),tF=function(t){function n(e,r,o){var i=t.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return _t(n,t),Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Wt.faceLandmark68TinyNet:Wt.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(xf),vQ=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return Ke(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof Cn?[4,Q_(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Y_(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof Cn&&c.dispose()}),[2,e.map(function(c,l){return Ug(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new vw(this,this.input)},n.prototype.withAgeAndGender=function(){return new ww(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Cw(this,this.input)},n}(tF),yQ=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o,i,a;return Ke(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?(r=e.detection,this.input instanceof Cn?[4,Q_(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Y_(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=i)[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof Cn&&u.dispose()}),[2,Ug(e,a)]}})})},n.prototype.withFaceExpressions=function(){return new yw(this,this.input)},n.prototype.withAgeAndGender=function(){return new xw(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ew(this,this.input)},n}(tF),nF=function(t){function n(e,r){void 0===r&&(r=new zg);var o=t.call(this)||this;return o.input=e,o.options=r,o}return _t(n,t),n}(xf),rF=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return _t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r,o,i;return Ke(this,function(a){switch(a.label){case 0:return r=(e=this).input,(o=e.options)instanceof $N?[4,Wt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(!(i=o instanceof lw?function(s){return Wt.tinyFaceDetector.locateFaces(s,o)}:o instanceof zg?function(s){return Wt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof cw?function(s){return Wt.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return Xe(e,void 0,void 0,function(){var o;return Ke(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return wf({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new vQ(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new gw(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new bw(this.runAndExtendWithFaceDetections(),this.input)},n}(nF);function Dw(t,n){return void 0===n&&(n=new zg),new rF(t,n)}function oF(t,n){if(t.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(t),r=Array.from(n);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}function iF(t,n){var e=new xu(n.width,n.height),r=e.width,o=e.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(t))return t.map(function(s){return iF(s,{width:r,height:o})});if(ow(t)){var i=t.detection.forSize(r,o),a=t.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Ug(wf(t,i),a)}return _f(t)?wf(t,t.detection.forSize(r,o)):t instanceof rl||t instanceof qo?t.forSize(r,o):t}!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}_t(n,t),n.prototype.run=function(){return Xe(this,void 0,void 0,function(){var e,r;return Ke(this,function(o){switch(o.label){case 0:return[4,new rF(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return Xe(e,void 0,void 0,function(){var o;return Ke(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?wf({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new yQ(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new mw(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new _w(this.runAndExtendWithFaceDetection(),this.input)}}(nF),function(){function t(n,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Og)return a;if(a instanceof Float32Array)return new Og(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Og(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(n,e){return e.map(function(r){return oF(r,n)}).reduce(function(r,o){return r+o},0)/(e.length||1)},t.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(r){return new vN(r.label,e.computeMeanDistance(n,r.descriptors))}).reduce(function(r,o){return r.distance<o.distance?r:o})},t.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new vN("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},t.fromJSON=function(n){return new t(n.labeledDescriptors.map(function(r){return Og.fromJSON(r)}),n.distanceThreshold)}}();var aF=nt(725);let sF=(()=>{class t{constructor(){}getCurrentTime(){return new Date}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275prov=Je({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function bQ(t,n){if(1&t&&(j(0,"div")(1,"h1"),J(2),V(),j(3,"p"),J(4),V()()),2&t){const e=ge();H(2),Wn(e.exam.examId),H(2),Sr(" \u010cas: ",e.currentTime," ")}}function _Q(t,n){if(1&t&&(j(0,"div",16)(1,"p"),J(2),V()()),2&t){const e=ge();H(2),Wn(e.connectionAcception)}}function wQ(t,n){if(1&t&&(j(0,"div"),bn(1,"img",17),V()),2&t){const e=ge();H(1),ds("src",e.imageBase64,fh)}}function xQ(t,n){1&t&&(j(0,"div"),bn(1,"img",18),V())}let CQ=(()=>{class t{constructor(e,r,o,i,a,s){this.studentService=e,this.agentsService=r,this.timeService=o,this.activatedRoute=i,this.router=a,this.authenticationService=s,this.connectionAcception="",this.conn_id="",this.phase="connectionMake",this.pres_ex_ids=[],this.imageBase64=null,this.uploadedFaceDescriptors=[],this.webcamFaceDescriptors=[],this.location=location}ngOnInit(){var e=this;return Do(function*(){e.getCurrentUser(),e.currentTime=e.timeService.getCurrentTime();let r="";e.activatedRoute.params.subscribe(o=>r=o.examId),e.userLoggedIn?.admin_api_key?(e.getExam(r),e.onCreateInvitation(e.userLoggedIn.admin_api_key)):(window.alert("Unauthorized."),e.logout()),e.intervalId=setInterval(()=>{e.myFunction()},1e3),yield e.loadModels(),e.loadModels().then(()=>{e.startWebcam()}),e.detectFace(),e.routerSubscription=e.router.events.subscribe(o=>{o instanceof Cd&&o.restoredState&&e.logout()})})()}getCurrentUser(){const e=this.authenticationService.getCurrentUser();this.userLoggedIn=e,null==this.userLoggedIn&&this.router.navigate(["/"]).then(()=>{location.reload()})}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId),this.routerSubscription&&this.routerSubscription.unsubscribe()}myFunction(){("connectionMade"==this.phase||"connectionMake"==this.phase)&&this.checkConnection(),0!=this.pres_ex_ids.length&&this.checkState()}getExam(e){this.studentService.getExam(e).pipe(Le(r=>(this.logout(),this.formError=r.toString(),Lr(()=>r)))).subscribe(r=>{this.exam=r})}isDateBetween(e,r,o){return e>=r&&e<=o}onCreateInvitation(e){this.agentsService.createInvitation2(e).subscribe(r=>{this.studentService.getInvitationQRCode(JSON.stringify(r.invitation)).subscribe(o=>{this.qrCodeAlert(o.img)}),this.agentsService.getConnectionByMsgIdFaber(r.invi_msg_id,e).subscribe(o=>{1!=o.results.length?(window.alert("Too many connections"),Lr(()=>"Too many connections!")):(this.conn_id=o.results[0].connection_id,this.phase="connectionMade")})})}qrCodeAlert(e){const r=document.getElementById("liveAlertPlaceholder");((i,a)=>{const s=document.createElement("div");s.innerHTML=[`   <img class="card-img-top" id="QrCode" src="${i}" alt="QR code" style=""/>`].join(""),r.append(s)})(e)}checkConnection(){var e=this;return Do(function*(){e.userLoggedIn?.admin_api_key?e.agentsService.getConnectionByIdFaber(e.conn_id,e.userLoggedIn.admin_api_key).subscribe(function(){var r=Do(function*(o){"active"==o.state?(e.phase="connectionAccepted",e.userLoggedIn?.admin_api_key&&e.onSendInvite(e.userLoggedIn.admin_api_key)):e.connectionAcception="Mobilni agent \u0161e ni potrdil povezave."});return function(o){return r.apply(this,arguments)}}()):e.connectionAcception="Unauthorized."})()}onSendInvite(e){for(const r of this.exam.credentialSchemaNames)if(this.exam.credentialSchemaNames.indexOf(r),"image"!=r){let i="",a=[];this.agentsService.getCredDefBySchemaNameFaber(r.split(":")[2],e).subscribe(s=>{1!=s.credential_definition_ids.length?window.alert("Too many IDs!"+r.split(":")[2]):i=s.credential_definition_ids[0];let u=r;this.agentsService.getSchemaIdByName(u.split(":")[2],e).subscribe(c=>{1!=c.schema_ids.length?window.alert("Too many ids!"+u.split(":")[2]):this.agentsService.getSchemaById(c.schema_ids[0],e).subscribe(l=>{a=l.schema.attrNames;let d={};a.forEach(f=>{d["0_"+f+"_uuid"]={name:f,restrictions:[{cred_def_id:i}]}}),this.agentsService.postPresentAnyProof(this.conn_id,i,"",d,e).subscribe(f=>{this.pres_ex_ids.push(f.pres_ex_id);const h=document.createElement("div");h.id=f.pres_ex_id;const p=document.getElementById("container");p&&p.appendChild(h)})})})})}else if("image"==r){let i="",a=[];this.agentsService.getCredDefBySchemaNameAdditionalAgent(r,e).subscribe(s=>{1!=s.credential_definition_ids.length?window.alert("Too many IDs!"):i=s.credential_definition_ids[0],this.agentsService.getSchemaIdByNameAdditionalAgent(r,e).subscribe(c=>{1!=c.schema_ids.length?window.alert("Too many ids!"):this.agentsService.getSchemaByIdAdditionalAgent(c.schema_ids[0],e).subscribe(l=>{a=l.schema.attrNames;let d={};a.forEach(f=>{d["0_"+f+"_uuid"]={name:f,restrictions:[{cred_def_id:i}]}}),this.agentsService.postPresentAnyProof(this.conn_id,i,"",d,e).subscribe(f=>{this.pres_ex_ids.push(f.pres_ex_id);const h=document.createElement("div");h.id=f.pres_ex_id;const p=document.getElementById("container");p&&p.appendChild(h)})})})})}}checkState(){for(let e of this.pres_ex_ids)this.userLoggedIn?.admin_api_key&&this.agentsService.getPresentProofRecordById(e,this.userLoggedIn.admin_api_key).subscribe(r=>{if("done"==r.state){if(r.verified){const o=document.getElementById("loader"+this.pres_ex_ids.indexOf(e));null!=o&&(o.innerHTML=[].join(""));const i=document.getElementById(r.pres_ex_id);r.by_format.pres.indy.requested_proof.revealed_attrs["0_studentId_uuid"]&&r.by_format.pres.indy.requested_proof.revealed_attrs["0_surname_uuid"]&&r.by_format.pres.indy.requested_proof.revealed_attrs["0_name_uuid"]?null!=i&&(i.innerHTML=['<div class="alert alert-success" role="alert" style="margin-top: 5%">'+r.by_format.pres.indy.requested_proof.revealed_attrs["0_studentId_uuid"].raw+" "+r.by_format.pres.indy.requested_proof.revealed_attrs["0_surname_uuid"].raw+" "+r.by_format.pres.indy.requested_proof.revealed_attrs["0_name_uuid"].raw+"</div>"].join("")):null!=i&&(i.innerHTML=['<div class="alert alert-success" role="alert" style="margin-top: 5%">Dokaz predlo\u017een!</div>'].join(""))}else{const o=document.getElementById(r.pres_ex_id);null!=o&&(o.innerHTML=['<div class="alert alert-danger" role="alert" style="margin-top: 5%">Dokaz ni predlo\u017een!</div>'].join(""))}r.by_format.pres.indy.requested_proof.revealed_attrs["0_image_uuid"]&&(this.imageBase64=this.displayImageFromBase64(r.by_format.pres.indy.requested_proof.revealed_attrs["0_image_uuid"].raw))}else{const o=document.getElementById("loader"+this.pres_ex_ids.indexOf(e));null!=o&&0===o.innerHTML.trim().length&&(o.innerHTML=['<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'].join(""))}})}loadModels(){return Do(function*(){const e="/assets/models";yield Wt.tinyFaceDetector.loadFromUri(e),yield Wt.faceLandmark68TinyNet.loadFromUri(e),yield Wt.faceRecognitionNet.loadFromUri(e)})()}detectFace(){var e=this;return Do(function*(){setInterval(Do(function*(){const r=document.getElementById("upload");if(r){const o=new lw({inputSize:160,scoreThreshold:.5}),i=yield Dw(r,o).withFaceLandmarks(!0).withFaceDescriptors();e.uploadedFaceDescriptors=i.map(u=>u.descriptor);const a=Lg(r);a.style.display="none",document.body.append(a),MN(a,r);const s=iF(i,r);a?.getContext("2d")?.clearRect(0,0,a.width,a.height),function HZ(t,n){(Array.isArray(n)?n:[n]).forEach(function(r){var o=r instanceof qo?r.score:_f(r)?r.detection.score:void 0,i=r instanceof qo?r.box:_f(r)?r.detection.box:new ca(r),a=o?""+z_(o):void 0;new UZ(i,{label:a}).draw(t)})}(a,s),function rY(t,n){(Array.isArray(n)?n:[n]).forEach(function(r){var o=r instanceof rl?r:ow(r)?r.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new nY(o).draw(t)})}(a,s)}}),500)})()}startWebcam(){var e=this;return Do(function*(){const r=document.getElementById("video");if(null!=r){const o=yield navigator.mediaDevices.getUserMedia({video:{}});r.srcObject=o,r.onplay=Do(function*(){const i=document.getElementById("webcamCanvas");null!=i&&(MN(i,r),setInterval(Do(function*(){const a=new lw({inputSize:160,scoreThreshold:.5}),s=yield Dw(r,a).withFaceLandmarks(!0).withFaceDescriptors();e.webcamFaceDescriptors=s.map(u=>u.descriptor),e.webcamFaceDescriptors.forEach(u=>{e.uploadedFaceDescriptors.forEach(c=>{if(oF(u,c)<.6){const d=document.getElementById("faceMatchText");null!=d&&(d.innerHTML=['<div class="alert alert-success" role="alert" style="margin-top: 5%">Zaznan ujemajo\u010di se obraz!</div>'].join(""))}else{const d=document.getElementById("faceMatchText");null!=d&&(d.innerHTML=['<div class="alert alert-danger" role="alert" style="margin-top: 5%">Ni ista oseba.</div>'].join(""))}})})}),500))})}})()}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}displayImageFromBase64(e){return this.uint8ArrayToBase64(aF.ungzip(JSON.parse(e)))}uint8ArrayToBase64(e){return String.fromCharCode.apply(null,[].slice.call(e))}static{this.\u0275fac=function(r){return new(r||t)(q(ja),q(jd),q(sF),q(Si),q(dr),q(na))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-exam"]],decls:24,vars:4,consts:[[4,"ngIf"],[1,"container","text-center"],[1,"row","align-items-start"],[1,"col"],[1,"card"],["id","liveAlertPlaceholder",1,""],[1,"card-body"],["class","","style","",4,"ngIf"],["id","loader0",1,"d-flex","justify-content-evenly",2,"padding-top","5%"],["id","loader1",1,"d-flex","justify-content-evenly",2,"padding-top","5%"],["id","container"],["type","button","id","nextStudent",1,"btn",3,"click"],["id","canvas",2,"display","none"],["id","video","width","640","height","480","autoplay","",1,"card-img-top"],["id","webcamCanvas",2,"display","none"],["id","faceMatchText",1,"card-body"],[1,""],["id","upload",1,"card-img-top",3,"src"],["src","assets/img.png",1,"card-img-top"]],template:function(r,o){1&r&&(xe(0,bQ,5,2,"div",0),j(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),bn(5,"div",5),j(6,"div",6),xe(7,_Q,3,1,"div",7),V()(),bn(8,"div",8)(9,"div",9)(10,"div",10),j(11,"button",11),Ie("click",function(){return o.location.reload()}),J(12,"Naslednji \u0161tudent"),V()(),j(13,"div",3)(14,"div",4),xe(15,wQ,2,1,"div",0),xe(16,xQ,2,0,"div",0),bn(17,"canvas",12)(18,"div",6),V()(),j(19,"div",3)(20,"div",4),bn(21,"video",13)(22,"canvas",14)(23,"div",15),V()()()()),2&r&&(ie("ngIf",o.isDateBetween(o.currentTime,o.exam.beginning,o.exam.ending)),H(7),ie("ngIf","connectionMade"==o.phase),H(8),ie("ngIf",null!=o.imageBase64),H(1),ie("ngIf",null==o.imageBase64))},dependencies:[Yi],styles:["#webcamCanvas[_ngcontent-%COMP%]{position:absolute;top:0;left:0}button[_ngcontent-%COMP%]{background-color:#7e8cbb;color:#fff}button[_ngcontent-%COMP%]:hover{background-color:#fff;color:#7e8cbb;border-color:#7e8cbb}#nextStudent[_ngcontent-%COMP%]{background-color:#006400;color:#fff;border-color:#006400;margin-top:10%}#nextStudent[_ngcontent-%COMP%]:hover{background-color:#fff;color:#006400;border-color:#006400}"]})}}return t})();function EQ(t,n){if(1&t){const e=Mn();j(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h5",6),J(6,"Prijava v sistem"),V()(),j(7,"div",7)(8,"form",8),Ie("ngSubmit",function(){return wt(e),xt(ge().onLogInPredavatelj())}),j(9,"div",9)(10,"label",10),J(11,"Elektronski naslov"),V(),j(12,"input",11),Ie("ngModelChange",function(o){return wt(e),xt(ge().userLoggingIn.email=o)}),V()(),j(13,"div",9)(14,"label",12),J(15,"Geslo"),V(),j(16,"input",13),Ie("ngModelChange",function(o){return wt(e),xt(ge().userLoggingIn.password=o)}),V()(),j(17,"button",14),J(18,"Prijava"),V()()()()(),j(19,"div",3)(20,"div",4)(21,"div",5)(22,"h5",6),J(23,"Prijava preveritelja"),V()(),j(24,"div",7)(25,"form",15),Ie("ngSubmit",function(){return wt(e),xt(ge().onLogInPreverjanje())}),j(26,"div",9)(27,"label",16),J(28,"Elektronski naslov"),V(),j(29,"input",17),Ie("ngModelChange",function(o){return wt(e),xt(ge().userLoggingInExam.email=o)}),V()(),j(30,"div",9)(31,"label",18),J(32,"Geslo"),V(),j(33,"input",19),Ie("ngModelChange",function(o){return wt(e),xt(ge().userLoggingInExam.password=o)}),V()(),j(34,"div",9)(35,"label",20),J(36,"ID preverjanja"),V(),j(37,"input",21),Ie("ngModelChange",function(o){return wt(e),xt(ge().examId=o)}),V()(),j(38,"button",14),J(39,"Prijava"),V()()()()()()()}if(2&t){const e=ge();H(12),ie("ngModel",e.userLoggingIn.email),H(4),ie("ngModel",e.userLoggingIn.password),H(13),ie("ngModel",e.userLoggingInExam.email),H(4),ie("ngModel",e.userLoggingInExam.password),H(4),ie("ngModel",e.examId)}}let DQ=(()=>{class t{constructor(e,r,o){this.authenticationService=e,this.router=r,this.studentService=o,this.userLoggingIn={name:"",email:"",type:"",password:""},this.userLoggingInExam={name:"",email:"",type:"",password:""}}ngOnInit(){this.getCurrentUser(),"pedagoski_delavec"==this.userLoggedIn?.type?this.router.navigate(["/subjects"]):"admin"==this.userLoggedIn?.type&&this.router.navigate(["/admin"])}getCurrentUser(){const e=this.authenticationService.getCurrentUser();this.userLoggedIn=e}onLogInPredavatelj(){this.authenticationService.login(this.userLoggingIn).subscribe(e=>{this.getCurrentUser(),"pedagoski_delavec"==this.userLoggedIn?.type?this.router.navigate(["/subjects"]):"admin"==this.userLoggedIn?.type&&this.router.navigate(["/admin"])})}onLogInPreverjanje(){this.authenticationService.login(this.userLoggingInExam).subscribe(e=>{this.studentService.getExam(this.examId).pipe(Le(r=>(this.formError=r.toString(),this.logout(),window.alert("Nimate pravic dostopa."),Lr(()=>r)))).subscribe(r=>{this.exam=r;const o=this.authenticationService.getCurrentUser();this.userLoggedIn=o,this.userLoggedIn&&this.exam.guardians.includes(this.userLoggedIn.email)?this.router.navigate([`/exams/${this.examId}`]):(this.logout(),window.alert("Nimate pravic dostopa."))})})}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}isLoggedIn(){return this.authenticationService.isLoggedIn()}static{this.\u0275fac=function(r){return new(r||t)(q(na),q(dr),q(ja))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-enter-page"]],decls:1,vars:1,consts:[["class","container text-center","style","margin-top: 1%",4,"ngIf"],[1,"container","text-center",2,"margin-top","1%"],[1,"row","align-items-center"],[1,"col"],[1,"card","text-center","shadow"],[1,"card-header"],[1,"card-title"],[1,"card-body"],["autocomplete","off",1,"forms",3,"ngSubmit"],[1,"mb-3","input-group"],["for","predavateljEmailInput",1,"input-group-text"],["type","email","id","predavateljEmailInput","placeholder","Vnesite elektronski naslov","name","userLoggingIn.email",1,"form-control",3,"ngModel","ngModelChange"],["for","predavateljPasswordInput",1,"input-group-text"],["type","password","id","predavateljPasswordInput","placeholder","Vnesite geslo","name","userLoggingIn.password",1,"form-control",3,"ngModel","ngModelChange"],["type","submit","data-bs-dismiss","modal",1,"btn","modal-button"],[3,"ngSubmit"],["for","preveriteljEmailInput",1,"input-group-text"],["type","email","id","preveriteljEmailInput","placeholder","Vnesite elektronski naslov","name","userLoggingInExam.email",1,"form-control",3,"ngModel","ngModelChange"],["for","preveriteljPasswordInput",1,"input-group-text"],["type","password","id","preveriteljPasswordInput","placeholder","Vnesite geslo","name","userLoggingInExam.password",1,"form-control",3,"ngModel","ngModelChange"],["for","preverjanjeId",1,"input-group-text"],["type","text","id","preverjanjeId","placeholder","Vnesite ID preverjanja","name","examId",1,"form-control",3,"ngModel","ngModelChange"]],template:function(r,o){1&r&&xe(0,EQ,40,5,"div",0),2&r&&ie("ngIf",!o.isLoggedIn())},dependencies:[Yi,iu,nu,Rd,ru,Lc,Ba],styles:["#end[_ngcontent-%COMP%]{color:#7e8cbb;background-color:#7e8cbb;bottom:10px;position:fixed;height:10px}#footer[_ngcontent-%COMP%]{color:#f0edef;background-color:#f0edef;position:fixed;height:100%;width:100%}.img-fluid[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]{margin-top:1em;margin-left:1em;border-color:#0e1122}.card-header[_ngcontent-%COMP%]{background-color:#fff!important;color:#0e1122}.input-group-text[_ngcontent-%COMP%]{background-color:#f0edef!important;color:#7e8cbb!important}.modal-button[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important}.modal-button[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}.menu-button[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important;margin-top:1%}.menu-button[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}"]})}}return t})();function SQ(t,n){if(1&t){const e=Mn();j(0,"div")(1,"li")(2,"a",19),Ie("click",function(){const i=wt(e).$implicit;return xt(ge().selectOption(i))}),J(3),V()()()}if(2&t){const e=n.$implicit;H(3),Wn(e)}}function IQ(t,n){if(1&t&&(j(0,"div",20),bn(1,"input",21),j(2,"label",22),J(3,"Izbrana shema"),V()()),2&t){const e=ge();H(1),ds("value",e.selectedUploadOption)}}let AQ=(()=>{class t{constructor(e,r,o){this.router=e,this.authenticationService=r,this.studentService=o,this.uploadOptions=["Users","Subjects","StudentAdministration","StudentAchievements","Exams","WalletUsers"],this.loadedJson=!1}ngOnInit(){this.userLoggedIn=this.authenticationService.getCurrentUser(),(null==this.userLoggedIn||"admin"!=this.userLoggedIn.type)&&this.logout()}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}onUpload(){"Subjects"==this.selectedUploadOption?this.studentService.postSubjectsAll(this.jsonData).subscribe(e=>{window.alert("Data uploaded successfully.")}):"StudentAdministration"==this.selectedUploadOption?this.studentService.postStudentsAdministrationAll(this.jsonData).subscribe(e=>{window.alert("Data uploaded successfully.")}):"StudentAchievements"==this.selectedUploadOption?this.studentService.postStudentAchievementsAll(this.jsonData).subscribe(e=>{window.alert("Data uploaded successfully.")}):"Exams"==this.selectedUploadOption?this.studentService.postExamsAll(this.jsonData).subscribe(e=>{window.alert("Data uploaded successfully.")}):"Users"==this.selectedUploadOption?this.studentService.postUsersAll(this.jsonData).subscribe(e=>{window.alert("Data uploaded successfully.")}):"WalletUsers"==this.selectedUploadOption&&this.userLoggedIn?.admin_api_key&&this.studentService.postWalletUsersAll(this.jsonData,this.userLoggedIn?.admin_api_key).subscribe(e=>{window.alert("Data uploaded successfully.")})}onDeleteAll(){"Subjects"==this.selectedUploadOption?this.studentService.deleteSubjectsAll().subscribe(e=>{window.alert("Data deleted successfully.")}):"StudentAdministration"==this.selectedUploadOption?this.studentService.deleteStudentsAdministrationAll().subscribe(e=>{window.alert("Data deleted successfully.")}):"StudentAchievements"==this.selectedUploadOption?this.studentService.deleteStudentAchievementsAll().subscribe(e=>{window.alert("Data deleted successfully.")}):"Exams"==this.selectedUploadOption?this.studentService.deleteExamsAll().subscribe(e=>{window.alert("Data deleted successfully.")}):"Users"==this.selectedUploadOption?this.studentService.deleteUsersAll().subscribe(e=>{window.alert("Data deleted successfully.")}):"WalletUsers"==this.selectedUploadOption&&this.userLoggedIn?.admin_api_key&&this.studentService.deleteWalletUsersAll(this.userLoggedIn?.admin_api_key).subscribe(e=>{window.alert("Data deleted successfully.")})}selectOption(e){this.selectedUploadOption=e}onFileSelected(e){const r=e.target;if(!r.files?.length)return;const o=r.files[0],i=new FileReader;i.onload=()=>{try{this.jsonData=JSON.parse(i.result),this.loadedJson=!0}catch{window.alert("Invalid JSON file")}},i.readAsText(o)}static{this.\u0275fac=function(r){return new(r||t)(q(dr),q(na),q(ja))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-insert-data"]],decls:26,vars:4,consts:[[1,"container","text-center",2,"margin-top","1%"],[1,"row","align-items-center",2,"padding-top","3%"],[1,"col"],[1,"card","text-center","shadow",2,"padding-bottom","5%"],[1,"dropdown","card-header"],[1,"fa-solid","fa-1"],[1,"card-body"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","dropdown-toggle","btn-success"],[1,"dropdown-menu"],[4,"ngFor","ngForOf"],["class","form-floating mb-3","style","margin-top: 5%",4,"ngIf"],[1,"card","text-center","shadow"],[1,"card-header"],[1,"fa-solid","fa-2"],["autocomplete","off",1,"forms",3,"ngSubmit"],["type","file","id","myFile","name","filename","accept",".json",3,"change"],["type","submit","id","fileSubmitButton","data-bs-dismiss","modal",1,"btn","modal-button",3,"disabled"],[1,"card-footer"],["type","button",1,"btn","btn-danger",3,"disabled","click"],[1,"dropdown-item",3,"click"],[1,"form-floating","mb-3",2,"margin-top","5%"],["type","text","id","floatingInput","placeholder","Izbrana shema","disabled","",1,"form-control","is-valid",2,"background-color","white",3,"value"],["for","floatingInput"]],template:function(r,o){1&r&&(j(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),bn(5,"i",5),J(6," Izberite shemo "),V(),j(7,"div",6)(8,"button",7),J(9," Izberite shemo "),V(),j(10,"ul",8),xe(11,SQ,4,1,"div",9),V(),xe(12,IQ,4,1,"div",10),V()()(),j(13,"div",2)(14,"div",11)(15,"div",12),bn(16,"i",13),J(17," Dodajte ali izbri\u0161ite vse zapise"),V(),j(18,"div",6)(19,"form",14),Ie("ngSubmit",function(){return o.onUpload()}),j(20,"input",15),Ie("change",function(a){return o.onFileSelected(a)}),V(),j(21,"button",16),J(22,"Submit"),V()()(),j(23,"div",17)(24,"button",18),Ie("click",function(){return o.onDeleteAll()}),J(25,"Izbri\u0161i vse zapise"),V()()()()()()),2&r&&(H(11),ie("ngForOf",o.uploadOptions),H(1),ie("ngIf",o.selectedUploadOption),H(9),ie("disabled",!o.loadedJson||!o.selectedUploadOption),H(3),ie("disabled",!o.selectedUploadOption))},dependencies:[Zs,Yi,iu,ru,Ba],styles:["#fileSubmitButton[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff}#fileSubmitButton[_ngcontent-%COMP%]:hover{background-color:#fff!important;border-color:#7e8cbb!important;color:#7e8cbb}"]})}}return t})();function MQ(t,n){if(1&t){const e=Mn();j(0,"a",26),Ie("click",function(){wt(e);const o=ge().$implicit;return xt(ge(2).onStudentSelected(o))}),J(1),V()}if(2&t){const e=ge().$implicit;H(1),Wn(e.studentId)}}function TQ(t,n){if(1&t&&(j(0,"p"),J(1),V()),2&t){const e=ge().$implicit;H(1),Wn(e.studentId)}}function kQ(t,n){1&t&&bn(0,"div",27),2&t&&Aa("id","",ge().$implicit._id,"liveAlertPlaceholder")}function RQ(t,n){if(1&t){const e=Mn();j(0,"tr")(1,"td"),xe(2,MQ,2,1,"a",21),xe(3,TQ,2,1,"p",0),V(),j(4,"td"),J(5),V(),j(6,"td"),J(7),V(),j(8,"td")(9,"form",22),Ie("ngSubmit",function(){const i=wt(e).$implicit;return xt(ge(2).onCreateInvitation2(i))}),j(10,"div",23)(11,"button",24),Ie("click",function(){const i=wt(e).$implicit;return xt(ge(2).onCreateInvitation2(i))}),J(12," Izdaj povabilo "),V()()()(),j(13,"td"),xe(14,kQ,1,1,"div",25),V()()}if(2&t){const e=n.$implicit,r=ge(2);H(2),ie("ngIf",r.activeStudentAdministration==e),H(1),ie("ngIf",r.activeStudentAdministration!=e),H(2),Wn(e.surname),H(2),Wn(e.name),H(4),Aa("id","",e._id,"CreateInvitation2Button"),H(3),ie("ngIf",r.studentShowQR==e)}}function NQ(t,n){if(1&t&&(j(0,"div")(1,"table",18)(2,"thead")(3,"tr")(4,"th",19),J(5,"Vpisna \u0161tevilka"),V(),j(6,"th",19),J(7,"Ime"),V(),j(8,"th",19),J(9,"Priimek"),V(),bn(10,"th")(11,"th"),V()(),j(12,"tbody"),xe(13,RQ,15,6,"tr",20),V()()()),2&t){const e=ge();H(13),ie("ngForOf",e.studentsAdministration)}}function FQ(t,n){if(1&t&&(j(0,"div",9),bn(1,"img",28),V()),2&t){const e=ge();H(1),ie("src",e.canvasElement.toDataURL("image/jpeg"),fh)}}function OQ(t,n){if(1&t){const e=Mn();j(0,"button",29),Ie("click",function(){return wt(e),xt(ge().takePhoto())}),J(1,"Slikaj"),V()}}function PQ(t,n){if(1&t){const e=Mn();j(0,"button",30),Ie("click",function(){wt(e);const o=ge();return xt(o.stopCamera(o.selectedStudent.studentId,o.selectedStudent.surname,o.selectedStudent.name))}),J(1,"Po\u0161lji sliko"),V()}}function LQ(t,n){if(1&t){const e=Mn();j(0,"button",31),Ie("click",function(){return wt(e),xt(ge().takePhoto())}),J(1,"Slikaj \u0161e enkrat"),V()}}let BQ=(()=>{class t{constructor(e,r,o,i){this.studentService=e,this.agentsService=r,this.authenticationService=o,this.router=i,this.credentialDefinitionId="",this.schemaIsPosted=!1,this.conn_id="",this.photoTaken=!1,this.isLoaded=!1,this.selectedStudent={_id:"",studentId:"",surname:"",name:"",image:"",email:"",userName:"",registered:!1},this.location=location}ngOnInit(){this.getCurrentUser(),this.userLoggedIn?(this.getStudentsAdministration(),this.getSchemaAndCredentialDefinition()):this.logout()}getCurrentUser(){const e=this.authenticationService.getCurrentUser();(!e||"pedagoski_delavec"!=e.type)&&this.router.navigate(["/"]),this.userLoggedIn=e}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}getStudentsAdministration(){this.studentService.getStudentsAdministrationInitial().subscribe(e=>{this.studentsAdministration=e,this.isLoaded=!0})}getSchemaAndCredentialDefinition(){this.userLoggedIn?.admin_api_key&&this.agentsService.getSchemaIdByNameAdditionalAgent("image",this.userLoggedIn?.admin_api_key).subscribe(e=>{1==e.schema_ids.length&&(this.schemaId=e.schema_ids[0],this.userLoggedIn?.admin_api_key&&this.agentsService.getCredDefBySchemaNameAdditionalAgent("image",this.userLoggedIn?.admin_api_key).subscribe(r=>{1==r.credential_definition_ids.length&&(this.credentialDefinitionId=r.credential_definition_ids[0],this.schemaIsPosted=!0)}))})}onCreateInvitation2(e){this.studentShowQR=e,this.agentsService.createInvitation2AdditionalAgent().subscribe(r=>{this.studentService.getInvitationQRCode(JSON.stringify(r.invitation)).subscribe(o=>{this.qrCodeAlert(e,o.img)}),this.agentsService.getConnectionByMsgIdAdditionalAgent(r.invi_msg_id).subscribe(o=>{this.conn_id=o.results[0].connection_id,this.activeStudentAdministration=e,this.selectedStudent=e})})}qrCodeAlert(e,r){const o=document.getElementById(e._id+"liveAlertPlaceholder");((a,s)=>{const u=document.createElement("div");o.innerHTML=['<div class="alert alert-dismissible border" role="alert">',`   <div><img id="${e._id}QrCode" src="${a}" alt="QR code" width="70%"/></div>`,"</div>"].join(""),o.append(u)})(r)}onStudentSelected(e){this.videoElement=document.getElementById("videoElement"),this.canvasElement=document.getElementById("canvasElement"),this.startCamera()}takePhoto(){var e=this;return Do(function*(){let r=document.getElementById("slikaj");r&&(r.disabled=!0);let o=document.getElementById("slikajSeEnkrat");o&&(o.disabled=!0);let i=document.getElementById("posljiSliko");if(i&&(i.disabled=!0),e.videoElement.paused||e.videoElement.ended)return;const a=e.canvasElement.getContext("2d");if(a){const s=e.videoElement.videoWidth,u=e.videoElement.videoHeight;e.canvasElement.width=s,e.canvasElement.height=u,a.drawImage(e.videoElement,0,0,s,u),yield e.loadModels(),yield e.detectFace()}})()}loadModels(){return Do(function*(){const e="/assets/models";yield Wt.ssdMobilenetv1.loadFromUri(e),yield Wt.faceLandmark68Net.loadFromUri(e),yield Wt.faceRecognitionNet.loadFromUri(e)})()}detectFace(){var e=this;return Do(function*(){const r=document.getElementById("upload");if((yield Dw(r).withFaceLandmarks().withFaceDescriptors()).length>0){e.photoTaken=!0;let i=document.getElementById("slikaj");i&&(i.disabled=!0);let a=document.getElementById("slikajSeEnkrat");a&&(a.disabled=!1);let s=document.getElementById("posljiSliko");return s&&(s.disabled=!1),!0}{e.photoTaken=!1;let i=document.getElementById("slikaj");i&&(i.disabled=!1);let a=document.getElementById("slikajSeEnkrat");a&&(a.disabled=!0);let s=document.getElementById("posljiSliko");return s&&(s.disabled=!0),!1}})()}sendimage(e,r,o){const i=this.canvasElement.toDataURL("image/jpeg",.7);this.compressedImage=aF.gzip(i),this.onSendInfo(e,r,o)}stopCamera(e,r,o){let i=document.getElementById("slikaj");i&&(i.disabled=!0);let a=document.getElementById("slikajSeEnkrat");a&&(a.disabled=!0);let s=document.getElementById("posljiSliko");s&&(s.disabled=!0);const u=document.getElementById("loader");null!=u&&(u.innerHTML=['<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'].join("")),this.sendimage(e,r,o),this.stream&&this.stream.getTracks().forEach(c=>c.stop())}startCamera(){navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{this.stream=e,this.videoElement.srcObject=e,this.videoElement.play()}).catch(e=>console.error("Error accessing webcam: ",e))}onSendInfo(e,r,o){this.postCredentialNew(e,r,o)}postCredentialNew(e,r,o){var i=this;return Do(function*(){i.agentsService.getPublicDidAdditionalAgent().subscribe(a=>{i.publicDidFaber=a.result.did,0==i.schemaIsPosted?i.agentsService.postSchemaAdditionalAgent(["image","studentId","surname","name"],"image","1.0").pipe(Le(s=>(i.formError=s.toString(),window.alert(i.formError),location.reload(),Lr(()=>s)))).subscribe(s=>{i.schemaId=s.schema_id,i.agentsService.postCredentialDefinitionsAdditionalAgent(1e3,s.schema_id,!1,s.schema.name).pipe(Le(u=>(i.formError=u.toString(),window.alert(i.formError),location.reload(),Lr(()=>u)))).subscribe(u=>{i.schemaIsPosted=!0,i.credentialDefinitionId=u.sent.credential_definition_id,i.onIssueCredential(e,r,o)})}):i.onIssueCredential(e,r,o)})})()}onIssueCredential(e,r,o){let i=this.conn_id,s=this.credentialDefinitionId,u=this.publicDidFaber,c=this.schemaId,l=u,h=[{name:"image",value:JSON.stringify(this.compressedImage)},{name:"studentId",value:e},{name:"surname",value:r},{name:"name",value:o}];this.postIssueCredential(i,"",h,{cred_def_id:s,issuer_did:u,schema_id:c,schema_issuer_did:l,schema_name:"image",schema_version:"1.0"})}postIssueCredential(e,r,o,i){this.agentsService.postIssueCredentialAdditionalAgent(e,r,o,i).pipe(Le(a=>(this.formError=a.toString(),window.alert(this.formError),location.reload(),Lr(()=>a)))).subscribe(a=>{location.reload()})}static{this.\u0275fac=function(r){return new(r||t)(q(ja),q(jd),q(na),q(dr))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-administration"]],decls:23,vars:8,consts:[[4,"ngIf"],["id","viewStudentAdministrationModal","tabindex","-1","aria-labelledby","viewStudentAdministrationModal","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"webcam-container"],[1,"d-flex","justify-content-evenly"],["id","videoElement","width","200","height","200","autoplay",""],["id","canvasElement",2,"display","none"],["class","d-flex justify-content-evenly",4,"ngIf"],[1,"d-flex","justify-content-evenly",2,"padding-top","5%"],["id","slikaj","class","btn purple-button",3,"click",4,"ngIf"],["id","posljiSliko","class","btn purple-button",3,"click",4,"ngIf"],["id","slikajSeEnkrat","class","btn purple-button",3,"click",4,"ngIf"],["id","loader",1,"d-flex","justify-content-evenly",2,"padding-top","5%"],[1,"table",2,"width","90%","margin-left","5%","margin-top","2%"],["scope","col"],[4,"ngFor","ngForOf"],["href","#","data-bs-toggle","modal","data-bs-target","#viewStudentAdministrationModal",3,"click",4,"ngIf"],["autocomplete","off",1,"forms",3,"ngSubmit"],[1,"d-flex"],["type","button",1,"btn","shadow","list-button","purple-button",3,"id","click"],["class","QRAllert",3,"id",4,"ngIf"],["href","#","data-bs-toggle","modal","data-bs-target","#viewStudentAdministrationModal",3,"click"],[1,"QRAllert",3,"id"],["id","upload","width","200","alt","Captured Photo",3,"src"],["id","slikaj",1,"btn","purple-button",3,"click"],["id","posljiSliko",1,"btn","purple-button",3,"click"],["id","slikajSeEnkrat",1,"btn","purple-button",3,"click"]],template:function(r,o){1&r&&(xe(0,NQ,14,1,"div",0),j(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),J(6),V(),j(7,"button",6),Ie("click",function(){return o.location.reload()}),V()(),j(8,"div",7)(9,"div",8)(10,"div",9)(11,"div"),bn(12,"video",10)(13,"canvas",11),V()(),xe(14,FQ,2,1,"div",12),j(15,"div",13),xe(16,OQ,2,0,"button",14),V(),j(17,"div",13),xe(18,PQ,2,0,"button",15),xe(19,LQ,2,0,"button",16),V(),bn(20,"div",17),V(),j(21,"p"),J(22),V()()()()()),2&r&&(ie("ngIf",o.isLoaded),H(6),Ql("",o.selectedStudent.surname," ",o.selectedStudent.name,""),H(8),ie("ngIf",o.canvasElement),H(2),ie("ngIf",!o.photoTaken),H(2),ie("ngIf",o.photoTaken),H(1),ie("ngIf",o.photoTaken),H(3),Sr("Vpisna \u0161tevilka: ",o.selectedStudent.studentId,""))},dependencies:[Zs,Yi,iu,ru,Ba],styles:[".modal-button[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important}.modal-button[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}.purple-button[_ngcontent-%COMP%]{background-color:#7e8cbb!important;border-color:#7e8cbb!important;color:#fff!important}.purple-button[_ngcontent-%COMP%]:hover{background-color:#fff!important;color:#7e8cbb!important;border-color:#7e8cbb!important}.QRAllert[_ngcontent-%COMP%]{width:40em!important}"]})}}return t})();function jQ(t,n){if(1&t&&(j(0,"p")(1,"i"),J(2),V()()),2&t){const e=ge().$implicit,r=ge(3);H(2),Sr("Potrjena: ",r.dateToString(e.cred_ex_record.updated_at),"")}}function VQ(t,n){if(1&t&&(j(0,"p")(1,"i"),J(2),V()()),2&t){const e=ge().$implicit,r=ge(3);H(2),Sr("Zavrnjena: ",r.dateToString(e.cred_ex_record.updated_at),"")}}const UQ=function(t,n,e){return{"offer-sent":t,abandoned:n,done:e}};function HQ(t,n){if(1&t&&(j(0,"div",18),J(1),bn(2,"br"),xe(3,jQ,3,1,"p",19),xe(4,VQ,3,1,"p",19),V()),2&t){const e=n.$implicit;ie("ngClass",iS(4,UQ,"offer-sent"==e.cred_ex_record.state,"abandoned"==e.cred_ex_record.state,"done"==e.cred_ex_record.state)),H(1),Sr(" ",e.cred_ex_record.by_format.cred_offer.indy.schema_id.split(":")[2]," "),H(2),ie("ngIf","done"==e.cred_ex_record.state),H(1),ie("ngIf","abandoned"==e.cred_ex_record.state)}}function zQ(t,n){if(1&t&&(j(0,"div",15)(1,"div",16),J(2),V(),xe(3,HQ,5,8,"div",17),V()),2&t){const e=n.$implicit;H(2),Wn(e.studentId),H(1),ie("ngForOf",e.records.results)}}function WQ(t,n){if(1&t&&(j(0,"table",13)(1,"thead")(2,"tr")(3,"th"),J(4,"Vpisna \u0161tevilka"),V()()(),j(5,"tbody"),xe(6,zQ,4,2,"div",14),V()()),2&t){const e=ge();H(6),ie("ngForOf",e.credentialRecordHistory)}}let $Q=(()=>{class t{constructor(e,r,o,i,a,s){this.studentService=e,this.agentsService=r,this.timeService=o,this.activatedRoute=i,this.router=a,this.authenticationService=s,this.isLoaded=!1,this.examSchemas=[],this.credentialRecordHistory=[]}ngOnInit(){var e=this;return Do(function*(){if(e.getCurrentUser(),e.userLoggedIn){let r="";e.activatedRoute.params.subscribe(o=>r=o.subjectId),e.getSubject(r)}else e.logout()})()}getCurrentUser(){const e=this.authenticationService.getCurrentUser();this.userLoggedIn=e,null==this.userLoggedIn&&this.router.navigate(["/"])}getSubject(e){this.selectedSubjectId=e,this.getStudentAchievements()}getStudentAchievements(){this.studentService.getStudentAchievements(this.selectedSubjectId).subscribe(e=>{this.studentAchievements=e,this.studentAchievements.forEach(r=>{r.connection_id&&this.userLoggedIn?.admin_api_key&&this.agentsService.getIssueCredentialRecordsFaber(this.userLoggedIn.admin_api_key,r.connection_id).subscribe(o=>{this.credentialRecordHistory.push({studentId:r.studentId,records:o})})}),this.isLoaded=!0})}logout(){this.authenticationService.logout(),this.router.navigate(["/"]).then(()=>{location.reload()})}redirectToSubjects(){this.router.navigate(["/subjects"])}onGetList(){this.router.navigate([`subjects/${this.selectedSubjectId}`])}dateToString(e){return new Date(e).toLocaleString("sk-SK",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:void 0,hour12:!1})}static{this.\u0275fac=function(r){return new(r||t)(q(ja),q(jd),q(sF),q(Si),q(dr),q(na))}}static{this.\u0275cmp=vi({type:t,selectors:[["app-exam-applications"]],decls:20,vars:1,consts:[[1,"row","g-0","text-center",2,"margin-top","1em"],[1,"col-sm-6","col-md-8"],[1,"card",2,"width","60%","margin-left","20%"],[1,"card-header"],[1,"list-group-item","offer-sent","legend-list"],[1,"list-group-item","abandoned","legend-list"],[1,"list-group-item","done","legend-list"],[1,"col-6","col-md-4"],[1,"btn-group"],["type","button",1,"btn","shadow","mini-navigation-button",3,"click"],["type","button","data-bs-toggle","modal",1,"btn","shadow","mini-navigation-button",3,"click"],[2,"overflow-x","auto !important"],["class","table",4,"ngIf"],[1,"table"],["class","d-flex mb-3",4,"ngFor","ngForOf"],[1,"d-flex","mb-3"],[1,"",2,"width","8%"],["style","width: 250px",3,"ngClass",4,"ngFor","ngForOf"],[2,"width","250px",3,"ngClass"],[4,"ngIf"]],template:function(r,o){1&r&&(j(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),J(4,"Legenda"),V(),j(5,"ul")(6,"li",4),J(7," \u010ce je polje prikazano takole, je ponudba poverilnice poslana."),V(),j(8,"li",5),J(9," \u010ce je polje prikazano takole, je prijava na izpit zavrnjena."),V(),j(10,"li",6),J(11," \u010ce je polje prikazano takole, je prijava na izpit potrjena."),V()()()(),j(12,"div",7)(13,"div",8)(14,"button",9),Ie("click",function(){return o.onGetList()}),J(15,"Nazaj na dose\u017eke"),V(),j(16,"button",10),Ie("click",function(){return o.redirectToSubjects()}),J(17,"Nazaj na predmete"),V()()()(),j(18,"div",11),xe(19,WQ,7,1,"table",12),V()),2&r&&(H(19),ie("ngIf",o.isLoaded))},dependencies:[HI,Zs,Yi],styles:[".offer-sent[_ngcontent-%COMP%]{background-color:#f6e6b4;color:#000}.abandoned[_ngcontent-%COMP%]{background-color:#e69ea4;color:#fff}.done[_ngcontent-%COMP%]{background-color:#c5dcc5;color:#000}.mini-navigation-button[_ngcontent-%COMP%]{background-color:#9e969b;border-color:#9e969b;color:#fff}.mini-navigation-button[_ngcontent-%COMP%]:hover{background-color:#f0edef;color:#9e969b;border-color:#9e969b}.legend-list[_ngcontent-%COMP%]{margin-right:5%;margin-top:1%}"]})}}return t})(),GQ=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=yi({type:t,bootstrap:[rG]})}static{this.\u0275inj=ti({imports:[O6,dW,$$,z8.forRoot([{path:"",component:DQ},{path:"subjects/:subjectId",component:XG},{path:"subjects",component:iq},{path:"exams/:examId",component:CQ},{path:"examApplications/:subjectId",component:$Q},{path:"admin",component:AQ},{path:"administration",component:BQ}],{onSameUrlNavigation:"reload"}),G$]})}}return t})();N6().bootstrapModule(GQ).catch(t=>console.error(t))},725:(vn,Ee,nt)=>{"use strict";var pe={};(0,nt(662).assign)(pe,nt(2),nt(426),nt(498)),vn.exports=pe},2:(vn,Ee,nt)=>{"use strict";var ve=nt(308),_e=nt(662),ct=nt(229),te=nt(943),pe=nt(629),Ge=Object.prototype.toString,oe=0,Oe=-1,be=0,we=8;function Ve(ht){if(!(this instanceof Ve))return new Ve(ht);this.options=_e.assign({level:Oe,method:we,chunkSize:16384,windowBits:15,memLevel:8,strategy:be,to:""},ht||{});var He=this.options;He.raw&&He.windowBits>0?He.windowBits=-He.windowBits:He.gzip&&He.windowBits>0&&He.windowBits<16&&(He.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pe,this.strm.avail_out=0;var ze=ve.deflateInit2(this.strm,He.level,He.method,He.windowBits,He.memLevel,He.strategy);if(ze!==oe)throw new Error(te[ze]);if(He.header&&ve.deflateSetHeader(this.strm,He.header),He.dictionary){var fe;if(fe="string"==typeof He.dictionary?ct.string2buf(He.dictionary):"[object ArrayBuffer]"===Ge.call(He.dictionary)?new Uint8Array(He.dictionary):He.dictionary,(ze=ve.deflateSetDictionary(this.strm,fe))!==oe)throw new Error(te[ze]);this._dict_set=!0}}function rt(ht,He){var ze=new Ve(He);if(ze.push(ht,!0),ze.err)throw ze.msg||te[ze.err];return ze.result}Ve.prototype.push=function(ht,He){var We,Tt,ze=this.strm,fe=this.options.chunkSize;if(this.ended)return!1;Tt=He===~~He?He:!0===He?4:0,ze.input="string"==typeof ht?ct.string2buf(ht):"[object ArrayBuffer]"===Ge.call(ht)?new Uint8Array(ht):ht,ze.next_in=0,ze.avail_in=ze.input.length;do{if(0===ze.avail_out&&(ze.output=new _e.Buf8(fe),ze.next_out=0,ze.avail_out=fe),1!==(We=ve.deflate(ze,Tt))&&We!==oe)return this.onEnd(We),this.ended=!0,!1;(0===ze.avail_out||0===ze.avail_in&&(4===Tt||2===Tt))&&this.onData("string"===this.options.to?ct.buf2binstring(_e.shrinkBuf(ze.output,ze.next_out)):_e.shrinkBuf(ze.output,ze.next_out))}while((ze.avail_in>0||0===ze.avail_out)&&1!==We);return 4===Tt?(We=ve.deflateEnd(this.strm),this.onEnd(We),this.ended=!0,We===oe):(2===Tt&&(this.onEnd(oe),ze.avail_out=0),!0)},Ve.prototype.onData=function(ht){this.chunks.push(ht)},Ve.prototype.onEnd=function(ht){ht===oe&&(this.result="string"===this.options.to?this.chunks.join(""):_e.flattenChunks(this.chunks)),this.chunks=[],this.err=ht,this.msg=this.strm.msg},Ee.Deflate=Ve,Ee.deflate=rt,Ee.deflateRaw=function Dt(ht,He){return(He=He||{}).raw=!0,rt(ht,He)},Ee.gzip=function Lt(ht,He){return(He=He||{}).gzip=!0,rt(ht,He)}},426:(vn,Ee,nt)=>{"use strict";var ve=nt(416),_e=nt(662),ct=nt(229),te=nt(498),pe=nt(943),Ge=nt(629),ye=nt(107),Ne=Object.prototype.toString;function oe(Oe){if(!(this instanceof oe))return new oe(Oe);this.options=_e.assign({chunkSize:16384,windowBits:0,to:""},Oe||{});var be=this.options;be.raw&&be.windowBits>=0&&be.windowBits<16&&(be.windowBits=-be.windowBits,0===be.windowBits&&(be.windowBits=-15)),be.windowBits>=0&&be.windowBits<16&&!(Oe&&Oe.windowBits)&&(be.windowBits+=32),be.windowBits>15&&be.windowBits<48&&(15&be.windowBits||(be.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ge,this.strm.avail_out=0;var we=ve.inflateInit2(this.strm,be.windowBits);if(we!==te.Z_OK)throw new Error(pe[we]);if(this.header=new ye,ve.inflateGetHeader(this.strm,this.header),be.dictionary&&("string"==typeof be.dictionary?be.dictionary=ct.string2buf(be.dictionary):"[object ArrayBuffer]"===Ne.call(be.dictionary)&&(be.dictionary=new Uint8Array(be.dictionary)),be.raw&&(we=ve.inflateSetDictionary(this.strm,be.dictionary))!==te.Z_OK))throw new Error(pe[we])}function st(Oe,be){var we=new oe(be);if(we.push(Oe,!0),we.err)throw we.msg||pe[we.err];return we.result}oe.prototype.push=function(Oe,be){var Dt,Lt,ht,He,ze,we=this.strm,Ve=this.options.chunkSize,rt=this.options.dictionary,fe=!1;if(this.ended)return!1;Lt=be===~~be?be:!0===be?te.Z_FINISH:te.Z_NO_FLUSH,we.input="string"==typeof Oe?ct.binstring2buf(Oe):"[object ArrayBuffer]"===Ne.call(Oe)?new Uint8Array(Oe):Oe,we.next_in=0,we.avail_in=we.input.length;do{if(0===we.avail_out&&(we.output=new _e.Buf8(Ve),we.next_out=0,we.avail_out=Ve),(Dt=ve.inflate(we,te.Z_NO_FLUSH))===te.Z_NEED_DICT&&rt&&(Dt=ve.inflateSetDictionary(this.strm,rt)),Dt===te.Z_BUF_ERROR&&!0===fe&&(Dt=te.Z_OK,fe=!1),Dt!==te.Z_STREAM_END&&Dt!==te.Z_OK)return this.onEnd(Dt),this.ended=!0,!1;we.next_out&&(0===we.avail_out||Dt===te.Z_STREAM_END||0===we.avail_in&&(Lt===te.Z_FINISH||Lt===te.Z_SYNC_FLUSH))&&("string"===this.options.to?(ht=ct.utf8border(we.output,we.next_out),He=we.next_out-ht,ze=ct.buf2string(we.output,ht),we.next_out=He,we.avail_out=Ve-He,He&&_e.arraySet(we.output,we.output,ht,He,0),this.onData(ze)):this.onData(_e.shrinkBuf(we.output,we.next_out))),0===we.avail_in&&0===we.avail_out&&(fe=!0)}while((we.avail_in>0||0===we.avail_out)&&Dt!==te.Z_STREAM_END);return Dt===te.Z_STREAM_END&&(Lt=te.Z_FINISH),Lt===te.Z_FINISH?(Dt=ve.inflateEnd(this.strm),this.onEnd(Dt),this.ended=!0,Dt===te.Z_OK):(Lt===te.Z_SYNC_FLUSH&&(this.onEnd(te.Z_OK),we.avail_out=0),!0)},oe.prototype.onData=function(Oe){this.chunks.push(Oe)},oe.prototype.onEnd=function(Oe){Oe===te.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):_e.flattenChunks(this.chunks)),this.chunks=[],this.err=Oe,this.msg=this.strm.msg},Ee.Inflate=oe,Ee.inflate=st,Ee.inflateRaw=function Qe(Oe,be){return(be=be||{}).raw=!0,st(Oe,be)},Ee.ungzip=st},662:(vn,Ee)=>{"use strict";var nt=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function ve(te,pe){return Object.prototype.hasOwnProperty.call(te,pe)}Ee.assign=function(te){for(var pe=Array.prototype.slice.call(arguments,1);pe.length;){var Ge=pe.shift();if(Ge){if("object"!=typeof Ge)throw new TypeError(Ge+"must be non-object");for(var ye in Ge)ve(Ge,ye)&&(te[ye]=Ge[ye])}}return te},Ee.shrinkBuf=function(te,pe){return te.length===pe?te:te.subarray?te.subarray(0,pe):(te.length=pe,te)};var _e={arraySet:function(te,pe,Ge,ye,Ne){if(pe.subarray&&te.subarray)te.set(pe.subarray(Ge,Ge+ye),Ne);else for(var oe=0;oe<ye;oe++)te[Ne+oe]=pe[Ge+oe]},flattenChunks:function(te){var pe,Ge,ye,Ne,oe,st;for(ye=0,pe=0,Ge=te.length;pe<Ge;pe++)ye+=te[pe].length;for(st=new Uint8Array(ye),Ne=0,pe=0,Ge=te.length;pe<Ge;pe++)st.set(oe=te[pe],Ne),Ne+=oe.length;return st}},ct={arraySet:function(te,pe,Ge,ye,Ne){for(var oe=0;oe<ye;oe++)te[Ne+oe]=pe[Ge+oe]},flattenChunks:function(te){return[].concat.apply([],te)}};Ee.setTyped=function(te){te?(Ee.Buf8=Uint8Array,Ee.Buf16=Uint16Array,Ee.Buf32=Int32Array,Ee.assign(Ee,_e)):(Ee.Buf8=Array,Ee.Buf16=Array,Ee.Buf32=Array,Ee.assign(Ee,ct))},Ee.setTyped(nt)},229:(vn,Ee,nt)=>{"use strict";var ve=nt(662),_e=!0,ct=!0;try{String.fromCharCode.apply(null,[0])}catch{_e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ct=!1}for(var te=new ve.Buf8(256),pe=0;pe<256;pe++)te[pe]=pe>=252?6:pe>=248?5:pe>=240?4:pe>=224?3:pe>=192?2:1;function Ge(ye,Ne){if(Ne<65534&&(ye.subarray&&ct||!ye.subarray&&_e))return String.fromCharCode.apply(null,ve.shrinkBuf(ye,Ne));for(var oe="",st=0;st<Ne;st++)oe+=String.fromCharCode(ye[st]);return oe}te[254]=te[254]=1,Ee.string2buf=function(ye){var Ne,oe,st,Qe,Oe,be=ye.length,we=0;for(Qe=0;Qe<be;Qe++)55296==(64512&(oe=ye.charCodeAt(Qe)))&&Qe+1<be&&56320==(64512&(st=ye.charCodeAt(Qe+1)))&&(oe=65536+(oe-55296<<10)+(st-56320),Qe++),we+=oe<128?1:oe<2048?2:oe<65536?3:4;for(Ne=new ve.Buf8(we),Oe=0,Qe=0;Oe<we;Qe++)55296==(64512&(oe=ye.charCodeAt(Qe)))&&Qe+1<be&&56320==(64512&(st=ye.charCodeAt(Qe+1)))&&(oe=65536+(oe-55296<<10)+(st-56320),Qe++),oe<128?Ne[Oe++]=oe:oe<2048?(Ne[Oe++]=192|oe>>>6,Ne[Oe++]=128|63&oe):oe<65536?(Ne[Oe++]=224|oe>>>12,Ne[Oe++]=128|oe>>>6&63,Ne[Oe++]=128|63&oe):(Ne[Oe++]=240|oe>>>18,Ne[Oe++]=128|oe>>>12&63,Ne[Oe++]=128|oe>>>6&63,Ne[Oe++]=128|63&oe);return Ne},Ee.buf2binstring=function(ye){return Ge(ye,ye.length)},Ee.binstring2buf=function(ye){for(var Ne=new ve.Buf8(ye.length),oe=0,st=Ne.length;oe<st;oe++)Ne[oe]=ye.charCodeAt(oe);return Ne},Ee.buf2string=function(ye,Ne){var oe,st,Qe,Oe,be=Ne||ye.length,we=new Array(2*be);for(st=0,oe=0;oe<be;)if((Qe=ye[oe++])<128)we[st++]=Qe;else if((Oe=te[Qe])>4)we[st++]=65533,oe+=Oe-1;else{for(Qe&=2===Oe?31:3===Oe?15:7;Oe>1&&oe<be;)Qe=Qe<<6|63&ye[oe++],Oe--;Oe>1?we[st++]=65533:Qe<65536?we[st++]=Qe:(we[st++]=55296|(Qe-=65536)>>10&1023,we[st++]=56320|1023&Qe)}return Ge(we,st)},Ee.utf8border=function(ye,Ne){var oe;for((Ne=Ne||ye.length)>ye.length&&(Ne=ye.length),oe=Ne-1;oe>=0&&128==(192&ye[oe]);)oe--;return oe<0||0===oe?Ne:oe+te[ye[oe]]>Ne?oe:Ne}},334:vn=>{"use strict";vn.exports=function Ee(nt,ve,_e,ct){for(var te=65535&nt|0,pe=nt>>>16&65535|0,Ge=0;0!==_e;){_e-=Ge=_e>2e3?2e3:_e;do{pe=pe+(te=te+ve[ct++]|0)|0}while(--Ge);te%=65521,pe%=65521}return te|pe<<16|0}},498:vn=>{"use strict";vn.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},208:vn=>{"use strict";var nt=function Ee(){for(var _e,ct=[],te=0;te<256;te++){_e=te;for(var pe=0;pe<8;pe++)_e=1&_e?3988292384^_e>>>1:_e>>>1;ct[te]=_e}return ct}();vn.exports=function ve(_e,ct,te,pe){var Ge=nt,ye=pe+te;_e^=-1;for(var Ne=pe;Ne<ye;Ne++)_e=_e>>>8^Ge[255&(_e^ct[Ne])];return-1^_e}},308:(vn,Ee,nt)=>{"use strict";var ko,ve=nt(662),_e=nt(838),ct=nt(334),te=nt(208),pe=nt(943),Ge=0,Qe=0,be=-2,fe=2,We=8,Kn=286,qt=30,un=19,Hn=2*Kn+1,kt=15,ot=3,Zn=258,En=Zn+ot+1,Nn=42,cn=113;function Tr(y,W){return y.msg=pe[W],W}function va(y){return(y<<1)-(y>4?9:0)}function go(y){for(var W=y.length;--W>=0;)y[W]=0}function Jr(y){var W=y.state,G=W.pending;G>y.avail_out&&(G=y.avail_out),0!==G&&(ve.arraySet(y.output,W.pending_buf,W.pending_out,G,y.next_out),y.next_out+=G,W.pending_out+=G,y.total_out+=G,y.avail_out-=G,W.pending-=G,0===W.pending&&(W.pending_out=0))}function On(y,W){_e._tr_flush_block(y,y.block_start>=0?y.block_start:-1,y.strstart-y.block_start,W),y.block_start=y.strstart,Jr(y.strm)}function Rt(y,W){y.pending_buf[y.pending++]=W}function eo(y,W){y.pending_buf[y.pending++]=W>>>8&255,y.pending_buf[y.pending++]=255&W}function es(y,W,G,E){var O=y.avail_in;return O>E&&(O=E),0===O?0:(y.avail_in-=O,ve.arraySet(W,y.input,y.next_in,O,G),1===y.state.wrap?y.adler=ct(y.adler,W,O,G):2===y.state.wrap&&(y.adler=te(y.adler,W,O,G)),y.next_in+=O,y.total_in+=O,O)}function Zo(y,W){var O,U,G=y.max_chain_length,E=y.strstart,qe=y.prev_length,De=y.nice_match,ke=y.strstart>y.w_size-En?y.strstart-(y.w_size-En):0,Bt=y.window,fi=y.w_mask,Ln=y.prev,zt=y.strstart+Zn,Yn=Bt[E+qe-1],mr=Bt[E+qe];y.prev_length>=y.good_match&&(G>>=2),De>y.lookahead&&(De=y.lookahead);do{if(Bt[(O=W)+qe]===mr&&Bt[O+qe-1]===Yn&&Bt[O]===Bt[E]&&Bt[++O]===Bt[E+1]){E+=2,O++;do{}while(Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&Bt[++E]===Bt[++O]&&E<zt);if(U=Zn-(zt-E),E=zt-Zn,U>qe){if(y.match_start=W,qe=U,U>=De)break;Yn=Bt[E+qe-1],mr=Bt[E+qe]}}}while((W=Ln[W&fi])>ke&&0!=--G);return qe<=y.lookahead?qe:y.lookahead}function mo(y){var G,E,O,U,qe,W=y.w_size;do{if(U=y.window_size-y.lookahead-y.strstart,y.strstart>=W+(W-En)){ve.arraySet(y.window,y.window,W,W,0),y.match_start-=W,y.strstart-=W,y.block_start-=W,G=E=y.hash_size;do{O=y.head[--G],y.head[G]=O>=W?O-W:0}while(--E);G=E=W;do{O=y.prev[--G],y.prev[G]=O>=W?O-W:0}while(--E);U+=W}if(0===y.strm.avail_in)break;if(E=es(y.strm,y.window,y.strstart+y.lookahead,U),y.lookahead+=E,y.lookahead+y.insert>=ot)for(y.ins_h=y.window[qe=y.strstart-y.insert],y.ins_h=(y.ins_h<<y.hash_shift^y.window[qe+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[qe+ot-1])&y.hash_mask,y.prev[qe&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=qe,qe++,y.insert--,!(y.lookahead+y.insert<ot)););}while(y.lookahead<En&&0!==y.strm.avail_in)}function di(y,W){for(var G,E;;){if(y.lookahead<En){if(mo(y),y.lookahead<En&&W===Ge)return 1;if(0===y.lookahead)break}if(G=0,y.lookahead>=ot&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ot-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),0!==G&&y.strstart-G<=y.w_size-En&&(y.match_length=Zo(y,G)),y.match_length>=ot)if(E=_e._tr_tally(y,y.strstart-y.match_start,y.match_length-ot),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=ot){y.match_length--;do{y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ot-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart}while(0!=--y.match_length);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else E=_e._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(E&&(On(y,!1),0===y.strm.avail_out))return 1}return y.insert=y.strstart<ot-1?y.strstart:ot-1,4===W?(On(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(On(y,!1),0===y.strm.avail_out)?1:2}function To(y,W){for(var G,E,O;;){if(y.lookahead<En){if(mo(y),y.lookahead<En&&W===Ge)return 1;if(0===y.lookahead)break}if(G=0,y.lookahead>=ot&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ot-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=ot-1,0!==G&&y.prev_length<y.max_lazy_match&&y.strstart-G<=y.w_size-En&&(y.match_length=Zo(y,G),y.match_length<=5&&(1===y.strategy||y.match_length===ot&&y.strstart-y.match_start>4096)&&(y.match_length=ot-1)),y.prev_length>=ot&&y.match_length<=y.prev_length){O=y.strstart+y.lookahead-ot,E=_e._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-ot),y.lookahead-=y.prev_length-1,y.prev_length-=2;do{++y.strstart<=O&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+ot-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart)}while(0!=--y.prev_length);if(y.match_available=0,y.match_length=ot-1,y.strstart++,E&&(On(y,!1),0===y.strm.avail_out))return 1}else if(y.match_available){if((E=_e._tr_tally(y,0,y.window[y.strstart-1]))&&On(y,!1),y.strstart++,y.lookahead--,0===y.strm.avail_out)return 1}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(E=_e._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<ot-1?y.strstart:ot-1,4===W?(On(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(On(y,!1),0===y.strm.avail_out)?1:2}function Pn(y,W,G,E,O){this.good_length=y,this.max_lazy=W,this.nice_length=G,this.max_chain=E,this.func=O}function I(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=We,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ve.Buf16(2*Hn),this.dyn_dtree=new ve.Buf16(2*(2*qt+1)),this.bl_tree=new ve.Buf16(2*(2*un+1)),go(this.dyn_ltree),go(this.dyn_dtree),go(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ve.Buf16(kt+1),this.heap=new ve.Buf16(2*Kn+1),go(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ve.Buf16(2*Kn+1),go(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ce(y){var W;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=fe,(W=y.state).pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?Nn:cn,y.adler=2===W.wrap?0:1,W.last_flush=Ge,_e._tr_init(W),Qe):Tr(y,be)}function me(y){var W=ce(y);return W===Qe&&function ns(y){y.window_size=2*y.w_size,go(y.head),y.max_lazy_match=ko[y.level].max_lazy,y.good_match=ko[y.level].good_length,y.nice_match=ko[y.level].nice_length,y.max_chain_length=ko[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=ot-1,y.match_available=0,y.ins_h=0}(y.state),W}function L(y,W,G,E,O,U){if(!y)return be;var qe=1;if(-1===W&&(W=6),E<0?(qe=0,E=-E):E>15&&(qe=2,E-=16),O<1||O>9||G!==We||E<8||E>15||W<0||W>9||U<0||U>4)return Tr(y,be);8===E&&(E=9);var De=new I;return y.state=De,De.strm=y,De.wrap=qe,De.gzhead=null,De.w_bits=E,De.w_size=1<<De.w_bits,De.w_mask=De.w_size-1,De.hash_bits=O+7,De.hash_size=1<<De.hash_bits,De.hash_mask=De.hash_size-1,De.hash_shift=~~((De.hash_bits+ot-1)/ot),De.window=new ve.Buf8(2*De.w_size),De.head=new ve.Buf16(De.hash_size),De.prev=new ve.Buf16(De.w_size),De.lit_bufsize=1<<O+6,De.pending_buf_size=4*De.lit_bufsize,De.pending_buf=new ve.Buf8(De.pending_buf_size),De.d_buf=1*De.lit_bufsize,De.l_buf=3*De.lit_bufsize,De.level=W,De.strategy=U,De.method=G,me(y)}ko=[new Pn(0,0,0,0,function Li(y,W){var G=65535;for(G>y.pending_buf_size-5&&(G=y.pending_buf_size-5);;){if(y.lookahead<=1){if(mo(y),0===y.lookahead&&W===Ge)return 1;if(0===y.lookahead)break}y.strstart+=y.lookahead,y.lookahead=0;var E=y.block_start+G;if((0===y.strstart||y.strstart>=E)&&(y.lookahead=y.strstart-E,y.strstart=E,On(y,!1),0===y.strm.avail_out)||y.strstart-y.block_start>=y.w_size-En&&(On(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,4===W?(On(y,!0),0===y.strm.avail_out?3:4):(y.strstart>y.block_start&&On(y,!1),1)}),new Pn(4,4,8,4,di),new Pn(4,5,16,8,di),new Pn(4,6,32,32,di),new Pn(4,4,16,16,To),new Pn(8,16,32,32,To),new Pn(8,16,128,128,To),new Pn(8,32,128,256,To),new Pn(32,128,258,1024,To),new Pn(32,258,258,4096,To)],Ee.deflateInit=function K(y,W){return L(y,W,We,15,8,0)},Ee.deflateInit2=L,Ee.deflateReset=me,Ee.deflateResetKeep=ce,Ee.deflateSetHeader=function Ae(y,W){return y&&y.state&&2===y.state.wrap?(y.state.gzhead=W,Qe):be},Ee.deflate=function C(y,W){var G,E,O,U;if(!y||!y.state||W>5||W<0)return y?Tr(y,be):be;if(E=y.state,!y.output||!y.input&&0!==y.avail_in||666===E.status&&4!==W)return Tr(y,0===y.avail_out?-5:be);if(E.strm=y,G=E.last_flush,E.last_flush=W,E.status===Nn)if(2===E.wrap)y.adler=0,Rt(E,31),Rt(E,139),Rt(E,8),E.gzhead?(Rt(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),Rt(E,255&E.gzhead.time),Rt(E,E.gzhead.time>>8&255),Rt(E,E.gzhead.time>>16&255),Rt(E,E.gzhead.time>>24&255),Rt(E,9===E.level?2:E.strategy>=2||E.level<2?4:0),Rt(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(Rt(E,255&E.gzhead.extra.length),Rt(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(y.adler=te(y.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(Rt(E,0),Rt(E,0),Rt(E,0),Rt(E,0),Rt(E,0),Rt(E,9===E.level?2:E.strategy>=2||E.level<2?4:0),Rt(E,3),E.status=cn);else{var qe=We+(E.w_bits-8<<4)<<8;qe|=(E.strategy>=2||E.level<2?0:E.level<6?1:6===E.level?2:3)<<6,0!==E.strstart&&(qe|=32),qe+=31-qe%31,E.status=cn,eo(E,qe),0!==E.strstart&&(eo(E,y.adler>>>16),eo(E,65535&y.adler)),y.adler=1}if(69===E.status)if(E.gzhead.extra){for(O=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),Jr(y),O=E.pending,E.pending!==E.pending_buf_size));)Rt(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(73===E.status)if(E.gzhead.name){O=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),Jr(y),O=E.pending,E.pending===E.pending_buf_size)){U=1;break}U=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,Rt(E,U)}while(0!==U);E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),0===U&&(E.gzindex=0,E.status=91)}else E.status=91;if(91===E.status)if(E.gzhead.comment){O=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),Jr(y),O=E.pending,E.pending===E.pending_buf_size)){U=1;break}U=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,Rt(E,U)}while(0!==U);E.gzhead.hcrc&&E.pending>O&&(y.adler=te(y.adler,E.pending_buf,E.pending-O,O)),0===U&&(E.status=103)}else E.status=103;if(103===E.status&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&Jr(y),E.pending+2<=E.pending_buf_size&&(Rt(E,255&y.adler),Rt(E,y.adler>>8&255),y.adler=0,E.status=cn)):E.status=cn),0!==E.pending){if(Jr(y),0===y.avail_out)return E.last_flush=-1,Qe}else if(0===y.avail_in&&va(W)<=va(G)&&4!==W)return Tr(y,-5);if(666===E.status&&0!==y.avail_in)return Tr(y,-5);if(0!==y.avail_in||0!==E.lookahead||W!==Ge&&666!==E.status){var ke=2===E.strategy?function Bi(y,W){for(var G;;){if(0===y.lookahead&&(mo(y),0===y.lookahead)){if(W===Ge)return 1;break}if(y.match_length=0,G=_e._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++,G&&(On(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,4===W?(On(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(On(y,!1),0===y.strm.avail_out)?1:2}(E,W):3===E.strategy?function ts(y,W){for(var G,E,O,U,qe=y.window;;){if(y.lookahead<=Zn){if(mo(y),y.lookahead<=Zn&&W===Ge)return 1;if(0===y.lookahead)break}if(y.match_length=0,y.lookahead>=ot&&y.strstart>0&&(E=qe[O=y.strstart-1])===qe[++O]&&E===qe[++O]&&E===qe[++O]){U=y.strstart+Zn;do{}while(E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&E===qe[++O]&&O<U);y.match_length=Zn-(U-O),y.match_length>y.lookahead&&(y.match_length=y.lookahead)}if(y.match_length>=ot?(G=_e._tr_tally(y,1,y.match_length-ot),y.lookahead-=y.match_length,y.strstart+=y.match_length,y.match_length=0):(G=_e._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++),G&&(On(y,!1),0===y.strm.avail_out))return 1}return y.insert=0,4===W?(On(y,!0),0===y.strm.avail_out?3:4):y.last_lit&&(On(y,!1),0===y.strm.avail_out)?1:2}(E,W):ko[E.level].func(E,W);if((3===ke||4===ke)&&(E.status=666),1===ke||3===ke)return 0===y.avail_out&&(E.last_flush=-1),Qe;if(2===ke&&(1===W?_e._tr_align(E):5!==W&&(_e._tr_stored_block(E,0,0,!1),3===W&&(go(E.head),0===E.lookahead&&(E.strstart=0,E.block_start=0,E.insert=0))),Jr(y),0===y.avail_out))return E.last_flush=-1,Qe}return 4!==W?Qe:E.wrap<=0?1:(2===E.wrap?(Rt(E,255&y.adler),Rt(E,y.adler>>8&255),Rt(E,y.adler>>16&255),Rt(E,y.adler>>24&255),Rt(E,255&y.total_in),Rt(E,y.total_in>>8&255),Rt(E,y.total_in>>16&255),Rt(E,y.total_in>>24&255)):(eo(E,y.adler>>>16),eo(E,65535&y.adler)),Jr(y),E.wrap>0&&(E.wrap=-E.wrap),0!==E.pending?Qe:1)},Ee.deflateEnd=function le(y){var W;return y&&y.state?(W=y.state.status)!==Nn&&69!==W&&73!==W&&91!==W&&103!==W&&W!==cn&&666!==W?Tr(y,be):(y.state=null,W===cn?Tr(y,-3):Qe):be},Ee.deflateSetDictionary=function it(y,W){var E,O,U,qe,De,ke,Bt,fi,G=W.length;if(!y||!y.state||2===(qe=(E=y.state).wrap)||1===qe&&E.status!==Nn||E.lookahead)return be;for(1===qe&&(y.adler=ct(y.adler,W,G,0)),E.wrap=0,G>=E.w_size&&(0===qe&&(go(E.head),E.strstart=0,E.block_start=0,E.insert=0),fi=new ve.Buf8(E.w_size),ve.arraySet(fi,W,G-E.w_size,E.w_size,0),W=fi,G=E.w_size),De=y.avail_in,ke=y.next_in,Bt=y.input,y.avail_in=G,y.next_in=0,y.input=W,mo(E);E.lookahead>=ot;){O=E.strstart,U=E.lookahead-(ot-1);do{E.ins_h=(E.ins_h<<E.hash_shift^E.window[O+ot-1])&E.hash_mask,E.prev[O&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=O,O++}while(--U);E.strstart=O,E.lookahead=ot-1,mo(E)}return E.strstart+=E.lookahead,E.block_start=E.strstart,E.insert=E.lookahead,E.lookahead=0,E.match_length=E.prev_length=ot-1,E.match_available=0,y.next_in=ke,y.input=Bt,y.avail_in=De,E.wrap=qe,Qe},Ee.deflateInfo="pako deflate (from Nodeca project)"},107:vn=>{"use strict";vn.exports=function Ee(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},282:vn=>{"use strict";vn.exports=function(_e,ct){var te,pe,Ge,ye,Ne,oe,st,Qe,Oe,be,we,Ve,rt,Dt,Lt,ht,He,ze,fe,We,Tt,ut,tn,fn,vt;fn=_e.input,Ge=(pe=_e.next_in)+(_e.avail_in-5),vt=_e.output,Ne=(ye=_e.next_out)-(ct-_e.avail_out),oe=ye+(_e.avail_out-257),st=(te=_e.state).dmax,Qe=te.wsize,Oe=te.whave,be=te.wnext,we=te.window,Ve=te.hold,rt=te.bits,Dt=te.lencode,Lt=te.distcode,ht=(1<<te.lenbits)-1,He=(1<<te.distbits)-1;e:do{rt<15&&(Ve+=fn[pe++]<<rt,Ve+=fn[pe++]<<(rt+=8),rt+=8),ze=Dt[Ve&ht];t:for(;;){if(Ve>>>=fe=ze>>>24,rt-=fe,0==(fe=ze>>>16&255))vt[ye++]=65535&ze;else{if(!(16&fe)){if(64&fe){if(32&fe){te.mode=12;break e}_e.msg="invalid literal/length code",te.mode=30;break e}ze=Dt[(65535&ze)+(Ve&(1<<fe)-1)];continue t}for(We=65535&ze,(fe&=15)&&(rt<fe&&(Ve+=fn[pe++]<<rt,rt+=8),We+=Ve&(1<<fe)-1,Ve>>>=fe,rt-=fe),rt<15&&(Ve+=fn[pe++]<<rt,Ve+=fn[pe++]<<(rt+=8),rt+=8),ze=Lt[Ve&He];;){if(Ve>>>=fe=ze>>>24,rt-=fe,16&(fe=ze>>>16&255)){if(Tt=65535&ze,rt<(fe&=15)&&(Ve+=fn[pe++]<<rt,(rt+=8)<fe&&(Ve+=fn[pe++]<<rt,rt+=8)),(Tt+=Ve&(1<<fe)-1)>st){_e.msg="invalid distance too far back",te.mode=30;break e}if(Ve>>>=fe,rt-=fe,Tt>(fe=ye-Ne)){if((fe=Tt-fe)>Oe&&te.sane){_e.msg="invalid distance too far back",te.mode=30;break e}if(ut=0,tn=we,0===be){if(ut+=Qe-fe,fe<We){We-=fe;do{vt[ye++]=we[ut++]}while(--fe);ut=ye-Tt,tn=vt}}else if(be<fe){if(ut+=Qe+be-fe,(fe-=be)<We){We-=fe;do{vt[ye++]=we[ut++]}while(--fe);if(ut=0,be<We){We-=fe=be;do{vt[ye++]=we[ut++]}while(--fe);ut=ye-Tt,tn=vt}}}else if(ut+=be-fe,fe<We){We-=fe;do{vt[ye++]=we[ut++]}while(--fe);ut=ye-Tt,tn=vt}for(;We>2;)vt[ye++]=tn[ut++],vt[ye++]=tn[ut++],vt[ye++]=tn[ut++],We-=3;We&&(vt[ye++]=tn[ut++],We>1&&(vt[ye++]=tn[ut++]))}else{ut=ye-Tt;do{vt[ye++]=vt[ut++],vt[ye++]=vt[ut++],vt[ye++]=vt[ut++],We-=3}while(We>2);We&&(vt[ye++]=vt[ut++],We>1&&(vt[ye++]=vt[ut++]))}break}if(64&fe){_e.msg="invalid distance code",te.mode=30;break e}ze=Lt[(65535&ze)+(Ve&(1<<fe)-1)]}}break}}while(pe<Ge&&ye<oe);Ve&=(1<<(rt-=(We=rt>>3)<<3))-1,_e.next_in=pe-=We,_e.next_out=ye,_e.avail_in=pe<Ge?Ge-pe+5:5-(pe-Ge),_e.avail_out=ye<oe?oe-ye+257:257-(ye-oe),te.hold=Ve,te.bits=rt}},416:(vn,Ee,nt)=>{"use strict";var ve=nt(662),_e=nt(334),ct=nt(208),te=nt(282),pe=nt(295),Oe=0,Ve=-2,He=1,go=852,Jr=592;function eo(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function es(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ve.Buf16(320),this.work=new ve.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Zo(L){var K;return L&&L.state?(L.total_in=L.total_out=(K=L.state).total=0,L.msg="",K.wrap&&(L.adler=1&K.wrap),K.mode=He,K.last=0,K.havedict=0,K.dmax=32768,K.head=null,K.hold=0,K.bits=0,K.lencode=K.lendyn=new ve.Buf32(go),K.distcode=K.distdyn=new ve.Buf32(Jr),K.sane=1,K.back=-1,Oe):Ve}function mo(L){var K;return L&&L.state?((K=L.state).wsize=0,K.whave=0,K.wnext=0,Zo(L)):Ve}function Li(L,K){var C,le;return!L||!L.state||(le=L.state,K<0?(C=0,K=-K):(C=1+(K>>4),K<48&&(K&=15)),K&&(K<8||K>15))?Ve:(null!==le.window&&le.wbits!==K&&(le.window=null),le.wrap=C,le.wbits=K,mo(L))}function di(L,K){var C,le;return L?(le=new es,L.state=le,le.window=null,(C=Li(L,K))!==Oe&&(L.state=null),C):Ve}var Bi,Pn,ts=!0;function ko(L){if(ts){var K;for(Bi=new ve.Buf32(512),Pn=new ve.Buf32(32),K=0;K<144;)L.lens[K++]=8;for(;K<256;)L.lens[K++]=9;for(;K<280;)L.lens[K++]=7;for(;K<288;)L.lens[K++]=8;for(pe(1,L.lens,0,288,Bi,0,L.work,{bits:9}),K=0;K<32;)L.lens[K++]=5;pe(2,L.lens,0,32,Pn,0,L.work,{bits:5}),ts=!1}L.lencode=Bi,L.lenbits=9,L.distcode=Pn,L.distbits=5}function ns(L,K,C,le){var it,y=L.state;return null===y.window&&(y.wsize=1<<y.wbits,y.wnext=0,y.whave=0,y.window=new ve.Buf8(y.wsize)),le>=y.wsize?(ve.arraySet(y.window,K,C-y.wsize,y.wsize,0),y.wnext=0,y.whave=y.wsize):((it=y.wsize-y.wnext)>le&&(it=le),ve.arraySet(y.window,K,C-le,it,y.wnext),(le-=it)?(ve.arraySet(y.window,K,C-le,le,0),y.wnext=le,y.whave=y.wsize):(y.wnext+=it,y.wnext===y.wsize&&(y.wnext=0),y.whave<y.wsize&&(y.whave+=it))),0}Ee.inflateReset=mo,Ee.inflateReset2=Li,Ee.inflateResetKeep=Zo,Ee.inflateInit=function To(L){return di(L,15)},Ee.inflateInit2=di,Ee.inflate=function I(L,K){var C,le,it,y,W,G,E,O,U,qe,De,ke,Bt,fi,zt,Yn,mr,hn,Du,Su,Qn,vo,hi,Yo,Ln=0,cr=new ve.Buf8(4),Qo=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&0!==L.avail_in)return Ve;12===(C=L.state).mode&&(C.mode=13),W=L.next_out,it=L.output,y=L.next_in,le=L.input,O=C.hold,U=C.bits,qe=G=L.avail_in,De=E=L.avail_out,vo=Oe;e:for(;;)switch(C.mode){case He:if(0===C.wrap){C.mode=13;break}for(;U<16;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(2&C.wrap&&35615===O){C.check=0,cr[0]=255&O,cr[1]=O>>>8&255,C.check=ct(C.check,cr,2,0),O=0,U=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&O)<<8)+(O>>8))%31){L.msg="incorrect header check",C.mode=30;break}if(8!=(15&O)){L.msg="unknown compression method",C.mode=30;break}if(U-=4,Qn=8+(15&(O>>>=4)),0===C.wbits)C.wbits=Qn;else if(Qn>C.wbits){L.msg="invalid window size",C.mode=30;break}C.dmax=1<<Qn,L.adler=C.check=1,C.mode=512&O?10:12,O=0,U=0;break;case 2:for(;U<16;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(C.flags=O,8!=(255&C.flags)){L.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){L.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=O>>8&1),512&C.flags&&(cr[0]=255&O,cr[1]=O>>>8&255,C.check=ct(C.check,cr,2,0)),O=0,U=0,C.mode=3;case 3:for(;U<32;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.head&&(C.head.time=O),512&C.flags&&(cr[0]=255&O,cr[1]=O>>>8&255,cr[2]=O>>>16&255,cr[3]=O>>>24&255,C.check=ct(C.check,cr,4,0)),O=0,U=0,C.mode=4;case 4:for(;U<16;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.head&&(C.head.xflags=255&O,C.head.os=O>>8),512&C.flags&&(cr[0]=255&O,cr[1]=O>>>8&255,C.check=ct(C.check,cr,2,0)),O=0,U=0,C.mode=5;case 5:if(1024&C.flags){for(;U<16;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.length=O,C.head&&(C.head.extra_len=O),512&C.flags&&(cr[0]=255&O,cr[1]=O>>>8&255,C.check=ct(C.check,cr,2,0)),O=0,U=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&((ke=C.length)>G&&(ke=G),ke&&(C.head&&(Qn=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),ve.arraySet(C.head.extra,le,y,ke,Qn)),512&C.flags&&(C.check=ct(C.check,le,ke,y)),G-=ke,y+=ke,C.length-=ke),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===G)break e;ke=0;do{Qn=le[y+ke++],C.head&&Qn&&C.length<65536&&(C.head.name+=String.fromCharCode(Qn))}while(Qn&&ke<G);if(512&C.flags&&(C.check=ct(C.check,le,ke,y)),G-=ke,y+=ke,Qn)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===G)break e;ke=0;do{Qn=le[y+ke++],C.head&&Qn&&C.length<65536&&(C.head.comment+=String.fromCharCode(Qn))}while(Qn&&ke<G);if(512&C.flags&&(C.check=ct(C.check,le,ke,y)),G-=ke,y+=ke,Qn)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;U<16;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(O!==(65535&C.check)){L.msg="header crc mismatch",C.mode=30;break}O=0,U=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),L.adler=C.check=0,C.mode=12;break;case 10:for(;U<32;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}L.adler=C.check=eo(O),O=0,U=0,C.mode=11;case 11:if(0===C.havedict)return L.next_out=W,L.avail_out=E,L.next_in=y,L.avail_in=G,C.hold=O,C.bits=U,2;L.adler=C.check=1,C.mode=12;case 12:if(5===K||6===K)break e;case 13:if(C.last){O>>>=7&U,U-=7&U,C.mode=27;break}for(;U<3;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}switch(C.last=1&O,U-=1,3&(O>>>=1)){case 0:C.mode=14;break;case 1:if(ko(C),C.mode=20,6===K){O>>>=2,U-=2;break e}break;case 2:C.mode=17;break;case 3:L.msg="invalid block type",C.mode=30}O>>>=2,U-=2;break;case 14:for(O>>>=7&U,U-=7&U;U<32;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if((65535&O)!=(O>>>16^65535)){L.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&O,O=0,U=0,C.mode=15,6===K)break e;case 15:C.mode=16;case 16:if(ke=C.length){if(ke>G&&(ke=G),ke>E&&(ke=E),0===ke)break e;ve.arraySet(it,le,y,ke,W),G-=ke,y+=ke,E-=ke,W+=ke,C.length-=ke;break}C.mode=12;break;case 17:for(;U<14;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(C.nlen=257+(31&O),U-=5,C.ndist=1+(31&(O>>>=5)),U-=5,C.ncode=4+(15&(O>>>=5)),O>>>=4,U-=4,C.nlen>286||C.ndist>30){L.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;U<3;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.lens[Qo[C.have++]]=7&O,O>>>=3,U-=3}for(;C.have<19;)C.lens[Qo[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,vo=pe(0,C.lens,0,19,C.lencode,0,C.work,hi={bits:C.lenbits}),C.lenbits=hi.bits,vo){L.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;Yn=(Ln=C.lencode[O&(1<<C.lenbits)-1])>>>16&255,mr=65535&Ln,!((zt=Ln>>>24)<=U);){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(mr<16)O>>>=zt,U-=zt,C.lens[C.have++]=mr;else{if(16===mr){for(Yo=zt+2;U<Yo;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(O>>>=zt,U-=zt,0===C.have){L.msg="invalid bit length repeat",C.mode=30;break}Qn=C.lens[C.have-1],ke=3+(3&O),O>>>=2,U-=2}else if(17===mr){for(Yo=zt+3;U<Yo;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}U-=zt,Qn=0,ke=3+(7&(O>>>=zt)),O>>>=3,U-=3}else{for(Yo=zt+7;U<Yo;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}U-=zt,Qn=0,ke=11+(127&(O>>>=zt)),O>>>=7,U-=7}if(C.have+ke>C.nlen+C.ndist){L.msg="invalid bit length repeat",C.mode=30;break}for(;ke--;)C.lens[C.have++]=Qn}}if(30===C.mode)break;if(0===C.lens[256]){L.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,vo=pe(1,C.lens,0,C.nlen,C.lencode,0,C.work,hi={bits:C.lenbits}),C.lenbits=hi.bits,vo){L.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,vo=pe(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,hi={bits:C.distbits}),C.distbits=hi.bits,vo){L.msg="invalid distances set",C.mode=30;break}if(C.mode=20,6===K)break e;case 20:C.mode=21;case 21:if(G>=6&&E>=258){L.next_out=W,L.avail_out=E,L.next_in=y,L.avail_in=G,C.hold=O,C.bits=U,te(L,De),W=L.next_out,it=L.output,E=L.avail_out,y=L.next_in,le=L.input,G=L.avail_in,O=C.hold,U=C.bits,12===C.mode&&(C.back=-1);break}for(C.back=0;Yn=(Ln=C.lencode[O&(1<<C.lenbits)-1])>>>16&255,mr=65535&Ln,!((zt=Ln>>>24)<=U);){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(Yn&&!(240&Yn)){for(hn=zt,Du=Yn,Su=mr;Yn=(Ln=C.lencode[Su+((O&(1<<hn+Du)-1)>>hn)])>>>16&255,mr=65535&Ln,!(hn+(zt=Ln>>>24)<=U);){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}O>>>=hn,U-=hn,C.back+=hn}if(O>>>=zt,U-=zt,C.back+=zt,C.length=mr,0===Yn){C.mode=26;break}if(32&Yn){C.back=-1,C.mode=12;break}if(64&Yn){L.msg="invalid literal/length code",C.mode=30;break}C.extra=15&Yn,C.mode=22;case 22:if(C.extra){for(Yo=C.extra;U<Yo;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.length+=O&(1<<C.extra)-1,O>>>=C.extra,U-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;Yn=(Ln=C.distcode[O&(1<<C.distbits)-1])>>>16&255,mr=65535&Ln,!((zt=Ln>>>24)<=U);){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(!(240&Yn)){for(hn=zt,Du=Yn,Su=mr;Yn=(Ln=C.distcode[Su+((O&(1<<hn+Du)-1)>>hn)])>>>16&255,mr=65535&Ln,!(hn+(zt=Ln>>>24)<=U);){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}O>>>=hn,U-=hn,C.back+=hn}if(O>>>=zt,U-=zt,C.back+=zt,64&Yn){L.msg="invalid distance code",C.mode=30;break}C.offset=mr,C.extra=15&Yn,C.mode=24;case 24:if(C.extra){for(Yo=C.extra;U<Yo;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}C.offset+=O&(1<<C.extra)-1,O>>>=C.extra,U-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){L.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(0===E)break e;if(C.offset>(ke=De-E)){if((ke=C.offset-ke)>C.whave&&C.sane){L.msg="invalid distance too far back",C.mode=30;break}Bt=ke>C.wnext?C.wsize-(ke-=C.wnext):C.wnext-ke,ke>C.length&&(ke=C.length),fi=C.window}else fi=it,Bt=W-C.offset,ke=C.length;ke>E&&(ke=E),E-=ke,C.length-=ke;do{it[W++]=fi[Bt++]}while(--ke);0===C.length&&(C.mode=21);break;case 26:if(0===E)break e;it[W++]=C.length,E--,C.mode=21;break;case 27:if(C.wrap){for(;U<32;){if(0===G)break e;G--,O|=le[y++]<<U,U+=8}if(L.total_out+=De-=E,C.total+=De,De&&(L.adler=C.check=C.flags?ct(C.check,it,De,W-De):_e(C.check,it,De,W-De)),De=E,(C.flags?O:eo(O))!==C.check){L.msg="incorrect data check",C.mode=30;break}O=0,U=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;U<32;){if(0===G)break e;G--,O+=le[y++]<<U,U+=8}if(O!==(4294967295&C.total)){L.msg="incorrect length check",C.mode=30;break}O=0,U=0}C.mode=29;case 29:vo=1;break e;case 30:vo=-3;break e;case 31:return-4;default:return Ve}return L.next_out=W,L.avail_out=E,L.next_in=y,L.avail_in=G,C.hold=O,C.bits=U,(C.wsize||De!==L.avail_out&&C.mode<30&&(C.mode<27||4!==K))&&ns(L,L.output,L.next_out,De-L.avail_out)?(C.mode=31,-4):(De-=L.avail_out,L.total_in+=qe-=L.avail_in,L.total_out+=De,C.total+=De,C.wrap&&De&&(L.adler=C.check=C.flags?ct(C.check,it,De,L.next_out-De):_e(C.check,it,De,L.next_out-De)),L.data_type=C.bits+(C.last?64:0)+(12===C.mode?128:0)+(20===C.mode||15===C.mode?256:0),(0===qe&&0===De||4===K)&&vo===Oe&&(vo=-5),vo)},Ee.inflateEnd=function ce(L){if(!L||!L.state)return Ve;var K=L.state;return K.window&&(K.window=null),L.state=null,Oe},Ee.inflateGetHeader=function me(L,K){var C;return L&&L.state&&2&(C=L.state).wrap?(C.head=K,K.done=!1,Oe):Ve},Ee.inflateSetDictionary=function Ae(L,K){var le,C=K.length;return L&&L.state&&(0===(le=L.state).wrap||11===le.mode)?11===le.mode&&_e(1,K,C,0)!==le.check?-3:ns(L,K,C,C)?(le.mode=31,-4):(le.havedict=1,Oe):Ve},Ee.inflateInfo="pako inflate (from Nodeca project)"},295:(vn,Ee,nt)=>{"use strict";var ve=nt(662),Ne=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],oe=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],st=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Qe=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];vn.exports=function(be,we,Ve,rt,Dt,Lt,ht,He){var Hn,kt,ot,Zn,En,ur,et,Xt,Dr,ze=He.bits,fe=0,We=0,Tt=0,ut=0,tn=0,fn=0,vt=0,Kn=0,qt=0,un=0,ho=null,Nn=0,Fn=new ve.Buf16(16),Ht=new ve.Buf16(16),At=null,cn=0;for(fe=0;fe<=15;fe++)Fn[fe]=0;for(We=0;We<rt;We++)Fn[we[Ve+We]]++;for(tn=ze,ut=15;ut>=1&&0===Fn[ut];ut--);if(tn>ut&&(tn=ut),0===ut)return Dt[Lt++]=20971520,Dt[Lt++]=20971520,He.bits=1,0;for(Tt=1;Tt<ut&&0===Fn[Tt];Tt++);for(tn<Tt&&(tn=Tt),Kn=1,fe=1;fe<=15;fe++)if(Kn<<=1,(Kn-=Fn[fe])<0)return-1;if(Kn>0&&(0===be||1!==ut))return-1;for(Ht[1]=0,fe=1;fe<15;fe++)Ht[fe+1]=Ht[fe]+Fn[fe];for(We=0;We<rt;We++)0!==we[Ve+We]&&(ht[Ht[we[Ve+We]]++]=We);if(0===be?(ho=At=ht,ur=19):1===be?(ho=Ne,Nn-=257,At=oe,cn-=257,ur=256):(ho=st,At=Qe,ur=-1),un=0,We=0,fe=Tt,En=Lt,fn=tn,vt=0,ot=-1,Zn=(qt=1<<tn)-1,1===be&&qt>852||2===be&&qt>592)return 1;for(;;){et=fe-vt,ht[We]<ur?(Xt=0,Dr=ht[We]):ht[We]>ur?(Xt=At[cn+ht[We]],Dr=ho[Nn+ht[We]]):(Xt=96,Dr=0),Hn=1<<fe-vt,Tt=kt=1<<fn;do{Dt[En+(un>>vt)+(kt-=Hn)]=et<<24|Xt<<16|Dr|0}while(0!==kt);for(Hn=1<<fe-1;un&Hn;)Hn>>=1;if(0!==Hn?(un&=Hn-1,un+=Hn):un=0,We++,0==--Fn[fe]){if(fe===ut)break;fe=we[Ve+ht[We]]}if(fe>tn&&(un&Zn)!==ot){for(0===vt&&(vt=tn),En+=Tt,Kn=1<<(fn=fe-vt);fn+vt<ut&&!((Kn-=Fn[fn+vt])<=0);)fn++,Kn<<=1;if(qt+=1<<fn,1===be&&qt>852||2===be&&qt>592)return 1;Dt[ot=un&Zn]=tn<<24|fn<<16|En-Lt|0}}return 0!==un&&(Dt[En+un]=fe-vt<<24|64<<16|0),He.bits=tn,0}},943:vn=>{"use strict";vn.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},838:(vn,Ee,nt)=>{"use strict";var ve=nt(662);function Ge(I){for(var ce=I.length;--ce>=0;)I[ce]=0}var Lt=15,ht=16,ut=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],tn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],fn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],qt=new Array(576);Ge(qt);var un=new Array(60);Ge(un);var Hn=new Array(512);Ge(Hn);var kt=new Array(256);Ge(kt);var ot=new Array(29);Ge(ot);var ho,Nn,ur,Zn=new Array(30);function En(I,ce,me,Ae,L){this.static_tree=I,this.extra_bits=ce,this.extra_base=me,this.elems=Ae,this.max_length=L,this.has_stree=I&&I.length}function Fn(I,ce){this.dyn_tree=I,this.max_code=0,this.stat_desc=ce}function Ht(I){return I<256?Hn[I]:Hn[256+(I>>>7)]}function At(I,ce){I.pending_buf[I.pending++]=255&ce,I.pending_buf[I.pending++]=ce>>>8&255}function cn(I,ce,me){I.bi_valid>ht-me?(I.bi_buf|=ce<<I.bi_valid&65535,At(I,I.bi_buf),I.bi_buf=ce>>ht-I.bi_valid,I.bi_valid+=me-ht):(I.bi_buf|=ce<<I.bi_valid&65535,I.bi_valid+=me)}function et(I,ce,me){cn(I,me[2*ce],me[2*ce+1])}function Xt(I,ce){var me=0;do{me|=1&I,I>>>=1,me<<=1}while(--ce>0);return me>>>1}function po(I,ce,me){var K,C,Ae=new Array(Lt+1),L=0;for(K=1;K<=Lt;K++)Ae[K]=L=L+me[K-1]<<1;for(C=0;C<=ce;C++){var le=I[2*C+1];0!==le&&(I[2*C]=Xt(Ae[le]++,le))}}function Tr(I){var ce;for(ce=0;ce<286;ce++)I.dyn_ltree[2*ce]=0;for(ce=0;ce<30;ce++)I.dyn_dtree[2*ce]=0;for(ce=0;ce<19;ce++)I.bl_tree[2*ce]=0;I.dyn_ltree[512]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function va(I){I.bi_valid>8?At(I,I.bi_buf):I.bi_valid>0&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Jr(I,ce,me,Ae){var L=2*ce,K=2*me;return I[L]<I[K]||I[L]===I[K]&&Ae[ce]<=Ae[me]}function On(I,ce,me){for(var Ae=I.heap[me],L=me<<1;L<=I.heap_len&&(L<I.heap_len&&Jr(ce,I.heap[L+1],I.heap[L],I.depth)&&L++,!Jr(ce,Ae,I.heap[L],I.depth));)I.heap[me]=I.heap[L],me=L,L<<=1;I.heap[me]=Ae}function Rt(I,ce,me){var Ae,L,C,le,K=0;if(0!==I.last_lit)do{Ae=I.pending_buf[I.d_buf+2*K]<<8|I.pending_buf[I.d_buf+2*K+1],L=I.pending_buf[I.l_buf+K],K++,0===Ae?et(I,L,ce):(et(I,(C=kt[L])+256+1,ce),0!==(le=ut[C])&&cn(I,L-=ot[C],le),et(I,C=Ht(--Ae),me),0!==(le=tn[C])&&cn(I,Ae-=Zn[C],le))}while(K<I.last_lit);et(I,256,ce)}function eo(I,ce){var C,le,y,me=ce.dyn_tree,Ae=ce.stat_desc.static_tree,L=ce.stat_desc.has_stree,K=ce.stat_desc.elems,it=-1;for(I.heap_len=0,I.heap_max=573,C=0;C<K;C++)0!==me[2*C]?(I.heap[++I.heap_len]=it=C,I.depth[C]=0):me[2*C+1]=0;for(;I.heap_len<2;)me[2*(y=I.heap[++I.heap_len]=it<2?++it:0)]=1,I.depth[y]=0,I.opt_len--,L&&(I.static_len-=Ae[2*y+1]);for(ce.max_code=it,C=I.heap_len>>1;C>=1;C--)On(I,me,C);y=K;do{C=I.heap[1],I.heap[1]=I.heap[I.heap_len--],On(I,me,1),le=I.heap[1],I.heap[--I.heap_max]=C,I.heap[--I.heap_max]=le,me[2*y]=me[2*C]+me[2*le],I.depth[y]=(I.depth[C]>=I.depth[le]?I.depth[C]:I.depth[le])+1,me[2*C+1]=me[2*le+1]=y,I.heap[1]=y++,On(I,me,1)}while(I.heap_len>=2);I.heap[--I.heap_max]=I.heap[1],function zr(I,ce){var y,W,G,E,O,U,me=ce.dyn_tree,Ae=ce.max_code,L=ce.stat_desc.static_tree,K=ce.stat_desc.has_stree,C=ce.stat_desc.extra_bits,le=ce.stat_desc.extra_base,it=ce.stat_desc.max_length,qe=0;for(E=0;E<=Lt;E++)I.bl_count[E]=0;for(me[2*I.heap[I.heap_max]+1]=0,y=I.heap_max+1;y<573;y++)(E=me[2*me[2*(W=I.heap[y])+1]+1]+1)>it&&(E=it,qe++),me[2*W+1]=E,!(W>Ae)&&(I.bl_count[E]++,O=0,W>=le&&(O=C[W-le]),I.opt_len+=(U=me[2*W])*(E+O),K&&(I.static_len+=U*(L[2*W+1]+O)));if(0!==qe){do{for(E=it-1;0===I.bl_count[E];)E--;I.bl_count[E]--,I.bl_count[E+1]+=2,I.bl_count[it]--,qe-=2}while(qe>0);for(E=it;0!==E;E--)for(W=I.bl_count[E];0!==W;)!((G=I.heap[--y])>Ae)&&(me[2*G+1]!==E&&(I.opt_len+=(E-me[2*G+1])*me[2*G],me[2*G+1]=E),W--)}}(I,ce),po(me,it,I.bl_count)}function es(I,ce,me){var Ae,K,L=-1,C=ce[1],le=0,it=7,y=4;for(0===C&&(it=138,y=3),ce[2*(me+1)+1]=65535,Ae=0;Ae<=me;Ae++)K=C,C=ce[2*(Ae+1)+1],!(++le<it&&K===C)&&(le<y?I.bl_tree[2*K]+=le:0!==K?(K!==L&&I.bl_tree[2*K]++,I.bl_tree[32]++):le<=10?I.bl_tree[34]++:I.bl_tree[36]++,le=0,L=K,0===C?(it=138,y=3):K===C?(it=6,y=3):(it=7,y=4))}function Zo(I,ce,me){var Ae,K,L=-1,C=ce[1],le=0,it=7,y=4;for(0===C&&(it=138,y=3),Ae=0;Ae<=me;Ae++)if(K=C,C=ce[2*(Ae+1)+1],!(++le<it&&K===C)){if(le<y)do{et(I,K,I.bl_tree)}while(0!=--le);else 0!==K?(K!==L&&(et(I,K,I.bl_tree),le--),et(I,16,I.bl_tree),cn(I,le-3,2)):le<=10?(et(I,17,I.bl_tree),cn(I,le-3,3)):(et(I,18,I.bl_tree),cn(I,le-11,7));le=0,L=K,0===C?(it=138,y=3):K===C?(it=6,y=3):(it=7,y=4)}}Ge(Zn);var To=!1;function Bi(I,ce,me,Ae){cn(I,0+(Ae?1:0),3),function go(I,ce,me,Ae){va(I),Ae&&(At(I,me),At(I,~me)),ve.arraySet(I.pending_buf,I.window,ce,me,I.pending),I.pending+=me}(I,ce,me,!0)}Ee._tr_init=function ts(I){To||(function ln(){var I,ce,me,Ae,L,K=new Array(Lt+1);for(me=0,Ae=0;Ae<28;Ae++)for(ot[Ae]=me,I=0;I<1<<ut[Ae];I++)kt[me++]=Ae;for(kt[me-1]=Ae,L=0,Ae=0;Ae<16;Ae++)for(Zn[Ae]=L,I=0;I<1<<tn[Ae];I++)Hn[L++]=Ae;for(L>>=7;Ae<30;Ae++)for(Zn[Ae]=L<<7,I=0;I<1<<tn[Ae]-7;I++)Hn[256+L++]=Ae;for(ce=0;ce<=Lt;ce++)K[ce]=0;for(I=0;I<=143;)qt[2*I+1]=8,I++,K[8]++;for(;I<=255;)qt[2*I+1]=9,I++,K[9]++;for(;I<=279;)qt[2*I+1]=7,I++,K[7]++;for(;I<=287;)qt[2*I+1]=8,I++,K[8]++;for(po(qt,287,K),I=0;I<30;I++)un[2*I+1]=5,un[2*I]=Xt(I,5);ho=new En(qt,ut,257,286,Lt),Nn=new En(un,tn,0,30,Lt),ur=new En(new Array(0),fn,0,19,7)}(),To=!0),I.l_desc=new Fn(I.dyn_ltree,ho),I.d_desc=new Fn(I.dyn_dtree,Nn),I.bl_desc=new Fn(I.bl_tree,ur),I.bi_buf=0,I.bi_valid=0,Tr(I)},Ee._tr_stored_block=Bi,Ee._tr_flush_block=function ko(I,ce,me,Ae){var L,K,C=0;I.level>0?(2===I.strm.data_type&&(I.strm.data_type=function di(I){var me,ce=4093624447;for(me=0;me<=31;me++,ce>>>=1)if(1&ce&&0!==I.dyn_ltree[2*me])return 0;if(0!==I.dyn_ltree[18]||0!==I.dyn_ltree[20]||0!==I.dyn_ltree[26])return 1;for(me=32;me<256;me++)if(0!==I.dyn_ltree[2*me])return 1;return 0}(I)),eo(I,I.l_desc),eo(I,I.d_desc),C=function mo(I){var ce;for(es(I,I.dyn_ltree,I.l_desc.max_code),es(I,I.dyn_dtree,I.d_desc.max_code),eo(I,I.bl_desc),ce=18;ce>=3&&0===I.bl_tree[2*vt[ce]+1];ce--);return I.opt_len+=3*(ce+1)+5+5+4,ce}(I),(K=I.static_len+3+7>>>3)<=(L=I.opt_len+3+7>>>3)&&(L=K)):L=K=me+5,me+4<=L&&-1!==ce?Bi(I,ce,me,Ae):4===I.strategy||K===L?(cn(I,2+(Ae?1:0),3),Rt(I,qt,un)):(cn(I,4+(Ae?1:0),3),function Li(I,ce,me,Ae){var L;for(cn(I,ce-257,5),cn(I,me-1,5),cn(I,Ae-4,4),L=0;L<Ae;L++)cn(I,I.bl_tree[2*vt[L]+1],3);Zo(I,I.dyn_ltree,ce-1),Zo(I,I.dyn_dtree,me-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,C+1),Rt(I,I.dyn_ltree,I.dyn_dtree)),Tr(I),Ae&&va(I)},Ee._tr_tally=function ns(I,ce,me){return I.pending_buf[I.d_buf+2*I.last_lit]=ce>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&ce,I.pending_buf[I.l_buf+I.last_lit]=255&me,I.last_lit++,0===ce?I.dyn_ltree[2*me]++:(I.matches++,ce--,I.dyn_ltree[2*(kt[me]+256+1)]++,I.dyn_dtree[2*Ht(ce)]++),I.last_lit===I.lit_bufsize-1},Ee._tr_align=function Pn(I){cn(I,2,3),et(I,256,qt),function Dr(I){16===I.bi_valid?(At(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):I.bi_valid>=8&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)}(I)}},629:vn=>{"use strict";vn.exports=function Ee(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},82:()=>{},318:()=>{},745:()=>{}},vn=>{vn(vn.s=126)}]);